/*
 Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2015 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc. */
var IS_CONCAT_BUILD=!0,BUILD_LMV_WORKER_URL="lmvworker.min.js",LMV_WORKER_URL=BUILD_LMV_WORKER_URL,ENABLE_DEBUG=!1,ENABLE_TRACE=!1,ENABLE_INLINE_WORKER=!0;AutodeskNamespace=function(a){var b=this;a=a.split(".");for(var c=0;c<a.length;++c)b[a[c]]=b[a[c]]||{},b=b[a[c]];return b};var _isIE11=!!navigator.userAgent.match(/Trident\/7\./);
"undefined"!==typeof window&&_isIE11&&function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var f=document.createEvent("CustomEvent");f.initCustomEvent(a,c.bubbles,c.cancelable,c.detail);return f}a.prototype=window.CustomEvent.prototype;window.CustomEvent=a}();
ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){!b||b>this.byteLength?b=this.byteLength:0>b&&(b=this.byteLength+b,0>b&&(b=0));0>a&&(a=this.byteLength+a,0>a&&(a=0));if(b<=a)return new ArrayBuffer;for(var c=b-a,f=new Uint8Array(this,a,c),g=new Uint8Array(c),d=0;d<c;d++)g[d]=f[d];return g.buffer});"undefined"!==typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);
function launchFullscreen(a,b){a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.webkitRequestFullscreen?a.webkitRequestFullscreen(b):a.msRequestFullscreen&&a.msRequestFullscreen(b)}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}
function inFullscreen(){return document.fullscreenEnabled||document.mozFullScreenElement||document.webkitIsFullScreen||document.msFullscreenElement?!0:!1}function fullscreenElement(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function isFullscreenAvailable(a){return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen}
function getAndroidVersion(a){a=a||navigator.userAgent;return(a=a.match(/Android\s([0-9\.]*)/))?a[1]:!1}function isTouchDevice(){return"ontouchstart"in window}function isIOSDevice(){return/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())}function isAndroidDevice(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")}function isMobileDevice(){return isIOSDevice()||isAndroidDevice()}
function detectWebGL(){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,f=0;4>f;f++)try{if((c=a.getContext(b[f]))&&"function"===typeof c.getParameter)return 1}catch(g){}return 0}return-1}function touchStartToClick(a){a.preventDefault();a.stopPropagation();a.target.click()}(function(){var a="undefined"!==typeof window&&null!==window?window:self;a.performance||(a.performance=Date)})();
"undefined"!==typeof window&&!function(a,b,c,f){function g(a,b,d){return setTimeout(q(a,d),b)}function d(a,b,d){return Array.isArray(a)?(h(a,d[b],d),!0):!1}function h(a,b,d){var c;if(a)if(a.forEach)a.forEach(b,d);else if(a.length!==f)for(c=0;c<a.length;)b.call(d,a[c],c,a),c++;else for(c in a)a.hasOwnProperty(c)&&b.call(d,a[c],c,a)}function k(a,b,d){for(var c=Object.keys(b),h=0;h<c.length;)(!d||d&&a[c[h]]===f)&&(a[c[h]]=b[c[h]]),h++;return a}function m(a,b){return k(a,b,!0)}function n(a,b,d){var c=
b.prototype;b=a.prototype=Object.create(c);b.constructor=a;b._super=c;d&&k(b,d)}function q(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==Fa?a.apply(b?b[0]||f:f,b):a}function p(a,b,d){h(C(b),function(b){a.addEventListener(b,d,!1)})}function r(a,b,d){h(C(b),function(b){a.removeEventListener(b,d,!1)})}function A(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function C(a){return a.trim().split(/\s+/g)}function H(a,b,d){if(a.indexOf&&!d)return a.indexOf(b);
for(var c=0;c<a.length;){if(d&&a[c][d]==b||!d&&a[c]===b)return c;c++}return-1}function z(a){return Array.prototype.slice.call(a,0)}function t(a,b,d){for(var c=[],h=[],g=0;g<a.length;){var f=b?a[g][b]:a[g];0>H(h,f)&&c.push(a[g]);h[g]=f;g++}return d&&(c=b?c.sort(function(a,d){return a[b]>d[b]}):c.sort()),c}function w(a,b){for(var d,c,h=b[0].toUpperCase()+b.slice(1),g=0;g<Ha.length;){if(d=Ha[g],c=d?d+h:b,c in a)return c;g++}return f}function E(a){a=a.ownerDocument;return a.defaultView||a.parentWindow}
function B(a,b){var d=this;this.manager=a;this.callback=b;this.element=a.element;this.target=a.options.inputTarget;this.domHandler=function(b){l(a.options.enable,[a])&&d.handler(b)};this.init()}function D(a){var b=a.options.inputClass;return new (b?b:Aa?O:Ea?X:Da?aa:K)(a,J)}function J(a,b,d){var c=d.pointers.length,h=d.changedPointers.length,g=b&na&&0===c-h,c=b&(ga|ja)&&0===c-h;d.isFirst=!!g;d.isFinal=!!c;g&&(a.session={});d.eventType=b;b=a.session;g=d.pointers;c=g.length;b.firstInput||(b.firstInput=
F(d));1<c&&!b.firstMultiple?b.firstMultiple=F(d):1===c&&(b.firstMultiple=!1);var h=b.firstInput,k=(c=b.firstMultiple)?c.center:h.center,m=d.center=G(g);d.timeStamp=Ka();d.deltaTime=d.timeStamp-h.timeStamp;d.angle=L(k,m);d.distance=I(k,m);var h=d.center,k=b.offsetDelta||{},m=b.prevDelta||{},n=b.prevInput||{};(d.eventType===na||n.eventType===ga)&&(m=b.prevDelta={x:n.deltaX||0,y:n.deltaY||0},k=b.offsetDelta={x:h.x,y:h.y});d.deltaX=m.x+(h.x-k.x);d.deltaY=m.y+(h.y-k.y);d.offsetDirection=M(d.deltaX,d.deltaY);
c?(h=c.pointers,h=I(g[0],g[1],ka)/I(h[0],h[1],ka)):h=1;d.scale=h;c?(c=c.pointers,g=L(g[1],g[0],ka)-L(c[1],c[0],ka)):g=0;d.rotation=g;m=b.lastInterval||d;g=d.timeStamp-m.timeStamp;d.eventType!=ja&&(g>Na||m.velocity===f)?(h=m.deltaX-d.deltaX,m=m.deltaY-d.deltaY,k={x:h/g||0,y:m/g||0},g=k.x,c=k.y,k=xa(k.x)>xa(k.y)?k.x:k.y,h=M(h,m),b.lastInterval=d):(k=m.velocity,g=m.velocityX,c=m.velocityY,h=m.direction);d.velocity=k;d.velocityX=g;d.velocityY=c;d.direction=h;b=a.element;A(d.srcEvent.target,b)&&(b=d.srcEvent.target);
d.target=b;a.emit("hammer.input",d);a.recognize(d);a.session.prevInput=d}function F(a){for(var b=[],d=0;d<a.pointers.length;)b[d]={clientX:qa(a.pointers[d].clientX),clientY:qa(a.pointers[d].clientY)},d++;return{timeStamp:Ka(),pointers:b,center:G(b),deltaX:a.deltaX,deltaY:a.deltaY}}function G(a){var b=a.length;if(1===b)return{x:qa(a[0].clientX),y:qa(a[0].clientY)};for(var d=0,c=0,h=0;b>h;)d+=a[h].clientX,c+=a[h].clientY,h++;return{x:qa(d/b),y:qa(c/b)}}function M(a,b){return a===b?Ga:xa(a)>=xa(b)?0<
a?Oa:v:0<b?ya:wa}function I(a,b,d){d||(d=Sa);var c=b[d[0]]-a[d[0]];a=b[d[1]]-a[d[1]];return Math.sqrt(c*c+a*a)}function L(a,b,d){d||(d=Sa);return 180*Math.atan2(b[d[1]]-a[d[1]],b[d[0]]-a[d[0]])/Math.PI}function K(){this.evEl=bb;this.evWin=Ta;this.allow=!0;this.pressed=!1;B.apply(this,arguments)}function O(){this.evEl=Ua;this.evWin=cb;B.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}function R(){this.evTarget=Va;this.evWin=mb;this.started=!1;B.apply(this,arguments)}function X(){this.evTarget=
nb;this.targetIds={};B.apply(this,arguments)}function W(a,b){var d=z(a.touches),c=this.targetIds;if(b&(na|oa)&&1===d.length)return c[d[0].identifier]=!0,[d,d];var h,g=z(a.changedTouches),f=[],k=this.target;if(h=d.filter(function(a){return A(a.target,k)}),b===na)for(d=0;d<h.length;)c[h[d].identifier]=!0,d++;for(d=0;d<g.length;)c[g[d].identifier]&&f.push(g[d]),b&(ga|ja)&&delete c[g[d].identifier],d++;return f.length?[t(h.concat(f),"identifier",!0),f]:void 0}function aa(){B.apply(this,arguments);var a=
q(this.handler,this);this.touch=new X(this.manager,a);this.mouse=new K(this.manager,a)}function fa(a,b){this.manager=a;this.set(b)}function U(a){if(-1<a.indexOf(Ra))return Ra;var b=-1<a.indexOf(Pa),d=-1<a.indexOf(Ia);return b&&d?Pa+" "+Ia:b||d?b?Pa:Ia:-1<a.indexOf(Xa)?Xa:db}function P(a){this.id=Ja++;this.manager=null;this.options=m(a||{},this.defaults);a=this.options.enable;this.options.enable=a===f?!0:a;this.state=Wa;this.simultaneous={};this.requireFail=[]}function Z(a){return a==wa?"down":a==
ya?"up":a==Oa?"left":a==v?"right":""}function S(a,b){var d=b.manager;return d?d.get(a):a}function N(){P.apply(this,arguments)}function ia(){N.apply(this,arguments);this.pY=this.pX=null}function ea(){N.apply(this,arguments)}function V(){P.apply(this,arguments);this._input=this._timer=null}function ca(){N.apply(this,arguments)}function Y(){N.apply(this,arguments)}function sa(){P.apply(this,arguments);this.pCenter=this.pTime=!1;this._input=this._timer=null;this.count=0}function ha(a,b){b=b||{};var d=
b.recognizers;return b.recognizers=d===f?ha.defaults.preset:d,new da(a,b)}function da(a,b){b=b||{};this.options=m(b,ha.defaults);this.options.inputTarget=this.options.inputTarget||a;this.handlers={};this.session={};this.recognizers=[];this.element=a;this.input=D(this);this.touchAction=new fa(this,this.options.touchAction);ba(this,!0);h(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]);a[3]&&b.requireFailure(a[3])},this)}function ba(a,b){var d=a.element;h(a.options.cssProps,
function(a,c){d.style[w(d.style,c)]=b?a:""})}function za(a,d){var c=b.createEvent("Event");c.initEvent(a,!0,!0);c.gesture=d;d.target.dispatchEvent(c)}var Ha=" webkit moz MS ms o".split(" "),la=b.createElement("div"),Fa="function",qa=Math.round,xa=Math.abs,Ka=Date.now,Ja=1,Ba=/mobile|tablet|ip(ad|hone|od)|android/i,Da="ontouchstart"in a,Aa=w(a,"PointerEvent")!==f,Ea=Da&&Ba.test(navigator.userAgent),Na=25,na=1,oa=2,ga=4,ja=8,Ga=1,Oa=2,v=4,ya=8,wa=16,ua=Oa|v,Ma=ya|wa,Ba=ua|Ma,Sa=["x","y"],ka=["clientX",
"clientY"];B.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler);this.evTarget&&p(this.target,this.evTarget,this.domHandler);this.evWin&&p(E(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&r(this.element,this.evEl,this.domHandler);this.evTarget&&r(this.target,this.evTarget,this.domHandler);this.evWin&&r(E(this.element),this.evWin,this.domHandler)}};var ma={mousedown:na,mousemove:oa,mouseup:ga},bb="mousedown",Ta="mousemove mouseup";
n(K,B,{handler:function(a){var b=ma[a.type];b&na&&0===a.button&&(this.pressed=!0);b&oa&&1!==a.which&&(b=ga);this.pressed&&this.allow&&(b&ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:"mouse",srcEvent:a}))}});var eb={pointerdown:na,pointermove:oa,pointerup:ga,pointercancel:ja,pointerout:ja},hb={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ua="pointerdown",cb="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ua="MSPointerDown",cb="MSPointerMove MSPointerUp MSPointerCancel");
n(O,B,{handler:function(a){var b=this.store,d=!1,c=a.type.toLowerCase().replace("ms",""),c=eb[c],h=hb[a.pointerType]||a.pointerType,g="touch"==h,f=H(b,a.pointerId,"pointerId");c&na&&(0===a.button||g)?0>f&&(b.push(a),f=b.length-1):c&(ga|ja)&&(d=!0);0>f||(b[f]=a,this.callback(this.manager,c,{pointers:b,changedPointers:[a],pointerType:h,srcEvent:a}),d&&b.splice(f,1))}});var fb={touchstart:na,touchmove:oa,touchend:ga,touchcancel:ja},Va="touchstart",mb="touchstart touchmove touchend touchcancel";n(R,B,
{handler:function(a){var b=fb[a.type];if(b===na&&(this.started=!0),this.started){var d,c=z(a.touches);d=z(a.changedTouches);d=(b&(ga|ja)&&(c=t(c.concat(d),"identifier",!0)),[c,d]);b&(ga|ja)&&0===d[0].length-d[1].length&&(this.started=!1);this.callback(this.manager,b,{pointers:d[0],changedPointers:d[1],pointerType:"touch",srcEvent:a})}}});var ib={touchstart:na,touchmove:oa,touchend:ga,touchcancel:ja},nb="touchstart touchmove touchend touchcancel";n(X,B,{handler:function(a){var b=ib[a.type],d=W.call(this,
a,b);d&&this.callback(this.manager,b,{pointers:d[0],changedPointers:d[1],pointerType:"touch",srcEvent:a})}});n(aa,B,{handler:function(a,b,d){var c="mouse"==d.pointerType;if("touch"==d.pointerType)this.mouse.allow=!1;else if(c&&!this.mouse.allow)return;b&(ga|ja)&&(this.mouse.allow=!0);this.callback(a,b,d)},destroy:function(){this.touch.destroy();this.mouse.destroy()}});var jb=w(la.style,"touchAction"),Ya=jb!==f,db="auto",Xa="manipulation",Ra="none",Pa="pan-x",Ia="pan-y";fa.prototype={set:function(a){"compute"==
a&&(a=this.compute());Ya&&(this.manager.element.style[jb]=a);this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return h(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){if(!Ya){var b=a.srcEvent;a=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,c=-1<d.indexOf(Ra),h=-1<d.indexOf(Ia),
d=-1<d.indexOf(Pa);return c||h&&a&ua||d&&a&Ma?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0;a.preventDefault()}};var Wa=1;P.prototype={defaults:{},set:function(a){return k(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(d(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=S(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return d(a,"dropRecognizeWith",
this)?this:(a=S(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(d(a,"requireFailure",this))return this;var b=this.requireFail;return a=S(a,this),-1===H(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(d(a,"dropRequireFailure",this))return this;a=S(a,this);a=H(this.requireFail,a);return-1<a&&this.requireFail.splice(a,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},
emit:function(a){function b(h){d.manager.emit(d.options.event+(h?c&16?"cancel":c&8?"end":c&4?"move":c&2?"start":"":""),a)}var d=this,c=this.state;8>c&&b(!0);b();8<=c&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=32)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(32|Wa)))return!1;a++}return!0},recognize:function(a){a=k({},a);return l(this.options.enable,[this,a])?(this.state&56&&(this.state=Wa),this.state=this.process(a),
void(this.state&30&&this.tryEmit(a))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}};n(N,P,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,d=a.eventType,c=b&6;a=this.attrTest(a);return c&&(d&ja||!a)?b|16:c||a?d&ga?b|8:b&2?b|4:2:32}});n(ia,N,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ba},getTouchAction:function(){var a=this.options.direction,
b=[];return a&ua&&b.push(Ia),a&Ma&&b.push(Pa),b},directionTest:function(a){var b=this.options,d=!0,c=a.distance,h=a.direction,g=a.deltaX,f=a.deltaY;return h&b.direction||(b.direction&ua?(h=0===g?Ga:0>g?Oa:v,d=g!=this.pX,c=Math.abs(a.deltaX)):(h=0===f?Ga:0>f?ya:wa,d=f!=this.pY,c=Math.abs(a.deltaY))),a.direction=h,d&&c>b.threshold&&h&b.direction},attrTest:function(a){return N.prototype.attrTest.call(this,a)&&(this.state&2||!(this.state&2)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX;this.pY=
a.deltaY;var b=Z(a.direction);b&&this.manager.emit(this.options.event+b,a);this._super.emit.call(this,a)}});n(ea,N,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ra]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&2)},emit:function(a){(this._super.emit.call(this,a),1!==a.scale)&&this.manager.emit(this.options.event+(1>a.scale?"in":"out"),a)}});n(V,P,{defaults:{event:"press",pointers:1,time:500,
threshold:5},getTouchAction:function(){return[db]},process:function(a){var b=this.options,d=a.pointers.length===b.pointers,c=a.distance<b.threshold,h=a.deltaTime>b.time;if(this._input=a,!c||!d||a.eventType&(ga|ja)&&!h)this.reset();else if(a.eventType&na)this.reset(),this._timer=g(function(){this.state=8;this.tryEmit()},b.time,this);else if(a.eventType&ga)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(a){8===this.state&&(a&&a.eventType&ga?this.manager.emit(this.options.event+
"up",a):(this._input.timeStamp=Ka(),this.manager.emit(this.options.event,this._input)))}});n(ca,N,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ra]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&2)}});n(Y,N,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:ua|Ma,pointers:1},getTouchAction:function(){return ia.prototype.getTouchAction.call(this)},attrTest:function(a){var b,d=this.options.direction;
return d&(ua|Ma)?b=a.velocity:d&ua?b=a.velocityX:d&Ma&&(b=a.velocityY),this._super.attrTest.call(this,a)&&d&a.direction&&a.distance>this.options.threshold&&xa(b)>this.options.velocity&&a.eventType&ga},emit:function(a){var b=Z(a.direction);b&&this.manager.emit(this.options.event+b,a);this.manager.emit(this.options.event,a)}});n(sa,P,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Xa]},process:function(a){var b=this.options,
d=a.pointers.length===b.pointers,c=a.distance<b.threshold,h=a.deltaTime<b.time;if(this.reset(),a.eventType&na&&0===this.count)return this.failTimeout();if(c&&h&&d){if(a.eventType!=ga)return this.failTimeout();d=this.pTime?a.timeStamp-this.pTime<b.interval:!0;c=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp;this.pCenter=a.center;c&&d?this.count+=1:this.count=1;this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=g(function(){this.state=
8;this.tryEmit()},b.interval,this),2):8}return 32},failTimeout:function(){return this._timer=g(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});ha.VERSION="2.0.4";ha.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ca,{enable:!1}],[ea,{enable:!1},["rotate"]],[Y,{direction:ua}],[ia,
{direction:ua},["swipe"]],[sa],[sa,{event:"doubletap",taps:2},["tap"]],[V]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};da.prototype={set:function(a){return k(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);
var d,c=this.recognizers,h=b.curRecognizer;(!h||h&&h.state&8)&&(h=b.curRecognizer=null);for(var g=0;g<c.length;)d=c[g],2===b.stopped||h&&d!=h&&!d.canRecognizeWith(h)?d.reset():d.recognize(a),!h&&d.state&14&&(h=b.curRecognizer=d),g++}},get:function(a){if(a instanceof P)return a;for(var b=this.recognizers,d=0;d<b.length;d++)if(b[d].options.event==a)return b[d];return null},add:function(a){if(d(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),
a.manager=this,this.touchAction.update(),a},remove:function(a){if(d(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(H(b,a),1),this.touchAction.update(),this},on:function(a,b){var d=this.handlers;return h(C(a),function(a){d[a]=d[a]||[];d[a].push(b)}),this},off:function(a,b){var d=this.handlers;return h(C(a),function(a){b?d[a].splice(H(d[a],b),1):delete d[a]}),this},emit:function(a,b){this.options.domEvents&&za(a,b);var d=this.handlers[a]&&this.handlers[a].slice();
if(d&&d.length){b.type=a;b.preventDefault=function(){b.srcEvent.preventDefault()};for(var c=0;c<d.length;)d[c](b),c++}},destroy:function(){this.element&&ba(this,!1);this.handlers={};this.session={};this.input.destroy();this.element=null}};k(ha,{INPUT_START:na,INPUT_MOVE:oa,INPUT_END:ga,INPUT_CANCEL:ja,STATE_POSSIBLE:Wa,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:Ga,DIRECTION_LEFT:Oa,DIRECTION_RIGHT:v,DIRECTION_UP:ya,DIRECTION_DOWN:wa,
DIRECTION_HORIZONTAL:ua,DIRECTION_VERTICAL:Ma,DIRECTION_ALL:Ba,Manager:da,Input:B,TouchAction:fa,TouchInput:X,MouseInput:K,PointerEventInput:O,TouchMouseInput:aa,SingleTouchInput:R,Recognizer:P,AttrRecognizer:N,Tap:sa,Pan:ia,Swipe:Y,Pinch:ea,Rotate:ca,Press:V,on:p,off:r,each:h,merge:m,extend:k,inherit:n,bindFn:q,prefixed:w});a[c]=ha}(window,document,"Hammer");
function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse};THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype);THREE.DDSLoader.prototype.constructor=THREE.DDSLoader;THREE.DDSLoader.parse=function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a,b,d,c){var h=d*c*4;a=new Uint8Array(a,b,h);for(var h=new Uint8Array(h),g=b=0,f=0;f<c;f++)for(var k=0;k<d;k++){var m=a[g];
g++;var n=a[g];g++;var l=a[g];g++;var q=a[g];g++;h[b]=l;b++;h[b]=n;b++;h[b]=m;b++;h[b]=q;b++}return h}var g={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},d=c("DXT1"),h=c("DXT3"),k=c("DXT5"),m=new Int32Array(a,0,31);if(542327876!==m[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),g;if(!m[20]&4)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),g;var n=m[21],q=!1;switch(n){case d:d=8;g.format=THREE.RGB_S3TC_DXT1_Format;
break;case h:d=16;g.format=THREE.RGBA_S3TC_DXT3_Format;break;case k:d=16;g.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(32==m[22]&&m[23]&16711680&&m[24]&65280&&m[25]&255&&m[26]&4278190080)q=!0,d=64,g.format=THREE.RGBAFormat;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",String.fromCharCode(n&255,n>>8&255,n>>16&255,n>>24&255)),g}g.mipmapCount=1;m[2]&131072&&!1!==b&&(g.mipmapCount=Math.max(1,m[7]));g.isCubemap=m[28]&512?!0:!1;g.width=m[4];g.height=m[3];for(var m=
m[1]+4,h=g.width,k=g.height,n=g.isCubemap?6:1,l=0;l<n;l++){for(var p=0;p<g.mipmapCount;p++){if(q)var r=f(a,m,h,k),A=r.length;else A=Math.max(4,h)/4*Math.max(4,k)/4*d,r=new Uint8Array(a,m,A);g.mipmaps.push({data:r,width:h,height:k});m+=A;h=Math.max(.5*h,1);k=Math.max(.5*k,1)}h=g.width;k=g.height}return g}}
!function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.lmv_poly2tri=a()}(function(){return function b(c,f,g){function d(k,n){if(!f[k]){if(!c[k]){var q="function"==typeof require&&require;if(!n&&q)return q(k,!0);if(h)return h(k,!0);throw Error("Cannot find module '"+k+"'");}q=f[k]={exports:{}};c[k][0].call(q.exports,function(b){var h=c[k][1][b];return d(h?h:b)},q,q.exports,b,c,f,g)}return f[k].exports}for(var h="function"==typeof require&&
require,k=0;k<g.length;k++)d(g[k]);return d}({1:[function(b,c,f){c.exports={version:"1.3.5"}},{}],2:[function(b,c,f){b=function(b,d){this.head_=b;this.tail_=d;this.search_node_=b};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.search=function(){return this.search_node_};b.prototype.setSearch=function(b){this.search_node_=b};b.prototype.findSearchNode=
function(){return this.search_node_};b.prototype.locateNode=function(b){var d=this.search_node_;if(b<d.value)for(;d=d.prev;){if(b>=d.value)return this.search_node_=d}else for(;d=d.next;)if(b<d.value)return this.search_node_=d.prev;return null};b.prototype.locatePoint=function(b){var d=b.x,c=this.findSearchNode(d),f=c.point.x;if(d===f){if(b!==c.point)if(b===c.prev.point)c=c.prev;else if(b===c.next.point)c=c.next;else throw Error("poly2tri Invalid AdvancingFront.locatePoint() call");}else if(d<f)for(;(c=
c.prev)&&b!==c.point;);else for(;(c=c.next)&&b!==c.point;);c&&(this.search_node_=c);return c};c.exports=b;c.exports.Node=function(b,d){this.point=b;this.triangle=d||null;this.prev=this.next=null;this.value=b.x}},{}],3:[function(b,c,f){c.exports=function(b,d){if(!b)throw Error(d||"Assert Failed");}},{}],4:[function(b,c,f){var g=b("./xy"),d=function(b,d){this.x=+b||0;this.y=+d||0;this._p2t_edge_list=null};d.prototype.toString=function(){return g.toStringBase(this)};d.prototype.toJSON=function(){return{x:this.x,
y:this.y}};d.prototype.clone=function(){return new d(this.x,this.y)};d.prototype.set_zero=function(){this.y=this.x=0;return this};d.prototype.set=function(b,d){this.x=+b||0;this.y=+d||0;return this};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};d.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};d.prototype.sub=function(b){this.x-=b.x;this.y-=b.y;return this};d.prototype.mul=function(b){this.x*=b;this.y*=b;return this};d.prototype.length=function(){return Math.sqrt(this.x*
this.x+this.y*this.y)};d.prototype.normalize=function(){var b=this.length();this.x/=b;this.y/=b;return b};d.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};d.negate=function(b){return new d(-b.x,-b.y)};d.add=function(b,c){return new d(b.x+c.x,b.y+c.y)};d.sub=function(b,c){return new d(b.x-c.x,b.y-c.y)};d.mul=function(b,c){return new d(b*c.x,b*c.y)};d.cross=function(b,c){return"number"===typeof b?"number"===typeof c?b*c:new d(-b*c.y,b*c.x):"number"===typeof c?new d(c*b.y,-c*b.x):b.x*
c.y-b.y*c.x};d.toString=g.toString;d.compare=g.compare;d.cmp=g.compare;d.equals=g.equals;d.dot=function(b,d){return b.x*d.x+b.y*d.y};c.exports=d},{"./xy":11}],5:[function(b,c,f){var g=b("./xy");b=function(b,c){this.name="PointError";this.points=c=c||[];this.message=b||"Invalid Points!";for(var f=0;f<c.length;f++)this.message+=" "+g.toString(c[f])};b.prototype=Error();b.prototype.constructor=b;c.exports=b},{"./xy":11}],6:[function(b,c,f){(function(c){var d=c.poly2tri;f.noConflict=function(){c.poly2tri=
d;return f};f.VERSION=b("../dist/version.json").version;f.PointError=b("./pointerror");f.Point=b("./point");f.Triangle=b("./triangle");f.SweepContext=b("./sweepcontext");var h=b("./sweep");f.triangulate=h.triangulate;f.sweep={Triangulate:h.triangulate}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(b,c,f){function g(b,c,h,f,k){if(!d(f,c,h)){var m=f.pointCCW(k),
n=G(h,m,c);if(n===F.COLLINEAR)throw new E("poly2tri EdgeEvent: Collinear not supported!",[h,m,c]);var m=f.pointCW(k),l=G(h,m,c);if(l===F.COLLINEAR)throw new E("poly2tri EdgeEvent: Collinear not supported!",[h,m,c]);n===l?(f=n===F.CW?f.neighborCCW(k):f.neighborCW(k),g(b,c,h,f,k)):H(b,c,h,f,k)}}function d(b,d,c){var h=b.edgeIndex(d,c);return-1!==h?(b.markConstrainedEdgeByIndex(h),(b=b.getNeighbor(h))&&b.markConstrainedEdgeByPoints(d,c),!0):!1}function h(b,d){var c=new B(d.prev.point,d.point,d.next.point);
c.markNeighbor(d.prev.triangle);c.markNeighbor(d.triangle);b.addToMap(c);d.prev.next=d.next;d.next.prev=d.prev;k(b,c)||b.mapTriangleToNodes(c)}function k(b,d){for(var c=0;3>c;++c)if(!d.delaunay_edge[c]){var h=d.getNeighbor(c);if(h){var g=d.getPoint(c),f=h.oppositePoint(d,g),n=h.index(f);if(h.constrained_edge[n]||h.delaunay_edge[n])d.constrained_edge[c]=h.constrained_edge[n];else{var l;var z=d.pointCCW(g),q=d.pointCW(g);l=g.x-f.x;var w=g.y-f.y,t=z.x-f.x,z=z.y-f.y,E=l*z-t*w;if(0>=E)l=!1;else{var r=
q.x-f.x,q=q.y-f.y,p=r*w-l*q;l=0>=p?!1:0<(l*l+w*w)*(t*q-r*z)+(t*t+z*z)*p+(r*r+q*q)*E}if(l)return d.delaunay_edge[c]=!0,h.delaunay_edge[n]=!0,m(d,g,h,f),(g=!k(b,d))&&b.mapTriangleToNodes(d),(g=!k(b,h))&&b.mapTriangleToNodes(h),d.delaunay_edge[c]=!1,h.delaunay_edge[n]=!1,!0}}}return!1}function m(b,d,c,h){var g,f,k,m;g=b.neighborCCW(d);f=b.neighborCW(d);k=c.neighborCCW(h);m=c.neighborCW(h);var n,l,z,q;n=b.getConstrainedEdgeCCW(d);l=b.getConstrainedEdgeCW(d);z=c.getConstrainedEdgeCCW(h);q=c.getConstrainedEdgeCW(h);
var w,t,E,r;w=b.getDelaunayEdgeCCW(d);t=b.getDelaunayEdgeCW(d);E=c.getDelaunayEdgeCCW(h);r=c.getDelaunayEdgeCW(h);b.legalize(d,h);c.legalize(h,d);c.setDelaunayEdgeCCW(d,w);b.setDelaunayEdgeCW(d,t);b.setDelaunayEdgeCCW(h,E);c.setDelaunayEdgeCW(h,r);c.setConstrainedEdgeCCW(d,n);b.setConstrainedEdgeCW(d,l);b.setConstrainedEdgeCCW(h,z);c.setConstrainedEdgeCW(h,q);b.clearNeighbors();c.clearNeighbors();g&&c.markNeighbor(g);f&&b.markNeighbor(f);k&&b.markNeighbor(k);m&&c.markNeighbor(m);b.markNeighbor(c)}
function n(b,d){var c;c=b.basin.width>(b.basin.left_highest?b.basin.left_node.point.y-d.point.y:b.basin.right_node.point.y-d.point.y)?!0:!1;if(!c&&(h(b,d),d.prev!==b.basin.left_node||d.next!==b.basin.right_node)){if(d.prev===b.basin.left_node){c=G(d.point,d.next.point,d.next.next.point);if(c===F.CW)return;d=d.next}else if(d.next===b.basin.right_node){c=G(d.point,d.prev.point,d.prev.prev.point);if(c===F.CCW)return;d=d.prev}else d=d.prev.point.y<d.next.point.y?d.prev:d.next;n(b,d)}}function q(b,d,c){c.point.x<
d.p.x&&(G(c.point,c.next.point,c.next.next.point)===F.CCW?l(b,d,c):(p(b,d,c),q(b,d,c)))}function l(b,d,c){h(b,c.next);c.next.point!==d.p&&G(d.q,c.next.point,d.p)===F.CCW&&G(c.point,c.next.point,c.next.next.point)===F.CCW&&l(b,d,c)}function p(b,d,c){G(c.next.point,c.next.next.point,c.next.next.next.point)===F.CCW?l(b,d,c.next):G(d.q,c.next.next.point,d.p)===F.CCW&&p(b,d,c.next)}function r(b,d,c){c.point.x>d.p.x&&(G(c.point,c.prev.point,c.prev.prev.point)===F.CW?C(b,d,c):(A(b,d,c),r(b,d,c)))}function A(b,
d,c){G(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===F.CW?C(b,d,c.prev):G(d.q,c.prev.prev.point,d.p)===F.CW&&A(b,d,c.prev)}function C(b,d,c){h(b,c.prev);c.prev.point!==d.p&&G(d.q,c.prev.point,d.p)===F.CW&&G(c.point,c.prev.point,c.prev.prev.point)===F.CW&&C(b,d,c)}function H(b,d,c,h,f){var n=h.neighborAcross(f);w(n,"FLIP failed due to missing triangle!");var l=n.oppositePoint(h,f);if(h.getConstrainedEdgeAcross(f))throw b=h.index(f),new E("poly2tri Intersecting Constraints",[f,l,h.getPoint((b+
1)%3),h.getPoint((b+2)%3)]);if(M(f,h.pointCCW(f),h.pointCW(f),l))if(m(h,f,n,l),b.mapTriangleToNodes(h),b.mapTriangleToNodes(n),f===c&&l===d)c===b.edge_event.constrained_edge.q&&d===b.edge_event.constrained_edge.p&&(h.markConstrainedEdgeByPoints(d,c),n.markConstrainedEdgeByPoints(d,c),k(b,h),k(b,n));else{var q=G(c,l,d);q===F.CCW?(l=n.edgeIndex(f,l),n.delaunay_edge[l]=!0,k(b,n),n.clearDelaunayEdges()):(l=h.edgeIndex(f,l),h.delaunay_edge[l]=!0,k(b,h),h.clearDelaunayEdges(),h=n);H(b,d,c,h,f)}else l=z(d,
c,n,l),t(b,d,c,h,n,l),g(b,d,c,h,f)}function z(b,d,c,h){var g=G(d,h,b);if(g===F.CW)return c.pointCCW(h);if(g===F.CCW)return c.pointCW(h);throw new E("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[d,h,b]);}function t(b,d,c,h,g,f){var k=g.neighborAcross(f);w(k,"FLIP failed due to missing triangle");g=k.oppositePoint(g,f);M(c,h.pointCCW(c),h.pointCW(c),g)?H(b,c,g,k,g):(g=z(d,c,k,g),t(b,d,c,h,k,g))}var w=b("./assert"),E=b("./pointerror"),B=b("./triangle"),D=b("./advancingfront").Node;
b=b("./utils");var J=b.EPSILON,F=b.Orientation,G=b.orient2d,M=b.inScanArea,I=b.isAngleObtuse;f.triangulate=function(b){b.initTriangulation();b.createAdvancingFront();var c,f=b.pointCount();for(c=1;c<f;++c){var m=b.getPoint(c),l;l=b;var z=m,t=l.locateNode(z),E=void 0,E=new B(z,t.point,t.next.point);E.markNeighbor(t.triangle);l.addToMap(E);var p=new D(z);p.next=t.next;p.prev=t;t.next.prev=p;t.next=p;k(l,E)||l.mapTriangleToNodes(E);E=p;z.x<=t.point.x+J&&h(l,t);for(z=E.next;z.next&&!I(z.point,z.next.point,
z.prev.point);)h(l,z),z=z.next;for(z=E.prev;z.prev&&!I(z.point,z.next.point,z.prev.point);)h(l,z),z=z.prev;if(E.next&&E.next.next&&(z=E.point.x-E.next.next.point.x,t=E.point.y-E.next.next.point.y,w(0<=t,"unordered y"),0<=z||Math.abs(z)<t)){z=E;G(z.point,z.next.point,z.next.next.point)===F.CCW?l.basin.left_node=z.next.next:l.basin.left_node=z.next;for(l.basin.bottom_node=l.basin.left_node;l.basin.bottom_node.next&&l.basin.bottom_node.point.y>=l.basin.bottom_node.next.point.y;)l.basin.bottom_node=l.basin.bottom_node.next;
if(l.basin.bottom_node!==l.basin.left_node){for(l.basin.right_node=l.basin.bottom_node;l.basin.right_node.next&&l.basin.right_node.point.y<l.basin.right_node.next.point.y;)l.basin.right_node=l.basin.right_node.next;l.basin.right_node!==l.basin.bottom_node&&(l.basin.width=l.basin.right_node.point.x-l.basin.left_node.point.x,l.basin.left_highest=l.basin.left_node.point.y>l.basin.right_node.point.y,n(l,l.basin.bottom_node))}}l=E;m=m._p2t_edge_list;for(E=0;m&&E<m.length;++E)if(z=b,t=m[E],p=l,z.edge_event.constrained_edge=
t,z.edge_event.right=t.p.x>t.q.x,!d(p.triangle,t.p,t.q)){if(z.edge_event.right)for(var H=z,C=t,A=p;A.next.point.x<C.p.x;)G(C.q,A.next.point,C.p)===F.CCW?q(H,C,A):A=A.next;else for(H=z,C=t,A=p;A.prev.point.x>C.p.x;)G(C.q,A.prev.point,C.p)===F.CW?r(H,C,A):A=A.prev;g(z,t.p,t.q,p.triangle,t.q)}}c=b.front().head().next.triangle;for(f=b.front().head().next.point;!c.getConstrainedEdgeCW(f);)c=c.neighborCCW(f);b.meshClean(c)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],
8:[function(b,c,f){var g=b("./pointerror"),d=b("./point"),h=b("./triangle"),k=b("./sweep"),m=b("./advancingfront"),n=m.Node,q=function(b,d){this.p=b;this.q=d;if(b.y>d.y)this.q=b,this.p=d;else if(b.y===d.y)if(b.x>d.x)this.q=b,this.p=d;else if(b.x===d.x)throw new g("poly2tri Invalid Edge constructor: repeated points!",[b]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]);this.q._p2t_edge_list.push(this)},l=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=
!1};l.prototype.clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};var p=function(){this.constrained_edge=null;this.right=!1};b=function(b,d){d=d||{};this.triangles_=[];this.map_=[];this.points_=d.cloneArrays?b.slice(0):b;this.edge_list=[];this.af_tail_=this.af_middle_=this.af_head_=this.tail_=this.head_=this.front_=this.pmin_=this.pmax_=null;this.basin=new l;this.edge_event=new p;this.initEdges(this.points_)};b.prototype.addHole=function(b){this.initEdges(b);
var d,c=b.length;for(d=0;d<c;d++)this.points_.push(b[d]);return this};b.prototype.AddHole=b.prototype.addHole;b.prototype.addHoles=function(b){var d,c=b.length;for(d=0;d<c;d++)this.initEdges(b[d]);this.points_=this.points_.concat.apply(this.points_,b);return this};b.prototype.addPoint=function(b){this.points_.push(b);return this};b.prototype.AddPoint=b.prototype.addPoint;b.prototype.addPoints=function(b){this.points_=this.points_.concat(b);return this};b.prototype.triangulate=function(){k.triangulate(this);
return this};b.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};b.prototype.getTriangles=function(){return this.triangles_};b.prototype.GetTriangles=b.prototype.getTriangles;b.prototype.front=function(){return this.front_};b.prototype.pointCount=function(){return this.points_.length};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.getMap=
function(){return this.map_};b.prototype.initTriangulation=function(){var b=this.points_[0].x,c=this.points_[0].x,h=this.points_[0].y,g=this.points_[0].y,f,k=this.points_.length;for(f=1;f<k;f++){var l=this.points_[f];l.x>b&&(b=l.x);l.x<c&&(c=l.x);l.y>h&&(h=l.y);l.y<g&&(g=l.y)}this.pmin_=new d(c,g);this.pmax_=new d(b,h);f=.3*(b-c);h=.3*(h-g);this.head_=new d(b+f,g-h);this.tail_=new d(c-f,g-h);this.points_.sort(d.compare)};b.prototype.initEdges=function(b,d){var c,h=b.length,g=d?b.length-1:b.length;
for(c=0;c<g;++c)this.edge_list.push(new q(b[c],b[(c+1)%h]))};b.prototype.getPoint=function(b){return this.points_[b]};b.prototype.addToMap=function(b){this.map_.push(b)};b.prototype.locateNode=function(b){return this.front_.locateNode(b.x)};b.prototype.createAdvancingFront=function(){var b,d,c;c=new h(this.points_[0],this.tail_,this.head_);this.map_.push(c);b=new n(c.getPoint(1),c);d=new n(c.getPoint(0),c);c=new n(c.getPoint(2));this.front_=new m(b,c);b.next=d;d.next=c;d.prev=b;c.prev=d};b.prototype.removeNode=
function(b){};b.prototype.mapTriangleToNodes=function(b){for(var d=0;3>d;++d)if(!b.getNeighbor(d)){var c=this.front_.locatePoint(b.pointCW(b.getPoint(d)));c&&(c.triangle=b)}};b.prototype.removeFromMap=function(b){var d,c=this.map_,h=c.length;for(d=0;d<h;d++)if(c[d]===b){c.splice(d,1);break}};b.prototype.meshClean=function(b){b=[b];for(var d,c;d=b.pop();)if(!d.isInterior())for(d.setInterior(!0),this.triangles_.push(d),c=0;3>c;c++)d.constrained_edge[c]||b.push(d.getNeighbor(c))};c.exports=b},{"./advancingfront":2,
"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(b,c,f){f=function(b,c,g){this.points_=[b,c,g];this.neighbors_=[null,null,null];this.interior_=!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1]};var g=b("./xy").toString;f.prototype.toString=function(){return"["+g(this.points_[0])+g(this.points_[1])+g(this.points_[2])+"]"};f.prototype.getPoint=function(b){return this.points_[b]};f.prototype.GetPoint=f.prototype.getPoint;f.prototype.getPoints=function(){return this.points_};
f.prototype.getNeighbor=function(b){return this.neighbors_[b]};f.prototype.containsPoint=function(b){var c=this.points_;return b===c[0]||b===c[1]||b===c[2]};f.prototype.containsEdge=function(b){return this.containsPoint(b.p)&&this.containsPoint(b.q)};f.prototype.containsPoints=function(b,c){return this.containsPoint(b)&&this.containsPoint(c)};f.prototype.isInterior=function(){return this.interior_};f.prototype.setInterior=function(b){this.interior_=b;return this};f.prototype.markNeighborPointers=
function(b,c,g){var f=this.points_;if(b===f[2]&&c===f[1]||b===f[1]&&c===f[2])this.neighbors_[0]=g;else if(b===f[0]&&c===f[2]||b===f[2]&&c===f[0])this.neighbors_[1]=g;else if(b===f[0]&&c===f[1]||b===f[1]&&c===f[0])this.neighbors_[2]=g;else throw Error("poly2tri Invalid Triangle.markNeighborPointers() call");};f.prototype.markNeighbor=function(b){var c=this.points_;b.containsPoints(c[1],c[2])?(this.neighbors_[0]=b,b.markNeighborPointers(c[1],c[2],this)):b.containsPoints(c[0],c[2])?(this.neighbors_[1]=
b,b.markNeighborPointers(c[0],c[2],this)):b.containsPoints(c[0],c[1])&&(this.neighbors_[2]=b,b.markNeighborPointers(c[0],c[1],this))};f.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};f.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};f.prototype.pointCW=function(b){var c=this.points_;return b===c[0]?c[2]:b===c[1]?c[0]:b===c[2]?c[1]:null};f.prototype.pointCCW=function(b){var c=
this.points_;return b===c[0]?c[1]:b===c[1]?c[2]:b===c[2]?c[0]:null};f.prototype.neighborCW=function(b){return b===this.points_[0]?this.neighbors_[1]:b===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};f.prototype.neighborCCW=function(b){return b===this.points_[0]?this.neighbors_[2]:b===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};f.prototype.getConstrainedEdgeCW=function(b){return b===this.points_[0]?this.constrained_edge[1]:b===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};
f.prototype.getConstrainedEdgeCCW=function(b){return b===this.points_[0]?this.constrained_edge[2]:b===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};f.prototype.getConstrainedEdgeAcross=function(b){return b===this.points_[0]?this.constrained_edge[0]:b===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};f.prototype.setConstrainedEdgeCW=function(b,c){b===this.points_[0]?this.constrained_edge[1]=c:b===this.points_[1]?this.constrained_edge[2]=c:this.constrained_edge[0]=
c};f.prototype.setConstrainedEdgeCCW=function(b,c){b===this.points_[0]?this.constrained_edge[2]=c:b===this.points_[1]?this.constrained_edge[0]=c:this.constrained_edge[1]=c};f.prototype.getDelaunayEdgeCW=function(b){return b===this.points_[0]?this.delaunay_edge[1]:b===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};f.prototype.getDelaunayEdgeCCW=function(b){return b===this.points_[0]?this.delaunay_edge[2]:b===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};f.prototype.setDelaunayEdgeCW=
function(b,c){b===this.points_[0]?this.delaunay_edge[1]=c:b===this.points_[1]?this.delaunay_edge[2]=c:this.delaunay_edge[0]=c};f.prototype.setDelaunayEdgeCCW=function(b,c){b===this.points_[0]?this.delaunay_edge[2]=c:b===this.points_[1]?this.delaunay_edge[0]=c:this.delaunay_edge[1]=c};f.prototype.neighborAcross=function(b){return b===this.points_[0]?this.neighbors_[0]:b===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};f.prototype.oppositePoint=function(b,c){var g=b.pointCW(c);return this.pointCW(g)};
f.prototype.legalize=function(b,c){var g=this.points_;if(b===g[0])g[1]=g[0],g[0]=g[2],g[2]=c;else if(b===g[1])g[2]=g[1],g[1]=g[0],g[0]=c;else if(b===g[2])g[0]=g[2],g[2]=g[1],g[1]=c;else throw Error("poly2tri Invalid Triangle.legalize() call");};f.prototype.index=function(b){var c=this.points_;if(b===c[0])return 0;if(b===c[1])return 1;if(b===c[2])return 2;throw Error("poly2tri Invalid Triangle.index() call");};f.prototype.edgeIndex=function(b,c){var g=this.points_;if(b===g[0]){if(c===g[1])return 2;
if(c===g[2])return 1}else if(b===g[1]){if(c===g[2])return 0;if(c===g[0])return 2}else if(b===g[2]){if(c===g[0])return 1;if(c===g[1])return 0}return-1};f.prototype.markConstrainedEdgeByIndex=function(b){this.constrained_edge[b]=!0};f.prototype.markConstrainedEdgeByEdge=function(b){this.markConstrainedEdgeByPoints(b.p,b.q)};f.prototype.markConstrainedEdgeByPoints=function(b,c){var g=this.points_;if(c===g[0]&&b===g[1]||c===g[1]&&b===g[0])this.constrained_edge[2]=!0;else if(c===g[0]&&b===g[2]||c===g[2]&&
b===g[0])this.constrained_edge[1]=!0;else if(c===g[1]&&b===g[2]||c===g[2]&&b===g[1])this.constrained_edge[0]=!0};c.exports=f},{"./xy":11}],10:[function(b,c,f){f.EPSILON=1E-12;var g={CW:1,CCW:-1,COLLINEAR:0};f.Orientation=g;f.orient2d=function(b,c,f){b=(b.x-f.x)*(c.y-f.y)-(b.y-f.y)*(c.x-f.x);return-1E-12<b&&1E-12>b?g.COLLINEAR:0<b?g.CCW:g.CW};f.inScanArea=function(b,c,g,f){return-1E-12<=(b.x-c.x)*(f.y-c.y)-(f.x-c.x)*(b.y-c.y)||1E-12>=(b.x-g.x)*(f.y-g.y)-(f.x-g.x)*(b.y-g.y)?!1:!0};f.isAngleObtuse=function(b,
c,g){return 0>(c.x-b.x)*(g.x-b.x)+(c.y-b.y)*(g.y-b.y)}},{}],11:[function(b,c,f){function g(b){return"("+b.x+";"+b.y+")"}c.exports={toString:function(b){var c=b.toString();return"[object Object]"===c?g(b):c},toStringBase:g,compare:function(b,c){return b.y===c.y?b.x-c.x:b.y-c.y},equals:function(b,c){return b.x===c.x&&b.y===c.y}}},{}]},{},[6])(6)});AutodeskNamespace("Autodesk.Viewing");
(function(){var a=Autodesk.Viewing;a.EventDispatcher=function(){};a.EventDispatcher.prototype={constructor:a.EventDispatcher,apply:function(b){b.addEventListener=a.EventDispatcher.prototype.addEventListener;b.hasEventListener=a.EventDispatcher.prototype.hasEventListener;b.removeEventListener=a.EventDispatcher.prototype.removeEventListener;b.fireEvent=a.EventDispatcher.prototype.fireEvent;b.dispatchEvent=a.EventDispatcher.prototype.fireEvent},addEventListener:function(a,c){void 0===this.listeners&&
(this.listeners={});"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]);this.listeners[a].push(c)},hasEventListener:function(a,c){if(void 0===this.listeners)return!1;var f=this.listeners;return void 0!==f[a]&&-1!==f[a].indexOf(c)?!0:!1},removeEventListener:function(a,c){void 0===this.listeners&&(this.listeners={});if(this.listeners[a]instanceof Array)for(var f=this.listeners[a],g=0,d=f.length;g<d;g++)if(f[g]===c){f.splice(g,1);break}},fireEvent:function(a){void 0===this.listeners&&(this.listeners=
{});"string"==typeof a&&(a={type:a});a.target||(a.target=this);if(!a.type)throw Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var c=this.listeners[a.type].slice(),f=0;f<c.length;f++)c[f].call(this,a)}}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){function a(a){for(var b=0;b<g.length;++b)document.addEventListener(g[b],a,!1)}function b(a){for(var b=0;b<g.length;++b)document.removeEventListener(g[b],a,!1)}var c=Autodesk.Viewing,f=Autodesk.Viewing.Private,g=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];c.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2};c.ScreenModeDelegate=function(b){this.viewer=b;this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this);this.getMode()===
c.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener)};c.ScreenModeDelegate.prototype.uninitialize=function(){b(this.bindFullscreenEventListener);this.viewer=null};c.ScreenModeDelegate.prototype.isModeSupported=function(a){return!0};c.ScreenModeDelegate.prototype.setMode=function(a){var b=this.getMode();return a!==b&&this.isModeSupported(a)?(this.doScreenModeChange(b,a),this.onScreenModeChanged(b,a),!0):!1};c.ScreenModeDelegate.prototype.getMode=function(){throw"Implement getMode() in derived class";
};c.ScreenModeDelegate.prototype.getNextMode=function(){var a=this.getMode(),b,g=c.ScreenMode;a===g.kNormal&&this.isModeSupported(g.kFullBrowser)?b=g.kFullBrowser:a===g.kNormal&&this.isModeSupported(g.kFullScreen)?b=g.kFullScreen:a===g.kFullBrowser&&this.isModeSupported(g.kFullScreen)?b=g.kFullScreen:a===g.kFullBrowser&&this.isModeSupported(g.kNormal)?b=g.kNormal:a===g.kFullScreen&&this.isModeSupported(g.kNormal)?b=g.kNormal:a===g.kFullScreen&&this.isModeSupported(g.kFullBrowser)&&(b=g.kFullBrowser);
return b};c.ScreenModeDelegate.prototype.getEscapeMode=function(){return this.getMode()!==c.ScreenMode.kNormal?c.ScreenMode.kNormal:void 0};c.ScreenModeDelegate.prototype.fullscreenEventListener=function(){if(inFullscreen())this.viewer.resize();else{var a=c.ScreenMode;this.doScreenModeChange(a.kFullScreen,a.kNormal);this.onScreenModeChanged(a.kFullScreen,a.kNormal)}};c.ScreenModeDelegate.prototype.doScreenModeChange=function(a,b){throw"Implement doScreenModeChange() in derived class";};c.ScreenModeDelegate.prototype.onScreenModeChanged=
function(d,g){d===c.ScreenMode.kFullScreen?b(this.bindFullscreenEventListener):g===c.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener);this.viewer.resize();this.viewer.fireEvent({type:c.FULLSCREEN_MODE_EVENT,mode:g})};c.ApplicationScreenModeDelegate=function(a){c.ScreenModeDelegate.call(this,a)};c.ApplicationScreenModeDelegate.prototype=Object.create(c.ScreenModeDelegate.prototype);c.ApplicationScreenModeDelegate.prototype.constructor=c.ApplicationScreenModeDelegate;c.ApplicationScreenModeDelegate.prototype.isModeSupported=
function(a){return a!==c.ScreenMode.kFullBrowser};c.ApplicationScreenModeDelegate.prototype.getMode=function(){return inFullscreen()?c.ScreenMode.kFullScreen:c.ScreenMode.kNormal};c.ApplicationScreenModeDelegate.prototype.doScreenModeChange=function(a,b){var g=this.viewer.container;b===c.ScreenMode.kNormal?(g.classList.remove("viewer-fill-browser"),exitFullscreen()):b===c.ScreenMode.kFullScreen&&(g.classList.add("viewer-fill-browser"),launchFullscreen(g))};c.NullScreenModeDelegate=function(a){c.ScreenModeDelegate.call(this,
a)};c.NullScreenModeDelegate.prototype=Object.create(c.ScreenModeDelegate.prototype);c.NullScreenModeDelegate.prototype.constructor=c.ScreenModeDelegate;c.NullScreenModeDelegate.prototype.isModeSupported=function(a){return!1};c.NullScreenModeDelegate.prototype.getMode=function(){return c.ScreenMode.kNormal};c.ScreenModeMixin=function(){};c.ScreenModeMixin.prototype={setScreenModeDelegate:function(a){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null);this.screenModeDelegateClass=
a?a:null===a?c.NullScreenModeDelegate:c.ApplicationScreenModeDelegate},getScreenModeDelegate:function(){this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this));return this.screenModeDelegate},isScreenModeSupported:function(a){return this.getScreenModeDelegate().isModeSupported(a)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(a){var b=f.logger;b&&b.log({category:"screen_mode",value:a});
return this.getScreenModeDelegate().setMode(a)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var a=this.getScreenModeDelegate().getNextMode();return void 0!==a?this.setScreenMode(a):!1},escapeScreenMode:function(){var a=this.getScreenModeDelegate().getEscapeMode();return void 0!==a?this.setScreenMode(a):!1},apply:function(a){var b=c.ScreenModeMixin.prototype;a.setScreenModeDelegate=b.setScreenModeDelegate;a.getScreenModeDelegate=b.getScreenModeDelegate;
a.isScreenModeSupported=b.isScreenModeSupported;a.canChangeScreenMode=b.canChangeScreenMode;a.setScreenMode=b.setScreenMode;a.getScreenMode=b.getScreenMode;a.nextScreenMode=b.nextScreenMode;a.escapeScreenMode=b.escapeScreenMode}}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.inWorkerThread="undefined"!==typeof self&&"undefined"===typeof window;a.ViewingService={};a.ViewingService.shouldRefreshToken=function(a){var c=!1;if(401===a.statusCode){a=a.responseText;try{var f=a?JSON.parse(a):{}}catch(g){}c=!a||f.errorCode&&"AUTH-006"===f.errorCode}else c=403===a.statusCode;return c};a.ViewingService.refreshToken=function(b,c){a.inWorkerThread?(self.addEventListener("message",function(a){a.data&&a.data.tokenRefreshed?b(a):c(a)}),self.postMessage({refreshToken:!0})):
a.refreshTokenAndCookie(b,c)};a.ViewingService.generateUrl=function(b,c,f,g){if(0!==f.indexOf("urn:"))return f;b+="/";"items"!==c&&(f=f.substr(4));return b="bubbles"===c&&0==a.env.indexOf("Autodesk")?b+f:b+(c+"/"+f)};a.ViewingService.get=function(b,c,f,g,d,h){h=h?h:{};f=a.ViewingService.generateUrl(b,c,f,h);h.queryParams&&(f=f+"?"+h.queryParams);var k=new XMLHttpRequest;try{var m=function(a){200===k.status?g(k.response?k.response:k.responseText):n(a)},n=function(l){!h.retriedOnce&&a.ViewingService.shouldRefreshToken(k)?
a.ViewingService.refreshToken(function(k){h.retriedOnce=!0;a.ViewingService.get(b,c,f,g,d,h)},function(a){d(k.status,k.statusText,{url:f})}):d(k.status,k.statusText,{url:f})},q=h.hasOwnProperty("asynchronous")?h.asynchronous:!0;k.open("GET",f,q);h.hasOwnProperty("responseType")&&(k.responseType=h.responseType);k.withCredentials=!0;h.hasOwnProperty("withCredentials")&&(k.withCredentials=h.withCredentials);if(h.headers)for(var l in h.headers)k.setRequestHeader(l,h.headers[l]);q&&(k.onload=m,k.onerror=
n,k.ontimeout=n);k.send();a.inWorkerThread?self.postMessage({assetRequest:[f,h.headers,null]}):a.assets.push([f,h.headers,null]);q||m(null)}catch(p){d(k.status,k.statusText,{url:f,exception:p})}}})();
var Xhr=function(){var a=function(a,c,f){this.xhr=new XMLHttpRequest;this.errorHandler=a;this.success=!1;this.viewing_url=f;this.auth=c};a.prototype.generateUrl=function(a,c,f){var g=a.indexOf("urn:");0===g&&this.viewing_url&&((f=f&&f.feature?f.feature:null)?"render"==f?(a=a.substr(4),a=this.viewing_url+"/"+f+"/"+encodeURIComponent(a)):"bubbles"==f?(a=a.substr(4),a=this.viewing_url+"/"+f+"/"+encodeURIComponent(a)):"comments"==f?(a=a.substr(4),a=this.viewing_url+"/"+f+"/file/"+encodeURIComponent(a)):
a=this.viewing_url+"/"+f+"/"+encodeURIComponent(a.substr(g)):a=this.viewing_url+"/items/"+encodeURIComponent(a.substr(g)));c&&(a=a+"?"+c);return a};a.prototype.addHeaders=function(a){for(var c in a)this.xhr.setRequestHeader(c,a[c])};a.prototype.get=function(a,c,f,g,d,h,k){a=this.generateUrl(a,h,{feature:d,oss_url:k});try{this.xhr.open("GET",a,!!g),this.xhr.responseType=f,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),g&&(this.xhr.onload=g),this.addHeaders(c),this.xhr.send()}catch(m){return this.errorHandler&&
this.errorHandler.networkFailure(a,m),null}this.errorCheck(a,200);return this.xhr.response};a.prototype.post=function(a,c,f,g,d,h){a=this.generateUrl(a,null,{feature:h});c["Content-Type"]||(c["Content-Type"]="application/json");try{this.xhr.open("POST",a,!!d),this.xhr.responseType=g,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),d&&(this.xhr.onload=d),this.addHeaders(c),this.xhr.send(f)}catch(k){return this.errorHandler&&this.errorHandler.networkFailure(a,k),null}this.errorCheck(a,200,201);
return this.xhr.response};a.prototype.getRange=function(a,c,f,g,d,h){a=this.generateUrl(path);c.Range="bytes="+g+"-"+d;try{this.xhr.open("GET",a,!!h),this.xhr.responseType=f,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),h&&(this.xhr.onload=h),this.addHeaders(c),this.xhr.send()}catch(k){return this.errorHandler&&this.errorHandler.networkFailure(a,k),null}this.errorCheck(a,206);return this.xhr.response};a.prototype.head=function(a){a=this.generateUrl(path);try{this.xhr.open("GET",a,!1),this.success=
!1,this.auth&&(this.xhr.withCredentials=!0),this.addHeaders([]),this.xhr.send()}catch(c){return this.errorHandler&&this.errorHandler.networkFailure(a,c),null}this.errorCheck(a,200);a=[];a["Accept-Ranges"]=this.xhr.getResponseHeader("Accept-Ranges");a["Content-Length"]=this.xhr.getResponseHeader("Content-Length");return a};a.prototype.errorCheck=function(a,c){if(4===this.xhr.readyState&&this.xhr.status){var f;for(f=1;f<arguments.length&&this.xhr.status!==arguments[f];f++);f===arguments.length&&this.errorHandler?
this.errorHandler.unsuccessfulResponse(a,this.xhr.status,this.xhr.statusText):this.success=!0}else this.success=!0};return a}(),XhrErrorHandler=function(){var a=function(a){this.host=a;this.ignoreFileNotFound=!1};a.prototype.networkFailure=function(a,c){this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:a,exception:c.toString(),stack:c.stack})};a.prototype.unsuccessfulResponse=function(a,c,f){403==c?this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED,
"Access denied to remote resource",{url:a,httpStatus:c,httpStatusText:f}):404==c?this.ignoreFileNotFound||this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:a,httpStatus:c,httpStatusText:f}):500<=c&&600>c?this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:a,httpStatus:c,httpStatusText:f}):this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",
{url:a,httpStatus:c,httpStatusText:f})};return a}();
if("undefined"!==typeof window){var trace=function(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1));console.log((performance.now()/1E3).toFixed(3)+": "+a)},RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=
mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(a,b,c){var f=null,g=a.split(":");0===g[0].indexOf("stun")?f={url:a}:0!==g[0].indexOf("turn")||-1===a.indexOf("transport=udp")&&-1!==a.indexOf("?transport")||(f={url:a.split("?")[0],credential:c,username:b});return f},attachMediaStream=function(a,b){console.log("Attaching media stream");a.mozSrcObject=b;a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream");
a.mozSrcObject=b.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]};else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40;createIceServer=function(a,b,c){var f=null,g=a.split(":");0===g[0].indexOf("stun")?f={url:a}:0===g[0].indexOf("turn")&&
(28>webrtcDetectedVersion?(a=a.split("turn:"),f={url:"turn:"+b+"@"+a[1],credential:c}):f={url:a,credential:c,username:b});return f};RTCPeerConnection=webkitRTCPeerConnection;getUserMedia=navigator.webkitGetUserMedia.bind(navigator);attachMediaStream=function(a,b){"undefined"!==typeof a.srcObject?a.srcObject=b:"undefined"!==typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!==typeof a.src?a.src=URL.createObjectURL(b):console.log("Error attaching stream to element.")};reattachMediaStream=function(a,
b){a.src=b.src};webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks});webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.config={userName:""};a.setUserName=function(b){a.config.userName=b};a.MessageClient=function(b,f){function g(){return a.config.userName&&a.config.userName.length?a.config.userName:l?l.slice(0,5):"Unknown"}function d(a){switch(a.type){case "txt":if(0==a.msg.indexOf("/nick ")){var b=H.getUserById(a.from,a.roomId),c=a.msg.slice(6);c.length&&(b.name=c,b.id==l&&(b.name+=" (you)"));H.dispatchEvent({type:"userListChange",data:a,channelId:a.roomId})}break;case "joinok":b=
C[a.roomId];stderr("joined channel "+a.roomId);b.users=a.users&&a.users.length?a.users:[];for(c=0;c<b.users.length;c++)b.users[c].name&&b.users[c].name.length||(b.users[c].name=b.users[c].id.slice(0,5));var c=g(),d={id:l,name:c+" (you)",isSelf:!0,status:0};b.userSet[l]||(b.users.push(d),b.userSet[l]=d);0!=d.id.indexOf(c)&&H.sendChatMessage("/nick "+c,a.roomId);break;case "join_error":break;case "sessionId":stderr("Connect successful, your id is: "+a.id);l=a.id;break;case "joined":a.userStatus="joined";
a.user.name&&a.user.name.length||(a.user.name=a.user.id.slice(0,5));a.roomId&&((b=C[a.roomId])?(b.users.push(a.user),stderr(a.user+" joined room "+a.roomId)):stderr("Channel "+a.roomId+" does not exist for socket "+l));break;case "left":a.userStatus="left";stderr(a.user+" left room "+a.room);for(b in C){for(var c=C[b].users,d=-1,f=0;f<c.length;f++)if(c[f].id==a.user){d=f;break}-1!=d&&c.splice(d,1);delete C[b].userSet[a.user]}break;case "camera":case "pointer":break;default:stderr(a)}H.dispatchEvent({type:n[a.type],
data:a,channelId:a.roomId})}function h(a){r<p.length?(stderr("Connect failed, trying another server..."),q.disconnect(),q=null,r++,H.connect(H.sessionID)):H.dispatchEvent({type:"socketError",data:a})}function k(a){H.dispatchEvent({type:"socketError",data:a})}function m(a){r=0;for(var b in A)H.join(b)}var n={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",
"private":"privateMessage",join_error:"socketError"},q,l=null,p=Array.isArray(b)?b:[b],r=0,A={},C={},H=this;this.connect=function(a){if(!q)return"undefined"!==typeof window.WebSocket?(this.sessionID=a,q=io.connect(p[r]+"?sessionID="+a,{path:f,forceNew:!0}),q.on("connect",m),q.on("message",d),q.on("connect_error",h),q.on("error",k),!0):!1};this.join=function(a){q&&q.connected?(delete A[a],C[a]={id:a,users:[],userSet:{}},q.emit("join",{roomId:a,name:g()})):A[a]=1};this.disconnect=function(){q&&(q.disconnect(),
q=null,C={},l=null)};this.sendMessage=function(a,b,c){q.emit("message",{type:a,from:l,msg:b,roomId:c})};this.sendPrivateMessage=function(a,b){q.emit("message",{type:"private",target:a,from:l,msg:b})};this.sendChatMessage=function(a,b){var c={type:"txt",from:l,msg:a,roomId:b};q.emit("message",c);d(c)};this.getUserById=function(a,b){for(var c=C[b].users,d=0;d<c.length;d++)if(c[d].id==a)return c[d];return null};this.getLocalId=function(){return l};this.getChannelInfo=function(a){return C[a]};this.isConnected=
function(){return q}};a.MessageClient.prototype.constructor=a.MessageClient;Autodesk.Viewing.EventDispatcher.prototype.apply(a.MessageClient.prototype);var b={};a.MessageClient.GetInstance=function(c,f){c||(c=a.EnvironmentConfigurations[a.env].LMV.RTC);Array.isArray(c)||(c=[c]);var g=b[c[0]];if(g)return g;g=new a.MessageClient(c,f);return b[c[0]]=g}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.P2PClient=function(a){function c(a){try{q=new RTCPeerConnection(H),q.onicecandidate=function(a){a.candidate?n.sendPrivateMessage(p,{type:"candidate",label:a.candidate.sdpMLineIndex,id:a.candidate.sdpMid,candidate:a.candidate.candidate}):stderr("End of candidates.")},q.ondatachannel=function(a){stderr("Data channel added.");A=a.channel;A.onmessage=h;m.dispatchEvent({type:"dataChannelAdded",data:a.channel})},q.onaddstream=function(a){stderr("Remote stream added.");
m.dispatchEvent({type:"remoteStreamAdded",data:a.stream})},q.onremovestream=function(a){stderr("Remote stream removed. Event: ",a);m.dispatchEvent({type:"remoteStreamRemoved",data:a.stream})},a&&(A=q.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1}),A.onmessage=h)}catch(b){stderr("Failed to create PeerConnection, exception: "+b.message),alert("Cannot create RTCPeerConnection object.")}}function f(a){stderr("createOffer() error: ",e)}function g(a){q.setLocalDescription(a);n.sendPrivateMessage(p,
a);if(C.length){for(a=0;a<C.length;a++)q.addIceCandidate(C[a]);C=[]}}function d(a){a=a.split("\n");for(var b=!1,c=!1,d=!1,g=0;g<a.length;g++)0==a[g].indexOf("a=mid:data")&&(b=!0),0==a[g].indexOf("a=mid:video")&&(d=!0),0==a[g].indexOf("a=mid:audio")&&(c=!0);return b&&!d&&!c}function h(a){a=JSON.parse(a.data);switch(a.type){case "camera":m.dispatchEvent({type:"cameraChange",data:a});break;case "joystick":m.dispatchEvent({type:"joystick",data:a});break;case "state":m.dispatchEvent({type:"viewerState",
data:a})}}function k(){l=!1;q.close();p=r=q=null}var m=this,n=a,q,l=!1,p,r,A,C=[],H={iceServers:[{url:"stun:stun.l.google.com:19302"}]},z={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},t={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};n.addEventListener("privateMessage",function(a){var b=a.data.msg;stderr("Client received message:"+JSON.stringify(b));"offer"!=b.type||l?"answer"===b.type&&l?q.setRemoteDescription(new RTCSessionDescription(b)):"candidate"===b.type?(a=new RTCIceCandidate({sdpMLineIndex:b.label,
candidate:b.candidate}),l?q.addIceCandidate(a):C.push(a)):"bye"===b&&l&&(m.dispatchEvent({type:"remoteHangup",data:null}),stderr("Session terminated."),k()):(stderr("Received offer. Accepting."),m.receiveCall(a.data))});this.hangup=function(){stderr("Hanging up.");l&&(n.sendPrivateMessage(p,"bye"),k())};this.initUserMedia=function(a){var b={video:!0,audio:!0};window.getUserMedia(b,function(b){stderr("Adding local stream.");a&&a(b);m.dispatchEvent({type:"localStreamAdded",data:b})},function(a){stderr("getUserMedia error: ",
a)});stderr("Getting user media with constraints",b)};this.callUser=function(a,b){p?stderr("Already in a call. Ignoring call request."):(p=a,stderr("Calling user "+p),b?(c(!0),l=!0,stderr("Sending data channel offer to peer"),q.createOffer(g,f)):this.initUserMedia(function(a){r=a;l||"undefined"==typeof r||(c(!1),q.addStream(r),l=!0,stderr("Sending audio/video offer to peer"),q.createOffer(g,f))}))};this.receiveCall=function(a){p=a.from;p||(p=a.senderId);d(a.msg.sdp)?(c(!0),l=!0,q.setRemoteDescription(new RTCSessionDescription(a.msg)),
stderr("Sending data-only answer to peer."),q.createAnswer(g,null,t)):this.initUserMedia(function(b){r=b;l||"undefined"==typeof r||(c(!1),q.addStream(r),l=!0);q.setRemoteDescription(new RTCSessionDescription(a.msg));stderr("Sending audio+video answer to peer.");q.createAnswer(g,null,z)})};this.getCurrentCallTarget=function(){return p};this.dataChannel=function(){return A}};a.P2PClient.prototype.constructor=a.P2PClient;Autodesk.Viewing.EventDispatcher.prototype.apply(a.P2PClient.prototype)})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.Logger=function(b){this.queue=[];b.eventCallback&&(this.callback=b.eventCallback);this.sessionId=b.sessionId;if(!this.sessionId){var c=Date.now()+"";this.sessionId=parseFloat((1E4*Math.random()|0)+""+c.substring(4))}this.endpoint=b.endpoint?b.endpoint+"/logs":null;this.flushThreshold=b.flushThreshold||10;this.ready=!1;this.retries=0;this.lastFlushTime=Date.now();this.heartbeat=null;b={category:"viewer_start",touch:isTouchDevice(),env:a.env,referer:window.location.href,
version:LMV_VIEWER_VERSION};this.log(b)};a.Logger.prototype.setupWS=function(){var a=this;a.reconnectPending=!1;if(this.endpoint){stderr("Opening web socket.");var c=function(){a.ready=!0;a.lastConnectTime=Date.now();stderr("Web socket opened successfully.");0<a.retries&&a.socket.send({category:"reconnect",sessionId:this.sessionId});a.flush()},f=function(){a.reconnectPending||a.xhr||(a.ready=!1,3>a.retries?(stderr("Attempting web socket reconnect."),a.retries++,a.reconnectPending=!0,setTimeout(function(){a.setupWS()},
5E3)):(stderr("Giving up on web sockets. Trying POST."),a.setupXHR()))},g=function(a){console.log(a.message);f()},d=function(c){6E4<Date.now()-a.lastConnectTime?(stderr("Web socket closed due to inactivity."),a.socket=null,a.ready=!1,a.retries=0):f()};try{this.socket=new WebSocket("wss://"+this.endpoint,"lmv-log-v1"),this.socket.onopen=c,this.socket.onerror=g,this.socket.onclose=d,this.socket.onmessage=function(a){console.log(a.data)}}catch(h){a.setupXHR()}}};a.Logger.prototype.setupXHR=function(){this.socket=
null;this.xhr=new XMLHttpRequest;this.ready=!0;this.retries=0;this.flush();var a=this;this.heartbeat&&clearInterval(this.heartbeat);this.heartbeat=setInterval(function(){a.flush()},6E4);"undefined"!==typeof window&&window.addEventListener("beforeunload",function(){a.log({category:"viewer_stop"},!0)})};a.Logger.prototype.flush=function(){if(!(2<this.retries)&&this.queue.length&&this.ready){var a=this,c=this.queue;this.queue=[];var f=JSON.stringify(c);if(this.socket)try{this.socket.send(f)}catch(g){}else if(this.endpoint)try{var d=
this.xhr;d.open("POST","https://"+this.endpoint,!0);d.send(f);d.onreadystatechange=function(){4==d.readyState&&200!==d.status&&(a.retries++,a.queue.unshift(c))}}catch(h){}else stderr(this.queue);this.lastFlushTime=Date.now()}};a.Logger.prototype.log=function(a,c){Autodesk.Viewing.Private.offline||(this.callback&&this.callback(a),2<this.retries||(a.timestamp=Date.now(),a.sessionId=this.sessionId,this.queue.push(a),this.socket||this.ready?(this.socket||this.queue.length>this.flushThreshold||6E4<a.timestamp-
this.lastFlushTime||c)&&this.flush():this.setupWS()))}})();
var Autocam=Autocam||function(a,b,c,f,g){function d(b){C=!0;a.target.copy(l.center);a.pivot.copy(l.pivot);a.worldup?a.worldup.copy(l.sceneUpDirection):a.up.copy(l.sceneUpDirection);f&&f(b);C=!1}function h(a,b){var c=new THREE.Vector2(0,0);c.x=a/window.innerWidth;c.y=b/window.innerHeight;return c}function k(a,b,c){var d,g,f,h=0,k=null,n=null,m=l.snapOrbitDeadZone,z=l.orbitMultiplier;"h"==a?(a=l.snapOrbitThresholdH,d=l.snapOrbitAccelerationAX,g=l.snapOrbitAccelerationBX,f=1-l.snapOrbitAccelerationPointX,
n=l.lockDeltaX,k=l.lockedX):(a=l.snapOrbitThresholdV,d=l.snapOrbitAccelerationAY,g=l.snapOrbitAccelerationBY,f=1-l.snapOrbitAccelerationPointY,n=l.lockDeltaY,k=l.lockedY);k?(n+=c,n<-m?h=(n+m)*z*1/g:n>m&&(h=(n-m)*z*1/g)):(h=Math.abs(b)>a?c*z:Math.abs(b)>f*a?0<c*b?c*z*d:c*z*1/d:0<c*b?c*z*g:c*z*1/g,0<h*b&&Math.abs(h)>Math.abs(b)&&(this.lockDeltaX=this.lockDeltaY=0,h=b));return h}function m(a,b){var c=!1,d=window.innerWidth,g=a.x%d,f=window.innerHeight,h=a.y%f,f=0<h?h-b.y:f+h-b.y;30>Math.abs(0<g?g-b.x:
d+g-b.x)&&30>Math.abs(f)&&(c=!0);return c}function n(a,b,c){if(!X||!a){if(a){var d=new THREE.Vector2;d.x=(b.x-c.x)/window.innerWidth;b.x=c.x+(b.x-c.x)%window.innerWidth;d.y=(b.y-c.y)/window.innerHeight;b.y=c.y+(b.y-c.y)%window.innerHeight}X=a}}function q(a){var b=l.sceneFrontDirection.clone().cross(l.sceneUpDirection),c=Math.abs(Math.abs(a.dot(l.sceneUpDirection))-1),d=Math.abs(Math.abs(a.dot(l.sceneFrontDirection))-1);a=Math.abs(Math.abs(a.dot(b))-1);return 1E-5>c||1E-5>d||1E-5>a}var l=this,p=null,
r=null,A=null,C=!1;this.camera=a;this.renderer="WEBGL";this.startState={};this.navApi=b;this.orthographicFaces=!1;var H=Date.now(),z,t=!1;this.showPivot=function(a){g&&g(a)};this.setViewCubeContainer=function(a){A=a};this.setWorldUpVector=function(a){!C&&a&&0<a.lengthSq()&&!a.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(a),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),p&&requestAnimationFrame(p.render))};
this.getWorldUpVector=function(){return this.sceneUpDirection.clone()};this.getWorldRightVector=function(){var a=this.sceneUpDirection.clone();Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):0<=a.z?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x);return a.normalize()};this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()};this.goToView=function(a){this.navApi.getIsLocked()||(a={position:a.position.clone(),up:a.up.clone(),center:a.center.clone(),pivot:a.pivot.clone(),
fov:a.fov,worldUp:a.worldUp.clone(),isOrtho:a.isOrtho},l.elapsedTime=0,this.animateTransition(a))};this.getCurrentView=function(){return{position:a.position.clone(),up:a.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:a.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===a.isPerspective}};this.setCurrentViewAsHome=function(a){a?(this.navApi.setRequestFitToView(!0),t=!0):this.homeVector=this.getCurrentView()};this.setHomeViewFrom=function(a){var b=a.pivot?a.pivot:this.center,
c=a.target?a.target:this.pivot,d=a.worldup?a.worldup:this.sceneUpDirection;this.homeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),isOrtho:!1===a.isPerspective};this.originalHomeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===a.isPerspective}};this.toPerspective=function(){a.isPerspective||(a.toPerspective(),d(!1))};
this.toOrthographic=function(){a.isPerspective&&(a.toOrthographic(),d(!1))};this.setOrthographicFaces=function(a){this.orthographicFaces=a};this.goHome=function(){this.navApi.getIsLocked()||(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))};this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position);this.homeVector.up.copy(this.originalHomeVector.up);this.homeVector.center.copy(this.originalHomeVector.center);this.homeVector.pivot.copy(this.originalHomeVector.pivot);
this.homeVector.fov=this.originalHomeVector.fov;this.homeVector.worldUp.copy(this.originalHomeVector.worldUp);this.homeVector.isOrtho=this.originalHomeVector.isOrtho;this.goHome()};this.getView=function(){return this.center.clone().sub(a.position)};this.setCameraUp=function(b){var c=this.dir.clone(),d=c.cross(b).normalize();0===d.lengthSq()&&(c.copy(this.dir),b.z>b.y?c.y+=1E-4:c.z+=1E-4,d=c.cross(b).normalize());a.up.copy(d).cross(this.dir).normalize()};(function U(){requestAnimationFrame(U);var a=
Date.now();z=a-H;H=a})();this.ortho=!1;this.center=a.target?a.target.clone():new THREE.Vector3(0,0,0);this.pivot=a.pivot?a.pivot.clone():this.center.clone();this.sceneUpDirection=a.worldup?a.worldup.clone():a.up.clone();this.sceneFrontDirection=this.getWorldFrontVector();this.dir=this.getView();this.setCameraUp(a.up);this.saveCenter=this.center.clone();this.savePivot=this.pivot.clone();this.saveEye=a.position.clone();this.saveUp=a.up.clone();var w,E,B,D;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();
this.setHomeViewFrom(a);var J=new THREE.Quaternion,F=new THREE.Quaternion,G=new THREE.Quaternion,M=new THREE.Quaternion,I,L;this.userPanSpeed=.5;this.userLookSpeed=2;this.userHeightSpeed=5;this.walkMultiplier=1;this.userZoomSpeed=1.015;this.orbitMultiplier=5;this.currentlyAnimating=!1;this.alignOrbitUpDirection=this.preserveOrbitUpDirection=a.keepSceneUpright=!0;this.doCustomOrbit=this.constrainOrbitVertical=this.constrainOrbitHorizontal=!1;this.snapOrbitDeadZone=.045;this.snapOrbitThresholdH=this.snapOrbitThresholdV=
THREE.Math.degToRad(15);this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5;this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2;this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5;this.alignDirTable=Array(26);this.alignDirTable[0]=new THREE.Vector3(-1,0,0);this.alignDirTable[1]=new THREE.Vector3(1,0,0);this.alignDirTable[2]=new THREE.Vector3(0,-1,0);this.alignDirTable[3]=new THREE.Vector3(0,1,0);this.alignDirTable[4]=new THREE.Vector3(0,0,-1);this.alignDirTable[5]=
new THREE.Vector3(0,0,1);this.alignDirTable[6]=new THREE.Vector3(-1,-1,0);this.alignDirTable[7]=new THREE.Vector3(-1,1,0);this.alignDirTable[8]=new THREE.Vector3(1,-1,0);this.alignDirTable[9]=new THREE.Vector3(1,1,0);this.alignDirTable[10]=new THREE.Vector3(0,-1,-1);this.alignDirTable[11]=new THREE.Vector3(0,-1,1);this.alignDirTable[12]=new THREE.Vector3(0,1,-1);this.alignDirTable[13]=new THREE.Vector3(0,1,1);this.alignDirTable[14]=new THREE.Vector3(-1,0,-1);this.alignDirTable[15]=new THREE.Vector3(1,
0,-1);this.alignDirTable[16]=new THREE.Vector3(-1,0,1);this.alignDirTable[17]=new THREE.Vector3(1,0,1);this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1);this.alignDirTable[19]=new THREE.Vector3(-1,-1,1);this.alignDirTable[20]=new THREE.Vector3(-1,1,-1);this.alignDirTable[21]=new THREE.Vector3(-1,1,1);this.alignDirTable[22]=new THREE.Vector3(1,-1,-1);this.alignDirTable[23]=new THREE.Vector3(1,-1,1);this.alignDirTable[24]=new THREE.Vector3(1,1,-1);this.alignDirTable[25]=new THREE.Vector3(1,1,1);this.useSnap=
this.combined=!1;this.lockDeltaX=0;this.lockedX=!1;this.lockDeltaY=this.lastSnapRotateX=0;this.lockedY=!1;this.lastSnapRotateY=0;this.lastSnapDir=new THREE.Vector3(0,0,0);this.bottomLimit=this.topLimit=!1;this.maxSceneBound=this.minSceneBound=0;var K={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=K;var O,R;this.zoomDelta=new THREE.Vector2;var X,W=new THREE.Vector3,aa=new THREE.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,
maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1};this.viewCubeMenuOpen=!1;this.menuSize=new THREE.Vector2(0,0);
this.menuOrigin=new THREE.Vector2(0,0);a.lookAt(this.center);this.setCube=function(a){p=a};this.loadObject=function(a,b,c){loader=new THREE.JSONLoader;loader.load(a,function(a,d){var g=new THREE.MeshPhongMaterial(d);mesh=new THREE.Mesh(a,g);mesh.scale=b;mesh.position.copy(c);mesh.geometry.computeBoundingBox();g=mesh.geometry.boundingBox.clone();aa.set(g.max.x,g.max.y,g.max.z);W.set(g.min.x,g.min.y,g.min.z);aa.multiply(b);W.multiply(b);scene.add(mesh);objects.push(mesh)})};this.sync=function(b){b.isPerspective!==
a.isPerspective&&(b.isPerspective?a.toPerspective():(a.toOrthographic(),b.saveFov&&(a.saveFov=b.saveFov)));a.fov=b.fov;a.position.copy(b.position);b.target&&(this.center.copy(b.target),a.target.copy(b.target));b.pivot&&(this.pivot.copy(b.pivot),a.pivot.copy(b.pivot));this.dir.copy(this.center).sub(a.position);this.setCameraUp(b.up);b=b.worldup?b.worldup:b.up;1E-4<b.distanceToSquared(this.sceneUpDirection)&&this.setWorldUpVector(b);t&&!this.navApi.getTransitionActive()&&(t=!1,this.setCurrentViewAsHome(!1));
p&&requestAnimationFrame(p.render)};this.refresh=function(){p&&p.refreshCube()};THREE.Box2.prototype.setCenter=function(a){var b=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);this.min.copy(a).sub(b);this.max.copy(a).add(b);return this};THREE.Box2.prototype.getIcon2DCoords=function(a,b){var c=this.center;b.set((a.x-c.x)/(this.size().x/2),(a.y-c.y)/(this.size().y/2))};THREE.Matrix3.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=
a.y,g=a.z,f=a.w,h=c+c,k=d+d,l=g+g;a=c*h;var n=c*k,c=c*l,m=d*k,d=d*l,g=g*l,h=f*h,k=f*k,f=f*l;b[0]=1-(m+g);b[3]=n-f;b[6]=c+k;b[1]=n+f;b[4]=1-(a+g);b[7]=d-h;b[2]=c-k;b[5]=d+h;b[8]=1-(a+m);return this};THREE.Quaternion.prototype.setFromRotationMatrix3=function(a){var b=a.elements,c=b[0];a=b[3];var d=b[6],g=b[1],f=b[4],h=b[7],k=b[2],l=b[5],b=b[8],n=c+f+b;0<n?(c=.5/Math.sqrt(n+1),this.w=.25/c,this.x=(l-h)*c,this.y=(d-k)*c,this.z=(g-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this.w=(l-h)/c,this.x=.25*c,this.y=
(a+g)/c,this.z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this.w=(d-k)/c,this.x=(a+g)/c,this.y=.25*c,this.z=(h+l)/c):(c=2*Math.sqrt(1+b-c-f),this.w=(g-a)/c,this.x=(d+k)/c,this.y=(h+l)/c,this.z=.25*c);return this};THREE.Quaternion.prototype.rotate=function(a){var b=(new THREE.Matrix4).makeRotationFromQuaternion(this).elements,b=(new THREE.Matrix3).set(b[0],b[1],b[2],b[4],b[5],b[6],b[8],b[9],b[10]);return a.applyMatrix3(b)};THREE.Vector3.prototype.findAngleWith=function(a,b){var c=0,d=this.clone().normalize().clone().dot(a.clone().normalize()),
c=this.clone().cross(a).clone().normalize();if(c.clone().length()<Number.MIN_VALUE)c=0<d?0:180;else{b=0<c.clone().dot(b.clone().normalize())?c:-c;var g=(new THREE.Quaternion).setFromAxisAngle(b,90*THREE.Math.degToRad),g=g.clone().rotate(a).clone().normalize().clone().dot(this),c=Math.acos(d)*THREE.Math.radToDeg;Math.abs(c-90)<Number.MIN_VALUE&&(c=90);if(90>c&&0<d*g||90<c&&0>d*g||90==c&&0<g)c*=-1}return c=THREE.Math.degToRad(c)};"contains"in String.prototype||(String.prototype.contains=function(a,
b){return-1!==String.prototype.indexOf.call(this,a,b)});Math.linearClamp=function(a,b,c){return a<=b?0:a>=c?1:(a-b)/(c-b)};Math.easeClamp=function(a,b,c){return a<=b?0:a>=c?1:.5*(Math.sin(((a-b)/(c-b)-.5)*Math.PI)+1)};Math.linearInterp=function(a,b,c){return b*(1-a)+c*a};Math.equalityClamp=function(a,b,c){return a<=b?b:a>=c?c:a};Math.round2=function(a){return Math.round(100*a)/100};Math.round1=function(a){return Math.round(10*a)/10};this.animateTransition=function(b){if(b){var c=!1,g=0;this.setCameraOrtho(b.isOrtho);
if(l.elapsedTime>=K.duration)g=1,l.center.copy(b.center),l.pivot.copy(b.pivot),a.position.copy(b.position),a.up.copy(b.up),b.isOrtho||(a.fov=b.fov),(c=!b.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(b.worldUp),this.currentlyAnimating=!1,d(c),this.showPivot(!1),p&&requestAnimationFrame(p.render),this.addHistoryElement(),this.navApi.setTransitionActive(!1);else{this.currentlyAnimating=!0;this.showPivot(!0);this.navApi.setTransitionActive(!0);g=Math.easeClamp(l.elapsedTime/K.duration,
0,K.destinationPercent);oneMinusTime=1-g;l.elapsedTime+=z/500;var c=l.center.clone().multiplyScalar(oneMinusTime).add(b.center.clone().multiplyScalar(g)),f=a.position.clone().multiplyScalar(oneMinusTime).add(b.position.clone().multiplyScalar(g)),h=a.up.clone().multiplyScalar(oneMinusTime).add(b.up.clone().multiplyScalar(g)),k=a.pivot.clone().multiplyScalar(oneMinusTime).add(b.pivot.clone().multiplyScalar(g)),n=this.sceneUpDirection.clone().multiplyScalar(oneMinusTime).add(b.worldUp.clone().multiplyScalar(g)),
g=a.fov*oneMinusTime+b.fov*g;l.center.copy(c);l.pivot.copy(k);a.position.copy(f);a.up.copy(h);b.isOrtho||(a.fov=g);(c=1E-4<n.distanceToSquared(this.sceneUpDirection))&&this.setWorldUpVector(n);a.lookAt(l.center);d(c);p&&requestAnimationFrame(p.render);requestAnimationFrame(function(){l.animateTransition(b)})}}};this.sphericallyInterpolateTransition=function(b){var c,g,f;c=0;this.currentlyAnimating=!0;this.navApi.setTransitionActive(!0);l.elapsedTime>=K.duration?(c=1,this.currentlyAnimating=!1):(c=
Math.easeClamp(l.elapsedTime/K.duration,0,K.destinationPercent),l.elapsedTime+=z/500);1===c?(g=R.position,c=R.center,f=R.up):(f=new THREE.Matrix3,g=J.clone(),g.slerp(F,c),f.makeRotationFromQuaternion(g),g=Math.linearInterp(c,I,L),f=f.elements,c=O.center.clone().multiplyScalar(1-c).add(R.center.clone().multiplyScalar(c)),g=c.clone().sub((new THREE.Vector3(f[0],f[1],f[2])).multiplyScalar(g)),f=new THREE.Vector3(f[3],f[4],f[5]));l.center.copy(c);a.position.copy(g);a.up.copy(f);l.navApi.getUsePivotAlways()||
l.pivot.copy(c);a.lookAt(l.center);!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame(function(){l.sphericallyInterpolateTransition(b)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),b&&b());d(!1);p&&requestAnimationFrame(p.render)};this.getOrientation=function(){if(p){var b=Math.round1(a.up.x),c=Math.round1(a.up.y),d=Math.round1(a.up.z),g=this.sceneFrontDirection.clone(),f=this.sceneUpDirection.clone(),
h=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();g.x=Math.round1(g.x);g.y=Math.round1(g.y);g.z=Math.round1(g.z);f.x=Math.round1(f.x);f.y=Math.round1(f.y);f.z=Math.round1(f.z);h.x=Math.round1(h.x);h.y=Math.round1(h.y);h.z=Math.round1(h.z);var k=h.clone().multiplyScalar(-1),l=f.clone().multiplyScalar(-1),n=g.clone().multiplyScalar(-1);switch(p.currentFace){case "front":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(h.x==b&&h.y==c&&h.z==d)return"right";
if(k.x==b&&k.y==c&&k.z==d)return"left";break;case "right":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(n.x==b&&n.y==c&&n.z==d)return"left";if(g.x==b&&g.y==c&&g.z==d)return"right";break;case "left":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"left";if(n.x==b&&n.y==c&&n.z==d)return"right";break;case "back":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(k.x==b&&k.y==c&&k.z==
d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case "top":if(n.x==b&&n.y==c&&n.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"up";if(h.x==b&&h.y==c&&h.z==d)return"right";if(k.x==b&&k.y==c&&k.z==d)return"left";break;case "bottom":if(g.x==b&&g.y==c&&g.z==d)return"down";if(n.x==b&&n.y==c&&n.z==d)return"up";if(h.x==b&&h.y==c&&h.z==d)return"right";if(k.x==b&&k.y==c&&k.z==d)return"left"}}};this.setCameraOrtho=function(b){b&&a.isPerspective&&a.toOrthographic();b||a.isPerspective||a.toPerspective()};
this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho);this.sceneUpDirection.copy(this.originalHomeVector.worldUp);this.sceneFrontDirection.copy(this.originalHomeVector.worldFront);this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize();this.setCameraUp(this.sceneUpDirection);d(!0)};this.setCurrentViewAsFront=function(){p&&(p.currentFace="front");this.sceneUpDirection.copy(a.up.clone());this.sceneFrontDirection.copy(this.getView()).normalize();
this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize();this.orthographicFaces&&this.setCameraOrtho(!0);d(!0)};this.setCurrentViewAsTop=function(){p&&(p.currentFace="top");this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize();this.sceneFrontDirection.copy(a.up);this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize();d(!0)};this.calculateCubeTransform=function(b){var c=this.sceneUpDirection.clone(),d=this.sceneFrontDirection.clone(),
g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();O=a.clone();O.center=l.center.clone();O.pivot=l.pivot.clone();R=a.clone();R.center=l.center.clone();R.pivot=l.pivot.clone();var f=new THREE.Vector3(0,0,0);b.contains("back")&&(f=f.add(d));b.contains("front")&&(f=f.sub(d));b.contains("top")&&(f=f.add(c));b.contains("bottom")&&(f=f.sub(c));b.contains("right")&&(f=f.add(g));b.contains("left")&&(f=f.sub(g));b=c;var h=f.clone().normalize();if(1-Math.abs(h.dot(c))<Number.MIN_VALUE)for(var k=
this.getView().normalize(),d=[d.clone(),d.clone().negate(),g.clone(),g.clone().negate()],c=0<h.dot(c)?1:-1,k=k.clone().add(a.up.clone().multiplyScalar(c)).normalize(),g=-2,h=0;4>h;h++){var n=k.dot(d[h]);n>g&&(g=n,b=d[h].multiplyScalar(c))}L=I=this.getView().length();R.position.copy(R.center.clone().add(f.multiplyScalar(L/f.length())));R.up.copy(b);f=O.center.clone().sub(O.position).normalize();b=f.clone().cross(O.up).normalize();d=b.clone().cross(f).normalize();c=new THREE.Matrix3;c.set(f.x,d.x,b.x,
f.y,d.y,b.y,f.z,d.z,b.z);J.setFromRotationMatrix3(c);f=R.center.clone().sub(R.position).normalize();b=f.clone().cross(R.up).normalize();d=b.clone().cross(f).normalize();c.set(f.x,d.x,b.x,f.y,d.y,b.y,f.z,d.z,b.z);G.setFromAxisAngle(f,0);M.setFromAxisAngle(d,0);F.setFromRotationMatrix3(c);F.multiply(G).multiply(M).normalize()};this.centerShot=function(b){if(!O||b)l.elapsedTime=0,O=R=a.clone(),O.center=l.center;b=l.pivot.clone();var c=b.clone().sub(O.position),g=O.center.clone().sub(O.position).normalize(),
f=O.up.clone(),h=g.clone().cross(f).normalize(),f=h.clone().cross(g).normalize(),g=h.clone().multiplyScalar(h.dot(c)),c=f.clone().multiplyScalar(f.dot(c)),c=g.clone().add(c);R.position.copy(O.position.clone().add(c));R.center=b;R.pivot=b;b=0;l.elapsedTime>=K.duration?b=1:(b=Math.easeClamp(l.elapsedTime/K.duration,0,K.destinationPercent),l.elapsedTime+=z/2E3);c=a.position.clone().multiplyScalar(1-b).add(R.position.clone().multiplyScalar(b));f=l.center.clone().multiplyScalar(1-b).add(R.center.clone().multiplyScalar(b));
g=l.pivot.clone().multiplyScalar(1-b).add(R.pivot.clone().multiplyScalar(b));a.position.copy(c);l.center.copy(f);l.pivot.copy(g);a.lookAt(l.center);d(!1);1===b?this.addHistoryElement():requestAnimationFrame(function(){l.centerShot(!1)})};this.levelShot=function(){var b=this.getView(),c=b.length(),d=this.sceneUpDirection.clone(),g=a.up.clone().normalize(),b=b.normalize(),f=b.dot(d);1-Math.abs(f)>Number.MIN_VALUE?(g=b.clone().cross(d),b=d.clone().cross(g),b.normalize()):b=g.clone();b.multiplyScalar(c);
c={center:b.add(a.position),up:d,position:a.position,pivot:l.center.clone().add(b),fov:a.fov,worldUp:d};l.elapsedTime=0;l.animateTransition(c)};this.fitToWindow=function(){var b=this.getView(),c=a.up.clone();b.normalize();c.normalize();R=a.clone();R.center=l.center;var d=c,c=d.clone();if(!(Math.abs(c.clone().dot(b))<Number.MIN_VALUE)&&(b.normalize(),c=d.clone().dot(b),c=b.clone().multiplyScalar(c),c=d.clone().sub(c),c.length()<Number.MIN_VALUE)){for(var d=new THREE.Vector3(0,0,0),c=[new THREE.Vector3(0,
1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],g=0;7>g;g++)if(Math.abs(c[g].dot(b))<Number.MIN_VALUE){d=c[g];break}c=d}c.normalize();c.normalize();R.up.copy(c);g=b.clone().cross(c);g.normalize();var f=W.clone(),h=aa.clone(),k=[f,h],d=new THREE.Vector3(h.x-f.x,h.y-f.y,h.z-f.z);k[2]=new THREE.Vector3(h.x,f.y,h.z);k[3]=new THREE.Vector3(h.x,f.y,f.z);k[4]=new THREE.Vector3(h.x,h.y,f.z);k[5]=new THREE.Vector3(f.x,
h.y,h.z);k[6]=new THREE.Vector3(f.x,h.y,f.z);k[7]=new THREE.Vector3(f.x,f.y,h.z);for(f=0;8>f;f++)h=k[f].clone().sub(a.position),k[f].setX(h.clone().dot(g)),k[f].setY(h.clone().dot(c)),k[f].setZ(h.clone().dot(b));var f=THREE.Math.degToRad(a.topFov),h=THREE.Math.degToRad(a.bottomFov),n=THREE.Math.degToRad(a.leftFov),m=THREE.Math.degToRad(a.rightFov),z,q,t,w;z=0<=n?Number.MAX_VALUE:Number.MIN_VALUE;q=0<=m?Number.MAX_VALUE:Number.MIN_VALUE;t=0<=f?Number.MAX_VALUE:Number.MIN_VALUE;w=0<=h?Number.MAX_VALUE:
Number.MIN_VALUE;for(var E=1/Math.tan(m),p=-1/Math.tan(n),r=1/Math.tan(f),H=-1/Math.tan(h),B=0;8>B;B++){var L=k[B].clone(),C=L.z-p*L.x;z=0<=n?Math.min(z,C):Math.max(z,C);C=L.z-E*L.x;q=0<=m?Math.min(q,C):Math.max(q,C);C=L.z-r*L.y;t=0<=f?Math.min(t,C):Math.max(t,C);C=L.z-H*L.y;w=0<=h?Math.min(w,C):Math.max(w,C)}k=(q-z)/(p-E);z=p*k+z;w=(w-t)/(r-H);t=r*w+t;r=0;z<=t?(f=(f-h)/2,Math.abs(f)>Number.MIN_VALUE&&(f=1/Math.tan(f),w=w-t/f+z/f),r=z):(f=(m-n)/2,Math.abs(f)>Number.MIN_VALUE&&(f=1/Math.tan(f),k=k-
z/f+t/f),r=t);f=new THREE.Vector3(k,w,r);g=g.clone().multiplyScalar(f.x);c=c.clone().multiplyScalar(f.y);f=b.clone().multiplyScalar(f.z);f=g.clone().add(c.clone().add(f));R.position.add(f);c=d.clone().sub(R.position).dot(b);R.center=R.position.clone().add(b.multiplyScalar(c));R.pivot=d.clone();b={center:R.center,up:R.up,position:R.position,pivot:R.pivot,fov:a.fov,worldUp:l.sceneUpDirection.clone()};l.elapsedTime=0;l.animateTransition(b)};this.updatePivotPosition=function(b){var c;c=new THREE.Vector3(b.x/
window.innerWidth*2-1,2*-(b.y/window.innerHeight)+1,.5);c=c.unproject(a);c=(new THREE.Raycaster(a.position,c.sub(a.position).normalize())).intersectObjects(objects);if("zoom"==l.mode)if(void 0!==c[0])b=c[0].point,l.pivot.copy(b);else{b.y=Math.abs(b.y-window.innerHeight);var d=a.position;c=l.center.clone().sub(d);var g=a.up,f=c.clone().cross(g),h=c.clone().length(),k=h*Math.tan(THREE.Math.degToRad(a.leftFov)),n=h*Math.tan(THREE.Math.degToRad(a.rightFov)),m=h*Math.tan(THREE.Math.degToRad(a.topFov)),
h=h*Math.tan(THREE.Math.degToRad(a.bottomFov)),k=b.x*(k+n)/window.innerWidth-k;b=b.y*(m+h)/window.innerHeight-h;g=g.clone().normalize().clone().multiplyScalar(b);f=f.clone().normalize().clone().multiplyScalar(k);l.ortho?b=d.clone().add(f).clone().add(g):(b=d,c=c.clone().add(g).clone().add(f));l.pivot.copy(b.clone().add(c))}else void 0!==c[0]?(wheel.cursorImage("pivot"),b=c[0].point,l.isMouseDown||l.pivot.copy(b)):wheel.cursorImage("SWInvalidArea")};this.onDrawHeight=function(b,c,d,g,f){b=new THREE.Vector3(0,
1,0);b=a.position.clone().dot(b);b=Math.linearClamp(b,l.minSceneBound,l.maxSceneBound)-.5;A&&(A.find("img#updownImageA").remove(),A.prepend('<img src="'+f+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(d-86*b)+"px; left:"+c+'px;"/>'),g||A.prepend('<img src="'+f+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(d-86*b)+"px; left:"+c+'px;"/>'))};this.drawDropdownMenu=function(a,b,d,g,f,h,k){var l=0;if(r)h.appendChild(r);else{r=document.createElement("div");
r.className="dropDownMenu";r.style.top="100px";r.style.left="-400px";for(var n=0,m=0;m<a.length;m++){var z;if(null===a[m])z=document.createElement("li"),z.style.height="1px",n+=1,z.style.backgroundColor="#E0E0E0";else{var q=Autodesk.Viewing.i18n.translate(a[m]);if(d[m]){z=document.createElement("div");var t=document.createElement("input"),w=document.createElement("label");t.type="radio";t.className="dropDownMenuCheck";w.innerHTML=q;w.className="dropDownMenuCheckText";z.appendChild(t);z.appendChild(w);
z.className="dropDownMenuCheckbox"}else z=document.createElement("li"),z.textContent=q,z.className=b[m]?"dropDownMenuItem":"dropDownMenuItemDisabled";z.id="menuItem"+l;l++;n+=25;z.setAttribute("data-i18n",a[m])}r.appendChild(z)}h.appendChild(r);l=r.getBoundingClientRect().width;this.menuSize.x=l;this.menuSize.y=n}for(m=l=0;m<a.length;m++)null!==a[m]&&(d[m]&&(n=document.getElementById("menuItem"+l))&&(n.children[0].checked=d[m]()),l++);a=f-15;d=g+1;f=c.getBoundingClientRect();d+this.menuSize.x>f.right&&
(d=g-this.menuSize.x-1);a+this.menuSize.y>f.bottom&&(a=f.bottom-this.menuSize.y);a-=k.y;d-=k.x;r.style.top=a+"px";r.style.left=d+"px";this.menuOrigin.x=d;this.menuOrigin.y=a};this.removeDropdownMenu=function(a){a.removeChild(r)};this.isFaceView=function(){var b=this.center.clone().sub(a.position).normalize();return q(b)&&q(a.up)};this.startInteraction=function(a,b){this.startCursor=new THREE.Vector2(a,b);this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),
saveUp:this.camera.up.clone()};this.lockDeltaX=0;this.lockedX=!1;this.lockDeltaY=this.lastSnapRotateX=0;this.lockedY=!1;this.lastSnapRotateY=0;this.lastSnapDir=new THREE.Vector3(0,0,0)};this.orbit=function(b,c,g,f){if(!this.navApi.getIsLocked()&&!0!==this.currentlyAnimating){var n="wheel";l.orthographicFaces&&!a.isPerspective&&(a.toPerspective(),f&&f.saveEye.copy(this.camera.position));f&&(n="cube");"cube"==n?(this.saveCenter.copy(f.saveCenter),this.saveEye.copy(f.saveEye),this.savePivot.copy(f.savePivot),
this.saveUp.copy(f.saveUp),this.doCustomOrbit=this.useSnap=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(a.position),this.saveUp.copy(a.up),this.doCustomOrbit=this.useSnap=!1);l.combined&&void 0==E&&(E=this.saveCenter.clone(),w=this.saveEye.clone(),D=this.savePivot.clone(),B=this.saveUp.clone());if(this.preserveOrbitUpDirection){var n=h(b.x-c.x,b.y-c.y),m=h(g.x,g.y);c=this.sceneUpDirection.clone();var z=this.sceneFrontDirection.clone(),q=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();
g=l.combined?D:this.savePivot;f=l.combined?w:this.saveEye;var t=l.combined?E:this.saveCenter,p=l.combined?B:this.saveUp,r=g.clone().sub(f).normalize(),H=t.clone().sub(f).normalize(),L=H.clone().cross(p);b=f.clone().sub(g).length();f=f.clone().sub(t).length();r=r.clone().multiplyScalar(-1);H=H.clone().multiplyScalar(-1);p=p.clone();this.constrainOrbitHorizontal||(-.009>c.dot(this.saveUp)&&(n.x=-n.x,m.x=-m.x),t=0,this.lastSnapRotateX=t=l.combined?m.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+
k("h",0,-m.x):n.x*this.orbitMultiplier,t=(new THREE.Quaternion).setFromAxisAngle(c,-t),r.applyQuaternion(t),H.applyQuaternion(t),L.applyQuaternion(t),p.applyQuaternion(t));this.constrainOrbitVertical||(z=z.clone().multiplyScalar(z.dot(L)),q=q.clone().multiplyScalar(q.dot(L)),q=z.clone().add(q),q.clone().normalize(),L=0,l.combined?L=m.y*this.orbitMultiplier:(m=k("v",0,m.y),L=this.useSnap?this.lastSnapRotateY+m:n.y*this.orbitMultiplier),n=(new THREE.Quaternion).setFromAxisAngle(q,-L),this.navApi.getOrbitPastWorldPoles()||
(m=p.clone(),m.applyQuaternion(n).normalize(),0>c.dot(m)&&(m=H.clone(),m.applyQuaternion(n).normalize(),c=m.angleTo(c),Math.abs(c)>.5*Math.PI&&(c-=0<c?Math.PI:-Math.PI),L-=c,n.setFromAxisAngle(q,-L))),r.applyQuaternion(n).normalize(),H.applyQuaternion(n).normalize(),p.applyQuaternion(n).normalize(),this.lastSnapRotateY=L);g=r.multiplyScalar(b).add(g);a.position.copy(g);a.up.copy(p);this.center.copy(g);this.center.sub(H.multiplyScalar(f));l.combined&&(E.copy(this.center),w.copy(a.position),D.copy(this.pivot),
B.copy(a.up))}a.lookAt(this.center);d(!1)}};this.endInteraction=function(){};this.look=function(b){if(!this.navApi.getIsLocked()){var c=h(b.x,b.y),g=this.userLookSpeed;b=this.getView();var f=a.up,k=b.clone().cross(f).normalize(),n=this.sceneUpDirection.clone(),c=c.clone();c.x*=Math.PI;c.y*=Math.PI/a.aspect;c.multiplyScalar(g);g=(new THREE.Quaternion).setFromAxisAngle(k,-c.y);if(a.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var l=f.clone();l.applyQuaternion(g).normalize();0>l.dot(n)&&
(l=b.clone(),l.applyQuaternion(g),l=l.angleTo(n),Math.abs(l)>.5*Math.PI&&(l-=0<l?Math.PI:-Math.PI),c.y-=l,g.setFromAxisAngle(k,-c.y))}b=g.clone().rotate(b);f=g.clone().rotate(f);f.normalize();k=a.keepSceneUpright?n:f;k=(new THREE.Quaternion).setFromAxisAngle(k,-c.x);b=k.clone().rotate(b);f=k.clone().rotate(f);this.center.copy(b.add(a.position));a.up.copy(f);a.lookAt(this.center);d(!1)}};this.pan=function(b){if(!this.navApi.getIsLocked()){b=h(b.x,b.y);var c=this.getView(),g=a.up.clone().cross(c),f=
c.clone().cross(g);g.normalize();f.normalize();c.normalize();var k=this.pivot.clone().sub(a.position),k=c.clone().dot(k),c=k*(Math.tan(THREE.Math.degToRad(a.leftFov))+Math.tan(THREE.Math.degToRad(a.rightFov))),k=k*(Math.tan(THREE.Math.degToRad(a.topFov))+Math.tan(THREE.Math.degToRad(a.bottomFov))),c=b.x*Math.abs(c);b=b.y*Math.abs(k);k=new THREE.Vector3;g=g.clone().multiplyScalar(c);f=f.clone().multiplyScalar(b);k=g.clone().add(f).clone().multiplyScalar(this.userPanSpeed);a.position.add(k);this.center.add(k);
a.lookAt(this.center);d(!1)}};this.zoom=function(b){if(!this.navApi.getIsLocked()){var c=this.userZoomSpeed,g=Number.MAX_VALUE;b=b.x+b.y;var f=Math.pow(c,b),h=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(f)),k=h.clone().add(l.D.clone().multiplyScalar(l.D.clone().dot(this.pivot.clone().sub(h).clone())));if(!(f>=g)){if(0<b){Math.pow(c,b-0);if(0>b)return;a.position.copy(h);this.center.copy(k);h.clone().sub(this.saveEye).dot(l.D)>g&&a.position.copy(this.saveEye.sub(l.D).clone().multiplyScalar(g))}else a.position.copy(h),
this.center.copy(k);a.lookAt(this.center);d(!1)}}};this.walk=function(b,c,g,f,k){if(!this.navApi.getIsLocked()){g=this.sceneUpDirection.clone();f=this.sceneFrontDirection.clone();k=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);m(b,c)?(wheel.cursorImage("SWWalk"),n(!0,b,c),x=c.x,y=c.y):n(!1,b,c);x=b.x;y=b.y;var l=h(x-c.x,y-c.y),z=-l.x,q=-l.y,t=0>z?-1:1,l=0>q?-1:1,w=Math.abs(z),E=Math.abs(q),E=new THREE.Vector2(30,30),E=h(E.x,E.y),w=m(b,c)?0:Math.abs(z)-E.x,E=m(b,c)?0:Math.abs(q)-E.y,
w=w/.25,E=E/.25,w=1>w?Math.easeClamp(w,0,1):Math.pow(w,1),E=1>E?Math.easeClamp(E,0,1):Math.pow(E,1),z=0<w?w*t:0,l=0<E?E*l:0;b=this.getView();c=b.length();b.normalize();b.clone().cross(a.up).normalize();k=k.clone().multiplyScalar(k.clone().dot(b));k=f.clone().multiplyScalar(f.clone().dot(b)).clone().add(k);k=k.clone().length()>Number.MIN_VALUE?k.normalize():a.up;f=1*l*this.walkMultiplier;l=Math.cos(.65);1!=l&&(g.clone().dot(a.up)<-Number.MIN_VALUE&&g.clone().dot(b)<-l||g.clone().dot(a.up)>Number.MIN_VALUE&&
g.clone().dot(b)>l)&&(k=-k);z=-z*this.walkMultiplier*.05;l=a.up;if(g.clone().dot(a.up)<-Number.MIN_VALUE||Math.abs(g.clone().dot(a.up))<Number.MIN_VALUE&&g.clone().dot(b)>Number.MIN_VALUE)z=-z;l=g;z=(new THREE.Quaternion).setFromAxisAngle(l,z);z.normalize();b=z.clone().rotate(b);b.normalize();a.up.copy(z.clone().rotate(a.up));a.up.normalize();a.position.add(k.clone().multiplyScalar(f));this.center.copy(a.position.clone().add(b.clone().multiplyScalar(c)));g.normalize();a.lookAt(this.center);d(!1)}};
this.updown=function(b){if(!this.navApi.getIsLocked()){var c=Math.pow(b,2);0>b&&(c=-c);c=h(0,c);c.y=.01*c.y*(l.maxSceneBound-l.minSceneBound);c=l.userHeightSpeed*c.y;var g=l.m_amount;if(0===b)c=0;else{var f=l.saveEye.clone().sub(worldUp.clone().multiplyScalar(g+c)),g=l.saveEye.clone().sub(worldUp.clone().multiplyScalar(g)),k=0,k=(l.maxSceneBound-l.minSceneBound)/1E3;l.topLimit&&0<b?(k=l.maxSceneBound-k,l.topLimit=!1):l.bottomLimit&&0>b?(k=l.minSceneBound+k,l.bottomLimit=!1):k=f.dot(worldUp);b=g.dot(worldUp);
k<l.minSceneBound?b<l.minSceneBound&&(l.bottomLimit=!0,c=0):k>l.maxSceneBound&&b>l.maxSceneBound&&(l.topLimit=!0,c=0)}l.m_amount+=c;b=new THREE.Vector3(0,1,0);c=l.saveEye.clone().sub(b.clone().multiplyScalar(l.m_amount));f=c.clone().dot(b);a.position.copy(c);f<l.minSceneBound&&a.position.add(b.clone().multiplyScalar(l.minSceneBound-f));f>l.maxSceneBound&&a.position.add(b.clone().multiplyScalar(l.maxSceneBound-f));this.center.copy(a.position.clone().add(l.saveCenter.clone().sub(l.saveEye)));a.lookAt(this.center);
d(!1)}};this.addHistoryElement=function(){};this.addIntermediateHistoryElement=function(){this.rewindParams.history=this.rewindParams.snapped?this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):0<this.rewindParams.slideOffset.x?this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1);this.addHistoryElement()};this.clearHistory=function(){this.rewindParams.history.length=0;this.rewindParams.timelineIndex=
0;this.rewindParams.timelineIndexSlide=0;this.rewindParams.resetWeights=!0};this.openTimeline=function(a){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex;this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled);0===this.rewindParams.history.length&&this.addHistoryElement();for(var b=0;b<this.rewindParams.history.length;b++){var c=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[b].thumbnailBounds.setCenter((new THREE.Vector2(a.x+
(b-this.rewindParams.timelineIndex)*c,a.y)).add(this.rewindParams.slideOffset));this.rewindParams.resetWeights&&(this.rewindParams.history[b].weight=b==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);this.rewindParams.open=!0;this.rewindParams.openLocation=a.clone();this.rewindParams.openLocationOrigin=a.clone();this.rewindParams.openBracket=a.clone();this.rewindParams.openBracketA=
new THREE.Vector2(c,a.y);this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-c,a.y);this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x&&(a=this.rewindParams.openBracketA.x,this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=a);this.rewindParams.locationOffset=new THREE.Vector2(0,0);this.rewindParams.snapOffset=new THREE.Vector2(0,0)};this.slideTimeline=function(a){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var b=
a.clone().add(this.rewindParams.locationOffset),c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);a=window.innerWidth-c;var d=this.rewindParams.history[0].thumbnailBounds.center().x,g=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,f=0;b.x<this.rewindParams.openBracketA.x&&(f=b.x-this.rewindParams.openBracketA.x,d-=f,c<d&&(f=Math.min(f+(d-c),0)));b.x>this.rewindParams.openBracketB.x&&(f=b.x-this.rewindParams.openBracketB.x,c=g-f,a>c&&
(f=Math.max(f+(c-a),0)));this.rewindParams.openLocation.x+=f;this.rewindParams.openBracketA.x+=f;this.rewindParams.openBracketB.x+=f;this.rewindParams.openBracket.x=b.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);a=new THREE.Vector2(-f,0);b=b.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));a.x+=this.rewindParams.snapOffset.x;this.rewindParams.snapOffset.x=0;c=!1;if(this.rewindParams.snappingEnabled)for(g=0;g<this.rewindParams.history.length;g++)if(d=
this.rewindParams.history[g].thumbnailBounds.center().add(a),4>Math.abs(d.x-b.x)||this.rewindParams.snapped&&16>Math.abs(d.x-b.x)){c=!0;0!==f?(this.rewindParams.snapOffset.x=d.x-b.x,a.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=d.x-b.x;b.x=d.x;break}this.rewindParams.snapped=c;c=-1;for(g=f=0;g<this.rewindParams.history.length;g++){d=this.rewindParams.history[g].thumbnailBounds.clone();this.rewindParams.history[g].thumbnailBounds.setCenter(this.rewindParams.history[g].thumbnailBounds.center().add(a));
if(this.rewindParams.history[g].thumbnail){var h=this.rewindParams.history[g].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+g).css("left",h);$("#rewindBorder"+g).css("left",h-4)}h=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));d.setFromCenterAndSize(d.center(),h);h=new THREE.Vector2(0,0);d.getIcon2DCoords(b,h);h=1-Math.abs(Math.equalityClamp(h.x,-1,1));
this.rewindParams.history[g].weight=h;0===g&&b.x<d.center().x&&(this.rewindParams.history[g].weight=1);g===this.rewindParams.history.length-1&&b.x>d.center().x&&(this.rewindParams.history[g].weight=1);f+=this.rewindParams.history[g].weight;this.rewindParams.history[g].weight>c&&(c=this.rewindParams.history[g].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[g].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[g].thumbnailBounds.center().x-
b.x,this.rewindParams.timelineIndexSlide=g)}for(a=0;a<this.rewindParams.history.length;a++)this.rewindParams.history[a].weight/=f;a=this.rewindParams.history[0].thumbnailBounds.center().x;b=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<a?(this.rewindParams.locationOffset.x+=a-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=a):this.rewindParams.openBracket.x>b&&(this.rewindParams.locationOffset.x+=b-this.rewindParams.openBracket.x,
this.rewindParams.openBracket.x=b)}};this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(0<this.rewindParams.timelineIndex||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||0<this.rewindParams.slideOffset.x)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,l.elapsedTime=0,this.animateToRewindIndex())};this.animateToRewindIndex=function(){var b=this.rewindParams.timelineIndex,
c=0;l.elapsedTime>=K.duration?c=1:(c=Math.easeClamp(l.elapsedTime/K.duration,0,K.destinationPercent),l.elapsedTime+=z/500);l.center.copy(l.center.clone().multiplyScalar(1-c).clone().add(this.rewindParams.history[b].camera.center.clone().multiplyScalar(c)));a.position.copy(a.position.clone().multiplyScalar(1-c).clone().add(this.rewindParams.history[b].camera.position.clone().multiplyScalar(c)));a.up.copy(this.rewindParams.history[b].camera.up);l.pivot.copy(l.center);a.lookAt(l.center);d(!1);p&&requestAnimationFrame(p.render);
1!==c&&requestAnimationFrame(function(){l.animateToRewindIndex()})};this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide);this.rewindParams.open=!1};this.getInterpolatedCamera=function(){var b=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1E4);b.center=new THREE.Vector3(0,0,0);b.pivot=new THREE.Vector3(0,0,0);b.leftFov=0;b.rightFov=0;b.topFov=0;b.bottomFov=
0;b.up.set(0,0,0);for(var c=0;c<this.rewindParams.history.length;c++){var g=this.rewindParams.history[c].camera,f=this.rewindParams.history[c].weight;b.center.add(g.center.clone().multiplyScalar(f));b.position.add(g.position.clone().multiplyScalar(f));b.up.add(g.up.clone().multiplyScalar(f));b.rotation.add(g.rotation.clone().multiplyScalar(f));b.pivot.add(g.pivot.clone().multiplyScalar(f));b.leftFov+=g.leftFov*f;b.rightFov+=g.rightFov*f;b.topFov+=g.topFov*f;b.bottomFov+=g.bottomFov*f}a.position.copy(b.position);
a.up.copy(b.up);a.rotation=b.rotation;a.leftFov=b.leftFov;a.rightFov=b.rightFov;a.topFov=b.topFov;a.bottomFov=b.bottomFov;l.center.copy(b.center);l.pivot.copy(b.pivot);a.lookAt(l.center);a.up.normalize();d(!1)}};
Autocam.ViewCube=function(a,b,c,f){function g(a,b){var c={};0===a.type.indexOf("touch")?0<a.touches.length?(c.clientX=a.touches[0].clientX,c.clientY=a.touches[0].clientY,c.pageX=a.touches[0].pageX,c.pageY=a.touches[0].pageY,c.screenX=a.touches[0].screenX,c.screenY=a.touches[0].screenY,c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY,c.which=h.navApi.getUseLeftHandedInput()?3:1):c=b.prevCoords:(c.clientX=a.clientX,c.clientY=a.clientY,c.pageX=a.pageX,c.pageY=a.pageY,c.screenX=a.screenX,c.screenY=
a.screenY,c.which=a.which,V?(c.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,c.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0):(c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY));b.prevX=c.screenX;b.prevY=c.screenY;return b.prevCoords=c}var d=this,h=b,k=b.camera;b.setCube(this);d.currentFace="front";var m="top,front;top right;top,left;top,back;bottom,front;bottom,right;bottom,left;bottom,back;left,front;front,right;right,back;back,left".split(";"),n="front,top,right back,top,right front,top,left back,top,left front,bottom,right back,bottom,right front,bottom,left back,bottom,left".split(" "),
q=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],l=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],p=[null,null,function(){return!h.orthographicFaces&&!k.isPerspective},function(){return!h.orthographicFaces&&k.isPerspective},function(){return h.orthographicFaces},null,null,null,null,null,null,null,null],r,A,C,H,z,t,w;d.camera=
new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2E3);d.camera.position.copy(k.position);d.center=new THREE.Vector3(0,0,0);d.camera.lookAt(d.center);var E,B,D,J,F,G=[],M,I=[],L=[],K=[],O=[],R=null,X=null,W=null,aa,fa,U,P,Z,S=0,N,ia=0,ea=!0,V=!1,ca=!1,Y=-1!=navigator.userAgent.search("Chrome"),sa=-1!=navigator.platform.search("Win32"),ha=!1,da=!1,ba=[];this.height=this.width=0;this.animSpeed=500;this.animate=!0;this.compass=!1;this.viewScaleFactorCompass=1.5;this.viewScale=1;this.draggable=
!0;this.wantHomeButton=!1;this.wantContextMenu=this.wantRollArrows=!0;this.inactiveOpacity=.5;var za=function(a){a=a.getBoundingClientRect();return{x:a.left,y:a.top,w:a.width,h:a.height}},Ha=function(){h.navApi.getIsLocked()||(c.style.opacity="1.0",da=!1);requestAnimationFrame(d.render)},la=function(a){if(da||h.viewCubeMenuOpen||h.navApi.getIsLocked())h.navApi.getIsLocked()||(c.style.opacity=1);else{var b=Math.max(4*Math.abs((a.clientX-N.x)/N.w-.5)-1,0);a=Math.max(4*Math.abs((a.clientY-N.y)/N.h-.5)-
1,0);b=Math.max(0,Math.min(Math.sqrt(b*b+a*a),1));c.style.opacity=1-b*(1-d.inactiveOpacity)}},Fa=function(){h.viewCubeMenuOpen||(c.style.opacity=d.inactiveOpacity,da=!0,requestAnimationFrame(d.render))},qa=function(a){var b=new Image;b.crossOrigin="anonymous";var c=new THREE.Texture(b);b.onload=function(){c.needsUpdate=!0;ia++;11<=ia&&requestAnimationFrame(d.render)};b.src=a;return c},xa=function(a,b,c){var d=new THREE.Vector3;d.copy(a);d=d.unproject(b);return(new THREE.Raycaster(b.position,d.sub(b.position).normalize())).intersectObjects(c)},
Ka=function(a,b){var c=a.clientX-b.x,d=a.clientY-b.y,c=c/b.w*2-1,d=(b.h-d)/b.h*2-1;return new THREE.Vector3(c,d,.5)},Ja=function(a){a.preventDefault();a.stopPropagation();if(!h.navApi.getIsLocked()&&!h.currentlyAnimating){a=g(a,d);N=za(c);c.removeEventListener("mousemove",Ea,!1);document.addEventListener("mouseup",Aa,!1);document.addEventListener("touchend",Aa,!1);h.navApi.getUsePivotAlways()||(h.pivot.copy(h.center),h.navApi.setPivotPoint(h.center),h.navApi.setPivotSetFlag(!1));h.startInteraction(a.pageX,
a.pageY);0==h.rewindParams.history.length&&h.addHistoryElement();h.rewindParams.snapped&&h.rewindParams.timelineIndex+1==h.rewindParams.history.length||h.addIntermediateHistoryElement();var b=h.navApi.getUseLeftHandedInput()?1:3;a.which!==b&&(0>=d.animSpeed?console.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation"):(a=Ka(a,N),a=xa(a,d.camera,O),0<a.length&&(Ga(),d.draggable&&(document.addEventListener("mousemove",Ba,!1),document.addEventListener("touchmove",
Ba,!1),V&&(c.requestPointerLock(),ca=Y&&sa)))))}},Ba=function(a){a.preventDefault();a.stopPropagation();0>=d.animSpeed?(document.removeEventListener("mousemove",Ba,!1),document.removeEventListener("touchmove",Ba,!1),console.error("animSpeed cannot be 0 or less")):h.currentlyAnimating||(a=g(a,d),V&&ca&&(ca=!1,a.movementX=a.movementY=0),a.movementX===a.movementY&&0===a.movementX?h.currentlyAnimating=!1:(ea=!1,ha=!0,h.showPivot(!0),h.currentCursor=new THREE.Vector2(a.pageX,a.pageY),h.orbit(h.currentCursor,
h.startCursor,new THREE.Vector3(-a.movementX,a.movementY,0),h.startState),d.camera.lookAt(d.center),requestAnimationFrame(d.render)))},Da=function(a){a||(document.removeEventListener("mouseup",Aa,!1),document.removeEventListener("touchend",Aa,!1));document.removeEventListener("mousemove",Ba,!1);document.removeEventListener("touchmove",Ba,!1);c.addEventListener("mousemove",Ea,!1)},Aa=function(a){a.preventDefault();a.stopPropagation();var b,f,n;if(h.currentlyAnimating||ha)h.endInteraction(),h.showPivot(!1),
ha=!1,Da(!1);else{var m=g(a,d);if(h.viewCubeMenuOpen){a=m.clientX-N.x;b=m.clientY-N.y;if(h.menuOrigin.x<=a&&a<=h.menuOrigin.x+h.menuSize.x&&h.menuOrigin.y<=b&&b<=h.menuOrigin.y+h.menuSize.y)switch(Math.floor((b-5-h.menuOrigin.y)/25)){case 0:h.goHome();break;case 1:h.setOrthographicFaces(!1);h.toOrthographic();break;case 2:h.setOrthographicFaces(!1);h.toPerspective();break;case 3:h.setOrthographicFaces(!0);ea?h.toOrthographic():h.toPerspective();break;case 4:h.setCurrentViewAsHome(!1);break;case 5:h.setCurrentViewAsHome(!0);
break;case 6:h.resetHome();break;case 7:h.setCurrentViewAsFront();break;case 8:h.setCurrentViewAsTop();break;case 9:h.resetOrientation()}h.viewCubeMenuOpen=!1;h.removeDropdownMenu(c);(m.clientX<N.x||m.clientX>N.w+N.x||m.clientY<N.y||m.clientY>N.h+N.y)&&Fa();d.mouseMoveSave&&d.processMouseMove(d.mouseMoveSave);Da(!1)}else if(b=h.navApi.getUseLeftHandedInput()?1:3,m.which===b)h.viewCubeMenuOpen=!0,h.drawDropdownMenu(q,l,p,m.clientX,m.clientY,c,N),Da(!0);else{n=Ka(m,N);b=xa(n,d.camera,O);f=xa(n,w,I);
n=xa(n,w,K);if(0<f.length&&ea){var z=h.getOrientation();switch(d.currentFace){case "front":switch(z){case "up":f[0].object===I[0]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[1]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[2]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[3]&&(h.calculateCubeTransform("left"),d.currentFace="left");break;case "right":f[0].object===I[0]?(h.calculateCubeTransform("right"),d.currentFace=
"right"):f[0].object===I[1]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[2]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[3]&&(h.calculateCubeTransform("top"),d.currentFace="top");break;case "down":f[0].object===I[0]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[1]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[2]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[3]&&
(h.calculateCubeTransform("right"),d.currentFace="right");break;case "left":f[0].object===I[0]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[1]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[2]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[3]&&(h.calculateCubeTransform("bottom"),d.currentFace="bottom")}break;case "right":switch(z){case "up":f[0].object===I[0]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===
I[1]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[2]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[3]&&(h.calculateCubeTransform("front"),d.currentFace="front");break;case "right":f[0].object===I[0]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[1]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[2]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[3]&&(h.calculateCubeTransform("top"),
d.currentFace="top");break;case "down":f[0].object===I[0]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[1]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[2]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[3]&&(h.calculateCubeTransform("back"),d.currentFace="back");break;case "left":f[0].object===I[0]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[1]?(h.calculateCubeTransform("back"),d.currentFace=
"back"):f[0].object===I[2]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[3]&&(h.calculateCubeTransform("bottom"),d.currentFace="bottom")}break;case "left":switch(z){case "up":f[0].object===I[0]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[1]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[2]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[3]&&(h.calculateCubeTransform("back"),d.currentFace="back");
break;case "right":f[0].object===I[0]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[1]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[2]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[3]&&(h.calculateCubeTransform("top"),d.currentFace="top");break;case "down":f[0].object===I[0]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[1]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===
I[2]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[3]&&(h.calculateCubeTransform("front"),d.currentFace="front");break;case "left":f[0].object===I[0]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[1]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[2]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[3]&&(h.calculateCubeTransform("bottom"),d.currentFace="bottom")}break;case "back":switch(z){case "up":f[0].object===
I[0]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[1]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[2]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[3]&&(h.calculateCubeTransform("right"),d.currentFace="right");break;case "right":f[0].object===I[0]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[1]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[2]?(h.calculateCubeTransform("bottom"),
d.currentFace="bottom"):f[0].object===I[3]&&(h.calculateCubeTransform("top"),d.currentFace="top");break;case "down":f[0].object===I[0]?(h.calculateCubeTransform("bottom"),d.currentFace="bottom"):f[0].object===I[1]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[2]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[3]&&(h.calculateCubeTransform("left"),d.currentFace="left");break;case "left":f[0].object===I[0]?(h.calculateCubeTransform("right"),d.currentFace=
"right"):f[0].object===I[1]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[2]?(h.calculateCubeTransform("top"),d.currentFace="top"):f[0].object===I[3]&&(h.calculateCubeTransform("bottom"),d.currentFace="bottom")}break;case "top":switch(z){case "up":f[0].object===I[0]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[1]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[2]?(h.calculateCubeTransform("right"),d.currentFace="right"):
f[0].object===I[3]&&(h.calculateCubeTransform("left"),d.currentFace="left");break;case "right":f[0].object===I[0]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[1]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[2]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[3]&&(h.calculateCubeTransform("back"),d.currentFace="back");break;case "down":f[0].object===I[0]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===
I[1]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[2]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[3]&&(h.calculateCubeTransform("right"),d.currentFace="right");break;case "left":f[0].object===I[0]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[1]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[2]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[3]&&(h.calculateCubeTransform("front"),
d.currentFace="front")}break;case "bottom":switch(z){case "up":f[0].object===I[0]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[1]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[2]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[3]&&(h.calculateCubeTransform("left"),d.currentFace="left");break;case "right":f[0].object===I[0]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[1]?(h.calculateCubeTransform("left"),
d.currentFace="left"):f[0].object===I[2]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[3]&&(h.calculateCubeTransform("front"),d.currentFace="front");break;case "down":f[0].object===I[0]?(h.calculateCubeTransform("back"),d.currentFace="back"):f[0].object===I[1]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[2]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[3]&&(h.calculateCubeTransform("right"),d.currentFace="right");break;
case "left":f[0].object===I[0]?(h.calculateCubeTransform("left"),d.currentFace="left"):f[0].object===I[1]?(h.calculateCubeTransform("right"),d.currentFace="right"):f[0].object===I[2]?(h.calculateCubeTransform("front"),d.currentFace="front"):f[0].object===I[3]&&(h.calculateCubeTransform("back"),d.currentFace="back")}}h.elapsedTime=0;h.sphericallyInterpolateTransition()}if(0<n.length){h.elapsedTime=0;if(d.wantHomeButton&&n[0].object===K[P]){h.goHome();Da(!1);return}if(d.wantContextMenu&&n[0].object===
K[Z]){h.viewCubeMenuOpen=!0;h.drawDropdownMenu(q,l,p,m.clientX,m.clientY,c,N);Da(!0);return}d.wantRollArrows&&ea&&(n[0].object===K[aa]||n[0].object===K[fa])&&(m=n[0].object===K[fa],f={center:h.center.clone(),position:k.position.clone(),pivot:k.pivot.clone(),fov:k.fov,worldUp:h.sceneUpDirection.clone(),isOrtho:!1===k.isPerspective},n=h.center.clone().sub(k.position).normalize(),m?f.up=k.up.clone().cross(n):(f.up=k.up.clone().multiplyScalar(-1),f.up.cross(n)),f.up.normalize(),h.elapsedTime=0,h.animateTransition(f))}0<
b.length&&(d.currentFace=b[0].object.name,h.orthographicFaces&&-1!==d.currentFace.indexOf(",")&&h.setCameraOrtho(!1),h.calculateCubeTransform(d.currentFace),h.elapsedTime=0,d.mouseMoveSave=a,h.sphericallyInterpolateTransition(function(){d.mouseMoveSave&&d.processMouseMove(d.mouseMoveSave)}));Da(!1)}}};this.processMouseMove=function(a){var b,c;if(h.viewCubeMenuOpen||h.currentlyAnimating)d.mouseMoveSave=a;else{d.mouseMoveSave=null;a=g(a,d);c=Ka(a,N);a=xa(c,d.camera,L);b=xa(c,w,I);c=xa(c,w,K);R&&!ha&&
(R.material.color.setHex(14540253),R=null,requestAnimationFrame(d.render));if(0<b.length&&!ha){R=b[0].object;for(b=M.children.length;0<=--b;)if(R===I[b]){R=M.children[b];R.material.color.setHex(45055);break}requestAnimationFrame(d.render)}X&&!ha&&(X.material.opacity=0,X=null,requestAnimationFrame(d.render));0<a.length&&!ha&&(X=a[0].object,X.material.opacity=.3,requestAnimationFrame(d.render));0<c.length&&!ha?W!==c[0].object&&(d.wantHomeButton&&c[0].object===K[P]?(W=c[0].object,K[P].material.map=ba[0]):
d.wantRollArrows&&c[0].object===K[aa]?(W=c[0].object,K[U].material.map=ba[1]):d.wantRollArrows&&c[0].object===K[fa]?(W=c[0].object,K[U].material.map=ba[2]):d.wantContextMenu&&c[0].object===K[Z]?(W=c[0].object,K[Z].material.map=ba[6]):d.wantHomeButton&&W===K[P]?(W=null,K[P].material.map=ba[3]):!d.wantRollArrows||W!==K[aa]&&W!==K[fa]&&W!==K[U]?d.wantContextMenu&&W===K[Z]&&(W=null,K[Z].material.map=ba[5]):(W=null,K[U].material.map=ba[4]),requestAnimationFrame(d.render)):null===W||ha||(d.wantHomeButton&&
W===K[P]?(W=null,K[P].material.map=ba[3]):!d.wantRollArrows||W!==K[aa]&&W!==K[fa]&&W!==K[U]?d.wantContextMenu&&W===K[Z]&&(W=null,K[Z].material.map=ba[5]):(W=null,K[U].material.map=ba[4]),requestAnimationFrame(d.render))}};var Ea=function(a){h.navApi.getIsLocked()||d.processMouseMove(a)},Na=function(){N=za(c);d.width=c.offsetWidth;d.height=c.offsetHeight;d.camera.aspect=d.width/d.height;d.camera.updateProjectionMatrix();d.camera.topFov=d.camera.bottomFov=d.camera.fov/2;d.camera.leftFov=d.camera.rightFov=
d.camera.aspect*d.camera.fov/2;t.setSize(d.width,d.height);requestAnimationFrame(d.render)},na=function(a,b){var c,d=new THREE.Geometry;c=new THREE.Vector3(0,0,0);var g=new THREE.Vector3(60,-60,105),f=new THREE.Vector3(60,60,105),h=new THREE.Vector3(-60,60,105),k=new THREE.Vector3(-60,-60,105);d.vertices.push(c);d.vertices.push(g);d.vertices.push(f);d.vertices.push(h);d.vertices.push(k);d.faces.push(new THREE.Face3(1,2,3));d.faces.push(new THREE.Face3(1,3,4));d.applyMatrix((new THREE.Matrix4).makeRotationX(a));
d.applyMatrix((new THREE.Matrix4).makeRotationY(b));d.computeFaceNormals();d.computeVertexNormals();c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0});return new THREE.Mesh(d,c)},oa=function(a,b,c){var d=new THREE.Geometry,g=new THREE.Vector3(60,105,105),f=new THREE.Vector3(-60,105,105),h=new THREE.Vector3(-60,60,105),k=new THREE.Vector3(60,60,105),l=new THREE.Vector3(60,105,60),n=new THREE.Vector3(-60,105,60),m=new THREE.Vector3(-60,105,105),z=new THREE.Vector3(60,
105,105);d.vertices.push(g);d.vertices.push(f);d.vertices.push(h);d.vertices.push(k);d.vertices.push(l);d.vertices.push(n);d.vertices.push(m);d.vertices.push(z);d.faces.push(new THREE.Face3(0,1,2));d.faces.push(new THREE.Face3(0,2,3));d.faces.push(new THREE.Face3(4,5,6));d.faces.push(new THREE.Face3(4,6,7));d.applyMatrix((new THREE.Matrix4).makeRotationX(a));d.applyMatrix((new THREE.Matrix4).makeRotationY(b));d.applyMatrix((new THREE.Matrix4).makeRotationZ(c));d.computeFaceNormals();d.computeVertexNormals();
a=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0});return new THREE.Mesh(d,a)},ga=function(a,b){var c,d=new THREE.Geometry;c=new THREE.Vector3(105,105,105);var g=new THREE.Vector3(60,105,105),f=new THREE.Vector3(60,60,105),h=new THREE.Vector3(105,60,105),k=new THREE.Vector3(105,105,60),l=new THREE.Vector3(105,105,105),n=new THREE.Vector3(105,60,105),m=new THREE.Vector3(105,60,60),z=new THREE.Vector3(105,105,105),q=new THREE.Vector3(105,105,60),t=new THREE.Vector3(60,
105,60),w=new THREE.Vector3(60,105,105);d.vertices.push(c);d.vertices.push(g);d.vertices.push(f);d.vertices.push(h);d.vertices.push(k);d.vertices.push(l);d.vertices.push(n);d.vertices.push(m);d.vertices.push(z);d.vertices.push(q);d.vertices.push(t);d.vertices.push(w);d.faces.push(new THREE.Face3(0,1,2));d.faces.push(new THREE.Face3(0,2,3));d.faces.push(new THREE.Face3(4,5,6));d.faces.push(new THREE.Face3(4,6,7));d.faces.push(new THREE.Face3(8,9,10));d.faces.push(new THREE.Face3(8,10,11));d.applyMatrix((new THREE.Matrix4).makeRotationX(a));
d.applyMatrix((new THREE.Matrix4).makeRotationY(b));d.computeFaceNormals();d.computeVertexNormals();c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0});return new THREE.Mesh(d,c)},ja=function(a){var b=h.cubeFront.clone(),c=h.sceneUpDirection.clone(),d=b.clone().cross(c);c.copy(d).cross(b);b.normalize();c.normalize();d.normalize();var g=(new THREE.Vector3(b.x,c.x,d.x)).multiplyScalar(a.x);g.add((new THREE.Vector3(b.y,c.y,d.y)).multiplyScalar(a.y));g.add((new THREE.Vector3(b.z,
c.z,d.z)).multiplyScalar(a.z));return g};this.render=function(){var a=d.compass?d.viewScaleFactorCompass*d.viewScale:d.viewScale,b=h.center.clone().sub(k.position).normalize(),c=k.up.normalize(),b=ja(b),c=ja(c);d.camera.position.copy(b);d.camera.position.multiplyScalar(-a/d.camera.position.length());d.camera.up=c.normalize();d.camera.lookAt(d.center);ea=h.isFaceView();!ea||da||h.currentlyAnimating?Ga():(z.add(M),a=d.wantRollArrows?1:0,K[U].material.opacity=a,K[Z].material.opacity=a);F.material.opacity=
da?0:d.wantContextMenu?1:0;D.material.opacity=da?0:d.wantHomeButton?1:0;t.clear();t.render(r,d.camera);t.render(A,d.camera);t.render(H,d.camera);t.render(C,d.camera);t.render(z,w)};var Ga=function(){z.remove(M);K[U].material.opacity=0;K[Z].material.opacity=0};this.refreshCube=function(){Na()};this.setSize=function(a,b){d.width=a;d.height=b;if(1<c.children.length)for(var g=1;g<c.children.length;g++)c.children[g].style.bottom=(d.height/5).toString()+"px";Na()};this.useTransparency=function(a){(da=a)?
(c.onmouseover=Ha,c.onmousemove=la,c.onmouseout=Fa,Fa()):(c.onmouseover=null,c.onmouseout=null,c.onmousemove=null,c.style.opacity="1.0")};(function(){var a=c.getBoundingClientRect();d.width=a.width;d.height=a.height;N=za(c);w=new THREE.PerspectiveCamera(70,d.height/d.width,1,1E4);w.position.set(0,0,500);r=new THREE.Scene;A=new THREE.Scene;C=new THREE.Scene;H=new THREE.Scene;z=new THREE.Scene;ea=!0;S=200;d.viewScale=3.5*S;var b=THREE.LinearFilter,a=Autodesk.Viewing.Private.getResourceUrl,g=f||"res/textures/",
k=(new THREE.DDSLoader).load(a(g+"VCcrossRGBA8small.dds"));k.minFilter=k.maxFilter=b;g=THREE.ShaderLib.cube;g=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:THREE.UniformsUtils.clone(g.uniforms),depthWrite:!1});g.uniforms.tCube.value=k;var l=new THREE.BoxGeometry(S,S,S,4,4,4),k=new THREE.BoxGeometry(S+1,S+1,S+1,4,4,4);E=new THREE.Mesh(l,g);E.position.set(0,0,0);A.add(E);g=qa(a("res/textures/VCedge1.png"));g.minFilter=g.maxFilter=b;B=new THREE.Mesh(k,
new THREE.MeshBasicMaterial({map:g,overdraw:!1,transparent:!0,shading:THREE.SmoothShading}));B.position.set(0,0,0);H.add(B);var b=S,g=new THREE.Geometry,k=new THREE.Vector3(-30,0,0),l=new THREE.Vector3(30,0,0),q=new THREE.Vector3(0,-30,0);g.vertices.push(k);g.vertices.push(l);g.vertices.push(q);g.faces.push(new THREE.Face3(1,0,2));g.computeFaceNormals();var q=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),p=new THREE.MeshBasicMaterial({overdraw:!0,
color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),da=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),ha=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),k=new THREE.PlaneBufferGeometry(.5*S,.3*S,2,2),l=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),q=new THREE.Mesh(g,q),ca=new THREE.Mesh(k,l);q.position.set(0,b,0);ca.position.set(0,.9*b,.1);var p=new THREE.Mesh(g,
p),Y=new THREE.Mesh(k,l);p.position.set(0,-b,0);Y.position.set(0,.9*-b,.1);p.rotation.z+=Math.PI;Y.rotation.z+=Math.PI;var da=new THREE.Mesh(g,da),R=new THREE.Mesh(k,l);da.position.set(b,0,0);R.position.set(.9*b,0,.1);da.rotation.z-=Math.PI/2;R.rotation.z-=Math.PI/2;g=new THREE.Mesh(g,ha);k=new THREE.Mesh(k,l);g.position.set(-b,0,0);k.position.set(.9*-b,0,.1);g.rotation.z+=Math.PI/2;k.rotation.z+=Math.PI/2;M=new THREE.Object3D;M.position.set(0,0,0);M.add(q);M.add(p);M.add(da);M.add(g);z.add(ca);z.add(Y);
z.add(R);z.add(k);z.add(M);I.push(ca);I.push(Y);I.push(R);I.push(k);b=new THREE.PlaneBufferGeometry(S/3,S/3,2,2);g=new THREE.MeshBasicMaterial({map:qa(a("res/textures/VChome.png")),transparent:!0,shading:THREE.FlatShading});D=new THREE.Mesh(b,g);D.position.set(-S,S,0);P=K.length;z.add(D);K.push(D);b=new THREE.PlaneBufferGeometry(1.5*S,1.5*S,2,2);g=new THREE.MeshBasicMaterial({map:qa(a("res/textures/VCarrows.png")),shading:THREE.FlatShading,transparent:!0});b=new THREE.Mesh(b,g);b.position.set(.5*
S+20,.5*S+20,0);g=new THREE.PlaneBufferGeometry(.6*S,.45*S,2,2);k=new THREE.MeshBasicMaterial({transparent:!0,opacity:0});g=new THREE.Mesh(g,k);g.position.set(.5*S+20,S+20,.1);k=new THREE.PlaneBufferGeometry(.45*S,.6*S,2,2);l=new THREE.MeshBasicMaterial({transparent:!0,opacity:0});k=new THREE.Mesh(k,l);k.position.set(S+20,.5*S+20,.1);z.add(b);z.add(g);z.add(k);aa=K.length;K.push(g);fa=K.length;K.push(k);U=K.length;K.push(b);b=new THREE.PlaneBufferGeometry(S/2.3,S/2.3,2,2);g=new THREE.MeshBasicMaterial({map:qa(a("res/textures/VCcontext.png")),
transparent:!0,shading:THREE.FlatShading});F=new THREE.Mesh(b,g);F.position.set(S,-S,0);Z=K.length;z.add(F);K.push(F);b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(-S/2,-S/2-20,-S/2));b.vertices.push(new THREE.Vector3(S/2,-S/2-20,-S/2));b.vertices.push(new THREE.Vector3(S/2,-S/2-20,S/2));b.vertices.push(new THREE.Vector3(-S/2,-S/2-20,S/2));b.faces.push(new THREE.Face3(4,3,2));b.faces.push(new THREE.Face3(4,2,1));g=new THREE.MeshBasicMaterial({color:0,
transparent:!0,opacity:.5});J=new THREE.Mesh(b,g);r.add(J);g=[];k=[];g[0]=ga(0,0);g[1]=ga(0,Math.PI/2);g[2]=ga(0,-Math.PI/2);g[3]=ga(0,Math.PI);g[4]=ga(Math.PI/2,0);g[5]=ga(Math.PI/2,Math.PI/2);g[6]=ga(Math.PI/2,-Math.PI/2);g[7]=ga(Math.PI/2,Math.PI);k[0]=oa(0,0,0);k[1]=oa(0,Math.PI/2,0);k[2]=oa(0,-Math.PI/2,0);k[3]=oa(0,Math.PI,0);k[4]=oa(Math.PI/2,0,0);k[5]=oa(Math.PI/2,Math.PI/2,0);k[6]=oa(Math.PI/2,-Math.PI/2,0);k[7]=oa(Math.PI/2,Math.PI,0);k[8]=oa(0,0,Math.PI/2);k[9]=oa(0,0,-Math.PI/2);k[10]=
oa(-Math.PI/2,0,-Math.PI/2);k[11]=oa(-Math.PI,0,-Math.PI/2);G.push(na(0,0));G[0].name="front";L.push(G[0]);O.push(G[0]);C.add(G[0]);G.push(na(0,Math.PI/2));G[1].name="right";L.push(G[1]);O.push(G[1]);C.add(G[1]);G.push(na(0,Math.PI));G[2].name="back";L.push(G[2]);O.push(G[2]);C.add(G[2]);G.push(na(0,-Math.PI/2));G[3].name="left";L.push(G[3]);O.push(G[3]);C.add(G[3]);G.push(na(Math.PI/2,0));G[4].name="bottom";L.push(G[4]);O.push(G[4]);C.add(G[4]);G.push(na(-Math.PI/2,0));G[5].name="top";L.push(G[5]);
O.push(G[5]);C.add(G[5]);b=G.length;for(l=0;l<g.length;l++)G.push(g[l]),G[b+l].name=n[l],C.add(G[b+l]),L.push(G[b+l]),O.push(G[b+l]);b=G.length;for(l=0;l<k.length;l++)G.push(k[l]),G[b+l].name=m[l],C.add(G[b+l]),L.push(G[b+l]),O.push(G[b+l]);"CANVAS"===h.renderer.toUpperCase()?t=new THREE.CanvasRenderer:"WEBGL"===h.renderer.toUpperCase()?t=new FireflyWebGLRenderer({alpha:!0,antialias:!0}):(console.log("Incorrect use of Autocam.renderer property"),t=new THREE.CanvasRenderer);d.useTransparency(!0);d.setSize(d.width,
d.height);d.camera.topFov=d.camera.bottomFov=d.camera.fov/2;d.camera.leftFov=d.camera.rightFov=d.camera.aspect*d.camera.fov/2;t.autoClear=!1;t.setSize(d.width,d.height);t.sortObjects=!1;c.appendChild(t.domElement);c.addEventListener("touchstart",Ja,!1);c.addEventListener("mousedown",Ja,!1);c.addEventListener("mousemove",Ea,!1);window.addEventListener("resize",Na,!1);V=!1;ba.push(qa(a("res/textures/VChomeS.png")));ba.push(qa(a("res/textures/VCarrowsS0.png")));ba.push(qa(a("res/textures/VCarrowsS1.png")));
ba.push(qa(a("res/textures/VChome.png")));ba.push(qa(a("res/textures/VCarrows.png")));ba.push(qa(a("res/textures/VCcontext.png")));ba.push(qa(a("res/textures/VCcontextS.png")))})()};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ToolController=function(a,b,c,f,g){function d(a,c){return b.navigation.getUseLeftHandedInput()&&0===a||k&&1===a||h&&!m&&0===a&&c.ctrlKey}this.domElement=b.canvasWrap;this.selector=a.selector;this.autocam=c;this.lastClickY=this.lastClickX=-1;var h=-1!=navigator.userAgent.search("Mac OS"),k=-1!=navigator.userAgent.search("Firefox");a=-1!==navigator.userAgent.search("Chrome");var m=-1!==navigator.userAgent.search("Safari")&&!a,n={},q=[],l=!1,p=-1,r=-1,A=!1,C=null,H=void 0,z=!1,t={},
w=this;this.__registerToolByName=function(a,b){n[b]=a};this.registerTool=function(a){var b=a.getNames();if(!b||0==b.length)return console.log("Cannot register tool with no name."),!1;for(var c=!1,d=0;d<b.length;++d)"default"!==b[d]&&(this.__registerToolByName(a,b[d]),c=!0);a.utilities=f;a.controller=this;a.register&&a.register();return c};this.deregisterTool=function(a){this.deactivateTool(a.getName());var b=a.getNames();if(!b||0==b.length)return!1;for(var c=b.length;0<=--c;)this.__deregisterToolName(b[c]);
a.deregister&&a.deregister();a.utilities=null;a.controller=null;return!0};this.__deregisterToolName=function(a){if(a in n){for(var b=q.length;0<=--b;)q[b]===a&&(n[a].deactivate(a),q.splice(b,1));delete n[a]}};this.getTool=function(a){return n[a]};this.getActiveToolName=function(){var a=q.length;return 0<a?q[a-1]:"default"};this.activateTool=function(a){if(l)return!1;var c=n[a];if(c){var d=null;"intercept"===q[q.length-1]&&(d=q.pop());q.push(a);c.activate(a);d&&q.push(d);b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,
toolName:a,active:!0});return!0}stderr("activateTool not found: "+a);return!1};this.deactivateTool=function(a){if(l)return!1;for(var c=q.length;0<=--c;)if(q[c]===a)return q.splice(c,1),n[a].deactivate(a),b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:a,active:!1}),!0;stderr("deactivateTool not found: "+a);return!1};this.getToolNames=function(){return Object.keys(n)};this.setDefaultTool=function(a){var b=this.getDefaultTool();return a&&a!==b?(this.__registerToolByName(a,"default"),b&&
b.deactivate("default"),a.activate("default"),!0):!1};this.getDefaultTool=function(){return n["default"]};this.setDefaultTool(g);this.setIsLocked=function(a){var b=l;l=!!a;return b};this.getIsLocked=function(){return l};this.__checkCursor=function(){for(var a=null,c=q.length;0<=--c;){var d=n[q[c]];if("getCursor"in d&&(a=d.getCursor()))break}a||(a="auto");C!=a&&(C=b.canvas.style.cursor=a)};this.update=function(a){this.__checkCursor();var c=!1;f&&f.update()&&(c=!0);for(var d=q.length;0<=--d;){var g=
n[q[d]];"update"in g&&g.update(a)&&(c=!0)}b.navigation.getCamera().dirty?(b.navigation.updateCamera(),this.cameraUpdated=c=!0):this.cameraUpdated=!1;c?(b.navigation.updateCamera(),this.moveDelay=Date.now()+150):0!==this.moveDelay&&(0<this.moveDelay-Date.now()?c=!0:this.moveDelay=0);return c};this.__clientToCanvasCoords=function(a,c,d){var g=b.navigation.getScreenViewport(),f=g.width,h=g.height,k=a.clientX-g.left,g=a.clientY-g.top;a.canvasX=k;a.canvasY=g;a.normalizedX=k/f*2-1;a.normalizedY=(h-g)/h*
2-1;c&&c.set(k/f,g/h,0);d&&d.set(k,g)};this.__invokeStack=function(a,b,c){for(var d=q.length;0<=--d;){var g=n[q[d]];if(a in g&&g[a](b,c))return!0}d=this.getDefaultTool();return a in d&&d[a](b,c)?!0:!1};this.distributeEvent=function(a,b,c){return this.__invokeStack(a,b,c)};this.handleResize=function(){b.navigation.setScreenViewport(b.container.getBoundingClientRect());for(var a=q.length;0<=--a;){var c=n[q[a]];"handleResize"in c&&c.handleResize()}};this.handleSingleClick=function(a){var b=this.applyButtonMappings(a);
this.lastClickX=a.clientX;this.lastClickY=a.clientY;this.__invokeStack("handleSingleClick",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleDoubleClick=function(a){var b=this.applyButtonMappings(a);this.__invokeStack("handleDoubleClick",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleSingleTap=function(a){this.lastClickX=a.canvasX;this.lastClickY=a.canvasY;this.__invokeStack("handleSingleTap",a)&&(a.preventDefault(),a.stopPropagation())};this.handleDoubleTap=function(a){this.lastClickX=
a.canvasX;this.lastClickY=a.canvasY;this.__invokeStack("handleDoubleTap",a)&&(a.preventDefault(),a.stopPropagation())};this.handleWheelInput=function(a,b){this.__invokeStack("handleWheelInput",a)&&(b.preventDefault(),b.stopPropagation())};this.applyButtonMappings=function(a){var c=a.button;"buttons"in a&&(a.firefoxSpoof?c=0:!A||a.buttons&1?2===c&&a.buttons&1&&(c=0,a.firefoxSpoof=A=!0):(a.firefoxSpoof=!0,A=!1,c=0));b.navigation.getUseLeftHandedInput()&&(c=0===c?2:2===c?0:c);return c};this.applyKeyMappings=
function(a,b){switch(a.keyCode){case 91:case 93:case 224:return h&&a.metaKey&&a.shiftKey?null:17;case 16:return b&&h&&a.metaKey?null:16;case 61:return 187;case 173:case 109:return 189}return a.keyCode};this.handleKeyDown=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyDown",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleKeyUp=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyUp",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleButtonDown=
function(a,b){this.__invokeStack("handleButtonDown",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleButtonUp=function(a,b){this.__invokeStack("handleButtonUp",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleMouseMove=function(a){this.__invokeStack("handleMouseMove",a)&&(a.preventDefault(),a.stopPropagation())};this.handleBlur=function(a){this.__invokeStack("handleBlur",a)&&(a.preventDefault(),a.stopPropagation())};this.keydown=function(a){if(!(!w.domElement.contains(H)||document.activeElement instanceof
HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)){if(document.activeElement){var b=document.activeElement.getAttribute("contenteditable");if("true"===b||""===b)return}h&&a.metaKey&&91!=a.keyCode&&93!=a.keyCode||w.handleKeyDown(a)}};this.keyup=function(a){h&&a.metaKey&&91!=a.keyCode&&93!=a.keyCode||w.handleKeyUp(a)};this.mousedown=function(a){function b(a){w.applyButtonMappings(a)===c&&(document.removeEventListener("mouseup",b),w.mouseup(a))}_isIE11&&inFullscreen()||document.activeElement.blur();
w.__clientToCanvasCoords(a);var c=w.applyButtonMappings(a);w.handleButtonDown(a,c);p=a.canvasX;r=a.canvasY;if(d(c,a)){var g=void 0!==t.time&&500>a.timeStamp-t.time,f=void 0!==t.x&&void 0!==t.y&&2>=Math.abs(t.x-a.canvasX)&&2>=Math.abs(t.y-a.canvasY);if(!g||!f||t.clickCount&&2<=t.clickCount)t.clickCount=0;t.clickCount?1===t.clickCount&&(t.clickCount=2):(t.clickCount=1,t.x=a.canvasX,t.y=a.canvasY,t.time=a.timeStamp)}document.addEventListener("mouseup",b,!1);w.registerWindowMouseMove()};this.mousemove=
function(a){w.__clientToCanvasCoords(a);var b=r-a.canvasY;if(2<Math.abs(p-a.canvasX)||2<Math.abs(b))r=p=-1;w.handleMouseMove(a)};this.mouseup=function(a){w.__clientToCanvasCoords(a);var b=w.applyButtonMappings(a);w.handleButtonUp(a,b);var c=p-a.canvasX,g=r-a.canvasY;r=p=-1;2>=Math.abs(c)&&2>=Math.abs(g)&&w.handleSingleClick(a);d(b,a)&&2===t.clickCount&&(w.handleDoubleClick(a),t.clickCount=0,t.x=void 0,t.y=void 0,t.time=void 0);w.unregisterWindowMouseMove()};this.doubleclick=function(a){w.__clientToCanvasCoords(a);
p=a.canvasX;r=a.canvasY;w.handleDoubleClick(a)};this.mousewheel=function(a){var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail);w.handleWheelInput(b,a)};this.blur=function(a){w.handleBlur(a)};this.mouseover=function(a){H=a.target};this.registerWindowMouseMove=function(){window.addEventListener("mousemove",w.mousemove);window.addEventListener("mouseover",w.mouseover);w.domElement.removeEventListener("mousemove",w.mousemove);w.domElement.removeEventListener("mouseover",w.mouseover)};this.unregisterWindowMouseMove=
function(){window.removeEventListener("mousemove",w.mousemove);window.removeEventListener("mouseover",w.mouseover);w.domElement.addEventListener("mousemove",w.mousemove);w.domElement.addEventListener("mouseover",w.mouseover)};this.enableMouseButtons=function(a){a&&!z?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):
!a&&z&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var b=z;z=a;return b};this.enableMouseButtons(!0);this.domElement.addEventListener("mousewheel",this.mousewheel,!1);this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1);window.addEventListener("keydown",this.keydown,!1);
window.addEventListener("keyup",this.keyup,!1);window.addEventListener("blur",this.blur,!1);this.uninitialize=function(){z&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",w.mousemove),window.removeEventListener("mouseover",w.mouseover));window.removeEventListener("keydown",this.keydown);window.removeEventListener("keyup",this.keyup);window.removeEventListener("blur",this.blur);
w=q=n=this.autocam=this.selector=this.domElement=null};this.set2DMode=function(a){};this.setAutocam=function(a){};this.syncCamera=function(){};this.recordHomeView=function(){var a=b.navigation.getCamera();c.sync(a);c.setHomeViewFrom(a)}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ViewingUtilities=function(a,b,c){this.autocam=b;var f=c.getCamera(),g={},d={},h=new function(a){var b=0,c=new THREE.SphereGeometry(1),d=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),g=new THREE.Mesh(c,d);a.createOverlayScene("pivot");g.visible=!1;this.shown=function(){return g.visible};this.show=function(c,f,h){g.scale.x=f;g.scale.y=f;g.scale.z=f;g.position.set(c.x,c.y,c.z);d.opacity=.6;g.visible=!0;a.addOverlay("pivot",g);a.invalidate(!1,!1,!0);
b=h?Date.now()+500:0};this.hide=function(){g.visible&&(g.visible=!1,a.removeOverlay("pivot",g),a.invalidate(!1,!1,!0),b=0)};this.fade=function(){if(0<b){var a=b-Date.now();if(0>=a)return this.hide(),!0;d.opacity=a/500*.6;return!0}return!1};this.fading=function(){return 0<b}}(a);this.transitionView=function(a,d,g,h,l,p){l=l||c.getWorldUpVector();if(p)if(h=l,p=d.clone().sub(a),0===p.lengthSq())h=p.copy(h);else{var r=p.clone().cross(h);0===r.lengthSq()&&(h.z>h.y?p.y-=1E-4:p.z-=1E-4,r.crossVectors(p,
h));h=r.cross(p).normalize()}h||(h=f.up);b.goToView({position:a,center:d,pivot:d,fov:g,up:h,worldUp:l,isOrtho:!1===f.isPerspective})};this.goHome=function(){b.goHome()};this.getHitPoint=function(b,c){c=2*(1-c)-1;var d=new THREE.Vector3(2*b-1,c,1);return(d=a.hitTestViewport(d,!1))?d.intersectPoint:null};this.activatePivot=function(a){var b=f.isPerspective?c.getPivotPlaneDistance():c.getEyeVector().length(),d=c.getVerticalFov(),b=2*b*Math.tan(THREE.Math.degToRad(.5*d)),d=c.getScreenViewport(),b=5*b/
(d.height*(window.devicePixelRatio||1));h.show(c.getPivotPoint(),b,a)};this.pivotActive=function(a,b){a=a&&!c.getIs2D();b=b||!1;!a&&h.shown()?h.hide():a&&this.activatePivot(b)};this.pivotUpdate=function(){h.shown()&&h.fade()&&a.invalidate(!1,!1,!0)};this.setPivotPoint=function(a,b,d){c.setPivotPoint(a);b||c.setTarget(a);d&&c.setPivotSetFlag(!0);this.setTemporaryPivot(null);c.getIs2D()||h.shown()&&this.activatePivot(h.fading())};this.savePivot=function(a){a||(a="default");g[a]=c.getPivotPoint();d[a]=
c.getPivotSetFlag()};this.restorePivot=function(a){a||(a="default");if(g[a]){var b=d[a];this.setPivotPoint(g[a],!0,b);b||c.setPivotSetFlag(!1);delete g[a];delete d[a]}};this.setTemporaryPivot=function(a){if(a){var b=c.getPivotPoint(),f=c.getPivotSetFlag();this.setPivotPoint(a,!0,f);g.TEMP=b;d.TEMP=f}else delete g.TEMP,delete d.TEMP};this.removeTemporaryPivot=function(){this.restorePivot("TEMP")};this.getBoundingBox=function(b){return a.getFitBounds(b)};this.fitToView=function(b){b=c.fitBounds(b,a.getFitBounds(!1));
this.activatePivot(!0);return b};this.update=function(){c.getRequestFitToView()&&!c.getTransitionActive()&&(c.setRequestFitToView(!1),this.fitToView());c.getRequestHomeView()&&!c.getTransitionActive()&&(c.setRequestHomeView(!1),this.goHome());var a=c.getRequestTransition();a&&!c.getTransitionActive()&&(c.setRequestTransition(!1),this.transitionView(a.position,a.coi,a.fov,a.up,a.worldUp,a.reorient));return!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.DefaultHandler=function(a,b,c){this.clickConfig=null;this.getNames=function(){return["default"]};this.getName=function(){return this.getNames()[0]};this.setClickBehavior=function(a){this.clickConfig=a};this.getClickBehavior=function(){return this.clickConfig};this.activate=function(a){};this.deactivate=function(a){};this.handleAction=function(b,g){for(var d=0;d<b.length;++d)switch(b[d]){case "selectOnly":a.selector&&g&&a.selector.setSelection([g.dbId]);break;case "deselectAll":a.selector&&
a.selector.setSelection([]);break;case "selectToggle":a.selector&&g&&a.selector.toggleSelection(g.dbId);break;case "isolate":g&&a.isolate(g.dbId);break;case "showAll":a.showAll();break;case "setCOI":g&&g.intersectPoint&&(c.setPivotPoint(g.intersectPoint,!0,!0),c.pivotActive(!0,!0));break;case "hide":g&&a.hideMultiple([g.dbId]);break;case "show":g&&a.showMultiple([g.dbId]);break;case "toggleVisibility":g&&a.toggleVisibility(g.dbId);break;case "focus":a.selector&&(g?a.selector.setSelection([g.dbId]):
a.selector.setSelection([]),c.fitToView())}};this.handleSingleClick=function(b,g){var d=b.ctrlKey||b.metaKey,h=b.shiftKey,k=b.altKey;if(0===g){var m=new THREE.Vector3(b.normalizedX,b.normalizedY,1),m=a.hitTestViewport(m,!1),n="click";d&&(n+="Ctrl");h&&(n+="Shift");k&&(n+="Alt");d=m?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[n]&&this.clickConfig[n][d])return this.handleAction(this.clickConfig[n][d],m),!0}else if(1===g&&h&&!k&&!d&&(m=new THREE.Vector3(b.normalizedX,b.normalizedY,1),
(m=a.hitTestViewport(m,!1))&&m.intersectPoint))return c.setPivotPoint(m.intersectPoint,!0,!0),c.pivotActive(!0,!0),!0;return!1};this.handleDoubleClick=function(f,g){if(null!=a.selector&&0===g){var d=new THREE.Vector3(f.normalizedX,f.normalizedY,1);(d=a.hitTestViewport(d,!1))?a.selector.setSelection([d.dbId]):a.selector.clearSelection();c.fitToView();return!0}return 1===g?(b.fitBounds(!1,c.getBoundingBox(!0)),b.setPivotSetFlag(!1),!0):!1};this.handleSingleTap=function(c){return c.hasOwnProperty("pointers")&&
2===c.pointers.length?(b.setRequestHomeView(!0),!0):null!=a.selector?(c=new THREE.Vector3(c.normalizedX,c.normalizedY,1),(c=a.hitTestViewport(c,!1))?a.selector.setSelection([c.dbId]):a.selector.clearSelection(),!0):!1};this.handleDoubleTap=function(a){a=this.handleSingleTap(a,0);c.fitToView();return a};this.handlePressHold=function(b){return"press"===b.type?(b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerContextMenu(b)):!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.GestureHandler=function(a){var b=a.navigation,c=["gestures"],f=this,g=!0,d=null,h=isTouchDevice();b.setIsTouchDevice(h);h&&(d=new Hammer.Manager(a.canvasWrap,{recognizers:[[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:400,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:6}],[Hammer.Tap,{event:"singletap",threshold:6}],[Hammer.Pan,{event:"drag3",pointers:3,
threshold:15}],[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Rotate,{enable:!0,threshold:7}],[Hammer.Pinch,{enable:!0,threshold:.05}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),a.canvasWrap.addEventListener("touchstart",function(a){a.preventDefault()},!1));this.getNames=function(){return c};this.getName=function(){return c[0]};this.__clientToCanvasCoords=function(a){var c=b.getScreenViewport(),d=c.width,g=c.height,f;
a.hasOwnProperty("center")?(f=a.center.x-c.left,c=a.center.y-c.top):(f=a.pointers[0].clientX-c.left,c=a.pointers[0].clientY-c.top);a.canvasX=f;a.canvasY=c;a.normalizedX=f/d*2-1;a.normalizedY=(g-c)/g*2-1};this.distributeGesture=function(a){f.__clientToCanvasCoords(a);f.controller.distributeEvent("handleGesture",a)&&a.preventDefault();a=a.type;-1!==a.indexOf("end",a.length-3)&&d.stop()};this.onSingleTap=function(a){f.__clientToCanvasCoords(a);f.controller.distributeEvent("handleSingleTap",a)&&a.preventDefault()};
this.onDoubleTap=function(a){f.__clientToCanvasCoords(a);f.controller.distributeEvent("handleDoubleTap",a)&&a.preventDefault()};this.onPressHold=function(a){f.__clientToCanvasCoords(a);"press"===a.type?g=f.controller.enableMouseButtons(!1):f.controller.enableMouseButtons(g);f.controller.distributeEvent("handlePressHold",a)&&a.preventDefault()};this.activate=function(a){d&&(d.on("dragstart dragmove dragend",this.distributeGesture),d.on("panstart panmove panend",this.distributeGesture),d.on("pinchstart pinchmove pinchend",
this.distributeGesture),d.on("rotatestart rotatemove rotateend",this.distributeGesture),d.on("drag3start drag3move drag3end",this.distributeGesture),d.on("singletap",this.onSingleTap),d.on("singletap2",this.onSingleTap),d.on("doubletap",this.onDoubleTap),d.on("doubletap2",this.onDoubleTap),d.on("press pressup",this.onPressHold),d.get("doubletap2").recognizeWith("doubletap"),d.get("singletap2").recognizeWith("singletap"),d.get("singletap").requireFailure("doubletap"))};this.deactivate=function(a){d&&
(d.off("dragstart dragmove dragend",this.distributeGesture),d.off("panstart panmove panend",this.distributeGesture),d.off("pinchstart pinchmove pinchend",this.distributeGesture),d.off("rotatestart rotatemove rotateend",this.distributeGesture),d.off("drag3start drag3move drag3end",this.distributeGesture),d.off("singletap",this.onSingleTap),d.off("singletap2",this.onSingleTap),d.off("doubletap",this.onDoubleTap),d.off("doubletap2",this.onDoubleTap),d.off("press pressup",this.onPressHold))};this.update=
function(){return!1};this.handleBlur=function(a){return!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.OrbitDollyPanTool=function(a,b){function c(a,b){var c=window.innerWidth,d=window.innerHeight;aa.set((a-.5*c-0)/(.5*c),(.5*d+0-b)/(.5*d),0);c=aa.length();1<c?aa.normalize():aa.z=Math.sqrt(1-c*c);O.copy(h.position).sub(h.pivot);X.copy(h.up).setLength(aa.y);X.add(W.copy(h.up).cross(O).setLength(aa.x));X.add(O.setLength(aa.z));return X}var f=this,g=-1!=navigator.userAgent.search("Mac OS"),d=b.navigation,h=d.getCamera(),k=["orbit","freeorbit","dolly","pan"],m=k[0],n=[m],q=m,l=null,p=0,
r=0,A=!1,C=null,H=!1,z,t,w=null,E=-5,B=new THREE.Vector3,D=new THREE.Vector3,J=new THREE.Vector2,F=new THREE.Vector2,G=new THREE.Vector2,M=new THREE.Vector2,I=new THREE.Vector3,L=new THREE.Vector3,K=new THREE.Vector3,O=new THREE.Vector3,R=new THREE.Vector3,X=new THREE.Vector3,W=new THREE.Vector3,aa=new THREE.Vector3,fa=new THREE.Vector3,U=new THREE.Quaternion,P=[!1,!1,!1,!1,!1,!1],Z=0,S=0,N=0,ia=0,ea=1,V=5,ca=.025;this.getNames=function(){return k};this.getName=function(){return k[0]};this.activate=
function(a){n.push(a);q=a};this.deactivate=function(a){var b=n.length-1;0<b&&n[b]===a&&(n.pop(),q=n[b-1])};this.adjustDollyLookSpeed=function(a){0===a?(ca=.025,V=5):(ca*=0<a?1.1:.9,V*=0<a?1.1:.9,1E-6>ca&&(ca=1E-6),1E-6>V&&(V=1E-6))};this.getDollySpeed=function(a){var b=d.getEyeVector(),c=d.getPosition();a=a.clone().sub(c).dot(b.normalize())*ca;return.01>Math.abs(a)?0>a?-.01:.01:a};this.getLookSpeed=function(){return V};this.coiIsActive=function(){return d.getPivotSetFlag()&&d.isPointVisible(d.getPivotPoint())};
this.adjustSpeed=function(a){this.adjustDollyLookSpeed(a);this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())};this.initTracking=function(a,b){var c;if(h.isPerspective){c=.5*(h.near+h.far);var g=this.utilities.getHitPoint(a,b),f=d.getPosition();g&&g.sub?(c=g.sub(f),g=d.getEyeVector().normalize(),c=Math.abs(g.dot(c))):d.getPivotSetFlag()&&d.isPointVisible(d.getPivotPoint())&&(g=d.getPivotPlaneDistance(),1E-5<g&&(c=g))}else c=d.getEyeVector().length();ea=c};this.initOrbit=
function(){this.utilities.setTemporaryPivot(0>=d.getPivotPoint().sub(d.getPosition()).dot(d.getEyeVector())?d.getTarget():null)};this.getCursor=function(){switch(m){case "freeorbit":case "orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";
case "dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";
case "pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null};
this.getMotionDelta=function(a,b){var c=d&&d.getReverseZoomDirection()?-1.5:1.5;g&&(c*=-1);P[0]&&(D.x+=.01,G.x+=20);P[1]&&(D.x-=.01,G.x-=20);P[2]&&(D.y+=.01,G.y+=20);P[3]&&(D.y-=.01,G.y-=20);P[4]&&(D.z+=c);P[5]&&(D.z-=c);var c=D.x-B.x,f=D.y-B.y,h=D.z-B.z;.001>Math.abs(c)&&(c=0);.001>Math.abs(f)&&(f=0);.001>Math.abs(h)&&(h=0);a.set(c,f,h);b&&b.set(G.x-F.x,G.y-F.y)};this.stepMotionDelta=function(a,b){b?(B.x+=.6*a.x,B.y+=.6*a.y,B.z+=.6*a.z):B.copy(D);F.copy(G)};this.update=function(){var a=!1,c=!1,g;
this.getMotionDelta(I,M);g=I.x;var f=I.y,n=I.z;A||this.checkInteractionMode();(A=-1<E)&&this.controller.setIsLocked(!0);if(0!==g||0!==f||0!==n){switch(m){case "orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(M.x=-M.x,C&&this.utilities.autocam.orbit(G,C,M.multiplyScalar(2),this.utilities.autocam.startState));break;case "freeorbit":O.subVectors(h.position,h.pivot);R.subVectors(h.position,h.target);c=R.length();R.normalize();if(g=Math.acos(L.dot(K)/L.length()/K.length()))g*=2,fa.crossVectors(L,
K).normalize(),U.setFromAxisAngle(fa,-g),O.applyQuaternion(U),h.up.applyQuaternion(U),K.applyQuaternion(U),R.applyQuaternion(U),L.copy(K);h.position.addVectors(h.pivot,O);h.target.subVectors(h.position,R.multiplyScalar(c));h.dirty=!0;break;case "dolly":n*=.6;0<=E?(f=-f,n=Math.abs(g)>Math.abs(f)?g:f,n*=100,c=g=.5):(g=d.getScreenViewport(),c=z/g.width,g=t/g.height);c=!d.getIs2D()&&d.getZoomTowardsPivot()?this.coiIsActive()?d.getPivotPoint():d.getWorldPoint(.5,.5):d.getWorldPoint(c,g);d.dollyFromPoint(n*
this.getDollySpeed(c),c);break;case "pan":d.panRelative(-g,f,ea);break;case "dollypan":0===g&&0===f||d.panRelative(-g,f,ea),g=d.getScreenViewport(),c=z/g.width,g=t/g.height,c=d.getWorldPoint(c,g),g=d.getPosition(),g=d.getIs2D()?g.sub(c).length():ea,f=(p/r-1)*g,d.dollyFromPoint(f,c),p=r,ea=g+f}c=!0}this.stepMotionDelta(I,"pan"!==m&&"dollypan"!==m);-1===E&&1E-5>Math.abs(n)&&(this.interactionEnd(-1),c=a=!0);(Z||S)&&-1!==k.indexOf(b.getActiveNavigationTool())&&(c=!0);!H&&(a||-5<E)&&(-1<E&&(B.copy(D),
this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),E=-5,A&&this.controller.setIsLocked(!1),A=!1,l=C=null);c?this.utilities.pivotActive(d.getPivotSetFlag(),-1>=E):this.utilities.pivotUpdate();return h.dirty};this.checkInteractionMode=function(){var a;a=1===E&&Z?n[1]:2===E&&Z&&!S&&!N||2===E&&S&&!Z&&!N||"dolly"===q&&!S&&"pinch"!==l||0!==I.z?N||S||Z||2!==E&&1!==E?"dolly":"pan":!(2!==E||Z||S^N)||2===E&&Z&&N||1===E&&!Z&&!N||1===E&&S||1===E&&N&&!S||0===E&&Z&&!N&&!S||"pan"===q&&
1!==E&&!S&&"pinch"!==l||ia?"pan":"pan"===l||"pinch"===l?"dollypan":q;a!==m&&(m=a,("pan"===m&&-1<E||"dollypan"===m)&&this.initTracking(B.x,B.y))};this.interactionStart=function(a,b){if(b||a>E)E=a,H=!0,-1<a&&("pan"===m&&this.initTracking(B.x,B.y),"orbit"===m&&this.initOrbit()),this.utilities.pivotActive(d.getPivotSetFlag(),-1===a),this.utilities.autocam&&(this.utilities.autocam.sync(h),this.utilities.autocam.startInteraction(F.x,F.y),C=F.clone())};this.interactionCheck=function(){(P[0]||P[1]||P[2]||
P[3]||P[4]||P[5]||Z||N||S||ia)&&this.interactionStart(-4,!0)};this.interactionEnd=function(a){a===E&&(-1!==a&&this.utilities.pivotActive(!1),H=!1)};this.handleWheelInput=function(b){if(this.isDragging)return!1;if(d.getIs2D()){var c=d.getScreenViewport(),c=a.intersectGround(z+c.width,t+c.height);this.utilities.setPivotPoint(c,!0,!0)}d.getReverseZoomDirection()&&(b*=-1);D.z+=b;c=Date.now();w||(w=c);0!=b&&this.interactionStart(-1);return!0};this.resetKeys=function(){this.autoMove(-1,!1);ia=S=N=Z=0};
this.autoMove=function(a,b){b&&this.isDragging||(0>a?P[0]=P[1]=P[2]=P[3]=P[4]=P[5]=b:P[a]=b,b||this.interactionEnd(-4),this.interactionCheck())};this.updateModifierState=function(a){N=g&&a.metaKey||a.ctrlKey?1:0;Z=a.shiftKey?1:0;S=a.altKey?1:0};this.handleKeyDown=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case 187:this.adjustSpeed(1);c=!0;break;case 189:this.adjustSpeed(-1);c=!0;break;case 48:this.adjustSpeed(0);c=!0;break;case 37:this.autoMove(0,!0);c=!0;break;case 39:this.autoMove(1,
!0);c=!0;break;case 33:this.autoMove(2,!0);c=!0;break;case 34:this.autoMove(3,!0);c=!0;break;case 38:this.autoMove(4,!0);c=!0;break;case 40:this.autoMove(5,!0);c=!0;break;default:return!1}this.isDragging||this.interactionStart(-4);return c};this.handleKeyUp=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case 37:this.autoMove(0,!1);c=!0;break;case 39:this.autoMove(1,!1);c=!0;break;case 33:this.autoMove(2,!1);c=!0;break;case 34:this.autoMove(3,!1);c=!0;break;case 38:this.autoMove(4,!1);
c=!0;break;case 40:this.autoMove(5,!1);c=!0;break;default:return!1}c&&(this.interactionEnd(-4),H||this.interactionCheck());return c};this.handleDollyPan=function(a){z=a.canvasX;t=a.canvasY;var b=d.getScreenViewport();G.x=J.x+a.deltaX;G.y=J.y+a.deltaY;D.x=G.x/b.width;D.y=G.y/b.height;var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY;r=Math.sqrt(b*b+c*c);a=a.type;-1!==a.indexOf("start",a.length-5)&&(p=r)};this.handleGesture=function(a){switch(a.type){case "dragstart":return l=
"drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===l?this.handleMouseMove(a):!1;case "dragend":if("drag"===l)return this.handleButtonUp(a,0),l=null,!0;break;case "panstart":return l="pan",this.isDragging=!0,B.x=.5*(a.normalizedX+1),B.y=1-.5*(a.normalizedY+1),J.set(a.canvasX,a.canvasY),F.set(a.canvasX,a.canvasY),this.interactionStart(3),this.handleDollyPan(a),!0;case "panmove":return"pan"===l?this.handleDollyPan(a):!1;case "panend":if("pan"===l)return this.isDragging=!1,this.handleDollyPan(a),
this.interactionEnd(3),!0;break;case "pinchstart":return this.isDragging=!0,l="pinch",B.x=.5*(a.normalizedX+1),B.y=1-.5*(a.normalizedY+1),J.set(a.canvasX,a.canvasY),F.set(a.canvasX,a.canvasY),this.interactionStart(3),this.handleDollyPan(a),!0;case "pinchmove":return"pinch"===l?this.handleDollyPan(a):!1;case "pinchend":if("pinch"===l)return this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(3),!0}return!1};this.handleButtonDown=function(a,b){this.updateModifierState(a);B.x=.5*(a.normalizedX+
1);B.y=1-.5*(a.normalizedY+1);F.set(a.canvasX,a.canvasY);D.copy(B);G.copy(F);L.copy(c(a.canvasX,a.canvasY));K.copy(L);z=a.canvasX;t=a.canvasY;this.isDragging=!0;this.interactionStart(b);return!0};this.handleButtonUp=function(a,b){this.updateModifierState(a);D.x=.5*(a.normalizedX+1);D.y=1-.5*(a.normalizedY+1);G.set(a.canvasX,a.canvasY);K.copy(c(a.canvasX,a.canvasY));L.copy(K);z=a.canvasX;t=a.canvasY;this.interactionEnd(b);this.isDragging=!1;return!0};this.handleMouseMove=function(b){this.updateModifierState(b);
if(!this.isDragging)return B.x=.5*(b.normalizedX+1),B.y=1-.5*(b.normalizedY+1),F.set(b.canvasX,b.canvasY),D.x=B.x,D.y=B.y,G.copy(F),z=b.canvasX,t=b.canvasY,a.rolloverObject(z,t),!1;D.x=.5*(b.normalizedX+1);D.y=1-.5*(b.normalizedY+1);G.set(b.canvasX,b.canvasY);K.copy(c(b.canvasX,b.canvasY));z=b.canvasX;t=b.canvasY;return!0};this.handleBlur=function(a){this.resetKeys();this.interactionEnd(E)};b.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(a){f.handleBlur(a)})};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.HotGestureTool=function(a){navigator.userAgent.search("Mac OS");a.navigation.getCamera();var b=["hottouch"],c=null,f=null,g=!1,d=!1,h=null;this.getNames=function(){return b};this.getName=function(){return b[0]};this.activate=function(a){};this.deactivate=function(a){};this.__checkStart=function(){h&&(this.controller.distributeEvent("handleGesture",h),h=null)};this.update=function(){if(this.controller.getIsLocked())return!1;var b=a.getActiveNavigationTool(),h=!1===g&&!0===d,n=!0===
g&&!1===d;if(h||n){h=h?"worldup":"fov";if(b===h)return!1;if(b===c)return a.setActiveNavigationTool(h),c=h,this.__checkStart(),!1;f=b;a.setActiveNavigationTool(h);c=h;this.__checkStart()}else c&&(a.setActiveNavigationTool(f),f=c=null);return!1};this.resetKeys=function(){};this.updateModifierState=function(a){};this.handleGesture=function(a){if(a===h)return!1;switch(a.type){case "drag3start":h=a;g=!0;break;case "drag3end":g=!1;break;case "rotatestart":h=a;d=!0;break;case "rotateend":d=!1}return!1};
this.handleKeyDown=function(a,b){this.updateModifierState(a);return!1};this.handleKeyUp=function(a,b){this.updateModifierState(a);return!1};this.handleButtonDown=function(a,b){this.updateModifierState(a);return!1};this.handleButtonUp=function(a,b){this.updateModifierState(a);return!1};this.handleMouseMove=function(a){this.updateModifierState(a);return!1};this.handleBlur=function(a){this.resetKeys();return!1}};"use strict";AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.HotkeyManager=function(){function a(a,b){return a-b}function b(){var a=g.join(),b,c;for(c=0;c<h.length;)b=h[c],b.keys===a?h.splice(c,1):c++;for(c=0;c<d.length;)b=d[c],b.keys!==a?d.splice(c,1):c++}function c(a,c){var k=g.join(),l=g.slice(0),p=g.indexOf(c);-1<p&&g.splice(p,1);var r=g.join(),A=g.slice(0);b();for(var C=[],H=[],z,p=f.length-1;0<=p;p--)z=f[p],z.keys===k&&z.onRelease?C.unshift(z):z.keys===r&&z.onPress&&H.unshift(z);for(p=C.length-1;0<=p&&(z=C[p],!z.onRelease(l));p--)z.options.tryUntilSuccess&&
h.unshift(z);for(p=H.length-1;0<=p&&(z=H[p],!z.onPress(A));p--)z.options.tryUntilSuccess&&d.unshift(z)}var f=[],g=[],d=[],h=[],k=["hotkeys"];return{pushHotkeys:function(b,c,d){if(f.some(function(a){return a.id===b}))return!1;for(var g=0;g<c.length;g++)f.push({id:b,keys:c[g].keycodes.sort(a).join(),onPress:c[g].onPress,onRelease:c[g].onRelease,options:d||{}});return!0},popHotkeys:function(a){for(var b=!1,c=f.length-1;0<=c;c--)f[c].id===a&&(f.splice(c,1),b=!0);return b},handleKeyDown:function(a,c){if(-1===
g.indexOf(c)){for(var k=g.join(),l=g.slice(0),p=0;p<g.length&&g[p]<c;)p++;g.splice(p,0,c);var r=g.join(),A=g.slice(0);b();for(var C=[],H=[],z,p=f.length-1;0<=p;p--)z=f[p],z.keys===k&&z.onRelease?C.unshift(z):z.keys===r&&z.onPress&&H.unshift(z);for(p=C.length-1;0<=p&&(z=C[p],!z.onRelease(l));p--)z.options.tryUntilSuccess&&h.unshift(z);for(p=H.length-1;0<=p&&(z=H[p],!z.onPress(A));p--)z.options.tryUntilSuccess&&d.unshift(z)}},handleKeyUp:c,handleBlur:function(){for(var a=g.length-1;0<=a;a--)c(null,
g[a])},getName:function(){return k[0]},getNames:function(){return k},activate:function(){},deactivate:function(){},update:function(){var a,b;for(b=0;b<h.length;)a=h[b],!0===a.onRelease(a.keys.split())?h.splice(b,1):b++;for(b=0;b<d.length;)a=d[b],!0===a.onPress(a.keys.split())?d.splice(b,1):b++;return!1},KEYCODES:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,a:65,b:66,c:67,d:68,
e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222}}};Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager;AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.FovTool=function(a){var b=a.navigation,c=b.getCamera(),f=["fov"],g=!1,d=0,h=null,k=null,m=!1,n=0,q=-5,l=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3,A=null;this.getNames=function(){return f};this.getName=function(){return f[0]};this.activate=function(a){n=0};this.deactivate=function(a){q=-5};this.getCursor=function(){return 0!==n&&-5===q?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"};
this.getMotionDelta=function(a){var b=p.x-l.x,c=p.y-l.y,d=p.z-l.z;.001>Math.abs(b)&&(b=0);.001>Math.abs(c)&&(c=0);.001>Math.abs(d)&&(d=0);a.set(b,c,d)};this.stepMotionDelta=function(a,b){b?(l.x+=.6*a.x,l.y+=.6*a.y,l.z+=.6*a.z):l.copy(p)};this.getAccumulatedWheelDelta=function(){var a=Date.now(),b=0;k&&100<a-k?(b=0>d&&-3<d?-3:0<d&&3>d?3:d,d=0,k=h=null,m=!1):h&&100<a-h&&(m?3<=Math.abs(d)&&(b=d,d=0):(b=0>d&&-3<d?-3:0<d&&3>d?3:d,m=!0,d=0));return b};this.update=function(){var a=!1,d=-5<q;if(-5<q){this.controller.setIsLocked(!0);
this.getMotionDelta(r);var f=r.x,h=r.y,k=r.z;if(0!==f||0!==h||0!==k)d=!0,0<=q?(h=-h,k=Math.abs(f)>Math.abs(h)?f:h,0!==k&&(k*=-1,b.setVerticalFov(b.getVerticalFov()*(1+k),!0))):(f=this.getAccumulatedWheelDelta()/3,0!==f&&b.setFocalLength(b.getFocalLength()+f,!0));this.stepMotionDelta(r,!0);-1===q&&1E-5>Math.abs(k)&&(this.interactionEnd(-1),a=!0)}d?this.utilities.pivotActive(b.getPivotSetFlag(),!0):this.utilities.pivotUpdate();!g&&(a||-5<q)&&(-1<q&&l.copy(p),q=-5,this.controller.setIsLocked(!1));return c.dirty};
this.interactionStart=function(a,c){if(c||a>q)q=a,g=!0;b.toPerspective()};this.interactionEnd=function(a){a===q&&(-1!==a&&this.utilities.pivotActive(!1),g=!1)};this.handleWheelInput=function(a){if(-1<q)return!1;b.getReverseZoomDirection()&&(a*=-1);p.z+=a;d+=a;var c=Date.now();h||(h=c);k=c;0!=a&&this.interactionStart(-1);return!0};this.handleGesture=function(a){switch(a.type){case "dragstart":return this.handleButtonDown(a,0);case "dragmove":return this.handleMouseMove(a);case "dragend":return this.handleButtonUp(a,
0);case "drag3start":return A="drag",this.handleButtonDown(a,0);case "drag3move":return"drag"===A?this.handleMouseMove(a):!1;case "drag3end":"drag"===A&&this.handleButtonUp(a,0),A=null}return!1};this.handleButtonDown=function(a,b){n+=1<<b;return 2!==b?(l.x=.5*(a.normalizedX+1),l.y=1-.5*(a.normalizedY+1),p.copy(l),this.interactionStart(b),!0):!1};this.handleButtonUp=function(a,b){n-=1<<b;return 2!==b?(p.x=.5*(a.normalizedX+1),p.y=1-.5*(a.normalizedY+1),this.interactionEnd(b),!0):!1};this.handleMouseMove=
function(a){p.x=.5*(a.normalizedX+1);p.y=1-.5*(a.normalizedY+1);return-1<q};this.handleBlur=function(a){this.interactionEnd(q);return!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.WorldUpTool=function(a,b){var c=b.navigation,f=c.getCamera(),g=["worldup"],d=this,h=function(){var a=new THREE.Vector3;return function(b,c,d,g){b=new THREE.Vector3(b,c,d);c=g.dot(b);a.copy(g);a.multiplyScalar(c);return b.sub(a)}}(),k=2*Math.PI,m=!1,n=!1,q=!1,l=new function(a,b){function d(a,b){var c=Math.abs(a-b);return c>k?c:Math.min(k-c,c)}function g(a,b){var c=l(a);if(1E-5>c.distanceToSquared(b))return!0;C.set(-b.x,-b.y,-b.z);return 1E-5>c.distanceToSquared(C)}function f(a){return a>
k?a:0>=a?a+Math.PI:a-Math.PI}function l(a){A.set(0,0,0);if(0<=a){var b=3<=a?-1:1;a%=3;0===a&&(A.x=b);1===a&&(A.y=b);2===a&&(A.z=b)}sa&&A.multiplyScalar(-1);return A}function n(a,b){for(var c=d(ca[0],a),g=0,f=1;6>f;++f){var h=d(ca[f],a);h<c&&(c=h,g=f)}return c<b?g:-1}function m(a){if(0!==a){var b=30*Math.PI/180,d=C.copy(X.position).sub(fa).normalize();R.setFromAxisAngle(d,a);a=c.getWorldUpVector();d=Math.abs(d.angleTo(a));(d<b||Math.PI-d<b)&&a.copy(c.getCameraUpVector());a.applyQuaternion(R);c.setIsLocked(!1);
c.setWorldUpVector(a,!0);c.setIsLocked(!0)}}function q(a,b){0>a.dot(b)&&(b=b.clone().multiplyScalar(-1));c.orient(ia,fa,X.position,b);ia.position.copy(b.multiplyScalar(.495));for(var g=!1,f=ha?za:ba,h=0;6>h;++h){var k=d(ca[h],Y),n;n=a;n=k<f?1E-5>l(h).distanceToSquared(n):!1;n&&(g=!0);k=n?4:3*(1-3*k/Math.PI);1>k&&(k=1);k*=W;V[h].visible=n;n=ea[h];n.scale.x=k;n.scale.y=k;n.scale.z=k}P.visible=g;Z.visible=g;return S.visible=g}function p(a){Y+=a;Y>Math.PI?Y-=k:Y<=-Math.PI&&(Y=k+Y);var b;a:{if(!ha&&(b=
n(Y,ba),0<=b)){ha=!0;Y=ca[b];b=l(b);break a}b=!1}if(b)da=Y,a=b,c.setIsLocked(!1),c.setWorldUpVector(a,!0),c.setIsLocked(!0);else if(ha&&0>n(Y,za)?(ha=!1,b=!0):b=!1,b)m(Y-da),da=0;else{if(ha)return!1;m(a)}return!0}var r=2*Math.tan(THREE.Math.degToRad(15)),H=new THREE.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),A=new THREE.Vector3,C=new THREE.Vector3,R=new THREE.Quaternion,X=new THREE.PerspectiveCamera(30,b.aspect,b.near,b.far),W=1,aa=1,
fa=null,U=null,P=null,Z=null,S=null,N=null,ia=null,ea=null,V=null,ca=Array(6),Y=0,sa=!1,ha=!0,da=0,ba=5*Math.PI/180,za=7*Math.PI/180,Ha=1;a.createOverlayScene("roll",null,null,X);this.updateRollCamera=function(a,c){X.position.copy(b.position);X.quaternion.copy(b.quaternion);X.up.copy(b.up);X.aspect=b.aspect;a&&c&&(X.near=c-a,X.far=c+a);X.updateProjectionMatrix()};this.isSnapped=function(){return ha};this.resize=function(){var a=Ha*r,c=a*b.aspect,a=(1>b.aspect?c:a)*aa;N.scale.x=a;N.scale.y=a;N.scale.z=
a};this.start=function(b,c){this.updateHUD(b,c);a.addOverlay("roll",N)};this.updateHUD=function(a,k){fa=a;.35>k?k=.35:.8<k&&(k=.8);aa=k;W=.8/k;var l=A.copy(a).sub(b.position);Ha=l.length();var n=Ha*r,m=n*b.aspect,n=(1>b.aspect?m:n)*k;this.updateRollCamera(n,Ha);var m=c.getWorldUpVector(),z=c.getCameraUpVector();if(!N){N=new THREE.Object3D;var p=new THREE.RingGeometry(.5-.01*W,.5,60);U=p=new THREE.Mesh(p,H);var D=.007*W,J=new THREE.BoxGeometry(.93,D,D),F=new THREE.BoxGeometry(D,.93,D),D=new THREE.BoxGeometry(D,
D,.93);P=new THREE.Mesh(J,H);Z=new THREE.Mesh(F,H);S=new THREE.Mesh(D,H);N.add(P);N.add(Z);N.add(S);ia=new THREE.Mesh(new THREE.CircleGeometry(.005),H);N.add(ia);ea=Array(6);V=Array(6);for(J=0;6>J;++J)F=.0025*W,ea[J]=new THREE.Mesh(new THREE.CircleGeometry(.005*W,16),H),V[J]=new THREE.Mesh(new THREE.CircleGeometry(F,16),H),V[J].visible=!1,ea[J].add(V[J]),p.add(ea[J]);N.add(p)}c.orient(U,a,X.position,m);p=l.clone().normalize();J=Array(3);l=Array(6);J[0]=h(1,0,0,p);J[1]=h(0,1,0,p);J[2]=h(0,0,1,p);F=
z.clone().cross(p).normalize();for(p=0;3>p;++p)D=J[p],l[p]=D.length(),.1>l[p]?ca[p]=1E3:(D.multiplyScalar(1/l[p]),ca[p]=Math.atan2(F.dot(D),z.dot(D)));ca[3]=f(ca[0]);ca[4]=f(ca[1]);ca[5]=f(ca[2]);l[3]=l[0];l[4]=l[1];l[5]=l[2];p=ba+za+2*Math.PI/180;for(J=0;6>J;++J)if(1E3!==ca[J])for(F=J+1;6>F;++F)if(1E3!==ca[F]&&d(ca[J],ca[F])<p)if(l[J]<l[F]&&!g(J,m)||g(F,m)){ca[J]=1E3;break}else ca[F]=1E3;for(p=0;6>p;++p)1E3!==ca[p]?(l=C.set(0,0,1),R.setFromAxisAngle(l,ca[p]),l=C.set(0,.54,0),l.applyQuaternion(R),
ea[p].position.copy(l),ea[p].visible=!0):ea[p].visible=!1;N.scale.x=n;N.scale.y=n;N.scale.z=n;N.position.copy(a);da=Y=0;sa=0>m.dot(z);ha=q(m,z)};this.handleRoll=function(a,b,d){this.updateRollCamera();q(c.getWorldUpVector(),c.getCameraUpVector());return 0!==a||0!==b?(a=d.x-a-.5,b=d.y-b-.5,p(Math.atan2(d.y-.5,d.x-.5)-Math.atan2(b,a))):!1};this.handleRollTouch=function(a){this.updateRollCamera();q(c.getWorldUpVector(),c.getCameraUpVector());a-=Y;return.001<Math.abs(a)?p(a):!1};this.end=function(){a.removeOverlay("roll",
N)}}(a,f),p=new THREE.Vector3,r=new THREE.Vector3,A=new THREE.Vector3,C=null,H=0;this.getNames=function(){return g};this.getName=function(){return g[0]};this.activate=function(a){b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange);q=!1};this.deactivate=function(a){l.end();c.setIsLocked(!1);b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange);this.utilities.restorePivot();C=null;q=m=!1};this.getCursor=function(){return"auto"};this.getMotionDelta=
function(a){var b=r.x-p.x,c=r.y-p.y,d=r.z-p.z;.001>Math.abs(b)&&(b=0);.001>Math.abs(c)&&(c=0);.001>Math.abs(d)&&(d=0);a.set(b,c,d)};this.stepMotionDelta=function(){p.copy(r)};this.update=function(){if(!q){var a=c.getEyeVector(),b=.5*(f.near+f.far);a.normalize().multiplyScalar(b);a=a.add(f.position);this.utilities.savePivot();this.utilities.setPivotPoint(a,!0,!0);this.utilities.pivotActive(!0);l.start(a,.65);q=!0}a=n;this.getMotionDelta(A);var b=A.x,d=A.y,g=A.z;if(n||"roll"===C||m&&(0!==b||0!==d||
0!==g))n="roll"===C?l.handleRollTouch(H):l.handleRoll(b,d,r);this.stepMotionDelta();f.dirty&&(a=!0);return a};this.handleResize=function(){l.resize();n=!0};this.handleGesture=function(a){switch(a.type){case "dragstart":return C="drag",this.handleButtonDown(a,0);case "dragmove":return this.handleMouseMove(a);case "dragend":return C=null,this.handleButtonUp(a,0);case "rotatestart":c.setIsLocked(!0);b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange);C="roll";H=THREE.Math.degToRad(a.rotation);
var d=a.pointers[1].clientX-a.pointers[0].clientX;a=a.pointers[1].clientY-a.pointers[0].clientY;Math.sqrt(d*d+a*a);d=c.getScreenViewport();Math.min(d.width,d.height);return!0;case "rotatemove":return H=THREE.Math.degToRad(a.rotation),"roll"===C;case "rotateend":c.setIsLocked(!1),b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),H=THREE.Math.degToRad(a.rotation),C=null}return!1};this.handleWheelInput=function(a){return!0};this.handleCameraChange=function(){var a=c.getEyeVector(),
b=.5*(f.near+f.far);a.normalize().multiplyScalar(b);a=a.add(f.position);l.updateHUD(a,.65)};this.handleButtonDown=function(a,g){p.x=.5*(a.normalizedX+1);p.y=1-.5*(a.normalizedY+1);r.copy(p);m=!0;C=null;c.setIsLocked(!0);this.controller.setIsLocked(!0);b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,d.handleCameraChange);return!0};this.handleButtonUp=function(a,g){r.x=.5*(a.normalizedX+1);r.y=1-.5*(a.normalizedY+1);m=!1;n=!0;c.setIsLocked(!1);this.controller.setIsLocked(!1);b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,
d.handleCameraChange);return!0};this.handleMouseMove=function(a){r.x=.5*(a.normalizedX+1);r.y=1-.5*(a.normalizedY+1);return!0};this.handleBlur=function(a){m=!1;C=null;return!1}};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing,b=a.Private;a.SelectionMode={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2};b.Selector=function(b){function f(a,b){if(0<m[b])m[b]--,0==m[b]&&k.viewer.highlightObjectNode(k.model,b,!1);else if(0>m[b])throw"Selection State machine broken. Negatively selected object!";a&&a.enumNodeChildren(b,function(b){f(a,b)},!1)}function g(a,b,c){m[b]?m[b]++:(k.viewer.highlightObjectNode(k.model,b,!0,c),m[b]=1);a&&a.enumNodeChildren(b,function(b){g(a,b,!0)},!1)}function d(b){"number"!==
typeof b&&(console.warn("Deprecated use of select. Use dbId instead of node."),b=b.dbId);var c=b;if(k.selectionMode===a.SelectionMode.LEAF_OBJECT)b=c;else if(b=c,k.selectionMode===a.SelectionMode.FIRST_OBJECT){for(var d=[],f=k.getInstanceTree(),h=c;h;)d.push(h),h=f.getNodeParentId(h);for(h=d.length-1;0<=h;h--)if(c=f.getNodeType(d[h]),c!==NODE_TYPE_MODEL&&c!==NODE_TYPE_LAYER&&c!==NODE_TYPE_COLLECTION){b=d[h];break}}else if(k.selectionMode===a.SelectionMode.LAST_OBJECT)for(f=k.getInstanceTree(),h=c;h;){c=
f.getNodeType(h);if(c===NODE_TYPE_COMPOSITE){b=h;break}h=f.getNodeParentId(h)}k.isSelected(b)||(k.selectedObjectIds[b]=b,k.selectionCount++,d=k.getInstanceTree(),g(d,b,!1))}function h(a){"number"!==typeof a&&(console.warn("Deprecated use of deselect. Use dbId instead of node."),a=a.dbId);if(k.isSelected(a)){var b=a,c=k.getInstanceTree();f(c,b);k.selectedObjectIds[a]=0;k.selectionCount--}}var k=this;this.viewer=b;this.model=null;this.selectedObjectIds={};this.selectionCount=0;this.selectionMode=a.SelectionMode.LEAF_OBJECT;
var m={};b.api.addEventListener(a.ISOLATE_EVENT,function(a){k.deselectInvisible()});b.api.addEventListener(a.HIDE_EVENT,function(a){k.deselectInvisible()});this.setModel=function(a){this.model=a};this.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null};this.getSelectionLength=function(){return k.selectionCount};this.getSelection=function(){var a=[],b=k.selectedObjectIds,c;for(c in b)b=parseInt(c),a.push(b);return a};this.clearSelection=function(a){if(0<this.selectionCount){var b=
k.selectedObjectIds,c;for(c in b)if(b=parseInt(c),void 0!==b){var d=k.getInstanceTree();f(d,b)}k.selectedObjectIds={};k.selectionCount=0;a||this.fireSelectionChangedEvent()}};this.fireSelectionChangedEvent=function(){var b=[],c=[],d=k.selectedObjectIds,g=this.getInstanceTree(),f;for(f in d)if(d=parseInt(f))b.push(d),g&&g.enumNodeFragments(d,function(a){c.push(a)},!1);this.viewer.api.fireEvent({type:a.SELECTION_CHANGED_EVENT,fragIdsArray:c,dbIdArray:b,nodeArray:b})};this.isSelected=function(a){"number"!==
typeof a&&(console.warn("Deprecated use of isSelected. Use dbId instead of node."),a=a.dbId);if(void 0!==a&&this.selectedObjectIds[a])return!0};this.toggleSelection=function(a){"number"!==typeof a&&(console.warn("Deprecated use of deselect. Use dbId instead of node."),a=a.dbId);a?(this.isSelected(a)?h(a):d(a),k.fireSelectionChangedEvent()):console.error("Attempting to select a null node.")};this.setSelectionIds=function(a){this.setSelection(a)};this.selectionIsEqual=function(a){if(this.selectionCount!==
a.length)return!1;for(var b=0;b<a.length;b++)if(!this.isSelected(a[b]))return!1;return!0};this.setSelectionMode=function(a){this.clearSelection(!0);this.selectionMode=a};this.setSelection=function(a){a&&a.length&&"number"!==typeof a[0]&&(console.warn("Deprecated use of setSelection. Use dbId instead of node."),a=a.map(function(a){return a.dbId}));if(!this.selectionIsEqual(a)&&(this.clearSelection(!0),null!=a)){for(var b=0;b<a.length;b++)d(a[b]);this.fireSelectionChangedEvent()}};this.deselectInvisible=
function(){var a=!1,b=k.selectedObjectIds,c=this.getInstanceTree(),d;for(d in b){var b=parseInt(d),g=c.isNodeHidden(b);b&&g&&(h(b),a=!0)}a&&this.fireSelectionChangedEvent()};this.isSelectedOrParentIsSelected=function(a){for(var b=this.getInstanceTree();a;){if(this.isSelected(a))return!0;a=b.getNodeParentId(a)}return!1};this.getSelectionBounds=function(){var a=new THREE.Box3,b=new THREE.Box3,c=this.getInstanceTree(),d=this.viewer.modelQueue().getFragmentList(),g=k.selectedObjectIds,f;for(f in g)g=
parseInt(f),c.enumNodeFragments(g,function(c){d.getWorldBounds(c,b);a.union(b)},!0);return a};this.getSelectionVisibility=function(){var a=!1,b=!1,c=k.selectedObjectIds,d;for(d in c)if(c=parseInt(d))if(this.getInstanceTree().isNodeHidden(c)?b=!0:a=!0,a&&b)break;return{hasVisible:a,hasHidden:b}};this.uninitialize=function(){this.selectedObjectIds=this.model=this.viewer=null}}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing,b=function(a){this.viewerImpl=a;this.model=null;this.isolatedNodes=[];this.hiddenNodes=[]};b.prototype.setModel=function(a){this.model=a};b.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null};b.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)};b.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)};b.prototype.isolate=function(a){var b=this.getInstanceTree().getRootId(),b="number"==
typeof a&&a===b||"object"==typeof a&&a.dbId===b;a&&!b?this.isolateMultiple(Array.isArray(a)?a:[a]):this.isolateNone()};b.prototype.isolateNone=function(){this.viewerImpl.setModelVisibility(this.model,!0);var b=this.model?this.model.getRootId():null;b&&this.setVisibilityOnNode(b,!0);this.hiddenNodes=[];this.isolatedNodes=[];this.viewerImpl.resetIsolation(this.model);this.viewerImpl.api.fireEvent({type:a.ISOLATE_EVENT,nodeIdArray:[]})};b.prototype.isolateMultiple=function(b){if(b&&0!=b.length){"number"!==
typeof b[0]&&(console.warn("Deprecated use of isolateMultiple. Use dbId instead of node object."),b=b.map(function(a){return a.dbId}));var f=this.model?this.model.getRootId():null;f&&this.setVisibilityOnNode(f,!1);this.viewerImpl.setModelVisibility(this.model,!1);this.isolatedNodes=b.slice(0);this.hiddenNodes=[];for(f=0;f<b.length;f++)this.setVisibilityOnNode(b[f],!0),this.viewerImpl.needGhostedPass=!0;this.viewerImpl.api.fireEvent({type:a.ISOLATE_EVENT,nodeIdArray:b})}else this.isolateNone();this.viewerImpl.invalidate(!0)};
b.prototype.hideMultiple=function(b){for(var f=0;f<b.length;++f)this.setVisibilityOnNode(b[f],!1);0<b.length&&this.viewerImpl.api.fireEvent({type:a.HIDE_EVENT,nodeIdArray:b})};b.prototype.hide=function(b){this.setVisibilityOnNode(b,!1);this.viewerImpl.api.fireEvent({type:a.HIDE_EVENT,nodeIdArray:[b]})};b.prototype.showMultiple=function(b){for(var f=0;f<b.length;++f)this.setVisibilityOnNode(b[f],!0);0<b.length&&this.viewerImpl.api.fireEvent({type:a.SHOW_EVENT,nodeIdArray:b})};b.prototype.show=function(b){this.setVisibilityOnNode(b,
!0);this.viewerImpl.api.fireEvent({type:a.SHOW_EVENT,nodeIdArray:[b]})};b.prototype.toggleVisibility=function(b){"number"!==typeof b&&(b=b.dbId,console.warn("Deprecated use of toggleVisibility. Use dbId instead of node object."));var f=this.getInstanceTree().isNodeHidden(b);this.setVisibilityOnNode(b,f);this.viewerImpl.api.fireEvent({type:f?a.SHOW_EVENT:a.HIDE_EVENT,nodeIdArray:[b]})};b.prototype.setVisibilityOnNode=function(a,b){"number"!==typeof a&&(a=a.dbId,console.warn("Deprecated use of setVisibilityOnNode. Use dbId instead of node object."));
var g=this.viewerImpl,d=this.model,h=this,k=this.getInstanceTree(),m=!b;k.enumNodeChildren(a,function(a){if(!k.isNodeHidden(a)&&m)for(var c=0,n=h.isolatedNodes.length;c<n;++c)if(h.isolatedNodes[c]===a){h.isolatedNodes.splice(c,1);break}k.setNodeHidden(a,m);k.enumNodeFragments(a,function(a){g.setFragmentVisibility(d,a,b)},!1)},!0);this.viewerImpl.needGhostedPass=!0;var n=this.hiddenNodes.indexOf(a);b&&-1!==n?this.hiddenNodes.splice(n,1):b||-1!==n||this.hiddenNodes.push(a)};b.prototype.setNodeOff=function(a,
b){var g=this.viewerImpl,d=this.model,h=this.getInstanceTree();h.enumNodeChildren(a,function(a){h.setNodeOff(a,b);h.enumNodeFragments(a,function(a){g.setFragmentOff(d,a,b)},!1)},!0)};a.Private.VisibilityManager=b})();AutodeskNamespace("Autodesk.Viewing.Private");LMV_WORKER_URL||(LMV_WORKER_URL="src/workers/MainWorker.js");void 0==ENABLE_INLINE_WORKER&&(ENABLE_INLINE_WORKER=!1);
(function(){var a=Autodesk.Viewing.Private,b=null;a.initWorkerScript=function(c,f){if(ENABLE_INLINE_WORKER&&!b){var g=new XMLHttpRequest,d=LMV_WORKER_URL,h=a.getResourceUrl(LMV_WORKER_URL);h&&(d=h);g.open("GET",d,!0);g.withCredentials=!1;g.onload=function(){var a;window.URL=window.URL||window.webkitURL;try{a=new Blob([g.responseText],{type:"application/javascript"})}catch(d){a=new BlobBuilder,a.append(g.responseText),a=a.getBlob()}b=URL.createObjectURL(a);c&&c()};g.send()}else c&&c()};a.createWorker=
function(){return ENABLE_INLINE_WORKER?new Worker(b):new Worker(a.getResourceUrl(LMV_WORKER_URL))};a.createWorkerWithTokenRefresh=function(){var b=a.createWorker();b.checkTokenRefresh=function(f){return f.data&&f.data.refreshToken?((new a.TokenRefreshHandler).refreshToken(function(){stderr("Token refreshed in thread");b.postMessage({tokenRefreshed:!0})},function(){stderr("Failed token refresh in thread");b.postMessage({tokenRefreshed:!1})}),!0):f.data&&f.data.assetRequest?(a.assets&&a.assets.push(f.data.assetRequest),
!0):!1};b.addEventListenerWithTokenRefresh=function(a){var g=function(d){b.checkTokenRefresh(d)||a(d)};b.addEventListener("message",g,!1);return g};b.removeEventListener=function(a){b.removeEventListener("message",a)};return b}})();AutodeskNamespace("Autodesk.Viewing.Private");
var NUM_WORKER_THREADS=isMobileDevice()?2:6,WORKER_LOAD_GEOMETRY="LOAD_GEOMETRY",WORKER_LOAD_SVF="LOAD_SVF",WORKER_LOAD_SVF_CONTD="LOAD_SVF_CONTD",WORKER_GET_PROPERTIES="GET_PROPERTIES",WORKER_SEARCH_PROPERTIES="SEARCH_PROPERTIES",WORKER_BUILD_EXTERNAL_ID_MAPPING="BUILD_EXTERNAL_ID_MAPPING",WORKER_GET_OBJECT_TREE="GET_OBJECT_TREE",WORKER_PARSE_F2D="PARSE_F2D",WORKER_STREAM_F2D="STREAM_F2D",WORKER_PARSE_F2D_FRAME="PARSE_F2D_FRAME";
(function(){function a(){n=new THREE.BufferAttribute(void 0,1);q=function(){THREE.BufferGeometry.call(this);this.name=this.uuid=null;this.numInstances=void 0;this.streamingIndex=this.streamingDraw=!1;this.svfid=void 0;this.vb=null;this.vbbuffer=void 0;this.ib=null;this.ibbuffer=void 0;this.vaos=null;this.vbNeedsUpdate=!1;this.byteSize=this.vbstride=0;this.attributesKeys=void 0;this.__webglInit=!1};q.prototype=Object.create(THREE.BufferGeometry.prototype);q.prototype.constructor=q}function b(b){q||
a();var c=b.mesh,d=new q;d.byteSize=0;d.vb=c.vb;d.vbbuffer=void 0;d.vbNeedsUpdate=!0;d.byteSize+=c.vb.byteLength;d.vbstride=c.vbstride;c.isLines&&(d.isLines=c.isLines);b.is2d&&(d.is2d=!0);d.numInstances=c.numInstances;for(var g in c.vblayout){var f=d.attributes,l=g,w;a:{var p=g;w=c.vblayout[g];var B=d.numInstances,D=void 0;if(w.array)D=new THREE.BufferAttribute(w.array,w.itemSize);else{p=p+"|"+w.bytesPerItem+"|"+w.normalize+"|"+w.isPattern+"|"+w.divisor+"|"+w.offset;if(D=k[p]){w=D;break a}D=new THREE.BufferAttribute(void 0,
w.itemSize);k[p]=D}D.bytesPerItem=w.bytesPerItem;D.normalize=w.normalize;D.isPattern=w.isPattern;B&&(D.divisor=w.divisor);w.array?geometry.byteSize+=w.array.byteLength:w.hasOwnProperty("offset")?D.itemOffset=w.offset:stderr("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.");w=D}f[l]=w}h.memoryOptimizedLoading?(d.attributes.index=n,d.ib=c.indices,d.ibbuffer=void 0):d.addAttribute("index",new THREE.BufferAttribute(c.indices,1));g="";for(var J in d.attributes)g+=
J+"|";J=m[g];J||(J=Object.keys(d.attributes),m[g]=J);d.attributesKeys=J;d.byteSize+=c.indices.byteLength;65535<c.vb.length/c.vbstride&&stderr("Mesh with >65535 vertices. It will fail to draw.");d.boundingBox=(new THREE.Box3).copy(c.boundingBox);d.boundingSphere=(new THREE.Sphere).copy(c.boundingSphere);d.drawcalls=null;d.offsets=null;d.vpIds=c.vpIds;b.geometry=d;b.mesh=null}function c(a,b,c){b=b.transforms;if(!b)return null;var d=a.elements;c*=12;d[0]=b[c+0];d[1]=b[c+1];d[2]=b[c+2];d[3]=0;d[4]=b[c+
3];d[5]=b[c+4];d[6]=b[c+5];d[7]=0;d[8]=b[c+6];d[9]=b[c+7];d[10]=b[c+8];d[11]=0;d[12]=b[c+9];d[13]=b[c+10];d[14]=b[c+11];d[15]=1;return a}function f(a){if((a=a.data)&&a.debug)stderr(a.message);else if(a.cbId){var b=p[a.cbId];if(a&&a.error){if(b[1])b[1](a.error)}else if(b[0])b[0](a.result);delete p[a.cbId]}}function g(a,b){var c=l++;p[c]=[a,b];return c}var d=Autodesk.Viewing,h=Autodesk.Viewing.Private;h.SvfLoader=function(a){this.viewer3DImpl=a;this.next_pack=0;this.loading=!1;this.loadedPacksCount=
0;this.loadedPacks=[];this.tmpMatrix=new THREE.Matrix4;this.logger=h.logger;this.loadTime=0;this.domainParam=auth?"domain="+encodeURIComponent(window.location.origin):"";this.pageOutGeometryEnabled=this.cullGeometryOnLoading=this.onDemandLoading=!1};h.SvfLoader.prototype.uninitialize=function(){this.viewer3DImpl=this.svf=null};h.SvfLoader.prototype.pathToURL=function(a){if("http://"==a.substr(0,7)||"https://"==a.substr(0,8)||"file:///"==a.substr(0,8)||"urn:"==a.substr(0,4))return a;var b=window.location.pathname,
c=b.lastIndexOf("/"),b=b.substr(0,c+1);return window.location.protocol+"//"+window.location.host+b+a};h.SvfLoader.prototype.loadFile=function(a,b,c,d,g){if(this.loading)return console.log("Loading of SVF already in progress. Ignoring new request."),!1;this.svfWorker&&(this.svfWorker.terminate(),this.svfWorker=null);this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null);this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null);this.propWorker&&(this.propWorker.terminate(),
this.propWorker=null);if(this.pack_workers){for(var f=0;f<this.pack_workers.length;f++)this.pack_workers[f].terminate();this.pack_workers=null}f=a.indexOf("urn:");if(-1!=f){a=decodeURIComponent(a);f=a.substr(f,a.substr(f).indexOf("/"));stderr("Extracted URN: "+f);var k=f.lastIndexOf(":");this.svfUrn=f.substr(k+1)}else this.svfUrn=a;this.sharedDbPath=c;this.currentLoadPath=a;var l=this.isf2d=-1!=a.indexOf(".f2d"),m=this;h.initWorkerScript(function(){l?m.loadFydoCB(a,b,d,g):m.loadSvfCB(a,b,d,g)});return!0};
h.SvfLoader.prototype.interceptManifest=void 0;h.SvfLoader.prototype.loadSvfCB=function(a,b,c,g){this.t0=(new Date).getTime();this.failedToLoadSomeGeometryPacks=null;var f=this,k={url:f.pathToURL(a),headers:d.HTTP_REQUEST_HEADERS,objectIds:b,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam,bvhOptions:{isWeakDevice:isAndroidDevice()||isIOSDevice()}},l=this.svfWorker=h.createWorkerWithTokenRefresh("SVF Load");l.addEventListenerWithTokenRefresh(function(a){var b=function(){l.terminate();
l=null};if(a.data&&a.data.manifest)f.interceptManifest(a.data.manifest),k.operation=WORKER_LOAD_SVF_CONTD,k.manifest=a.data.manifest,l.postMessage(k);else if(a.data&&a.data.svf){var m=f.svf=a.data.svf;f.failedToLoadSomeGeometryPacks&&(g&&g(f.failedToLoadSomeGeometryPacks.code,f.failedToLoadSomeGeometryPacks.msg),f.failedToLoadSomeGeometryPacks=null);f.onSvfLoadDone(m);c&&c(m);f.viewer3DImpl.api.fireEvent({type:d.MODEL_ROOT_LOADED_EVENT,svf:m});var n=m.geompacks.length;f.svf.loadDone=!1;if(0==n)f.onGeomLoadDone();
else if(m.fragments.length>h.FRAGS_PERSISTENT_MAX_COUNT?(f.onDemandLoading=h.onDemandLoading,f.cullGeometryOnLoading=h.cullGeometryOnLoading,f.pageOutGeometryEnabled=h.pageOutGeometryEnabled):(f.onDemandLoading=!1,f.cullGeometryOnLoading=!1,f.pageOutGeometryEnabled=!1),stderr("SVF on demand loading: "+f.onDemandLoading),stderr("SVF culling geometry on loading: "+f.cullGeometryOnLoading),stderr("SVF page out geometry: "+f.pageOutGeometryEnabled),f.onDemandLoading)f.loadedPacksCount=0;else if(n)for(var n=
Math.min(n,NUM_WORKER_THREADS),q=0;q<n;q++){var p=m.geompacks[q];p.loading=!0;f.loadGeometryPack(p.id,p.uri);f.next_pack=q+1}1==a.data.progress&&(f.loading=!1,b());m.fragments.polygonCounts||(m.fragments.polygonCounts=new Int32Array(m.fragments.length))}else a.data&&a.data.bvh?1==a.data.progress&&(f.svf.bvh||(f.svf.bvh=a.data.bvh,f.viewer3DImpl.setBVH(new NodeArray(f.svf.bvh.nodes,f.svf.bvh.useLeanNodes),f.svf.bvh.primitives),f.viewer3DImpl.invalidate(!1,!0)),f.loading=!1,b()):a.data&&a.data.progress?
1==a.data.progress&&(f.loading=!1,b()):a.data&&a.data.error?(f.loading=!1,b(),g&&g(a.data.error.code,a.data.error.msg)):a.data&&a.data.debug?stderr(a.data.message):(stderr("SVF download failed."),f.loading=!1,b())});k.operation=WORKER_LOAD_SVF;k.interceptManifest=!!this.interceptManifest;l.postMessage(k);return!0};h.SvfLoader.prototype.loadFydoCB=function(a,b,c,g){this.t0=Date.now();var f=this.pathToURL(a),k=this.streamingWorker=h.createWorker(),l=this.parsingWorker=h.createWorker(),m=this,n={};k.addEventListener("message",
function(a){if(a.data&&"F2DBLOB"==a.data.type){var b={operation:WORKER_PARSE_F2D,data:a.data.buffer,metadata:a.data.metadata,manifest:a.data.manifest,basePath:a.data.basePath,f2dLoadOptions:n,url:f};l.postMessage(b,[b.data]);k.terminate()}else a.data&&"F2DSTREAM"==a.data.type?(b={operation:WORKER_PARSE_F2D_FRAME,data:a.data.frames,url:f,f2dLoadOptions:n},a.data.metadata&&(b.metadata=a.data.metadata,b.manifest=a.data.manifest),a.data.finalFrame&&(b.finalFrame=!0),a.data.progress&&m.viewer3DImpl.signalProgress(100*
a.data.progress),l.postMessage(b,b.data?[b.data]:void 0),a.data.finalFrame&&k.terminate()):a.data&&"F2DAssetURL"==a.data.type?h.assets=h.assets.concat(a.data.urls):a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?(m.loading=!1,k.terminate(),g&&g.call(this,a.data.error.code,a.data.error.msg)):(stderr("F2D download failed."),m.loading=!1,k.terminate())},!1);l.addEventListener("message",function(a){if(a.data&&a.data.f2d){var b=m.svf=a.data.f2d;l.terminate();stderr("Num polylines: "+b.numPolylines);
stderr("Line segments: "+b.numLineSegs);stderr("Circular arcs: "+b.numCircles);stderr("Ellipitcal arcs:"+b.numEllipses);stderr("Plain triangles:"+b.numTriangles);stderr("Total # of op codes generated by fydo.parse: "+b.opCount);m.onSvfLoadDone(m.svf);c&&c(m.svf);m.viewer3DImpl.api.fireEvent({type:d.MODEL_ROOT_LOADED_EVENT,svf:m.svf});for(var f=0;f<b.meshes.length;f++)m.processReceivedMesh2D(b.meshes[f],f);b.meshes=null;m.onGeomLoadDone();m.loading=!1}else if(a.data&&a.data.f2dframe){var h=0;a.data.meshes?
(b=a.data.bbox,m.svf.bbox=new THREE.Box3(b.min,b.max)):m.svf=a.data.f2dframe;h=a.data.baseIndex;b=m.svf;b.fragments&&b.fragments.initialized?(b.maxObjectNumber=a.data.maxObjectNumber,b.viewports=a.data.viewports,b.currentVpId=a.data.currentVpId):(m.onSvfLoadDone(b),c&&c(b),m.viewer3DImpl.api.fireEvent({type:d.MODEL_ROOT_LOADED_EVENT,svf:b}));if(a.data.meshes&&a.data.meshes.length){for(f=0;f<a.data.meshes.length;f++)m.processReceivedMesh2D(a.data.meshes[f],h+f);a.data.finalFrame&&(m.onGeomLoadDone(),
m.loading=!1,l.terminate())}}else a.data&&a.data.progress||(a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?(m.loading=!1,l.terminate(),stderr("Error while parsing F2d: "+JSON.stringify(a.data.error.args)),g&&g.call(this,a.data.error.code,a.data.error.msg)):(stderr("F2D download failed."),m.loading=!1,l.terminate()))},!1);k.postMessage({operation:WORKER_STREAM_F2D,url:f,headers:d.HTTP_REQUEST_HEADERS,objectIds:b,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam});
return!0};h.SvfLoader.prototype.loadGeometryPackOnDemand=function(a){var b=this;if(b.onDemandLoading){var c=b.svf.geompacks[a];if(!c.loading){var g,f=function(a){if(a.data&&a.data.mesh){if(b.processReceivedMesh(a.data),1<=a.data.progress){--b.pack_workers[a.data.workerId].queued;b.svf.geompacks[a.data.packId].loading=!1;var c=b.viewer3DImpl.modelQueue().geomPacksMissingLastFrame(),d=c.indexOf(a.data.packId);0<=d&&c.splice(d,1);c=!0;for(j=0;j<b.pack_workers.length;j++)if(0!=b.pack_workers[j].queued){c=
!1;break}-1==b.loadedPacks.indexOf(a.data.packId)&&b.loadedPacks.push(a.data.packId);if(c&&0==b.viewer3DImpl.modelQueue().geomPacksMissingLastFrame().length)if(b.loadedPacks.length==b.svf.geompacks.length)b.onGeomLoadDone();else b.onGeomPackFilesLoadDone()}}else if(a.data&&a.data.progress){--b.pack_workers[a.data.workerId].queued;b.loadedPacksCount++;a=null;c=b.viewer3DImpl.modelQueue().geomPacksMissingLastFrame();for(g=0;g<c.length&&(d=c[g],a=b.svf.geompacks[d],a.loading);++g);a&&!a.loading&&b.loadGeometryPackOnDemand(d);
b.viewer3DImpl.signalProgress(100*b.loadedPacks.length/b.svf.geompacks.length)}else a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?b.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}:(b.pack_workers[a.data.workerId].queued-=2,b.svf.geompacks[a.data.packId].loading=!1)};if(!this.pack_workers)for(this.pack_workers=[],g=0;g<NUM_WORKER_THREADS;g++){var k=h.createWorkerWithTokenRefresh("Mesh Load");k.addEventListenerWithTokenRefresh(f);k.queued=0;this.pack_workers.push(k)}k=
0;f=this.pack_workers[0].queued;for(g=1;g<NUM_WORKER_THREADS;g++)this.pack_workers[g].queued<f&&(k=g,f=this.pack_workers[g].queued);if(2<f)b.viewer3DImpl.modelQueue().addGeomPackMissingLastFrame(a);else{var l=c.uri,f=this.pack_workers[k];f.queued+=2;c.loading=!0;b.svf.partPacksLoadDone=!1;c=this.pathToURL(this.svf.basePath+l);a={operation:WORKER_LOAD_GEOMETRY,url:c,packId:parseInt(a),headers:d.HTTP_REQUEST_HEADERS,workerId:k,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam};
f.postMessage(a)}}}};h.SvfLoader.prototype.loadGeometryPack=function(a,b){var c,g,f,k,l=this;c=function(a){if(a.data&&a.data.mesh){if(l.processReceivedMesh(a.data),1<=a.data.progress){--l.pack_workers[a.data.workerId].queued;a=!0;for(k=0;k<l.pack_workers.length;k++)if(0!=l.pack_workers[k].queued){a=!1;break}if(a){for(k=0;k<NUM_WORKER_THREADS;k++)l.pack_workers[k].terminate();l.pack_workers=null}l.svf.fragments.numLoaded==l.svf.fragments.length&&(l.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||l.viewer3DImpl.matman().loadTextures(l.svf),
l.onGeomLoadDone())}}else if(a.data&&a.data.progress){--l.pack_workers[a.data.workerId].queued;if(l.next_pack<l.svf.geompacks.length){a=null;var b=l.viewer3DImpl.modelQueue().geomPacksMissingLastFrame();for(f=0;f<b.length&&(a=l.svf.geompacks[b[f]],a.loading);++f);if(!a||a.loading)for(;l.next_pack<l.svf.geompacks.length&&(a=l.svf.geompacks[l.next_pack++],a.loading););a&&!a.loading?(a.loading=!0,l.loadGeometryPack(a.id,a.uri)):(l.viewer3DImpl.modelQueue().enforceBvh=!1,l.svf.fragments.packIds=null)}l.viewer3DImpl.signalProgress(100*
l.next_pack/l.svf.geompacks.length)}else a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?l.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}:l.pack_workers[a.data.workerId].queued-=2};if(!this.pack_workers)for(this.pack_workers=[],f=0;f<NUM_WORKER_THREADS;f++)g=h.createWorkerWithTokenRefresh("Mesh Load"),g.addEventListenerWithTokenRefresh(c),g.queued=0,this.pack_workers.push(g);g=0;c=this.pack_workers[0].queued;for(f=1;f<NUM_WORKER_THREADS;f++)this.pack_workers[f].queued<
c&&(g=f,c=this.pack_workers[f].queued);c=this.pack_workers[g];c.queued+=2;var m=this.pathToURL(this.svf.basePath+b);g={operation:WORKER_LOAD_GEOMETRY,url:m,packId:parseInt(a),headers:d.HTTP_REQUEST_HEADERS,workerId:g,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam};c.postMessage(g)};var k={},m={},n,q;h.SvfLoader.meshToGeometry=b;h.SvfLoader.prototype.processReceivedMesh=function(a){var d=a.packId+":"+a.meshIndex,g=this.svf,f=g.fragments,k=f.mesh2frag[d];if(void 0===
k)stderr("Mesh "+d+" was not referenced by any fragments.");else{var l=Array.isArray(k);if(this.cullGeometryOnLoading&&!this.isf2d){var m=!0;l||(k=[k]);for(var n=0;n<k.length;++n){if(k[n]<h.FRAGS_PERSISTENT_COUNT){m=!1;break}m=m&&this.viewer3DImpl.modelQueue().checkCull(k[n],!0,!0);if(!m)break}if(m){a.mesh=null;return}}b(a);n=Array.isArray(k)?k.length:1;m=l?k[0]:k;m=this.viewer3DImpl.modelQueue().getFragmentList().geomids[m];m=this.viewer3DImpl.addGeometry(a.geometry,n,m);this.cullGeometryOnLoading&&
!this.isf2d&&1<n&&null==this.viewer3DImpl.modelQueue().getFragmentList().geomidsmap[m]&&(this.viewer3DImpl.modelQueue().getFragmentList().geomidsmap[m]={n:n,t:0});a=(a.geometry.attributes.index.array||a.geometry.ib).length/3;if(l)for(n=0;n<k.length;n++){var q=0|k[n],l=f.materials[q].toString();f.polygonCounts&&(f.polygonCounts[q]=a);this.viewer3DImpl.addMeshInstance(m,q,l,c(this.tmpMatrix,f,q),!1)}else n=c(this.tmpMatrix,f,0|k),l=f.materials[k].toString(),f.polygonCounts&&(f.polygonCounts[0|k]=a),
this.viewer3DImpl.addMeshInstance(m,0|k,l,n,!1);this.onDemandLoading||(f.mesh2frag[d]=null);f.numLoaded+=k.length||1;d=f.numLoaded;g.geomPolyCount>g.nextRepaintPolys&&(g.numRepaints++,g.nextRepaintPolys+=1E4*Math.pow(1.5,g.numRepaints),this.viewer3DImpl.invalidate(!1,!0));this.isf2d&&0==d%20&&this.viewer3DImpl.invalidate(!1,!0)}};h.SvfLoader.prototype.processReceivedMesh2D=function(a,b){var c={mesh:a,is2d:!0,packId:"0",meshIndex:b},d="0:"+b,g=this.svf.fragments,f=Object.keys(c.mesh.dbIds).map(function(a){return parseInt(a)});
g.fragId2dbId[b]=f;for(var h=0;h<f.length;h++){var k=f[h],l=g.dbId2fragId[k];Array.isArray(l)?l.push(b):g.dbId2fragId[k]="undefined"!==typeof l?[l,b]:b}g.mesh2frag[d]=b;g.materials[b]=this.viewer3DImpl.matman().create2DMaterial(this.svf,a.material);g.length++;this.processReceivedMesh(c)};h.SvfLoader.prototype.onSvfLoadDone=function(a){this.isf2d&&(a.fragments={},a.fragments.mesh2frag={},a.fragments.materials=[],a.fragments.fragId2dbId=[],a.fragments.dbId2fragId=[],a.fragments.length=0,a.fragments.initialized=
!0);a.geomPolyCount=0;a.instancePolyCount=0;a.geomMemory=0;a.fragments.numLoaded=0;a.meshCount=0;a.gpuNumMeshes=0;a.gpuMeshMemory=0;a.nextRepaintPolys=1E4;a.numRepaints=0;a.basePath="";var b=this.currentLoadPath.lastIndexOf("/");-1!=b&&(a.basePath=this.currentLoadPath.substr(0,b+1));b=Date.now();this.loadTime+=b-this.t0;stderr("SVF load: "+(b-this.t0));this.isf2d||this.loadPropertyDb();this.viewer3DImpl.matman().convertMaterials(a);this.t0=b;a.bbox=(new THREE.Box3).copy(a.bbox);if(a.cameras)for(b=
0;b<a.cameras.length;b++){var c=a.cameras[b];c.position=(new THREE.Vector3).copy(c.position);c.target=(new THREE.Vector3).copy(c.target);c.up=(new THREE.Vector3).copy(c.up)}a.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(a);stderr("scene bounds: "+JSON.stringify(a.bbox));this.viewer3DImpl.signalProgress(5,"Hold on, getting the model...");this.viewer3DImpl.invalidate(!1,!1)};h.SvfLoader.prototype.addTransparencyFlagsToMaterials=function(a){for(var b in a){var c=
a[b];c.transparent=c.materials[c.userassets[0]].transparent}};h.SvfLoader.prototype.makeBVH=function(a){var b=performance.now(),c=a.materials.materials;this.addTransparencyFlagsToMaterials(c);a.bvh=new BVHBuilder(a.fragments,c);a.bvh.build({isWeakDevice:isAndroidDevice()||isIOSDevice()});a=performance.now();stderr("BVH build time: "+(a-b))};h.SvfLoader.prototype.onGeomPackFilesLoadDone=function(){stderr("Part of geom pack files are load done.");this.svf.partPacksLoadDone=!0;this.viewer3DImpl.invalidate(!1,
!0)};h.SvfLoader.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0;this.onDemandLoading||(this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null);var a=Date.now(),b="Fragments load time: "+(a-this.t0);this.loadTime+=a-this.t0;this.isf2d||this.svf.bvh||(this.makeBVH(this.svf),this.viewer3DImpl.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives));this.isf2d&&this.loadPropertyDb();stderr(b);this.logger&&(a={category:"model_load_stats",is_f2d:this.isf2d,has_prism:this.viewer3DImpl.matman().hasPrism,
load_time:this.loadTime,geometry_size:this.viewer3DImpl.modelQueue().getGeometryList().geomMemory,meshes_count:this.viewer3DImpl.modelQueue().getGeometryList().geoms.length,urn:this.svfUrn},this.logger.log(a,!0));h.assets&&window.webkit&&(window.webkit.messageHandlers.callbackHandler.postMessage({command:"assets",data:h.assets}),h.assets=null);this.currentLoadPath=null;this.isf2d=void 0;this.viewer3DImpl.onLoadComplete()};var l=1,p={};h.SvfLoader.prototype.loadPropertyDb=function(){var a=this;this.propWorker||
(this.propWorker=h.createWorkerWithTokenRefresh("Property"),this.propWorker.addEventListenerWithTokenRefresh(f));var b=g(function(b){var c=b.instanceTree,g=b.instanceBoxes;c?(a.svf.instanceTree=new InstanceTree(c,g,b.objectCount,b.maxTreeDepth),a.svf.fragToNodeDone=!0):b.objectCount&&(a.svf.hasObjectProperties=b.objectCount);a.viewer3DImpl.api.fireEvent({type:d.OBJECT_TREE_CREATED_EVENT,svf:a.svf})},function(b){a.svf.propertyDbError=b;a.viewer3DImpl.api.fireEvent({type:d.OBJECT_TREE_UNAVAILABLE_EVENT,
svf:a.svf})}),c=this.pathToURL(this.svf.basePath);this.sharedDbPath&&!this.svf.propertydb.values.length&&(c=this.sharedDbPath,stderr("Using shared property db: "+c));this.propWorker.postMessage({operation:WORKER_GET_OBJECT_TREE,url:c,propertydb:this.svf.propertydb,headers:d.HTTP_REQUEST_HEADERS,fragToDbId:this.svf.fragments.fragId2dbId,fragBoxes:this.svf.fragments.boxes,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,cbId:b,queryParams:this.domainParam})};h.SvfLoader.prototype.asyncPropertyOperation=
function(a,b,c){var f=this;if(f.svf.instanceTree||f.svf.hasObjectProperties){var h=g(b,c);a.cbId=h;this.propWorker.postMessage(a)}else if(f.svf.propertyDbError)c&&c(f.svf.propertyDbError);else{var k=function(g){f.viewer3DImpl.api.removeEventListener(d.OBJECT_TREE_CREATED_EVENT,k);f.viewer3DImpl.api.removeEventListener(d.OBJECT_TREE_UNAVAILABLE_EVENT,k);g.svf.instanceTree||g.svf.hasObjectProperties||g.svf.propertyDbError?f.asyncPropertyOperation(a,b,c):c&&c({code:d.UNKNOWN_FAILURE,msg:"Failed to load properties."})};
f.viewer3DImpl.api.addEventListener(d.OBJECT_TREE_CREATED_EVENT,k);f.viewer3DImpl.api.addEventListener(d.OBJECT_TREE_UNAVAILABLE_EVENT,k)}};h.SvfLoader.prototype.getProperties=function(a,b,c){this.asyncPropertyOperation({operation:WORKER_GET_PROPERTIES,dbId:a},b,c)};h.SvfLoader.prototype.searchProperties=function(a,b,c,d){this.asyncPropertyOperation({operation:WORKER_SEARCH_PROPERTIES,searchText:a,attributeNames:b},c,d)};h.SvfLoader.prototype.getExternalIdMapping=function(a,b){this.asyncPropertyOperation({operation:WORKER_BUILD_EXTERNAL_ID_MAPPING},
a,b)};h.SvfLoader.prototype.getObjectTree=function(a,b){var c=this;if(c.svf.instanceTree)a(c.svf.instanceTree);else if(c.svf.propertyDbError||"hasObjectProperties"in c.svf)b(c.svf.propertyDbError);else{var g=function(){c.viewer3DImpl.api.removeEventListener(d.OBJECT_TREE_CREATED_EVENT,g);c.viewer3DImpl.api.removeEventListener(d.OBJECT_TREE_UNAVAILABLE_EVENT,g);c.getObjectTree(a,b)};c.viewer3DImpl.api.addEventListener(d.OBJECT_TREE_CREATED_EVENT,g);c.viewer3DImpl.api.addEventListener(d.OBJECT_TREE_UNAVAILABLE_EVENT,
g)}}})();var VBB_LINE_SEGMENT=16,VBB_ARC_CIRCULAR=32,VBB_ARC_ELLIPTICAL=48,VBB_TEX_QUAD=64,VBB_ONE_TRIANGLE=80,VBB_INSTANCED_FLAG=0,VBB_SEG_START_RIGHT=1,VBB_SEG_START_LEFT=2,VBB_SEG_END_RIGHT=3,VBB_SEG_END_LEFT=4,TAU=2*Math.PI,VBB_COLOR_OFFSET=6,VBB_DBID_OFFSET=7,VBB_FLAGS_OFFSET=8;
function VertexBufferBuilder(a,b){var c=b||65536;this.useInstancing=a;this.stride=12;this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?c/4:c));this.vbf=new Float32Array(this.vb);this.vbi=new Int32Array(this.vb);this.vcount=0;this.ib=this.useInstancing?null:new Uint16Array(c);this.icount=0;this.minx=this.miny=Infinity;this.maxx=this.maxy=-Infinity;this.dbIds={};this.vpIds=[];this.numTriangleGeoms=this.numCirculars=this.numEllipticals=0}
VertexBufferBuilder.prototype.expandStride=function(){var a=this.stride;if(!(12<=a)){for(var b=this.stride+3,c=new ArrayBuffer(this.vb.byteLength/a*b),f=new Uint8Array(this.vb),g=new Uint8Array(c),d=0,h=this.vcount;d<h;d++)for(var k=d*a*4,m=d*b*4,n=0;n<4*a;n++)g[m+n]=f[k+n];this.vb=c;this.vbf=new Float32Array(c);this.vbi=new Int32Array(c);this.stride=b}};
VertexBufferBuilder.prototype.addToBounds=function(a,b){a<this.minx&&(this.minx=a);a>this.maxx&&(this.maxx=a);b<this.miny&&(this.miny=b);b>this.maxy&&(this.maxy=b)};VertexBufferBuilder.prototype.setVertexFlag=function(a,b,c,f){this.vbi[a*this.stride+VBB_FLAGS_OFFSET]=f|c|b<<16};
VertexBufferBuilder.prototype.addVertexTriangleGeom=function(a,b,c,f,g,d,h,k,m){for(var n=this.vcount,q=this.useInstancing?1:4,l=0;l<q;l++){var p=(n+l)*this.stride,r=this.vbf;r[p]=a;r[p+1]=b;r[p+2]=c;r[p+3]=f;r[p+4]=g;r[p+5]=d;this.vbi[p+VBB_COLOR_OFFSET]=h;this.vbi[p+VBB_DBID_OFFSET]=k;this.vcount++;this.dbIds[k]=1;this.vpIds.push(m)}return n};
VertexBufferBuilder.prototype.addVertexLine=function(a,b,c,f,g,d,h,k){for(var m=this.vcount,n=this.useInstancing?1:4,q=0;q<n;q++){var l=(m+q)*this.stride,p=this.vbf;p[l]=a;p[l+1]=b;p[l+2]=c;p[l+3]=f;p[l+4]=g;p[l+5]=0;this.vbi[l+VBB_COLOR_OFFSET]=d;this.vbi[l+VBB_DBID_OFFSET]=h;this.dbIds[h]=1;this.vcount++;this.vpIds.push(k)}return m};
VertexBufferBuilder.prototype.addVertexArc=function(a,b,c,f,g,d,h,k,m,n,q){for(var l=this.vcount,p=this.useInstancing?1:4,r=0;r<p;r++){var A=(l+r)*this.stride,C=this.vbf;C[A]=a;C[A+1]=b;C[A+2]=c;C[A+3]=f;C[A+4]=k;C[A+5]=g;this.vbi[A+VBB_COLOR_OFFSET]=m;this.vbi[A+VBB_DBID_OFFSET]=n;g!=d&&(C[A+9]=d,C[A+10]=h);this.dbIds[n]=1;this.vcount++;this.vpIds.push(q)}return l};
VertexBufferBuilder.prototype.addVertex=function(a,b,c,f,g,d,h,k,m){if(!this.useInstancing){var n=this.vcount,q=n*this.stride,l=this.vbf;l[q]=a;l[q+1]=b;l[q+2]=c;l[q+3]=f;l[q+4]=g;l[q+5]=0;this.vbi[q+VBB_COLOR_OFFSET]=d;this.vbi[q+VBB_DBID_OFFSET]=h;this.setVertexFlag(n,k,0,0);this.vcount++;this.dbIds[h]=1;this.vpIds.push(m);return n}};VertexBufferBuilder.prototype.addVertexPolytriangle=function(a,b,c,f,g,d,h,k,m){this.useInstancing||(this.addVertex(a,b,c,f,g,d,h,k,m),this.addToBounds(a,b))};
VertexBufferBuilder.prototype.setVertexColor=function(a,b){this.useInstancing||(this.vbi[a*this.stride+VBB_COLOR_OFFSET]=b)};VertexBufferBuilder.prototype.addTriangle=function(a,b,c){if(!this.useInstancing){var f=this.ib,g=this.icount;if(g+3>=f.length){for(var d=new Uint16Array(2*f.length),h=0;h<g;h++)d[h]=f[h];this.ib=f=d}f[g]=a;f[g+1]=b;f[g+2]=c;this.icount+=3}};
VertexBufferBuilder.prototype.finalizeQuad=function(a,b,c){this.useInstancing?this.setVertexFlag(a,c,VBB_INSTANCED_FLAG,b):(this.addTriangle(a,a+1,a+2),this.addTriangle(a,a+2,a+3),this.setVertexFlag(a,c,VBB_SEG_START_RIGHT,b),this.setVertexFlag(a+1,c,VBB_SEG_END_RIGHT,b),this.setVertexFlag(a+2,c,VBB_SEG_END_LEFT,b),this.setVertexFlag(a+3,c,VBB_SEG_START_LEFT,b))};
VertexBufferBuilder.prototype.addSegment=function(a,b,c,f,g,d,h,k,m){var n=c-a,q=f-b,l=0;if(n||q)l=Math.atan2(q,n);n=Math.sqrt(n*n+q*q);g=this.addVertexLine(a,b,l,n,.5*g,d,h,m);this.finalizeQuad(g,VBB_LINE_SEGMENT,k);this.addToBounds(a,b);this.addToBounds(c,f)};
VertexBufferBuilder.prototype.addTriangleGeom=function(a,b,c,f,g,d,h,k,m,n){this.numTriangleGeoms++;h=this.addVertexTriangleGeom(a,b,c,f,g,d,h,k,m,n);this.finalizeQuad(h,VBB_ONE_TRIANGLE,m);this.addToBounds(a,b);this.addToBounds(c,f);this.addToBounds(g,d)};
VertexBufferBuilder.prototype.addCircularArc=function(a,b,c,f,g,d,h,k,m,n){this.numCirculars++;0==c&&0==f&&(f=TAU);var q=Math.abs(c-f);if(1E-4<q&&1E-4<Math.abs(q-TAU)){var q=a+g*Math.cos(c),l=b+g*Math.sin(c);this.addSegment(q,l,q,l,d,h,k,m,n);q=a+g*Math.cos(f);l=b+g*Math.sin(f);this.addSegment(q,l,q,l,d,h,k,m,n)}else this.addToBounds(a-g,b-g),this.addToBounds(a+g,b+g);a=this.addVertexArc(a,b,c,f,g,g,0,.5*d,h,k,n);this.finalizeQuad(a,VBB_ARC_CIRCULAR,m)};
VertexBufferBuilder.prototype.addEllipticalArc=function(a,b,c,f,g,d,h,k,m,n,q,l){this.expandStride();this.numEllipticals++;0==c&&0==f&&(f=TAU);var p=Math.abs(c-f);if(1E-4<Math.abs(p-TAU)){var p=a+g*Math.cos(c),r=b+d*Math.sin(c);this.addSegment(p,r,p,r,k,m,n,q,l);p=a+g*Math.cos(f);r=b+d*Math.sin(f);this.addSegment(p,r,p,r,k,m,n,q,l)}else this.addToBounds(a-g,b-d),this.addToBounds(a+g,b+d);a=this.addVertexArc(a,b,c,f,g,d,h,.5*k,m,n,l);this.finalizeQuad(a,VBB_ARC_ELLIPTICAL,q)};
VertexBufferBuilder.prototype.addTexturedQuad=function(a,b,c,f,g,d,h){var k=.5*f;g=this.addVertexLine(a,b+k,0,c,k,4278255615,g,h);this.finalizeQuad(g,VBB_TEX_QUAD,d);this.addToBounds(a,b);this.addToBounds(a+c,b+f)};VertexBufferBuilder.prototype.isFull=function(a){a||(a=3);return this.useInstancing?32767<4*this.vcount+a:32767<this.vcount+a};
VertexBufferBuilder.prototype.toMesh=function(){var a={};a.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4));a.vbstride=this.stride;var b=this.useInstancing?1:0;a.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:b},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:b},color4b:{offset:VBB_COLOR_OFFSET,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},dbId4b:{offset:VBB_DBID_OFFSET,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},flags4b:{offset:VBB_FLAGS_OFFSET,itemSize:4,
bytesPerItem:1,divisor:b,normalize:!1}};9<this.stride&&(a.vblayout.extraParams={offset:9,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1});if(this.useInstancing){for(var c in a.vblayout)a.vblayout[c].divisor=1;a.numInstances=this.vcount;b=new Int32Array(4);b[0]=VBB_SEG_START_RIGHT;b[1]=VBB_SEG_END_RIGHT;b[2]=VBB_SEG_END_LEFT;b[3]=VBB_SEG_START_LEFT;a.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,normalize:!1,divisor:0};a.vblayout.instFlags4b.array=b.buffer;b=a.indices=new Uint16Array(6);
b[0]=0;b[1]=1;b[2]=2;b[3]=0;b[4]=2;b[5]=3}else a.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));a.dbIds=this.dbIds;b=this.maxx-this.minx;c=this.maxy-this.miny;var f=Math.max(b,c);a.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-f},max:{x:this.maxx,y:this.maxy,z:.001*f}};f=a.boundingSphere={};f.center={x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0};f.radius=.5*Math.sqrt(b*b+c*c);a.vpIds=new Uint16Array(this.vpIds);return a};
function init_three_triangulator(){Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function a(){this.bbox=new THREE.Box2;this.right=this.left=null;this.node_edges=[]}function b(a,b,c){this.pts=a;this.edges=b;this.bbox=c;this.pipResult=!1}function c(a,b){this.edges=a;this.bbox=b;this.pts=[];this.idmap={};this.xymap={};this.contours=[];this.scale=1E6/this.bbox.size().length()}function f(a){this.indices=[];this.cset=a;var c=this.pts=a.pts;this.intervalTree=new b(a.pts,
a.edges,a.bbox);this.intervalTree.build();for(var f=0;f<c.length;f++)c[f].id=f;var k=new lmv_poly2tri.SweepContext([]);k.points_=c.slice();if(a.contours)for(f=this.cset.contours,a=0;a<f.length;a++){for(var m=f[a],n=m[0]!==m[m.length-1],q=[],l=0;l<m.length-1;l++)q.push(c[m[l]]);k.initEdges(q,n)}else for(a=this.cset.edges,f=0;f<a.length;f++)m=a[f],m.p1!=m.p2&&k.initEdges([c[m.p1],c[m.p2]],!0);this.triangulate(k);this.processResult(k)}b.prototype.splitNode=function(b){if(!(b.bbox.min.y>=b.bbox.max.y||
3>b.node_edges.length)){var c=.5*(b.bbox.min.y+b.bbox.max.y);b.left=new a;b.right=new a;for(var f=this.pts,k=b.node_edges,m=[],n=new THREE.Vector2,q=0;q<k.length;q++){var l=this.edges[k[q]],p=f[l.p1].y,r=f[l.p2].y;if(p>r)var A=p,p=r,r=A;A=null;r<c?(b.left.node_edges.push(k[q]),A=b.left.bbox):p>c?(b.right.node_edges.push(k[q]),A=b.right.bbox):m.push(k[q]);A&&(n.set(f[l.p1].x,f[l.p1].y),A.expandByPoint(n),n.set(f[l.p2].x,f[l.p2].y),A.expandByPoint(n))}b.node_edges=m;b.left.node_edges.length&&this.splitNode(b.left);
b.right.node_edges.length&&this.splitNode(b.right)}};b.prototype.build=function(){this.root=new a;for(var b=this.root.node_edges,c=0;c<this.edges.length;c++)b.push(c);this.root.bbox.copy(this.bbox);this.splitNode(this.root)};b.prototype.pointInPolygonRec=function(a,b,c){if(a.bbox.min.y<=c&&a.bbox.max.y>=c)for(var f=this.pts,m=a.node_edges,n=0,q=m.length;n<q;n++){var l=this.edges[m[n]],p=f[l.p1],r=p.x,p=p.y,A=f[l.p2],l=A.x,A=A.y,C=A>=c;p>=c!=C&&(A-c)*(r-l)>=(l-b)*(p-A)==C&&(this.pipResult=!this.pipResult)}(f=
a.left)&&f.bbox.min.y<=c&&f.bbox.max.y>=c&&this.pointInPolygonRec(f,b,c);(a=a.right)&&a.bbox.min.y<=c&&a.bbox.max.y>=c&&this.pointInPolygonRec(a,b,c)};b.prototype.pointInPolygon=function(a,b){this.pipResult=!1;this.pointInPolygonRec(this.root,a,b);return this.pipResult};c.prototype.getPointIndex=function(a,b,c){var f=this.idmap[c];if(void 0!==f)return f;var m=0|a*this.scale,f=0|b*this.scale,n=this.xymap[m];void 0===n?(this.xymap[m]=n={},m=void 0):m=n[f];void 0===m&&(n[f]=m=this.pts.length,this.idmap[c]=
m,this.pts.push({x:a,y:b}));return m};c.prototype.snapEdges=function(){for(var a=0;a<this.edges.length;a++){var b=this.edges[a];b.p1=this.getPointIndex(b.pt1.x,b.pt1.y,b.eid1);b.p2=this.getPointIndex(b.pt2.x,b.pt2.y,b.eid2)}};c.prototype.stitchContours=function(){for(var a={},b=0;b<this.edges.length;b++){var c=this.edges[b];c.p1!==c.p2&&(void 0!==a[c.p1]?a[c.p1].push(c.p2):a[c.p1]=[c.p2],void 0!==a[c.p2]?a[c.p2].push(c.p1):a[c.p2]=[c.p1])}var c=[],f;for(f in a)if(2!==a[f].length){stderr("Incomplete edge table");
break}for(;;){var m=void 0;for(f in a)if(1<a[f].length){m=f;break}if(!m)for(f in a)if(0<a[f].length){m=f;break}if(!m)break;var b=-1,n=parseInt(m),m=a[m];for(c.push(n);m&&m.length;){var q=m.shift();q===b&&(q=m.shift());if(void 0===q){delete a[n];break}c.push(q);0==m.length?delete a[n]:m[0]===b&&delete a[n];b=n;n=q;m=a[q]}c.length&&(this.contours.push(c),c=[])}a=[];for(b=0;b<this.contours.length;b++)m=this.contours[b],m[0]!==m[m.length-1]&&a.push(m);if(a.length)for(a=!0;a;){a=!1;n={};c=this.contours;
for(b=0;b<c.length;b++)m=c[b],q=m[0],m=m[m.length-1],q!==m&&(n[q]?n[q].push(-b-1):n[q]=[-b-1],n[m]?n[m].push(b):n[m]=[b]);for(f in n)if(b=n[f],2==b.length){n=void 0;0>b[0]&&0>b[1]&&(n=-b[0]-1,m=-b[1]-1,c[m].shift(),Array.prototype.push.apply(c[n].reverse(),c[m]),n=m);0>b[0]&&0<b[1]&&(n=-b[0]-1,m=b[1],c[m].pop(),Array.prototype.push.apply(c[m],c[n]));0<b[0]&&0>b[1]&&(n=b[0],m=-b[1]-1,c[n].pop(),Array.prototype.push.apply(c[n],c[m]),n=m);0<b[0]&&0<b[1]&&(n=b[0],m=b[1],c[n].pop(),Array.prototype.push.apply(c[n],
c[m].reverse()),n=m);void 0!==n&&(c.splice(n,1),a=!0);break}}};f.prototype.triangulate=function(a){try{a.triangulate()}catch(b){}};f.prototype.processResult=function(a){for(var b=0;b<a.map_.length;b++){var c=a.map_[b],f=c.points_[0],m=c.points_[1],c=c.points_[2];void 0!==f.id&&void 0!==m.id&&void 0!==c.id&&this.filterFace(f.id,m.id,c.id)}};f.prototype.pointInEdgeList=function(a,b){for(var c,f,m,n,q,l,p=this.cset.pts,r=this.cset.edges,A=!1,C=0,H=r.length;C<H;++C)f=r[C],m=p[f.p1].x,n=p[f.p1].y,c=n>=
b,q=p[f.p2].x,l=p[f.p2].y,f=l>=b,c!=f&&(l-b)*(m-q)>=(q-a)*(n-l)==f&&(A=!A);return A};f.prototype.pointInContour=function(a,b,c){var f,m,n,q,l,p,r=!1,A=this.cset.pts;n=A[c[c.length-1]].x;q=A[c[c.length-1]].y;f=q>=b;for(var C=0,H=c.length;C<H;++C)l=A[c[C]].x,p=A[c[C]].y,m=p>=b,f!=m&&(p-b)*(n-l)>=(l-a)*(q-p)==m&&(r=!r),f=m,n=l,q=p;return r};f.prototype.pointInPolygon=function(a,b){for(var c=!1,f=0;f<this.cset.contours.length;f++)this.pointInContour(a,b,this.cset.contours[f])&&(c=!c);return c};f.prototype.filterFace=
function(a,b,c){var f=this.pts[a],m=this.pts[b],n=this.pts[c];this.intervalTree.pointInPolygon((f.x+m.x+n.x)/3,(f.y+m.y+n.y)/3)&&(0<(m.x-f.x)*(n.y-f.y)-(n.x-f.x)*(m.y-f.y)?this.indices.push(a,b,c):this.indices.push(a,c,b))};return{TriangulatedSurface:f,ContourSet:c,Edge:function(a,b,c,f,m,n,q){this.pt1=a;this.pt2=b;this.p2=this.p1=-1;this.eid1=q+":"+(c<f?c+":"+f:f+":"+c);this.eid2=q+":"+(m<n?m+":"+n:n+":"+m)}}}())}
function init_three_intersector(){Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function a(a,b,c,d,g){var h=f.subVectors(c,b),k=a.normal.dot(h);if(1E-10>Math.abs(k))return d.copy(b),g.copy(c),2;k=1/k;a=-(b.dot(a.normal)*k+a.constant*k);if(-1E-10>a||a>1+1E-10)return 0;b=h.multiplyScalar(a).add(b);d.copy(b);return 1}function b(b,f,h,k,l,m,n,q,E){var B=b.distanceToPoint(f),D=b.distanceToPoint(h),J=b.distanceToPoint(k);if(0>B&&0>D&&0>J||0<B&&0<D&&0<J)return null;
var B=Math.sign(B),D=Math.sign(D),J=Math.sign(J),F,G,M,I,L,K;if(B!==D){var O=a(b,f,h,g,d);if(2==O){q.push(new c(f.clone(),h.clone(),l,l,m,m,E));return}1==O?(M=l,I=m,F=g.clone()):console.warn("Unexpected zero intersections where at least one was expected")}if(D!==J){O=a(b,h,k,g,d);if(2==O){q.push(new c(h.clone(),k.clone(),m,m,n,n,E));return}1==O?F?(L=m,K=n,G=g.clone()):(M=m,I=n,F=g.clone()):console.warn("Unexpected zero intersections where at least one was expected")}if(J!==B){O=a(b,k,f,g,d);if(2==
O){q.push(new c(k.clone(),f.clone(),n,n,l,l,E));return}1==O?F?(L=n,K=l,G=g.clone()):console.warn("Unexpected single intersection point"):console.warn("Unexpected zero intersections where at least one was expected")}F&&G?q.push(new c(F,G,M,I,L,K,E)):console.warn("Unexpected one intersection where two were expected")}var c=Autodesk.Viewing.Private.Triangulator.Edge,f=new THREE.Vector3,g=new THREE.Vector3,d=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,
q=new THREE.Matrix4,l=new THREE.Plane;return{makePlaneBasis:function(a){var b=new THREE.Vector3(0,0,1),c=a.normal.clone().cross(b),c=c.normalize(),b=b.dot(a.normal),d=new THREE.Matrix4;if(!(1E-10>Math.abs(c.x)&&1E-10>Math.abs(c.y)&&1E-10>Math.abs(c.z))){var f=c,c=Math.sqrt(1-b*b),g=1-b,h=f.x,k=f.y,f=f.z,l=g*h,m=g*k;d.set(l*h+b,l*k-c*f,l*f+c*k,0,l*k+c*f,m*k+b,m*f-c*h,0,l*f-c*k,m*f+c*h,g*f*f+b,0,0,0,0,1)}d.elements[14]=a.constant;return d},convertToPlaneCoords:function(a,b,c){for(var d=0;d<b.length;d++){var f=
b[d];f.pt1.applyMatrix4(a);f.pt2.applyMatrix4(a);c.expandByPoint(f.pt1);c.expandByPoint(f.pt2)}},intersectTrianglePlane:b,intersectMeshPlane:function(a,c,d){var f=c.geometry,g=d.length,h=f.attributes,t=c.matrixWorld;q.getInverse(t);l.copy(a).applyMatrix4(q);var w,E,B;if(void 0!==h.index){a=h.index.array||f.ib;var h=f.vb?f.vb:h.position.array,D=f.vb?f.vbstride:3;(f=f.offsets)&&0!==f.length||(f=[{start:0,count:a.length,index:0}]);for(var J=0,F=f.length;J<F;++J){w=f[J].start;for(var G=f[J].index,M=w,
I=w+f[J].count;M<I;M+=3)w=G+a[M],E=G+a[M+1],B=G+a[M+2],k.x=h[w*D],k.y=h[w*D+1],k.z=h[w*D+2],m.x=h[E*D],m.y=h[E*D+1],m.z=h[E*D+2],n.x=h[B*D],n.y=h[B*D+1],n.z=h[B*D+2],b(l,k,m,n,w,E,B,d,c.fragId)}}else for(h=f.vb?f.vb:h.position.array,D=f.vb?f.vbstride:3,M=0,I=h.length;M<I;M+=3)w=M,E=M+1,B=M+2,k.x=h[w*D],k.y=h[w*D+1],k.z=h[w*D+2],m.x=h[E*D],m.y=h[E*D+1],m.z=h[E*D+2],n.x=h[B*D],n.y=h[B*D+1],n.z=h[B*D+2],b(l,k,m,n,w,E,B,d,c.fragId);for(M=g;M<d.length;M++)d[M].pt1.applyMatrix4(t),d[M].pt2.applyMatrix4(t)},
intersectBoxPlane:function(a,b){h.set(b.min.x,b.min.y,b.min.z);var c=a.distanceToPoint(h),c=Math.sign(c);h.set(b.min.x,b.min.y,b.max.z);var d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.min.x,b.max.y,b.min.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.min.x,b.max.y,b.max.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.max.x,b.min.y,b.min.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.max.x,b.min.y,b.max.z);d=a.distanceToPoint(h);if(Math.sign(d)!==
c)return!0;h.set(b.max.x,b.max.y,b.min.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.max.x,b.max.y,b.max.z);d=a.distanceToPoint(h);return Math.sign(d)!==c?!0:!1}}}())}
function NodeArray(a,b){this.bytes_per_node=b?32:36;var c,f;a instanceof ArrayBuffer?(c=a.byteLength/this.bytes_per_node,f=a,this.nodeCount=c):(c=a|0,f=new ArrayBuffer(this.bytes_per_node*c),this.nodeCount=0);this.nodeCapacity=c;this.nodesRaw=f;this.is_lean_node=b;this.node_stride=this.bytes_per_node/4;this.node_stride_short=this.bytes_per_node/2;this.nodesF=new Float32Array(this.nodesRaw);this.nodesI=new Int32Array(this.nodesRaw);this.nodesS=new Uint16Array(this.nodesRaw)}
NodeArray.prototype.setLeftChild=function(a,b){this.nodesI[a*this.node_stride+6]=b};NodeArray.prototype.getLeftChild=function(a){return this.nodesI[a*this.node_stride+6]};NodeArray.prototype.setPrimStart=function(a,b){this.is_lean_node?this.nodesI[a*this.node_stride+6]=b:this.nodesI[a*this.node_stride+8]=b};NodeArray.prototype.getPrimStart=function(a){return this.is_lean_node?this.nodesI[a*this.node_stride+6]:this.nodesI[a*this.node_stride+8]};
NodeArray.prototype.setPrimCount=function(a,b){this.nodesS[a*this.node_stride_short+14]=b};NodeArray.prototype.getPrimCount=function(a){return this.nodesS[a*this.node_stride_short+14]};NodeArray.prototype.setFlags=function(a,b,c,f){this.nodesS[a*this.node_stride_short+15]=f<<3|c<<2|b&3};NodeArray.prototype.getFlags=function(a){return this.nodesS[a*this.node_stride_short+15]};
NodeArray.prototype.setBox0=function(a,b){var c=a*this.node_stride,f=this.nodesF;f[c]=b[0];f[c+1]=b[1];f[c+2]=b[2];f[c+3]=b[3];f[c+4]=b[4];f[c+5]=b[5]};NodeArray.prototype.getBoxThree=function(a,b){var c=a*this.node_stride,f=this.nodesF;b.min.x=f[c];b.min.y=f[c+1];b.min.z=f[c+2];b.max.x=f[c+3];b.max.y=f[c+4];b.max.z=f[c+5]};NodeArray.prototype.setBoxThree=function(a,b){var c=a*this.node_stride,f=this.nodesF;f[c]=b.min.x;f[c+1]=b.min.y;f[c+2]=b.min.z;f[c+3]=b.max.x;f[c+4]=b.max.y;f[c+5]=b.max.z};
NodeArray.prototype.makeEmpty=function(a){a*=this.node_stride;var b=this.nodesI;b[a+6]=-1;b[a+7]=0;this.is_lean_node||(b[a+8]=-1)};NodeArray.prototype.realloc=function(a){if(this.nodeCount+a>this.nodeCapacity){var b=0|3*this.nodeCapacity/2;b<this.nodeCount+a&&(b=this.nodeCount+a);a=new ArrayBuffer(b*this.bytes_per_node);var c=new Int32Array(a);c.set(this.nodesI);this.nodeCapacity=b;this.nodesRaw=a;this.nodesF=new Float32Array(a);this.nodesI=c;this.nodesS=new Uint16Array(a)}};
NodeArray.prototype.nextNodes=function(a){this.realloc(a);var b=this.nodeCount;this.nodeCount+=a;for(var c=0;c<a;c++)this.makeEmpty(b+c);return b};NodeArray.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};
var BOX_STRIDE=6,POINT_STRIDE=3,BOX_EPSILON=1E-5,BOX_SCALE_EPSILON=1E-5,MAX_DEPTH=15,MAX_BINS=16,BVHModule=function(){function a(a,b,c){a[0]>b[c]&&(a[0]=b[c]);a[3]<b[c]&&(a[3]=b[c]);a[1]>b[c+1]&&(a[1]=b[c+1]);a[4]<b[c+1]&&(a[4]=b[c+1]);a[2]>b[c+2]&&(a[2]=b[c+2]);a[5]<b[c+2]&&(a[5]=b[c+2])}function b(a,b,c){a[0]>b[c]&&(a[0]=b[c]);a[1]>b[c+1]&&(a[1]=b[c+1]);a[2]>b[c+2]&&(a[2]=b[c+2]);a[3]<b[c+3]&&(a[3]=b[c+3]);a[4]<b[c+4]&&(a[4]=b[c+4]);a[5]<b[c+5]&&(a[5]=b[c+5])}function c(a,b){a[0]>b[0]&&(a[0]=b[0]);
a[1]>b[1]&&(a[1]=b[1]);a[2]>b[2]&&(a[2]=b[2]);a[3]<b[3]&&(a[3]=b[3]);a[4]<b[4]&&(a[4]=b[4]);a[5]<b[5]&&(a[5]=b[5])}function f(a,b,c,d){for(var f=0;3>f;f++)a[b+f]=c[d+3+f]-c[d+f]}function g(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5]}function d(a){a[0]=Infinity;a[1]=Infinity;a[2]=Infinity;a[3]=-Infinity;a[4]=-Infinity;a[5]=-Infinity}function h(a){var b=a[3]-a[0],c=a[4]-a[1];a=a[5]-a[2];return 0>b||0>c||0>a?0:2*(b*c+c*a+a*b)}function k(){this.vb_left=new Float32Array(6);this.vb_right=
new Float32Array(6);this.cb_left=new Float32Array(6);this.cb_right=new Float32Array(6);this.num_left=0;this.num_bins=this.best_cost=this.best_split=-1}function m(){this.box_bbox=new Float32Array(6);this.box_centroid=new Float32Array(6);this.num_prims=0}function n(){this.BL=new Float32Array(6);this.CL=new Float32Array(6);this.AL=this.NL=0}k.prototype.reset=function(){this.num_left=0;this.num_bins=this.best_cost=this.best_split=-1};m.prototype.reset=function(){this.num_prims=0;d(this.box_bbox);d(this.box_centroid)};
n.prototype.reset=function(){this.AL=this.NL=0;d(this.BL);d(this.CL)};for(var q=[],l=0;l<MAX_BINS;l++)q.push(new m);for(var p=[],l=0;l<MAX_BINS-1;l++)p.push(new n);var r=new Float32Array(6),A=new Float32Array(6),C=new Float32Array(3);return{bvh_subdivide:function(l,m,n,w,E,B,D,J){f(C,0,B,0);var F=l.nodes,G=D?l.frags_per_leaf_node_transparent:l.frags_per_leaf_node,M=D?l.frags_per_inner_node_transparent:l.frags_per_inner_node,I=l.max_polys_per_node,L=0;C[1]>C[0]&&(L=1);C[2]>C[L]&&(L=2);F.setBox0(m,
E);var K=0;E=0;if(l.polygonCounts)for(var O=n;O<=w&&!(K+=l.polygonCounts[l.primitives[O]],E++,K>I);O++);O=w-n+1;if(O<=G&&K<I||1===O||J>MAX_DEPTH||C[L]<l.scene_epsilon)F.setLeftChild(m,-1),F.setPrimStart(m,n),F.setPrimCount(m,w-n+1),F.setFlags(m,0,0,D?1:0);else{if(M){M=n;L=l.primitives;G=l.centroids;I=w-M+1;I>l.frags_per_inner_node&&(I=l.frags_per_inner_node);I>E&&(I=E);F.setPrimStart(m,M);F.setPrimCount(m,I);M+=I;d(B);for(E=M;E<=w;E++)a(B,G,3*L[E]);f(C,0,B,0);L=0;C[1]>C[0]&&(L=1);C[2]>C[L]&&(L=2);
n+=F.getPrimCount(m)}E=new k;var R=n,M=L;if(C[M]<l.scene_epsilon)E.best_cost=Infinity;else{G=MAX_BINS;G>w-R+1&&(G=w-R+1);for(I=0;I<G;I++)q[I].reset();for(I=0;I<G-1;I++)p[I].reset();var I=E.num_bins=G,K=l.centroids,O=l.primitives,X=l.boxes,W=I*(1-BOX_SCALE_EPSILON)/C[M];B=B[M];for(var aa=l.sort_prims;R<=w;R++){var fa=O[R]|0,U=W*(K[3*fa+M]-B)|0;0>U?U=0:U>=I&&(U=I-1);aa[R]=U;q[U].num_prims++;b(q[U].box_bbox,X,6*fa);a(q[U].box_centroid,K,3*fa)}g(p[0].BL,q[0].box_bbox);g(p[0].CL,q[0].box_centroid);p[0].AL=
h(p[0].BL);p[0].NL=q[0].num_prims;for(I=1;I<G-1;I++)B=q[I],M=p[I],g(M.BL,p[I-1].BL),c(M.BL,B.box_bbox),M.AL=h(M.BL),g(M.CL,p[I-1].CL),c(M.CL,B.box_centroid),M.NL=p[I-1].NL+B.num_prims;I=G-1;g(r,q[I].box_bbox);g(A,q[I].box_centroid);O=h(r);G=q[I].num_prims;M=I;K=O*G+p[I-1].AL*p[I-1].NL;g(E.vb_right,r);g(E.cb_right,q[I].box_centroid);g(E.vb_left,p[I-1].BL);g(E.cb_left,p[I-1].CL);E.num_left=p[I-1].NL;for(--I;1<=I;I--)B=q[I],c(r,B.box_bbox),c(A,B.box_centroid),O=h(r),G+=B.num_prims,B=O*G+p[I-1].AL*p[I-
1].NL,B<=K&&(K=B,M=I,g(E.vb_right,r),g(E.cb_right,A),g(E.vb_left,p[I-1].BL),g(E.cb_left,p[I-1].CL),E.num_left=p[I-1].NL);E.best_split=M;E.best_cost=K}if(0>E.num_bins)F.setPrimCount(m,F.getPrimCount(m)+w-n+1);else{B=l.primitives;G=l.sort_prims;M=0;I=n|0;O=E.best_split|0;for(K=n;K<=w;K++)X=B[K]|0,G[K]<O?B[I++]=X:G[M++]=X;for(K=0;K<M;K++)B[I+K]=G[K];B=F.nextNodes(2);F.setFlags(m,L,.5*(E.vb_left[3+L]+E.vb_left[L])<.5*(E.vb_right[3+L]+E.vb_right[L])?0:1,D?1:0);F.setLeftChild(m,B);l.recursion_stack.push([l,
B+1,n+E.num_left,w,E.vb_right,E.cb_right,D,J+1]);l.recursion_stack.push([l,B,n,n+E.num_left-1,E.vb_left,E.cb_left,D,J+1])}}},compute_boxes:function(c){var g=c.boxv_o,h=c.boxc_o,k=c.boxv_t,l=c.boxc_t;d(g);d(h);d(k);d(l);for(var m=c.centroids,n=c.boxes,q=0,p=c.prim_count;q<p;q++){var r=m,A=3*q,I=n,L=6*q;r[A]=.5*(I[L]+I[L+3]);r[A+1]=.5*(I[L+1]+I[L+4]);r[A+2]=.5*(I[L+2]+I[L+5]);q>=c.first_transparent?(a(l,m,3*q),b(k,n,6*q)):(a(h,m,3*q),b(g,n,6*q))}f(C,0,c.boxv_o,0);g=Math.max(C[0],C[1],C[2]);c.scene_epsilon=
BOX_EPSILON*g},box_area:function(a,b){var c=a[b+3]-a[b],d=a[b+4]-a[b+1],f=a[b+5]-a[b+2];return 0>c||0>d||0>f?0:2*(c*d+d*f+f*c)}}}();
function BVHBuilder(a,b){this.boxes=a.boxes;this.polygonCounts=a.polygonCounts;this.materials=a.materials;this.materialDefs=b;this.prim_count=a.length;this.frags_per_inner_node=this.frags_per_leaf_node=-1;this.nodes=null;this.work_buf=new ArrayBuffer(4*this.prim_count);this.sort_prims=new Int32Array(this.work_buf);this.primitives=new Int32Array(this.prim_count);this.centroids=new Float32Array(POINT_STRIDE*this.prim_count);this.boxv_o=new Float32Array(6);this.boxc_o=new Float32Array(6);this.boxv_t=
new Float32Array(6);this.boxc_t=new Float32Array(6);this.recursion_stack=[]}
BVHBuilder.prototype.sortPrimitives=function(){for(var a=new Float32Array(this.work_buf),b=this.materialDefs,c=this.materials,f=this.primitives,g=0,d=0,h=this.prim_count;d<h;d++){f[d]=d;var k=b[c[d]]?b[c[d]].transparent:!1;k&&g++;m?(a[d]=BVHModule.box_area(this.boxes,BOX_STRIDE*d),k&&(a[d]=-a[d])):a[d]=k?-1:1}var m=!1;if(g&&g<this.prim_count){b=new Int32Array(g);d=k=c=0;for(h=this.prim_count;d<h;d++)0<=a[d]?f[c++]=f[d]:b[k++]=f[d];f.set(b,this.prim_count-g)}this.first_transparent=this.prim_count-
g};
BVHBuilder.prototype.build=function(a){var b=a&&!!a.useSlimNodes;if(b)this.frags_per_leaf_node=1,this.frags_per_inner_node=0,this.frags_per_leaf_node_transparent=1,this.frags_per_inner_node_transparent=0,this.max_polys_per_node=Infinity;else{var c=a.isWeakDevice?.5:1;this.frags_per_leaf_node=0|32*c;this.frags_per_inner_node=0|this.frags_per_leaf_node;this.frags_per_leaf_node_transparent=this.frags_per_leaf_node;this.frags_per_inner_node_transparent=0;this.max_polys_per_node=0|1E4*c}if(this.nodes&&this.nodes.is_lean_node==
b)this.nodes.nodeCount=0;else{b=this.prim_count/this.frags_per_leaf_node;for(c=1;c<b;)c*=2;this.nodes=new NodeArray(c,a?a.useSlimNodes:!1)}this.sortPrimitives();BVHModule.compute_boxes(this);a=this.nodes.nextNodes(2);for(BVHModule.bvh_subdivide(this,a,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)b=this.recursion_stack.pop(),BVHModule.bvh_subdivide(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);for(BVHModule.bvh_subdivide(this,a+1,this.first_transparent,this.prim_count-
1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)b=this.recursion_stack.pop(),BVHModule.bvh_subdivide(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7])};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.VertexBufferReader=function(a){this.vb=a.vb.buffer;this.vbf=new Float32Array(this.vb);this.vbi=new Int32Array(this.vb);this.stride=a.vbstride;this.vcount=this.vbf.length/this.stride;this.useInstancing=!1;this.vpIds=a.vpIds};a.VertexBufferReader.prototype.getIdAt=function(a){return this.vbi[a*this.stride+7]};a.VertexBufferReader.prototype.getVertexFlagAt=function(a){return this.vbi[a*this.stride+8]};a.VertexBufferReader.prototype.getViewportIndexAt=function(a){return this.vpIds[a]};
a.VertexBufferReader.prototype.decodeLineAt=function(a,c,f,g){var d=this.stride*a;a=this.vbf[d];c=this.vbf[d+1];var h=this.vbf[d+2],k=this.vbf[d+3],d=a+k*Math.cos(h),h=c+k*Math.sin(h);if(g.onLineSegment)g.onLineSegment(a,c,d,h,f)};a.VertexBufferReader.prototype.decodeCircularArcAt=function(a,c,f,g){var d=this.stride*a;a=this.vbf[d];c=this.vbf[d+1];var h=this.vbf[d+2],k=this.vbf[d+3],d=this.vbf[d+5];if(g.onCircularArc)g.onCircularArc(a,c,h,k,d,f)};a.VertexBufferReader.prototype.decodeEllipticalArcAt=
function(a,c,f,g){var d=this.stride*a;a=this.vbf[d];c=this.vbf[d+1];var h=this.vbf[d+2],k=this.vbf[d+3],m=this.vbf[d+5],n=this.vbf[d+9],d=this.vbf[d+10];if(g.onEllipticalArc)g.onEllipticalArc(a,c,h,k,m,n,d,f)};a.VertexBufferReader.prototype.enumGeomsForObject=function(a,c){for(var f=0;f<this.vcount;){var g=this.getVertexFlagAt(f),d=g&240,h=g&15,g=g>>16&255,k=this.getViewportIndexAt(f);if(this.getIdAt(f)===a)switch(d){case 16:this.decodeLineAt(f,g,k,c);break;case 32:this.decodeCircularArcAt(f,g,k,
c);break;case 48:this.decodeEllipticalArcAt(f,g,k,c)}f+=h&&d?4:1}}})();var OUTSIDE=0,INTERSECTS=1,CONTAINS=2;function FrustumIntersector(){this.frustum=new THREE.Frustum;this.viewProj=new THREE.Matrix4;this.viewDir=[0,0,1];this.ar=1;this.viewport=new THREE.Vector3(1,1,1);this.areaConv=1;this.areaCullThreshold=0}
FrustumIntersector.prototype.reset=function(a){this.viewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);this.frustum.setFromMatrix(this.viewProj);var b=a.matrixWorldInverse.elements;this.ar=a.aspect;this.viewDir[0]=-b[2];this.viewDir[1]=-b[6];this.viewDir[2]=-b[10];this.areaConv=a.right*a.top};
FrustumIntersector.prototype.projectedArea=function(){var a,b;return function(c){a||(a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],b=new THREE.Box2);var f=this.viewProj;a[0].set(c.min.x,c.min.y,c.min.z);a[1].set(c.min.x,c.min.y,c.max.z);a[2].set(c.min.x,c.max.y,c.min.z);a[3].set(c.min.x,c.max.y,c.max.z);a[4].set(c.max.x,c.min.y,c.min.z);a[5].set(c.max.x,c.min.y,c.max.z);a[6].set(c.max.x,c.max.y,c.min.z);
a[7].set(c.max.x,c.max.y,c.max.z);for(c=0;8>c;c++){var g=a[c],d=g.x,h=g.y,k=g.z,m=f.elements,n=m[3]*d+m[7]*h+m[11]*k+m[15];0>n&&(n=-n);n=1/n;g.x=(m[0]*d+m[4]*h+m[8]*k+m[12])*n;g.y=(m[1]*d+m[5]*h+m[9]*k+m[13])*n}b.makeEmpty();b.setFromPoints(a);-1>b.min.x&&(b.min.x=-1);1<b.min.x&&(b.min.x=1);-1>b.min.y&&(b.min.y=-1);1<b.min.y&&(b.min.y=1);1<b.max.x&&(b.max.x=1);-1>b.max.x&&(b.max.x=-1);1<b.max.y&&(b.max.y=1);-1>b.max.y&&(b.max.y=-1);return(b.max.x-b.min.x)*(b.max.y-b.min.y)}}();
FrustumIntersector.prototype.estimateDepth=function(a){var b=this.viewProj.elements,c=a.min.x,f=a.min.y,g=a.min.z,d=1/(b[3]*c+b[7]*f+b[11]*g+b[15]),h=(b[2]*c+b[6]*f+b[10]*g+b[14])*d,c=a.max.x,f=a.max.y,g=a.max.z,d=1/(b[3]*c+b[7]*f+b[11]*g+b[15]);return Math.min(h,(b[2]*c+b[6]*f+b[10]*g+b[14])*d)};
FrustumIntersector.prototype.intersectsBox=function(){var a,b;return function(c){a||(a=new THREE.Vector3,b=new THREE.Vector3);for(var f=this.frustum.planes,g=0,d=0;6>d;d++){var h=f[d];a.x=0<h.normal.x?c.min.x:c.max.x;b.x=0<h.normal.x?c.max.x:c.min.x;a.y=0<h.normal.y?c.min.y:c.max.y;b.y=0<h.normal.y?c.max.y:c.min.y;a.z=0<h.normal.z?c.min.z:c.max.z;b.z=0<h.normal.z?c.max.z:c.min.z;var k=h.distanceToPoint(a),h=h.distanceToPoint(b);if(0>k&&0>h)return OUTSIDE;0<k&&0<h&&g++}return 6==g?CONTAINS:INTERSECTS}}();
var VBIntersector=function(){function a(){f||(f=new THREE.Matrix4,g=new THREE.Ray,d=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3)}function b(b,c,q){a();var l=b.geometry,p=b.material,r=p?p.side:THREE.FrontSide,A=l.attributes;f.getInverse(b.matrixWorld);g.copy(c.ray).applyMatrix4(f);var C,H,z,t=c.precision;if(void 0!==A.index){var p=A.index.array||l.ib,A=l.vb?l.vb:A.position.array,w=l.vb?l.vbstride:3,E=l.offsets;E&&0!==E.length||(E=[{start:0,count:p.length,index:0}]);for(var B=0,D=E.length;B<
D;++B){C=E[B].start;for(var J=E[B].index,l=C,F=C+E[B].count;l<F;l+=3){C=J+p[l];H=J+p[l+1];z=J+p[l+2];d.fromArray(A,C*w);h.fromArray(A,H*w);k.fromArray(A,z*w);var G;G=r===THREE.BackSide?g.intersectTriangle(k,h,d,!0):g.intersectTriangle(d,h,k,r!==THREE.DoubleSide);if(null!==G){G.applyMatrix4(b.matrixWorld);var M=c.ray.origin.distanceTo(G);M<t||M<c.near||M>c.far||q.push({distance:M,point:G,face:new THREE.Face3(C,H,z,THREE.Triangle.normal(d,h,k)),faceIndex:null,fragId:b.fragId})}}}}else for(A=l.vb?l.vb:
A.position.array,w=l.vb?l.vbstride:3,l=0,F=A.length;l<F;l+=3)C=l,H=l+1,z=l+2,d.fromArray(A,C*w),h.fromArray(A,H*w),k.fromArray(A,z*w),G=p.side===THREE.BackSide?g.intersectTriangle(k,h,d,!0):g.intersectTriangle(d,h,k,p.side!==THREE.DoubleSide),null!==G&&(G.applyMatrix4(b.matrixWorld),M=c.ray.origin.distanceTo(G),M<t||M<c.near||M>c.far||q.push({distance:M,point:G,face:new THREE.Face3(C,H,z,THREE.Triangle.normal(d,h,k)),faceIndex:null,fragId:b.fragId}))}function c(b,c,d){a();var h=c.linePrecision,h=
h*h,k=b.geometry;f.getInverse(b.matrixWorld);g.copy(c.ray).applyMatrix4(f);var r=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,H=new THREE.Vector3,z=b.mode===THREE.LineStrip?1:2;if(k instanceof THREE.BufferGeometry){var t=k.attributes;if(void 0!==t.index){var w=k.ib?k.ib:t.index.array,t=k.vb?k.vb:t.position.array,E=k.vb?k.vbstride:3;(k=k.offsets)&&0!==k.length||(k=[{start:0,count:w.length,index:0}]);for(var B=0;B<k.length;B++)for(var D=k[B].start,J=k[B].count,F=k[B].index,G=D;G<D+J-1;G+=
z){var M=F+w[G+1];r.fromArray(t,(F+w[G])*E);A.fromArray(t,M*E);M=g.distanceSqToSegment(r,A,H,C);M>h||(M=g.origin.distanceTo(H),M<c.near||M>c.far||d.push({distance:M,point:C.clone().applyMatrix4(b.matrixWorld),face:null,faceIndex:null,fragId:b.fragId}))}}else for(t=k.vb?k.vb:t.position.array,E=k.vb?k.vbstride:3,G=0;G<t.length/E-1;G+=z)r.fromArray(t,E*G),A.fromArray(t,E*G+E),M=g.distanceSqToSegment(r,A,H,C),M>h||(M=g.origin.distanceTo(H),M<c.near||M>c.far||d.push({distance:M,point:C.clone().applyMatrix4(b.matrixWorld),
face:null,faceIndex:null,fragId:b.fragId}))}}var f,g,d,h,k;return{meshRayCast:b,lineRayCast:c,rayCast:function(a,d,f){a.isLine?c(a,d,f):b(a,d,f)}}}();
function GeometryList(a){this.geoms=[];this.instancePolyCount=this.geomPolyCount=this.gpuNumMeshes=this.gpuMeshMemory=this.geomMemory=this.numGeomsInMemory=0;this.is2d=a.is2d();this.svf=a.getData();a=this.svf.geomMetadata?this.svf.geomMetadata.primCounts.length:0;this.geomBoxes=new Float32Array(6*Math.max(1,a));this.svf.packFileTotalSize&&this.svf.packFileTotalSize-6*this.svf.primitiveCount<=Autodesk.Viewing.Private.GPU_MEMORY_LIMIT&&a<Autodesk.Viewing.Private.GPU_OBJECT_LIMIT&&(this.svf.disableStreaming=
!0)}GeometryList.prototype.getGeometry=function(a){return this.geoms[a]};
GeometryList.prototype.addGeometry=function(a,b,c){var f=Autodesk.Viewing.Private.GPU_MEMORY_LIMIT,g=2*f,d=Autodesk.Viewing.Private.GPU_OBJECT_LIMIT;this.isf2d&&(g*=2);this.disableStreaming||this.gpuMeshMemory<f&&this.geoms.length<d?(a.streamingDraw=!1,a.streamingIndex=!1):this.gpuMeshMemory>=g?(a.streamingDraw=!0,a.streamingIndex=!0):1E5>(this.is2d?100001:a.byteSize*(b||1))&&(a.streamingDraw=!0,a.streamingIndex=!0);a.streamingDraw||(this.gpuMeshMemory+=a.byteSize,this.gpuNumMeshes+=1);this.numGeomsInMemory++;
!c||0>c?(c=this.geoms.length,this.geoms.push(a),this.geomBoxes.length/6<this.geoms.length&&(f=new Float32Array(3*this.geoms.length/2*6),f.set(this.geomBoxes),this.geomBoxes=f),f=a.boundingBox,this.geomBoxes[6*c]=f.min.x,this.geomBoxes[6*c+1]=f.min.y,this.geomBoxes[6*c+2]=f.min.z,this.geomBoxes[6*c+3]=f.max.x,this.geomBoxes[6*c+4]=f.max.y,this.geomBoxes[6*c+5]=f.max.z,Autodesk.Viewing.Private.memoryOptimizedLoading&&!this.is2d&&(a.boundingBox=null,a.boundingSphere=null),this.geomMemory+=a.byteSize,
f=(a.attributes.index.array||a.ib).length/3,this.svf.geomPolyCount=this.geomPolyCount+=f,this.instancePolyCount+=f*(b||1)):this.geoms[c]=a;a.svfid=c;return a.svfid};GeometryList.prototype.removeGeometry=function(a){var b=this.getGeometry(a);if(!b)return 0;b=b.byteSize;this.geoms[a]=null;this.numGeomsInMemory--;return b};
GeometryList.prototype.getModelBox=function(a,b){if(this.geoms[a]){var c=6*a,f=this.geomBoxes;b.min.x=f[c];b.min.y=f[c+1];b.min.z=f[c+2];b.max.x=f[c+3];b.max.y=f[c+4];b.max.z=f[c+5]}else b.makeEmpty()};GeometryList.prototype.dispose=function(a){for(var b=0,c=this.geoms.length;b<c;b++)this.geoms[b]&&a.deallocateGeometry(this.geoms[b])};
GeometryList.prototype.printStats=function(){stderr("Total geometry size: "+this.geomMemory/1048576+" MB");stderr("Number of meshes: "+this.geoms.length);stderr("Num Meshes on GPU: "+this.gpuNumMeshes);stderr("Net GPU geom memory used: "+this.gpuMeshMemory)};var NODE_TYPE_ASSEMBLY=0,NODE_TYPE_INSERT=1,NODE_TYPE_LAYER=2,NODE_TYPE_COLLECTION=3,NODE_TYPE_COMPOSITE=4,NODE_TYPE_MODEL=5,NODE_TYPE_GEOMETRY=6,NODE_TYPE_BITS=7,NODE_FLAG_OFF=1073741824,NODE_FLAG_HIDE=2147483648;
function InstanceTree(a,b,c,f){this.root=a;this.rootId=a.dbId;this.maxDepth=f;this.boxes=b;this.objectCount=c;this.nodeflags=new Int32Array(c);this.numOff=this.numHidden=0;this.createDbIdToNodeMapping()}InstanceTree.prototype.createDbIdToNodeMapping=function(){if(this.root){var a=this.dbIdToNode=Array(this.objectCount),b=this.nodeflags;(function f(g){a[g.dbId]=g;var d=g.children,h=g.flags;void 0!==h?b[g.dbId]=h:g.flags=b[g.dbId]=d?NODE_TYPE_ASSEMBLY:NODE_TYPE_GEOMETRY;if(d)for(g=0;g<d.length;g++)f(d[g])})(this.root)}};
InstanceTree.prototype.setFlagNode=function(a,b,c){var f=this.nodeflags[a];if(!!(f&b)==c)return!1;this.nodeflags[a]=c?f|b:f&~b;return!0};InstanceTree.prototype.setFlagGlobal=function(a,b){var c=this.nodeflags,f=0,g=c.length;if(b)for(;f<g;f++)c[f]|=a;else for(var d=~a;f<g;f++)c[f]&=d};InstanceTree.prototype.setNodeOff=function(a,b){var c=this.setFlagNode(a,NODE_FLAG_OFF,b);c&&(b?this.numOff++:this.numOff--);return c};InstanceTree.prototype.isNodeOff=function(a){return!!(this.nodeflags[a]&NODE_FLAG_OFF)};
InstanceTree.prototype.setNodeHidden=function(a,b){var c=this.setFlagNode(a,NODE_FLAG_HIDE,b);c&&(b?this.numHidden++:this.numHidden--);return c};InstanceTree.prototype.isNodeHidden=function(a){return!!(this.nodeflags[a]&NODE_FLAG_HIDE)};InstanceTree.prototype.getNodeType=function(a){return this.nodeflags[a]&NODE_TYPE_BITS};InstanceTree.prototype.getNodeParentId=function(a){return this.dbIdToNode[a].parent};InstanceTree.prototype.getRootId=function(){return this.rootId};
InstanceTree.prototype.getNodeName=function(a){return this.dbIdToNode[a].name};InstanceTree.prototype.getChildCount=function(a){return(a=this.dbIdToNode[a])&&a.children?a.children.length:0};InstanceTree.prototype.enumNodeFragments=function(a,b,c){function f(a){var h=g.dbIdToNode[a];if(void 0!==h){h=h.fragIds;if(void 0!==h){Array.isArray(h)||b(h);for(var k=0;k<h.length;++k)b(h[k])}c&&g.enumNodeChildren(a,function(a){f(a)})}}var g=this;f("number"==typeof a?a:a.dbId)};
InstanceTree.prototype.enumNodeChildren=function(a,b,c){function f(a){a=g.dbIdToNode[a];if(void 0!==a&&a.children)for(var h=0;h<a.children.length;h++){var k=a.children[h].dbId;b(k);c&&f(k)}}a="number"==typeof a?a:a.dbId;var g=this;c&&b(a);f(a)};var MESH_VISIBLE=1,MESH_HIGHLIGHTED=2,MESH_HIDE=4,MESH_ISLINE=8,MESH_MOVED=16,MESH_TRAVERSED=32,MESH_RENDERFLAG=128;
function FragmentList(a,b){this.fragments=a.getData().fragments;this.svf=a.getData();this.svfLoader=a.myLoader;var c=this.fragments.length;this.geoms=b;(this.isFixedSize=0<this.fragments.length)?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!Autodesk.Viewing.Private.memoryOptimizedLoading):(this.transforms=this.boxes=null,this.useThreeMesh=!0);0>=c&&(c=1);this.vizmeshes=Array(c);this.vizflags=new Uint8Array(c);this.geomids=new Int32Array(c);this.materialids=
new Int32Array(c);this.materialmap={};this.reachLimit=!1;this.traversedGeom=[];this.culledGeom=[];this.geomidsmap={};this.animxforms=null;for(var f=0;f<c;f++)this.vizflags[f]=1,this.geomids[f]=-1;this.allVisible=!0;this.allVisibleDirty=!1;this.nextAvailableFragID=c}FragmentList.prototype.getNextAvailableFragmentId=function(){return this.nextAvailableFragID++};FragmentList.prototype.getSvfMaterialId=function(a){return(a=this.getMaterial(a))?a.svfMatId:void 0};
FragmentList.prototype.requireGeometry=function(a){var b=null,c=this.geomids[a];0<=c&&(b=this.geoms.getGeometry(c));null!=b||this.reachLimit||this.svfLoader.loadGeometryPackOnDemand(this.fragments.packIds[a]);return b};
FragmentList.prototype.setMesh=function(a,b,c){var f=this.vizmeshes[a];f&&f.parent&&f.parent.remove(f);if(this.vizflags.length<=a){this.isFixedSize&&(console.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);f=Math.ceil(1.5*this.vizflags.length);this.useThreeMesh&&f<this.vizmeshes.length&&(f=this.vizmeshes.length);var g=new Uint8Array(f);g.set(this.vizflags);this.vizflags=g;this.transforms&&(g=new Float32Array(12*
f),g.set(this.transforms),this.transforms=g);this.boxes&&(g=new Float32Array(6*f),g.set(this.boxes),this.boxes=g);this.geomids&&(g=new Int32Array(f),g.set(this.geomids),this.geomids=g);this.materialids&&(f=new Int32Array(f),f.set(this.materialids),this.materialids=f)}this.useThreeMesh?(this.vizmeshes[a]=b,b.fragId=a,b.dbId=this.fragments.fragId2dbId[a]|0):(this.geomids[a]=b.geometry.svfid,this.materialids[a]=b.material.id,this.materialmap[b.material.id]||(this.materialmap[b.material.id]=b.material));
this.vizflags[a]=1|(b.isLine?MESH_ISLINE:0);c&&(f=b.matrixWorld,c=new THREE.Box3,c.copy(b.geometry.boundingBox),c.applyMatrix4(f),b=12*a,f=f.elements,g=this.transforms,g[b]=f[0],g[b+1]=f[1],g[b+2]=f[2],g[b+3]=f[4],g[b+4]=f[5],g[b+5]=f[6],g[b+6]=f[8],g[b+7]=f[9],g[b+8]=f[10],g[b+9]=f[12],g[b+10]=f[13],g[b+11]=f[14],a*=6,b=this.boxes,b[a]=c.min.x,b[a+1]=c.min.y,b[a+2]=c.min.z,b[a+3]=c.max.x,b[a+4]=c.max.y,b[a+5]=c.max.z)};FragmentList.prototype.isFlagSet=function(a,b){return!!(this.vizflags[a]&b)};
FragmentList.prototype.setFlagFragment=function(a,b,c){var f=this.vizflags[a];if(!!(f&b)==c)return!1;this.vizflags[a]=c?f|b:f&~b;return!0};FragmentList.prototype.setFlagGlobal=function(a,b){var c=this.vizflags,f=0,g=c.length;if(b)for(;f<g;f++)c[f]|=a;else for(var d=~a;f<g;f++)c[f]&=d};FragmentList.prototype.hideLines=function(a){var b=MESH_HIDE,c=this.vizflags,f=0,g=c.length;if(a)for(;f<g;f++)c[f]&MESH_ISLINE&&(c[f]|=b);else for(a=~b;f<g;f++)c[f]&MESH_ISLINE&&(c[f]&=a);this.allVisibleDirty=!0};
FragmentList.prototype.isFragVisible=function(a){return 1==(this.vizflags[a]&3)};FragmentList.prototype.isFragOff=function(a){return!!(this.vizflags[a]&MESH_HIDE)};FragmentList.prototype.isLine=function(a){return!!(this.vizflags[a]&MESH_ISLINE)};FragmentList.prototype.areAllVisible=function(){if(this.allVisibleDirty){for(var a=this.vizflags,b=!0,c=0,f=a.length;c<f;c++)if(0===(a[c]&1)){b=!1;break}this.allVisible=b;this.allVisibleDirty=!1}return this.allVisible};
FragmentList.prototype.getVizmesh=function(){var a;return function(b){if(this.useThreeMesh)return this.vizmeshes[b];a||(a=new THREE.Mesh(void 0,void 0,!0),a.isTemp=!0,a.dbId=0,a.fragId=-1);a.geometry=this.getGeometry(b);a.material=this.getMaterial(b);a.dbId=this.getDbIds(b);a.fragId=b;a.visible=!0;a.isLine=this.isLine(b);this.getWorldMatrix(b,a.matrixWorld);return a}}();FragmentList.prototype.getMaterialId=function(a){return this.useThreeMesh?this.vizmeshes[a].material.id:this.materialids[a]};
FragmentList.prototype.getMaterial=function(a){return this.useThreeMesh?this.vizmeshes[a].material:this.materialmap[this.materialids[a]]};FragmentList.prototype.getGeometry=function(a){return this.geoms.getGeometry(this.geomids[a])};FragmentList.prototype.setMaterial=function(a,b){this.useThreeMesh?this.vizmeshes[a].material=b:(this.materialids[a]=b.id,this.materialmap[b.id]=b)};FragmentList.prototype.getCount=function(){return this.vizflags.length};FragmentList.prototype.getDbIds=function(a){return this.fragments.fragId2dbId[a]};
FragmentList.prototype.dispose=function(a){var b={type:"dispose"};if(this.useThreeMesh){a={type:"removed"};for(var c=0;c<this.vizmeshes.length;c++){var f=this.vizmeshes[c];f&&(f.dispatchEvent(a),f.geometry.dispatchEvent(b))}}else this.geoms.dispose(a)};FragmentList.prototype.setVisibility=function(a,b){this.setFlagFragment(a,MESH_VISIBLE,b);this.allVisibleDirty=!0};FragmentList.prototype.setFragOff=function(a,b){this.setFlagFragment(a,MESH_HIDE,b);this.allVisibleDirty=!0};
FragmentList.prototype.setAllVisibility=function(a){this.setFlagGlobal(MESH_VISIBLE,a);this.allVisible=a;this.allVisibleDirty=!1};
FragmentList.prototype.updateAnimTransform=function(a,b,c,f){var g=this.animxforms;if(!g)for(var d=this.getCount(),g=this.animxforms=new Float32Array(10*d),h=0;h<d;h++){var k=10*h;g[k]=1;g[k+1]=1;g[k+2]=1;g[k+3]=0;g[k+4]=0;g[k+5]=0;g[k+6]=1;g[k+7]=0;g[k+8]=0;g[k+9]=0}k=10*a;d=!1;b&&(g[k]=b.x,g[k+1]=b.y,g[k+2]=b.z,d=!0);c&&(g[k+3]=c.x,g[k+4]=c.y,g[k+5]=c.z,g[k+6]=c.w,d=!0);f&&(g[k+7]=f.x,g[k+8]=f.y,g[k+9]=f.z,d=!0);this.setFlagFragment(a,MESH_MOVED,d);d||(g[k]=1,g[k+1]=1,g[k+2]=1,g[k+3]=0,g[k+4]=0,
g[k+5]=0,g[k+6]=1,g[k+7]=0,g[k+8]=0,g[k+9]=0)};FragmentList.prototype.getAnimTransform=function(a,b,c,f){if(!this.animxforms||!this.isFlagSet(a,MESH_MOVED))return!1;a*=10;var g=this.animxforms;b&&(b.x=g[a],b.y=g[a+1],b.z=g[a+2]);c&&(c.x=g[a+3],c.y=g[a+4],c.z=g[a+5],c.w=g[a+6]);f&&(f.x=g[a+7],f.y=g[a+8],f.z=g[a+9]);return!0};
FragmentList.prototype.getOriginalWorldMatrix=function(a,b){var c=12*a,f=b.elements,g=this.transforms;g?(f[0]=g[c],f[1]=g[c+1],f[2]=g[c+2],f[3]=0,f[4]=g[c+3],f[5]=g[c+4],f[6]=g[c+5],f[7]=0,f[8]=g[c+6],f[9]=g[c+7],f[10]=g[c+8],f[11]=0,f[12]=g[c+9],f[13]=g[c+10],f[14]=g[c+11],f[15]=1):b.identity()};
FragmentList.prototype.getWorldMatrix=function(){var a,b,c,f;return function(g,d){a||(a=new THREE.Matrix4,b=new THREE.Vector3,c=new THREE.Quaternion,f=new THREE.Vector3);this.getOriginalWorldMatrix(g,d);this.isFlagSet(g,MESH_MOVED)&&(this.getAnimTransform(g,f,c,b),a.compose(b,c,f),d.multiplyMatrices(a,d))}}();
FragmentList.prototype.getWorldBounds=function(){var a;return function(b,c){a||(a=new THREE.Matrix4);if(this.boxes&&!this.isFlagSet(b,MESH_MOVED)){var f=this.boxes,g=6*b;c.min.x=f[g];c.min.y=f[g+1];c.min.z=f[g+2];c.max.x=f[g+3];c.max.y=f[g+4];c.max.z=f[g+5]}else this.getWorldMatrix(b,a),this.useThreeMesh?(f=this.getVizmesh(b))&&f.geometry&&c.copy(f.geometry.boundingBox):this.geoms.getModelBox(this.geomids[b],c),c.empty()||c.applyMatrix4(a)}}();
function FragmentPointer(a,b){this.frags=a;this.fragId=b;this.position=this.quaternion=this.scale=null}FragmentPointer.prototype.getWorldMatrix=function(a){return this.frags.getWorldMatrix(this.fragId,a)};FragmentPointer.prototype.getWorldBounds=function(a){return this.frags.getWorldBounds(this.fragId,a)};
FragmentPointer.prototype.getAnimTransform=function(){this.scale||(this.scale=new THREE.Vector3(1,1,1),this.quaternion=new THREE.Quaternion(0,0,0,1),this.position=new THREE.Vector3(0,0,0));return this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)};
FragmentPointer.prototype.updateAnimTransform=function(){this.scale||(this.scale=new THREE.Vector3(1,1,1),this.quaternion=new THREE.Quaternion(0,0,0,1),this.position=new THREE.Vector3(0,0,0));return this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)};FragmentPointer.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)};FragmentPointer.prototype.setMaterial=function(a){return this.frags.setMaterial(this.fragId,a)};
function RenderBatch(a,b,c,f){this.frags=a;this.indices=b;this.start=c;this.count=f;this.lastItem=c;this.overrideMaterial=null;this.sortDone=!1;this.avgFrameTime=void 0;this.numAdded=0;this.boundingBox=new THREE.Box3;this.boundingBoxHidden=new THREE.Box3;this.sortDone=this.sortObjects=!1;this.indicesView=this.depths=null;this.frustumCulled=!0;this.forceVisible=!1;this.renderImmediate=!a.useThreeMesh;this.tmpBox=new THREE.Box3}
RenderBatch.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices};RenderBatch.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var a=this.frags,b=this.getIndices();b||stderr("Only indexed RenderSubsets can be sorted.");var c=b.subarray(this.start,this.start+this.count);Array.prototype.sort.call(c,function(c,g){var d=a.getMaterialId(b[c]),h=a.getMaterialId(b[g]);return void 0===d?h?1:0:void 0===h?-1:d-h});this.numAdded=0;this.sortDone=!0}};
RenderBatch.prototype.sortByDepth=function(){function a(a,b){c.getGeometry(a)?(c.getWorldBounds(a,d),h[b]=g.estimateDepth(d)):h[b]=-Infinity}function b(a,b){return h[b]-h[a]}var c,f,g,d,h;return function(k){c=this.frags;f=this.getIndices();g=k;d=this.tmpBox;f||stderr("Only indexed RenderSubsets can be sorted.");if(!this.indicesView||this.indicesView.length<this.count)this.indicesView=f.subarray(this.start,this.start+this.count);if(!this.depths||this.depths.length<this.count)this.depths=new Float32Array(this.count);
h=this.depths;this.forEachNoMesh(a);Array.prototype.sort.call(this.indicesView,b)}}();RenderBatch.prototype.onFragmentAdded=function(){return function(a){this.frags.getWorldBounds(a,this.tmpBox);this.boundingBox.union(this.tmpBox);this.numAdded++;this.sortDone=!1;this.lastItem<=a&&(this.lastItem=a+1)}}();
RenderBatch.prototype.forEach=function(a,b,c){for(var f=this.getIndices(),g=this.frags,d=g.svfLoader.pageOutGeometryEnabled,h=this.start,k=this.lastItem;h<k;h++){var m=f?f[h]:h;if(d){if(g.isFlagSet(m,MESH_TRAVERSED)&&b==MESH_RENDERFLAG)continue;var n=g.getVizmesh(m);if(!c&&b&&g.isFlagSet(m,b))if(n.geometry){if(b==MESH_RENDERFLAG&&g.setFlagFragment(m,MESH_TRAVERSED,!0),m>Autodesk.Viewing.Private.FRAGS_PERSISTENT_COUNT){var q=g.geomids[m],l=!0,p=g.geomidsmap[q];null!=p&&(p.t++,l=p.n==p.t);l&&g.traversedGeom.push(q)}}else n.geometry=
g.requireGeometry(m)}else n=g.getVizmesh(m);!(c||n&&n.geometry)||b&&!g.isFlagSet(m,b)||a(n,m)}};RenderBatch.prototype.forEachNoMesh=function(a,b,c){for(var f=this.getIndices(),g=this.frags,d=this.start,h=this.lastItem;d<h;d++){var k=f?f[d]:d,m;if(g.useThreeMesh){var n=g.getVizmesh(k);n&&(m=n.geometry)}else m=g.getGeometry(k);!c&&!m||b&&!g.isFlagSet(k,b)||a(k,d-this.start)}};
RenderBatch.prototype.raycast=function(){return function(a,b){if(!1!==a.ray.isIntersectionBox(this.boundingBox)){var c=this,f=this.tmpBox;this.forEach(function(g,d){c.frags.getWorldBounds(d,f);a.ray.isIntersectionBox(f)&&VBIntersector.rayCast(g,a,b)},MESH_VISIBLE)}}}();
RenderBatch.prototype.calculateBounds=function(){function a(a){g.getWorldBounds(a,d);b[a]&1?c.union(d):f.union(d)}var b,c,f,g,d;return function(){this.boundingBox.makeEmpty();this.boundingBoxHidden.makeEmpty();b=this.frags.vizflags;c=this.boundingBox;f=this.boundingBoxHidden;g=this.frags;d=this.tmpBox;this.forEachNoMesh(a)}}();
RenderBatch.prototype.applyVisibility=function(){function a(a,q){if(!a&&b.useThreeMesh||!Autodesk.Viewing.Private.onDemandLoading&&!a.geometry)d&&d(q);else{var l=!1;b.getWorldBounds(q,m);if(h&&!f.intersectsBox(m))l=!0;else{var p=f.projectedArea(m),p=p*f.areaConv;p<f.areaCullThreshold&&(l=!0)}if(l)a?a.visible=!1:stderr("Unexpected null mesh"),c[q]&=~MESH_RENDERFLAG,b.svfLoader.pageOutGeometryEnabled&&q>Autodesk.Viewing.Private.FRAGS_PERSISTENT_COUNT&&(l=b.geomids[q],b.geoms.getGeometry(l)&&(b.geomidsmap[l]||
b.culledGeom.push(l)));else{p=c[q]&127;switch(g){case RENDER_HIDDEN:l=!(p&MESH_VISIBLE);break;case RENDER_HIGHLIGHTED:l=p&MESH_HIGHLIGHTED;break;default:l=1==(p&(MESH_VISIBLE|MESH_HIGHLIGHTED|MESH_HIDE))}a&&(a.visible=!!l);c[q]=p|(l?MESH_RENDERFLAG:0);k=k&&!l}}}var b,c,f,g,d,h,k,m;return function(n,q,l){k=!0;f=q;g=n;d=l;n=f.intersectsBox(g===RENDER_HIDDEN?this.boundingBoxHidden:this.boundingBox);if(n===OUTSIDE)return k;c=this.frags.vizflags;b=this.frags;h=n!==CONTAINS;m=this.tmpBox;this.forEach(a,
null,d);return k}}();var MAX_FRAGS_PER_GROUP=333;
function RenderQueue(a){function b(a){S.length<NUM_WORKER_THREADS&&(a=t.fragments.packIds[a],-1==S.indexOf(a)&&S.push(a))}function c(a){for(var b=M[a],c=L;c>I&&M[G[c-1]]>b;)G[c]=G[c-1],c--;G[c]=a;L++}function f(a){var b=D.getLeftChild(a);-1!==b&&(f(b),f(b+1));H.makeEmpty();-1!==b&&(D.getBoxThree(b,N),H.union(N),D.getBoxThree(b+1,N),H.union(N));D.getPrimCount(a)&&(H.union(F[a].boundingBox),H.union(F[a].boundingBoxHidden));D.setBoxThree(a,H)}var g=a.is2d(),d=Autodesk.Viewing.Private.PAGEOUT_NONE,h=
0,k=!1,m=!1,n=0,q=0,l=null,p=!0,r=0,A=new THREE.Box3,C=new THREE.Box3;this.visibleBoundsDirty=!1;for(var H=new THREE.Box3,z=new GeometryList(a),t=new FragmentList(a,z),w=a.getData().fragments,E=[new Int32Array(w.length)],B=0;B<w.length;B++)E[0][B]=B;var D=null,J=null,F=null,G=null,M=null,I,L,K=!1,O=!1,R=new FrustumIntersector,X=new THREE.Raycaster,W=RENDER_NORMAL,aa=!1,fa=0,U=performance,B=MAX_FRAGS_PER_GROUP;a.is2d()&&(B/=6);if(isIOSDevice()||isAndroidDevice())B/=3;for(var B=B|0,P=0<B?B:MAX_FRAGS_PER_GROUP,
w=0|(w.length+P-1)/P,Z=Array(w),B=0;B<w;B++)Z[B]=new RenderBatch(t,E,B*P,P);if(a=a.getBoundingBox())A.copy(a),C.copy(a);this.getSvfMaterialId=function(a){return t.getSvfMaterialId(a)};var S=[];this.checkCull=function(){var a=new THREE.Box3;return function(b,c,d){t.getWorldBounds(b,a);return c&&!R.intersectsBox(a)||d&&(b=R.projectedArea(a),b*=R.areaConv,b<R.areaCullThreshold)?!0:!1}}();this.pageOutStatus=function(){return d};this.needsRender=function(){return k};this.resetNeedsRender=function(){k=
!1};this.addMeshInstance=function(a,b,c){void 0===a&&(a=t.getNextAvailableFragmentId());t.setMesh(a,b,c);E[0].length<=a&&(c=2*E[0].length,c<=a&&(c=a+1),c=new Int32Array(c),c.set(E[0]),E[0]=c,this.visibleBoundsDirty=!0);E[0][a]=a;c=0|a/P;if(Z){var d=Z[c];d||(Z[c]=d=new RenderBatch(t,E,c*P,P))}t.getWorldBounds(a,H);A.union(H);C.union(H);b.frustumCulled=!1;if(d)d.onFragmentAdded(a);return a};this.renderSome=function(a,c){var f=U.now(),k,q=0===n;p&&q&&!aa&&(l=null,aa=!0);for(var z;z=K?this.nextBatchBVH():
this.nextBatch();){g||(z.sortObjects&&!t.useThreeMesh?z.sortByDepth(R):z.sortDone||z.sortByMaterial());z.applyVisibility(W,R,t.fragments.packIds?b:null)||a(z);n++;k=U.now();var w=k-f,f=k;z.avgFrameTime=void 0===z.avgFrameTime?w:.8*z.avgFrameTime+.2*w;c-=z.avgFrameTime;k=!1;p&&q&&null!==l?z==l&&(k=!0):0>=c&&(k=!0);if(k)break}(f=t.svfLoader.pageOutGeometryEnabled)&&!q&&(d==avp.PAGEOUT_FAIL?t.traversedGeom.length>.5*Autodesk.Viewing.Private.GEOMS_PAGEOUT_COUNT&&(d=this.pageOutIfNeeded()):d=this.pageOutIfNeeded());
z||(m=!0,f&&(d=this.pageOutIfNeeded(),d==Autodesk.Viewing.Private.PAGEOUT_FAIL&&0==h&&this.pageOutIfNeeded(!0)));p&&q&&null==l&&(l=z);z&&q||(l=null,aa=!1);return c};this.enforceBvh=!1;this.fragmentsAdded=function(){return t.vizflags.length>t.fragments.length};this.reset=function(a,b,c){q=0;fa++;m=!1;W=b;K=!1;n=0;this.resetNeedsRender();h=0;if(c){S=[];d=Autodesk.Viewing.Private.PAGEOUT_NONE;t.traversedGeom=[];t.culledGeom=[];b=t.vizflags.length;for(c=0;c<b;++c)t.setFlagFragment(c,MESH_TRAVERSED,!1);
for(var f in t.geomidsmap)t.geomidsmap.hasOwnProperty(f)&&(t.geomidsmap[f].t=0)}R.reset(a);!this.fragmentsAdded()&&G&&(this.enforceBvh||!Z?K=!0:(f=C.size().length(),b=C.center(),a.position.distanceTo(b)<.5*f&&(K=!0)));!0===K&&(L=I=0,G[L++]=0,O=!1,n=0)};this.nextBatch=function(){return q==Z.length?null:Z[q++]};this.nextBatchBVH=function(){O||I!==L||(G[L++]=1,O=!0);for(;I!==L;){var a=G[--L];D.getBoxThree(a,H);if(R.intersectsBox(H)!==OUTSIDE){var b=D.getLeftChild(a);if(-1!==b){var d=D.getFlags(a),f=
0>R.viewDir[d&3]?1:0,g=d>>2&1,h=d>>3&1,k=d=0;O?(f^1^h&&(g=1-g),G[L++]=b+g,G[L++]=b+(1-g)):(f=b+g,b=b+1-g,D.getBoxThree(f,H),M[f]=d=R.projectedArea(H),D.getBoxThree(b,H),M[b]=k=R.projectedArea(H),0<d&&c(f),0<k&&c(b))}if(0!==D.getPrimCount(a))return F[a]}O||I!==L||(G[L++]=1,O=!0)}return null};this.isDone=function(){return m};this.setHighlighted=function(a,b){var c=t.setFlagFragment(a,MESH_HIGHLIGHTED,b);c&&(b?r++:r--);return c};this.setVisibility=function(a,b){t.setVisibility(a,b);this.visibleBoundsDirty=
!0};this.setFragOff=function(a,b){t.setFragOff(a,b);this.visibleBoundsDirty=!0};this.setAllVisibility=function(a){t.setAllVisibility(a);this.visibleBoundsDirty=!0};this.hideLines=function(a){t.hideLines(a)};this.hasHighlighted=function(){return!!r};this.areAllVisible=function(){return t.areAllVisible()};var N=new THREE.Box3;this.getVisibleBounds=function(a){if(this.visibleBoundsDirty){A.makeEmpty();C.makeEmpty();if(!this.fragmentsAdded()&&D){for(var b=0;b<F.length;b++){var c=F[b];c&&(c.calculateBounds(),
A.union(c.boundingBox),C.union(c.boundingBox),C.union(c.boundingBoxHidden))}f(0);f(1);if(Z)for(b=0;b<Z.length;b++)Z[b].calculateBounds()}else if(Z)for(b=0;b<Z.length;b++)Z[b].calculateBounds(),A.union(Z[b].boundingBox),C.union(Z[b].boundingBox),C.union(Z[b].boundingBoxHidden);this.visibleBoundsDirty=!1}return a?C:A};this.rayIntersect=function(a,b,c,d){this.visibleBoundsDirty&&this.getVisibleBounds();X.set(a,b);a=[];if(d)for(b=0;b<d.length;b++){var f=t.getVizmesh(d[b]);VBIntersector.rayCast(f,X,a)}else if(K)for(b=
[1,0],d=new THREE.Vector3;b.length;){if(f=b.pop(),D.getBoxThree(f,H),null!==X.ray.intersectBox(H,d)){var g=D.getLeftChild(f);-1!==g&&(b.push(g),b.push(g+1));0!==D.getPrimCount(f)&&F[f].raycast(X,a)}}else for(b=0;b<Z.length;b++)Z[b].raycast(X,a);if(!a.length)return null;a.sort(function(a,b){return a.distance-b.distance});var f=d=null,h;for(b=0;b<a.length;b++)if(h=a[b].fragId,d=a[b].point,f=a[b].face,!z.is2d)if(t.isFragVisible(h)&&!t.isFragOff(h)){if(g=t.getMaterial(h),!c||!g.transparent){var k=!1;
if(g.cutplanes)for(var l=0;l<g.cutplanes.length;l++)k|=0>g.cutplanes[l].dot(new THREE.Vector4(d.x,d.y,d.z,1));if(k)f=d=null;else break}}else h=void 0;return void 0===h?null:[h,d,f]};this.getRenderProgress=function(){return K?n/F.length:q/Z.length};this.getFragmentList=function(){return t};this.getGeometryList=function(){return z};this.getSceneCount=function(){return K?F.length:Z.length};this.cleanup=function(a){t.dispose(a)};this.setBVH=function(a,b){J=b;F=Array(a.nodeCount);D=a;G=new Int32Array(a.nodeCount+
1);M=new Float32Array(a.nodeCount);for(var c=0;c<a.nodeCount;c++){var d=a.getPrimCount(c);d&&(F[c]=new RenderBatch(t,J,a.getPrimStart(c),d),F[c].lastItem=F[c].start+d,a.getFlags(c)&8&&(F[c].sortObjects=!0),a.getBoxThree(c,F[c].boundingBox))}p=!1;t.useThreeMesh||(Z=null)};this.getGeomScenes=function(){return Z||F};this.geomPacksMissingLastFrame=function(){return S};this.addGeomPackMissingLastFrame=function(a){-1==S.indexOf(a)&&S.push(a)};this.pageOutIfNeeded=function(a){var b=z.numGeomsInMemory;if(b>
Autodesk.Viewing.Private.GEOMS_COUNT_LIMIT){var c=0,d=0,b=0,f,g,l=Autodesk.Viewing.Private.GEOMS_PAGEOUT_COUNT;f=t.culledGeom.length;f=f>l?l:f;for(b=0;b<f;b++)g=t.culledGeom[b],g=z.removeGeometry(g),0<g&&(c+=g,d++);t.culledGeom.splice(0,f);l-=f;if(0<l){f=t.traversedGeom.length;for(b=f>l?f-l:0;b<f;++b)g=t.traversedGeom[b],g=z.removeGeometry(g),0<g&&(c+=g,d++);f=f>l?l:f;t.traversedGeom.splice(-f,f)}b=z.numGeomsInMemory;if(a&&b>Autodesk.Viewing.Private.GEOMS_COUNT_LIMIT){f=z.geoms.length;for(b=0;b<f&&
!(g=z.removeGeometry(b),0<g&&(c+=g,d++),z.numGeomsInMemory<GEOMS_COUNT_LIMIT);++b);stderr("A force page out occur. ")}h+=d;stderr("Page out geometry count: "+d+" , size: "+c/1048576+"MB");if(z.numGeomsInMemory>Autodesk.Viewing.Private.GEOMS_COUNT_LIMIT)return t.reachLimit=!0,S=[],k=!0,Autodesk.Viewing.Private.PAGEOUT_FAIL}t.reachLimit=!1;return Autodesk.Viewing.Private.PAGEOUT_SUCCESS}}
function RenderContext(){function a(){function a(b){b.material.blending=THREE.NoBlending;b.material.depthWrite=!1;b.material.depthTest=!1}var b=NormalsShader;c=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:THREE.UniformsUtils.clone(b.uniforms)});c.blending=THREE.NoBlending;c.packedNormals=!0;m=new LmvShaderPass(SAOShader);a(m);k=new LmvShaderPass(SAOBlurShader);a(k);q=new LmvShaderPass(SAOMinifyFirstShader);a(q);n=new LmvShaderPass(SAOMinifyShader);
a(n);l=new LmvShaderPass(FXAAShader);a(l);p=new LmvShaderPass(CelShader);a(p);r=new LmvShaderPass(BlendShader);a(r);h=new LmvShaderPass(BackgroundShader);a(h);A=new LmvShaderPass(CopyShader);a(A)}var b,c,f,g,d,h,k,m,n,q,l,p,r,A,C=!1,H,z=null,t=null,w=null,E=null,B=null,D=null,J=0,F=0,G=1,M,I,L=!1,K=new Uint8Array(4),O=(new THREE.Color).setRGB(1,1,1),R=(new THREE.Color).setRGB(0,0,0),X=null,W=!1,aa=!1,fa=!1,U=!1,P=0,Z=0,S=[.42,0,1,1],N={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,
idbuffer:!0,customPresentPass:!1,toonShaded:!1},ia,ea,V;this.settings=N;this.init=function(c,d,f){init_FireflyPhongShader();init_BackgroundShader();init_BlendShader();init_CelShader();init_CopyShader();init_FXAAShader();init_LineShader();init_NormalsShader();init_SAOBlurShader();init_SAOMinifyShader();init_SAOShader();c?(W=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS"),aa=isAndroidDevice()||isIOSDevice(),N.idbuffer=!aa,M=d,I=f,b=c,a(),this.initPostPipeline(N.sao,
N.antialias,!1)):console.error("You need a gl context to make a renderer. Things will go downhill from here.")};this.overlayUpdate=function(a){if(0===P||-1===P)return!1;a=r.uniforms.highlightIntensity.value;var b=.004*(performance.now()-Z),b=Math.min(b,1),c=3*S[1],d=3*(S[3]-S[1])-c,b=(((1-c-d)*b+d)*b+c)*b;return a!=b?(r.uniforms.highlightIntensity.value=b,!0):!1};this.beginScene=function(a,c,f,k){g=c;d=f;C=!1;if(t){k&&(X?(b.setClearColor(X,1),b.clearTarget(t,!0,!0,!1)):(b.clearTarget(t,!1,!0,!1),
h.render(b,t,null)));D&&(b.setClearColor(O,1),b.clearTarget(D,!0,!1,!1));if(N.sao||N.toonShaded)k&&(b.setClearColor(R,0),b.clearTarget(H,!0,!1,!1)),f=c.near,k=c.far,m.uniforms.cameraNear.value=f,m.uniforms.cameraFar.value=k,p.uniforms.cameraNear.value=f,p.uniforms.cameraFar.value=k,q.uniforms.cameraNear.value=f,q.uniforms.cameraInvNearFar.value=1/(f-k),f=c.projectionMatrix.elements,c.isPerspective?(m.uniforms.projInfo.value.set(-2/(t.width*f[0]),-2/(t.height*f[5]),(1-f[8])/f[0],(1+f[9])/f[5]),p.uniforms.projInfo.value.copy(m.uniforms.projInfo.value),
m.uniforms.isOrtho.value=0,p.uniforms.isOrtho.value=0):(m.uniforms.projInfo.value.set(-2/(t.width*f[0]),-2/(t.height*f[5]),(1-f[12])/f[0],(1-f[13])/f[5]),p.uniforms.projInfo.value.copy(m.uniforms.projInfo.value),m.uniforms.isOrtho.value=1,p.uniforms.isOrtho.value=1),m.uniforms.projScale.value=.125*t.height*f[5];this.renderScenePart(a,!0,!0,!1,!0)}else M||L||(console.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance."),
L=!0)};this.renderScenePart=function(a,h,k,l,m){C=!1;m=m?d:void 0;fa&&U?N.idbuffer&&l&&(N.sao||N.toonShaded)?b.render(a,g,[t,H,D],!1,m):N.sao||N.toonShaded?b.render(a,g,[t,H],!1,m):N.idbuffer&&l?b.render(a,g,[t,D]):b.render(a,g,t,!1,m):(U?N.idbuffer&&l?b.render(a,g,[t,D],!1,m):b.render(a,g,t,!1,m):(h&&b.render(a,g,t,!1,m),N.idbuffer&&l&&f&&(h=a.overrideMaterial,a.overrideMaterial=f,b.render(a,g,D,!1,void 0),a.overrideMaterial=h)),(N.sao||N.toonShaded)&&k&&(h=a.overrideMaterial,a.overrideMaterial=
c,b.render(a,g,H,!1,void 0),a.overrideMaterial=h))};this.clearAllOverlays=function(){b.clearTarget(w,!0,!1,!1)};this.renderOverlays=function(a,c){var d=0,f;for(f in a){var h=a[f],k=h.scene,l=h.camera?h.camera:g;k.children.length&&(d||(d=1,b.setClearColor(R,0),b.clearTarget(w,!0,!1,!1)),h.materialPre&&(k.overrideMaterial=h.materialPre),b.render(k,l,w,!1,c),h.materialPost&&(k.overrideMaterial=h.materialPost,b.context.depthFunc(b.context.GREATER),b.render(k,l,w,!1,c),b.context.depthFunc(b.context.LEQUAL)),
k.overrideMaterial=null)}r.uniforms.useOverlay.value=d};this.computeSSAO=function(a){if(a||!N.sao||N.toonShaded)r.uniforms.useAO.value=0;else{if(!C){if(z){a=z[0];q.uniforms.resolution.value.set(1/a.width,1/a.height);q.render(b,a,H);for(var c=1;c<z.length;c++){var d=z[c];n.uniforms.resolution.value.set(1/d.width,1/d.height);n.render(b,d,a);a=d}}m.render(b,B,t);k.uniforms.axis.value.set(1,0);k.render(b,E,B);k.uniforms.axis.value.set(0,1);k.render(b,B,E);C=!0}r.uniforms.useAO.value=1}};this.presentBuffer=
function(a){N.sao||r.uniforms.useOverlay.value||r.uniforms.objID.value?N.antialias?(r.render(b,E,t),a?(l.render(b,B,E),a.render(b,null,B)):N.toonShaded?(p.render(b,B,E),l.render(b,null,B)):l.render(b,null,E)):a?(r.render(b,E,t),a.render(b,null,E)):N.toonShaded?(r.render(b,E,t),p.render(b,B,E),A.render(b,null,B)):r.render(b,null,t):N.antialias?a?(l.render(b,E,t),a.render(b,null,E)):N.toonShaded?(p.render(b,E,t),l.render(b,null,E)):l.render(b,null,t):a?a.render(b,null,t):A.render(b,null,t)};this.composeFinalFrame=
function(a,b,c){N.sao&&!N.toonShaded&&this.computeSSAO(a);c||this.presentBuffer()};this.cleanup=function(){t&&(t.dispose(),t=null);H&&(H.dispose(),H=null);w&&(w.dispose(),w=null);E&&(E.dispose(),E=null);B&&(B.dispose(),B=null);if(z){for(var a=0;a<z.length;a++)z[a].dispose();z=[]}};this.setSize=function(a,c,d){M=a;I=c;var f=0|a*b.getPixelRatio(),g=0|c*b.getPixelRatio();N.logicalWidth=a;N.logicalHeight=c;N.deviceWidth=f;N.deviceHeight=g;if(0==a&&0==c)this.cleanup();else{b.setSize(a,c);stderr("width: "+
f+" height: "+g);a=1/f;c=1/g;if(N.useSSAA||N.toonShaded&&1>=b.getPixelRatio())f*=2,g*=2,d=!0;if(d||!t||t.width!=f||t.height!=g)stderr("Reallocating render targets."),this.cleanup(),t=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:N.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1,generateMipmaps:!1}),w=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,
stencilBuffer:!1,generateMipmaps:!1}),w.shareDepthFrom=t,B=E=H=null,z=[];if(N.antialias||N.sao||N.customPresentPass||N.toonShaded)if(d||!E||E.width!=f||E.height!=g)E=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});if(N.sao||N.toonShaded){if(d||!H||H.width!=f||H.height!=g){var h=THREE.FloatType;isMobileDevice()&&(h=THREE.HalfFloatType);H=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.NearestFilter,
magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:h,stencilBuffer:!1});H.shareDepthFrom=t;z=[];for(h=0;5>h;h++){var n=new THREE.WebGLRenderTarget(0|f/(2<<h),0|g/(2<<h),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});n.generateMipmaps=!1;z.push(n);m.uniforms["tDepth_mip"+(h+1)].value=n}fa=!W&&b.verifyMRTWorks([t,H]);B=E.clone()}!B&&N.antialias&&N.customPresentPass&&(B=E.clone());m.uniforms.size.value.set(f,g);m.uniforms.resolution.value.set(a,
c);m.uniforms.tDepth.value=H;k.uniforms.size.value.set(f,g);k.uniforms.resolution.value.set(a,c);p.uniforms.tDepth.value=H}if(N.idbuffer){if(d||!D||D.width!=f||D.height!=g)D=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1,generateMipmaps:!1}),D.shareDepthFrom=t,(U=!W&&b.verifyMRTWorks([t,D]))||console.warn("ID buffer requested, but MRT is not supported. Some features will not work.");p.uniforms.tID.value=
D}else D&&(D.dispose(),D=null);l.uniforms.resolution.value.set(a,c);p.uniforms.resolution.value.set(a,c);r.uniforms.tOverlay.value=w;r.uniforms.tAO.value=B;r.uniforms.useAO.value=N.sao?1:0;r.uniforms.resolution.value.set(a,c);r.uniforms.tID.value=D}};this.getMaxAnisotropy=function(){return b.getMaxAnisotropy()};this.hasMRT=function(){return!W&&b.supportsMRT()};this.applyMRTFlags=function(a){var b=a.mrtNormals,c=a.mrtIdBuffer;a.mrtNormals=this.hasMRT()&&fa&&(N.sao||N.toonShaded);a.mrtIdBuffer=this.hasMRT()&&
U&&N.idbuffer;if(a.mrtNormals!==b||a.mrtIdBuffer!==c)a.needsUpdate=!0};this.initPostPipeline=function(a,b){N.sao=a&&!_isIE11;N.antialias=b&&!_isIE11;N.sao&&(N.toonShaded=!1);N.haveTwoSided&&(c.side=THREE.DoubleSide);c.needsUpdate=!0;m.material.needsUpdate=!0;k.material.needsUpdate=!0;q.material.needsUpdate=!0;n.material.needsUpdate=!0;l.material.needsUpdate=!0;p.material.needsUpdate=!0;r.material.needsUpdate=!0;h.material.needsUpdate=!0;A.material.needsUpdate=!0;this.setSize(M,I)};this.setClearColors=
function(a,b){X=b?a.equals(b)||aa?new THREE.Color(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)):void 0:a.clone();X||(h.uniforms.color1.value.copy(a),h.uniforms.color2.value.copy(b))};this.setAOOptions=function(a,b){void 0!==a&&(m.uniforms.radius.value=a);void 0!==b&&(m.uniforms.intensity.value=b);C=!1};this.getAORadius=function(){return m.uniforms.radius.value};this.getAOIntensity=function(){return m.uniforms.intensity.value};this.setTonemapExposureBias=function(a){J=a};this.getExposureBias=function(){return J};
this.setTonemapMethod=function(a){F=a;b.gammaInput=0===a?!1:!0};this.getToneMapMethod=function(){return F};this.toggleTwoSided=function(a){N.haveTwoSided!=a&&c&&(c.side=a?THREE.DoubleSide:THREE.FrontSide,c.needsUpdate=!0);N.haveTwoSided=a};this.toggleCelShading=function(a){N.sao=!a;N.toonShaded=a;N.idbuffer=a;this.initPostPipeline(N.sao,N.antialias)};this.enter2DMode=function(a){f=a;ia=N.sao;ea=N.antialias;V=N.idbuffer;N.idbuffer=!0;r.material.defines.IS_2D="";this.initPostPipeline(!1,!1)};this.exit2DMode=
function(){f=null;N.idbuffer=V;delete r.material.defines.IS_2D;this.initPostPipeline(ia,ea)};this.idAtPixel=function(a,c){if(!D)return 0;b.readRenderTargetPixels(D,.5*(a+1)*D.width,.5*(c+1)*D.height,1,1,K);var d=K[2]<<16|K[1]<<8|K[0];return d<<8>>8};this.rolloverObjectViewport=function(a,b){var c=this.idAtPixel(a,b);if(c==P)return!1;r.uniforms.highlightIntensity.value=0;Z=performance.now();P=c;0>=c&&(c=0,K[0]=K[1]=K[2]=K[3]=0);r.uniforms.objID.value=c;r.uniforms.objIDv3.value.set(K[0]/255,K[1]/255,
K[2]/255);return!0};this.setUnitScale=function(a){G=a};this.getUnitScale=function(){return G};this.getBlendPass=function(){return r};this.getColorTarget=function(){return t};this.getDepthMaterial=function(){return c}}
function init_FXAAShader(){"undefined"===typeof FXAAShader&&(FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#define FXAA_SPAN_MAX     8.0\n#define FXAA_EDGE_THRESHOLD_MIN (1.0/24.0)\n#define FXAA_EDGE_THRESHOLD (1.0/8.0)\n#define FXAA_SEARCH_THRESHOLD (1.0/4.0)\n#define FXAA_SEARCH_STEPS 16\n#define FXAA_SUBPIX_TRIM (1.0/8.0)\n#define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n#define FXAA_SUBPIX_CAP (7.0/8.0)\nvec4 getColor(sampler2D tex, vec2 uv) {\nvec4 c = texture2D(tex, uv);\nreturn c;\n}\nfloat FxaaLuma(vec3 rgb) {\nreturn rgb.y * (0.587/0.299) + rgb.x; }\nvec4 FxaaFilterReturn(vec4 rgba) {\nreturn rgba;}\nvec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\nreturn (vec3(-amountOfA) * b) +\n((a * vec3(amountOfA)) + b); }\nvec4 FxaaTex(sampler2D tex, vec2 pos) {\nreturn getColor(tex, pos.xy);}\nvec4 FxaaTexOff(sampler2D tex, vec2 pos, vec2 offset, vec2 resolution) {\nvec2 uv = pos.xy + offset * resolution;\nreturn getColor(tex, uv);}\nvoid main() {\nvec3 rgbN = FxaaTexOff( tDiffuse, vUv, vec2(0.0,-1.0), resolution ).xyz;\nvec3 rgbE = FxaaTexOff( tDiffuse, vUv, vec2(1.0, 0.0), resolution ).xyz;\nvec3 rgbW = FxaaTexOff( tDiffuse, vUv, vec2(-1.0,0.0), resolution ).xyz;\nvec3 rgbS = FxaaTexOff( tDiffuse, vUv, vec2(0.0, 1.0), resolution ).xyz;\nvec4 rgbaM = FxaaTex( tDiffuse, vUv);\nvec3 rgbM  = rgbaM.xyz;\nfloat lumaN = FxaaLuma(rgbN);\nfloat lumaE = FxaaLuma(rgbE);\nfloat lumaW = FxaaLuma(rgbW);\nfloat lumaS = FxaaLuma(rgbS);\nfloat lumaM = FxaaLuma(rgbM);\nfloat rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\nfloat rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\nfloat range = rangeMax - rangeMin;\nif(range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\ngl_FragColor = FxaaFilterReturn(rgbaM); return;}\nvec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\nfloat lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\nfloat rangeL = abs(lumaL - lumaM);\nfloat blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\nblendL = min(FXAA_SUBPIX_CAP, blendL);\nvec3 rgbNW = FxaaTexOff( tDiffuse, vUv, vec2(-1.0,-1.0), resolution ).xyz;\nvec3 rgbNE = FxaaTexOff( tDiffuse, vUv, vec2(1.0,-1.0), resolution ).xyz;\nvec3 rgbSW = FxaaTexOff( tDiffuse, vUv, vec2(-1.0,1.0), resolution ).xyz;\nvec3 rgbSE = FxaaTexOff( tDiffuse, vUv, vec2(1.0,1.0), resolution ).xyz;\nfloat opacity  = rgbaM.w;\nrgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\nrgbL *= vec3(1.0/9.0);\nfloat lumaNW = FxaaLuma( rgbNW);\nfloat lumaNE = FxaaLuma( rgbNE);\nfloat lumaSW = FxaaLuma( rgbSW);\nfloat lumaSE = FxaaLuma( rgbSE);\nfloat edgeVert = abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\nabs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\nabs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\nfloat edgeHorz = abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\nabs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\nabs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\nbool horzSpan = edgeHorz >= edgeVert;\nfloat lengthSign = horzSpan ? -resolution.y : -resolution.x;\nif(!horzSpan) lumaN = lumaW;\nif(!horzSpan) lumaS = lumaE;\nfloat gradientN = abs(lumaN - lumaM);\nfloat gradientS = abs(lumaS - lumaM);\nlumaN = (lumaN + lumaM) * 0.5;\nlumaS = (lumaS + lumaM) * 0.5;\nbool pairN = gradientN >= gradientS;\nif(!pairN) lumaN = lumaS;\nif(!pairN) gradientN = gradientS;\nif(!pairN) lengthSign *= -1.0;\nvec2 posN;\nposN.x = vUv.x + (horzSpan ? 0.0 : lengthSign * 0.5);\nposN.y = vUv.y + (horzSpan ? lengthSign * 0.5 : 0.0);\ngradientN *= FXAA_SEARCH_THRESHOLD;\nvec2 posP = posN;\nvec2 offNP = horzSpan ? vec2(resolution.x, 0.0) : vec2(0.0, resolution.y);\nfloat lumaEndN = lumaN;\nfloat lumaEndP = lumaN;\nbool doneN = false;\nbool doneP = false;\nposN += offNP * vec2(-1.0, -1.0);\nposP += offNP * vec2( 1.0,  1.0);\nfor(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTex( tDiffuse, posN.xy).xyz);\nif(!doneP) lumaEndP = FxaaLuma(FxaaTex( tDiffuse, posP.xy).xyz);\ndoneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\ndoneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\nif(doneN && doneP) break;\nif(!doneN) posN -= offNP;\nif(!doneP) posP += offNP; }\nfloat dstN = horzSpan ? vUv.x - posN.x : vUv.y - posN.y;\nfloat dstP = horzSpan ? posP.x - vUv.x : posP.y - vUv.y;\nbool directionN = dstN < dstP;\nlumaEndN = directionN ? lumaEndN : lumaEndP;\nif(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0))\nlengthSign = 0.0;\nfloat spanLength = (dstP + dstN);\ndstN = directionN ? dstN : dstP;\nfloat subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\nvec3 rgbF = FxaaTex(tDiffuse, vec2(\nvUv.x + (horzSpan ? 0.0 : subPixelOffset),\nvUv.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\ngl_FragColor = FxaaFilterReturn(vec4(FxaaLerp3(rgbL, rgbF, blendL), opacity));\n}"})}
var PackDepthShaderChunk="vec4 packDepth( const in float depth ) {\nvec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\nreturn enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\nreturn dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}",TonemapShaderChunk="float luminance_post(vec3 rgb) {\nreturn dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\nreturn dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\nvec3 R = vec3( 3.240479, -1.537150, -0.498535);\nvec3 G = vec3(-0.969256,  1.875992,  0.041556);\nvec3 B = vec3( 0.055648, -0.204043,  1.057311);\nvec3 rgb;\nrgb.b = dot(xyz, B);\nrgb.g = dot(xyz, G);\nrgb.r = dot(xyz, R);\nreturn rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\nvec3 X = vec3(0.412453, 0.35758, 0.180423);\nvec3 Y = vec3(0.212671, 0.71516, 0.0721688);\nvec3 Z = vec3(0.0193338, 0.119194, 0.950227);\nvec3 xyz;\nxyz.x = dot(rgb, X);\nxyz.y = dot(rgb, Y);\nxyz.z = dot(rgb, Z);\nreturn xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\nfloat sum = xyz.x + xyz.y + xyz.z;\nsum = 1.0 / sum;\nvec3 xyY;\nxyY.z = xyz.y;\nxyY.x = xyz.x * sum;\nxyY.y = xyz.y * sum;\nreturn xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\nfloat x = xyY.x;\nfloat y = xyY.y;\nfloat Y = xyY.z;\nvec3 xyz;\nxyz.y = Y;\nxyz.x = x * (Y / y);\nxyz.z = (1.0 - x - y) * (Y / y);\nreturn xyz;\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\nx *= Shift;\nconst float A = 0.2;\nconst float B = 0.34;\nconst float C = 0.002;\nconst float D = 1.68;\nconst float E = 0.0005;\nconst float F = 0.252;\nconst float scale = 1.0/0.833837;\nreturn (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\nx *= Shift;\nconst float A = 0.27;\nconst float B = 0.29;\nconst float C = 0.052;\nconst float D = 0.2;\nconst float F = 0.18;\nconst float scale = 1.0/0.897105;\nreturn (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}",
OrderedDitheringShaderChunk="vec3 orderedDithering(vec3 col) {\nconst vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\nconst vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\nconst vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\nconst vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\nint i = int(mod(float(gl_FragCoord.x), 4.0));\nint j = int(mod(float(gl_FragCoord.y), 4.0));\nvec4 biasRow;\nif      (i==0) biasRow = m0;\nelse if (i==1) biasRow = m1;\nelse if (i==2) biasRow = m2;\nelse           biasRow = m3;\nfloat bias;\nif      (j==0) bias = biasRow.x;\nelse if (j==1) bias = biasRow.y;\nelse if (j==2) bias = biasRow.z;\nelse           bias = biasRow.w;\nreturn col + bias / 17.0 / 256.0;\n}",
CutPlanesShaderChunk="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\n#ifdef CUTPLANES_LINE\nuniform vec3 cutplanesOutlineColor;\nuniform float cutplanesOutlineThickness;\n#endif\nbool checkCutPlanes() {\nbool isCut = false;\n#ifdef CUTPLANES_LINE\nbool isCutEdge = false;\nfloat eyeDist = length(vViewPosition);\n#endif\nfor (int i=0; i<NUM_CUTPLANES; i++) {\nfloat dotPlane = dot(vec4(vWorldPosition, 1.0), cutplanes[i]);\nisCut = isCut || (dotPlane > 0.0);\n#ifdef CUTPLANES_LINE\nisCutEdge = isCutEdge || (dotPlane > -cutplanesOutlineThickness*eyeDist);\n#endif\n}\nif (isCut) {\ndiscard;\nreturn true;\n}\n#ifdef CUTPLANES_LINE\nelse if (isCutEdge) {\ngl_FragColor = vec4(cutplanesOutlineColor, 1.0);\nreturn true;\n}\n#endif\nreturn false;\n}\n#endif",
PackNormalsShaderChunk="#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n)\n{\nreturn (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc)\n{\nvec2 ang = enc * 2.0 - 1.0;\nvec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\nvec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\nreturn vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}";
function init_CopyShader(){"undefined"===typeof CopyShader&&(CopyShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D(tDiffuse, vUv);\n}"})}
function init_CelShader(){"undefined"===typeof CelShader&&(CelShader={uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},projInfo:{type:"v4",value:new THREE.Vector4(0,0,0,0)},isOrtho:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["#extension GL_OES_standard_derivatives : enable\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float isOrtho;\nuniform vec4 projInfo;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\nfloat z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\nnrmz.w = -(nrmz.z +cameraNear) / (cameraFar - cameraNear);\nnrmz.z = z;\nreturn nrmz;\n}",TonemapShaderChunk,"vec4 quantize(vec4 c) {\nc *= c;\nfloat L = max(c.x, max(c.y, c.z));\nc.xyz *= floor(L * 8.0 + 0.5) / (8.0 * L);\nc.w = 1.0;\nreturn sqrt(c);\n}\nvec4 quantizeRGB(vec4 c) {\nc *= c;\nc.xyz *= floor(c.xyz * 8.0 + 0.5) / 8.0;\nc.w = 1.0;\nreturn sqrt(c);\n}\nvec3 reconstructCSPosition(vec2 S, float z) {\nreturn vec3((S.xy * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\nreturn normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\nvec3 P;\nP = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\nreturn P;\n}\nint isObjectEdge() {\nvec4 MM = texture2D(tID, vUv + vec2( 0.0,  0.0));\nvec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);\nif (MM != LL) return 1;\nvec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);\nif (MM != LM) return 1;\nvec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);\nif (MM != LR) return 1;\nvec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);\nif (MM != ML) return 1;\nvec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);\nif (MM != MR) return 1;\nvec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);\nif (MM != UL) return 1;\nvec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);\nif (MM != UM) return 1;\nvec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);\nif (MM != UR) return 1;\nreturn 0;\n}\nfloat normalDiff(vec3 n1, vec3 n2) {\nfloat d = dot(n1.xyz, n2.xyz);\nreturn acos(clamp(d, -1.0, 1.0));\n}\nconst float r = 1.0;\nvoid main() {\nvec4 color = texture2D(tDiffuse, vUv);\nivec2 ssC = ivec2(gl_FragCoord.xy);\nif (isObjectEdge() == 1) {\ngl_FragColor = vec4(0,0,0,1);\nreturn;\n}\nvec4 MM = texture2D(tDepth, vUv + vec2( 0.0,  0.0));\nif (MM.z == 0.0) {\ngl_FragColor = quantize(color);\nreturn;\n}\nvec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);\nvec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);\nvec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);\nvec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);\nvec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);\nvec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);\nvec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);\nvec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);\nvec3 C = getPosition(ssC + ivec2(-1, -1), LL.z);\nvec3 LLz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 0, -1), LM.z);\nvec3 LMz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 1, -1), LR.z);\nvec3 LRz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(-1, 0), ML.z);\nvec3 MLz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 0, 0), MM.z);\nvec3 MMz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 1, 0), MR.z);\nvec3 MRz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(-1, 1), UL.z);\nvec3 ULz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(0, 1), UM.z);\nvec3 UMz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(1, 1), UR.z);\nvec3 URz = reconstructCSFaceNormal(C);\nLL = recoverNZ(LL);\nLM = recoverNZ(LM);\nLR = recoverNZ(LR);\nML = recoverNZ(ML);\nMM = recoverNZ(MM);\nMR = recoverNZ(MR);\nUL = recoverNZ(UL);\nUM = recoverNZ(UM);\nUR = recoverNZ(UR);\nfloat pLL = normalDiff(LL.xyz, MM.xyz);\nfloat pLM = normalDiff(LM.xyz, MM.xyz);\nfloat pLR = normalDiff(LR.xyz, MM.xyz);\nfloat pML = normalDiff(ML.xyz, MM.xyz);\nfloat pMM = normalDiff(MM.xyz, MM.xyz);\nfloat pMR = normalDiff(MR.xyz, MM.xyz);\nfloat pUL = normalDiff(UL.xyz, MM.xyz);\nfloat pUM = normalDiff(UM.xyz, MM.xyz);\nfloat pUR = normalDiff(UR.xyz, MM.xyz);\nfloat pLLz = normalDiff(LLz.xyz, MMz.xyz);\nfloat pLMz = normalDiff(LMz.xyz, MMz.xyz);\nfloat pLRz = normalDiff(LRz.xyz, MMz.xyz);\nfloat pMLz = normalDiff(MLz.xyz, MMz.xyz);\nfloat pMMz = normalDiff(MMz.xyz, MMz.xyz);\nfloat pMRz = normalDiff(MRz.xyz, MMz.xyz);\nfloat pULz = normalDiff(ULz.xyz, MMz.xyz);\nfloat pUMz = normalDiff(UMz.xyz, MMz.xyz);\nfloat pURz = normalDiff(URz.xyz, MMz.xyz);\nfloat dGx = (dFdx(UL.w) + 2.0 * dFdx(UM.w) + dFdx(UR.w)) - (dFdx(LL.w) + 2.0 * dFdx(LM.w) + dFdx(LR.w)) + (dFdx(UR.w) + 2.0 * dFdx(MR.w) - dFdx(LR.w)) - (dFdx(UL.w) + 2.0 * dFdx(ML.w) - dFdx(LL.w));\nfloat dGy = (dFdy(UL.w) + 2.0 * dFdy(UM.w) + dFdy(UR.w)) - (dFdy(LL.w) + 2.0 * dFdy(LM.w) + dFdy(LR.w)) + (dFdy(UR.w) + 2.0 * dFdy(MR.w) - dFdy(LR.w)) - (dFdy(UL.w) + 2.0 * dFdy(ML.w) - dFdy(LL.w));\nfloat Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\nfloat Gnz = (abs(pULz - pMMz) + 2.0 * abs(pUMz - pMMz) + abs(pURz - pMMz) + 2.0 * abs(pMLz - pMMz) + 2.0 * abs(pMRz - pMMz) + abs(pLLz - pMMz) + 2.0 * abs(pLMz - pMMz) + abs(pLRz - pMMz));\nfloat G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\nfloat dd = abs(dFdx(G)) + abs(dFdy(G));\nif (dd > 0.004 || abs(Gnz) > 2.2 || abs(Gn) > 2.0)\ngl_FragColor = vec4(0.0,0.0,0.0,1.0);\nelse\ngl_FragColor = /*vec4(1.0,1.0,1.0,1.0);*/quantize(color);\n}"].join("\n")})}
function init_BlendShader(){"undefined"===typeof BlendShader&&(BlendShader={uniforms:{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},objID:{type:"i",value:0},objIDv3:{type:"v3",value:new THREE.Vector3(0,0,0)},highlightIntensity:{type:"f",value:1},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform vec2 resolution;\nuniform int objID;\nuniform vec3 objIDv3;\nuniform sampler2D tID;\nuniform float highlightIntensity;\nvarying vec2 vUv;",TonemapShaderChunk,"vec4 overlayEdgeDetect(vec2 vUv) {\n#define IS_SELECTION(C) ( (C).b > (C).r && (C).b > (C).g )\n#define CHECK_EDGE_ALPHA(I, J)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; selectionPixel = c; } }\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a <= 0.0) hasEdge++; }\nint hasEdge = 0;\nvec4 center = texture2D(tOverlay, vUv);\nvec4 selectionPixel = vec4(0.0);\nfloat maxAlpha = 0.0;\nbool paintOutline = false;\nif (center.a <= 0.0) {\nCHECK_EDGE_ALPHA(-1.0,-1.0);\nCHECK_EDGE_ALPHA( 0.0,-1.0);\nCHECK_EDGE_ALPHA( 1.0,-1.0);\nCHECK_EDGE_ALPHA(-1.0, 0.0);\nCHECK_EDGE_ALPHA( 1.0, 0.0);\nCHECK_EDGE_ALPHA(-1.0, 1.0);\nCHECK_EDGE_ALPHA( 0.0, 1.0);\nCHECK_EDGE_ALPHA( 1.0, 1.0);\nif (hasEdge != 0) {\ncenter = selectionPixel;\npaintOutline = true;\n}\n}\nelse if (center.a > 0.0 && IS_SELECTION(center)) {\nCHECK_EDGE_SELECTION(-1.0,-1.0);\nCHECK_EDGE_SELECTION( 0.0,-1.0);\nCHECK_EDGE_SELECTION( 1.0,-1.0);\nCHECK_EDGE_SELECTION(-1.0, 0.0);\nCHECK_EDGE_SELECTION( 1.0, 0.0);\nCHECK_EDGE_SELECTION(-1.0, 1.0);\nCHECK_EDGE_SELECTION( 0.0, 1.0);\nCHECK_EDGE_SELECTION( 1.0, 1.0);\nif (hasEdge != 0)\npaintOutline = true;\nelse\ncenter.a = -center.a;\n}\nif (paintOutline) {\nfloat maxComponent = max(center.r, max(center.g, center.b));\ncenter.rgb /= maxComponent;\ncenter.rgb = sqrt(center.rgb);\ncenter.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n}\nreturn center;\n}\nvec4 sampleColor() {\nreturn texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\nreturn (useAO != 0) ? texture2D(tAO, vUv).r : 1.0;\n}\nvoid main() {\nvec4 texel = sampleColor();\ntexel.rgb *= sampleAO();\nif (useOverlay != 0) {\nvec4 overlay = overlayEdgeDetect(vUv);\nif (overlay.a < 0.0) {\noverlay.a = -overlay.a;\nif (overlay.a >= 0.99) {\noverlay.a = 0.75;\ntexel.rgb = vec3(luminance_post(texel.rgb));\n}\n}\ntexel.rgb = mix(texel.rgb, sqrt(overlay.rgb)/*sqrt=gamma*/, overlay.a);\n}\nif (objID != 0) {\nvec4 idAtPixel = texture2D(tID, vUv);\nvec3 idDelta = abs(idAtPixel.rgb - objIDv3.rgb);\nif (max(max(idDelta.r, idDelta.g), idDelta.b) < 1e-3) {\n#ifdef IS_2D\ntexel.rgb = mix(texel.rgb, vec3(1.0,1.0,0.0), highlightIntensity * 0.25);\n#else\ntexel.rgb += highlightIntensity * 0.2;\n#endif\n}\n}\ngl_FragColor = texel;\n}"].join("\n")})}
LmvShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)});this.renderToScreen=!1;this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var c=new THREE.BufferGeometry,f=new Float32Array(9);f[0]=-1;f[1]=-1;f[2]=0;f[3]=3;f[4]=-1;f[5]=0;f[6]=
-1;f[7]=3;f[8]=0;var g=new Float32Array(6);g[0]=0;g[1]=0;g[2]=2;g[3]=0;g[4]=0;g[5]=2;c.addAttribute("position",new THREE.BufferAttribute(f,3));c.addAttribute("uv",new THREE.BufferAttribute(g,2));this.quad=new THREE.Mesh(c,this.material);this.scene=new THREE.Scene;this.scene.add(this.quad)};
LmvShaderPass.prototype={render:function(a,b,c,f){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c);this.renderToScreen||!b?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}};
function init_SAOShader(){"undefined"===typeof SAOShader&&(SAOShader={uniforms:{tDepth:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:10},bias:{type:"f",value:.01},projScale:{type:"f",value:500},projInfo:{type:"v4",value:new THREE.Vector4(0,0,0,0)},intensity:{type:"f",value:.5},isOrtho:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},
tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (7)\nuniform float           projScale;\nuniform sampler2D tDepth;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nuniform float isOrtho;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\nfloat alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\nfloat angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\nssR = alpha;\nreturn vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\nreturn clamp(z * (1.0 / -cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\nfloat temp = floor(key * 256.0);\np.x = temp * (1.0 / 256.0);\np.y = key * 256.0 - temp;\n}",
PackDepthShaderChunk,"float unpackDepthNearFar( const in vec4 rgba_depth ) {\nfloat depth = unpackDepth( rgba_depth );\nif (depth == 0.0)\nreturn -cameraFar * 1.0e10;\nreturn depth * (cameraNear - cameraFar) - cameraNear;\n}\nuniform vec4 projInfo;\nvec3 reconstructCSPosition(vec2 S, float z) {\nreturn vec3((S.xy * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\nreturn normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\nreturn cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\nvec3 P;\nP = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\nreturn P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\nivec2 ssP = ivec2(ssR * unitOffset) + ssC;\nvec3 P;\nvec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;\n#ifdef USE_MIPMAP\nint mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\nif (mipLevel == 0) {\nP.z = texture2D(tDepth, screenUV).z;\nif (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n}\nelse if (mipLevel == 1)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\nelse if (mipLevel == 2)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\nelse if (mipLevel == 3)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\nelse if (mipLevel == 4)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\nelse if (mipLevel == 5)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\nP.z = texture2D(tDepth, screenUV).z;\nif (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\nP = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\nreturn P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\nfloat ssR;\nvec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\nssR *= ssDiskRadius;\nvec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\nvec3 v = Q - C;\nfloat vv = dot(v, v);\nfloat vn = dot(v, n_C);\nconst float epsilon = 0.01;\nfloat f = max(radius * radius - vv, 0.0); return f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n}\nconst bool useNoise = true;\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );\nfloat gg = fract( coord.t * ( size.y / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 );\n}\nfloat getRandomAngle(vec2 pos) {\nvec2 rnd = rand(pos);\nreturn atan(rnd.y, rnd.x);\n}\nvoid main() {\nivec2 ssC = ivec2(gl_FragCoord.xy);\nvec4 nrmz = texture2D(tDepth, vUv);\nif (nrmz.z == 0.0) {\ngl_FragColor.r = 1.0;\ngl_FragColor.a = 0.0;\npackKey(1.0, gl_FragColor.gb);\nreturn;\n}\nvec3 C = getPosition(ssC, nrmz.z);\npackKey(CSZToKey(C.z), gl_FragColor.gb);\nfloat randomPatternRotationAngle = getRandomAngle(vUv);\nvec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\nfloat ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\nfloat sum = 0.0;\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\nfloat intensityDivR6 = intensity / pow(radius, 6.0);\nfloat A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\nif (abs(dFdx(C.z)) < 0.02) {\nA -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n}\nif (abs(dFdy(C.z)) < 0.02) {\nA -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n}\ngl_FragColor.r = A;\ngl_FragColor.a = 1.0;\n}"].join("\n")})}
function init_SAOBlurShader(){"undefined"===typeof SAOBlurShader&&(SAOBlurShader={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)},axis:{type:"v2",value:new THREE.Vector2(1,0)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define EDGE_SHARPNESS     (1.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);  // stddev = 2.0\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\nreturn p.x * (256.0 / 257.0) + p.y * (1.0 / 257.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\nfloat gaussian[R + 1];\n#       if R == 3\ngaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;  // stddev = 2.0\n#       elif R == 4\ngaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;  // stddev = 2.0\n#       elif R == 6\ngaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\nivec2 axisi = ivec2(axis);\nivec2 ssC = ivec2(gl_FragCoord.xy);\nvec4 temp = texture2D(tDiffuse, vUv);\ngl_FragColor.gb = temp.KEY_COMPONENTS;\ngl_FragColor.a = temp.a;\nVALUE_TYPE sum = temp.VALUE_COMPONENTS;\nif (temp.a == 0.0) {\nresult = sum;\nreturn;\n}\nfloat key = unpackKey(keyPassThrough);\nfloat BASE = gaussian[0];\nfloat totalWeight = BASE;\nsum *= totalWeight;\nint r = -4; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[4];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = -3; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[3];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = -2; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[2];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr=-1; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[1];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 1; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[1];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 2; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[2];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 3; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[3];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 4; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[4];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nconst float epsilon = 0.0001;\nresult = sum / (totalWeight + epsilon);\n}"})}
function init_SAOMinifyShader(){"undefined"===typeof SAOMinifyFirstShader&&(SAOMinifyFirstShader={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;",
PackDepthShaderChunk,"void main() {\nvec2 ssP = vec2(gl_FragCoord.xy);\nssP = ssP * 2.0 + mod(ssP, 2.0);\nssP = (ssP + 0.5) * resolution * 0.5;\nfloat depth = texture2D(tDiffuse, ssP).z;\nif (depth != 0.0)\ndepth = (depth + cameraNear) * cameraInvNearFar;\ngl_FragColor = packDepth(depth);\n}"].join("\n")},SAOMinifyShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\nvec2 ssP = vec2(gl_FragCoord.xy);\nssP = ssP * 2.0 + mod(ssP, 2.0);\nssP = (ssP + 0.5) * resolution * 0.5;\ngl_FragColor = texture2D(tDiffuse, ssP);\n}"})}
function init_FireflyPhongShader(){"undefined"===typeof FireflyPhongShader&&(FireflyPhongShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},texMatrix:{type:"m3",value:new THREE.Matrix3},texMatrixBump:{type:"m3",
value:new THREE.Matrix3},texMatrixAlpha:{type:"m3",value:new THREE.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},cutplanes:{type:"v4v",value:[]},cutplanesOutlineColor:{type:"v3",value:new THREE.Vector3(0,1,0)},hatchParams:{type:"v2",value:new THREE.Vector2(1,10)},cutplanesOutlineThickness:{type:"f",value:.001},dbId:{type:"v4",value:new THREE.Vector4(0,0,0,0)}}]),vertexShader:["varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif",
PackNormalsShaderChunk,"void main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\nvUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\nvec3 objectNormal = decodeNormal(normal);\n#else\nvec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\nif (projectionMatrix[3][3] == 0.0) {\ngl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\nvFragDepth = 1.0 + gl_Position.w;\n#else\ngl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n} else {\n#ifdef USE_LOGDEPTHBUF_EXT\nvFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n}\n#endif\n#ifdef MRT_NORMALS\ndepth = mvPosition.z;\n#endif\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 InputToLinear(vec3 c) {\nreturn c * c;\n}\nfloat InputToLinear(float c) {\nreturn c * c;\n}\n#else\nvec3 InputToLinear(vec3 c) {\nreturn c;\n}\nfloat InputToLinear(float c) {\nreturn c;\n}\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if defined(TONEMAP_OUTPUT)\nuniform float exposureBias;",
TonemapShaderChunk,"#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\nuniform vec4 dbId;\n#endif\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\nvec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\nret *= ret;\nret *= exposure;\nreturn ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\nreturn vRGBA.xyz * vRGBA.xyz * exposure;\n}\n#ifdef USE_ENVMAP\nuniform float reflMipIndex;\nuniform float reflectivity;\nuniform samplerCube envMap;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\nvec3 sampleReflection(vec3 dir, float mipIndex) {\ndir.z = -dir.z;\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\nvec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\nvec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\nreturn GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\nvec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\nvec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\nreturn RGBMDecode(envTexColor, envMapExposure);\n#else\nvec4 envTexColor = textureCube( envMap, dir );\nvec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\ncubeColor *= cubeColor;\n#endif\nreturn cubeColor;\n#endif\n}\n#endif\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef USE_IRRADIANCEMAP\nuniform samplerCube irradianceMap;\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying highp vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying highp vec3 vNormal;\n#endif\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUvBump );\nvec2 dSTdy = dFdy( vUvBump );\nfloat Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\nfloat dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\nfloat dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUvBump.st );\nvec2 st1 = dFdy( vUvBump.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif\n#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nfloat curveGaussian(float r, float invWidth) {\nfloat amt = clamp(r * invWidth, 0.0, 1.0);\nfloat exponent = amt * 3.5;\nreturn exp(-exponent*exponent);\n}\n#endif\n#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\nvarying highp float depth;\n#define gl_FragColor gl_FragData[0]\n#endif\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\nvec3 Schlick_v3(vec3 v, float cosHV) {\nfloat facing = max(1.0 - cosHV, 0.0);\nfloat facing2 = facing * facing;\nreturn v + (1.0 - v) * facing * facing2 * facing2;\n}\nfloat Schlick_f(float v, float cosHV) {\nfloat facing = max(1.0 - cosHV, 0.0);\nfloat facing2 = facing * facing;\nreturn v + ( 1.0 - v ) * facing2 * facing2 * facing;\n}",
CutPlanesShaderChunk,"void main() {\n#if NUM_CUTPLANES > 0\nif (checkCutPlanes()) return;\n#endif\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );\n#ifdef USE_MAP\nvec4 texelColor = GET_MAP(vUv);\n#ifdef MAP_INVERT\ntexelColor.xyz = 1.0-texelColor.xyz;\n#endif\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif\n#ifdef USE_ALPHAMAP\nvec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\ngl_FragColor.a *= texelAlpha.r;\n#endif\n#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif\nfloat specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = GET_SPECULARMAP(vUv);\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif\n#ifndef FLAT_SHADED\nvec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#else\nvec3 fdx = dFdx( vViewPosition );\nvec3 fdy = dFdy( vViewPosition );\nvec3 normal = normalize( cross( fdx, fdy ) );\n#endif\nvec3 geomNormal = normal;\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\nvec3 viewDirection;\nif (projectionMatrix[3][3] == 0.0) {\nviewDirection = normalize( vViewPosition );\n} else {\nviewDirection = vec3(0.0, 0.0, 1.0);\n}\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\nfloat shininessB = shininess * 4.0;\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewDirection );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\nfloat specularNormalization = shininessB * 0.125 + 0.25;\nvec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\npointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\n}\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewDirection );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\nfloat specularNormalization = shininessB * 0.125 + 0.25;\nvec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\nspotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n}\n}\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewDirection );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\nfloat specularNormalization = shininessB * 0.125 + 0.25;\nvec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\ndirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n}\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#ifdef USE_IRRADIANCEMAP\nvec3 worldNormal = mat3(viewMatrixInverse) * normal;\nvec4 cubeColor4 = textureCube(irradianceMap, vec3(worldNormal.xy, -worldNormal.z));\n#ifdef IRR_GAMMA\nvec3 indirectDiffuse = GammaDecode(cubeColor4, envMapExposure);\n#elif defined(IRR_RGBM)\nvec3 indirectDiffuse = RGBMDecode(cubeColor4, envMapExposure);\n#else\nvec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\nindirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\ntotalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\n#endif\n#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif\n#if defined(USE_ENVMAP)\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n#ifdef ENVMAP_MODE_REFLECTION\nreflectVec = reflect( -viewDirection, normal );\n#else \nreflectVec = refract( -viewDirection, normal, refractionRatio );\n#endif\n#else\nreflectVec = reflect( -viewDirection, normal );\n#endif\nreflectVec = mat3(viewMatrixInverse) * reflectVec;\nfloat reflectScale = 1.0;\nvec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\ncubeColor *= reflectScale;\nfloat facing = dot( viewDirection, geomNormal );\nif (facing < -1e-2)\nfacing = 1.0;\nelse\nfacing = max(1e-6, facing);\nvec3 schlickRefl;\n#ifdef METAL\nschlickRefl = InputToLinear(specular);\n#else\nschlickRefl = Schlick_v3(InputToLinear(specular), facing);\ngl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\nfloat invSchlick = (1.0 - facing * 0.5);\nfloat invSchlick2 = invSchlick * invSchlick;\nfloat norm_factor = 1.0 - invSchlick * invSchlick2 * invSchlick2;\nnorm_factor = (28.0 / 23.0) * norm_factor;\ngl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\n#endif\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\n#ifdef CLEARCOAT\nvec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\nreflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\nvec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\nfloat schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\ngl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\n#endif\n#endif\n#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif\n#ifdef TONEMAP_OUTPUT\ngl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\n#endif\n#ifdef HATCH_PATTERN\nfloat hatchSlope = hatchParams.x;\nfloat hatchPeriod = hatchParams.y;\nif (abs(hatchSlope) <= 1.0) {\nfloat hatchPhase = gl_FragCoord.y - hatchSlope * gl_FragCoord.x;\nfloat dist = abs(mod((hatchPhase), (hatchPeriod)));\nif (dist < 1.0) {\ngl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n} else {\nfloat hatchPhase = - gl_FragCoord.y / hatchSlope + gl_FragCoord.x;\nfloat dist = abs(mod((hatchPhase), (hatchPeriod)));\nif (dist < 1.0) {\ngl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n}\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, 1.0);\n#elif defined(ID_COLOR)\ngl_FragColor = dbId;\n#endif\n}"].join("\n")},
THREE.ShaderLib.firefly_phong=FireflyPhongShader)}
function init_NormalsShader(){"undefined"===typeof NormalsShader&&(NormalsShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:["varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif",PackNormalsShaderChunk,"void main() {\n#ifdef UNPACK_NORMALS\nvec3 objectNormal = decodeNormal(normal);\n#else\nvec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\nvNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ndepth = mvPosition.z;\nvec4 p_Position = projectionMatrix * mvPosition;\ngl_Position = p_Position;\n}"].join("\n"),fragmentShader:["varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif",
CutPlanesShaderChunk,"void main() {\n#if NUM_CUTPLANES > 0\nif (checkCutPlanes()) return;\n#endif\nvec3 n = vNormal;\nn = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nn = normalize( n );\ngl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}"].join("\n")})}
function init_BackgroundShader(){"undefined"===typeof BackgroundShader&&(BackgroundShader={uniforms:{color1:{type:"v3",value:new THREE.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new THREE.Vector3(1/255,2/255,3/255)}},vertexShader:"uniform vec3 color1;\nuniform vec3 color2;\nvarying vec3 vColor;\nvoid main() {\nif (uv.y == 0.0)\nvColor = color2;\nelse\nvColor = color1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["varying vec3 vColor;",
OrderedDitheringShaderChunk,"void main() {\ngl_FragColor = vec4(orderedDithering(vColor), 1.0);\n}"].join("\n")})}
function init_LineShader(){"undefined"===typeof LineShader&&(LineShader={uniforms:{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new THREE.Vector2(4096,1)}},attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,extraParams:0,instFlags4b:0},defines:{},vertexShader:"#define TAU 6.28318530718\n#define PI 3.14159265358979\n#define HALF_PI 1.57079632679\n#define VBB_LINE_SEGMENT     16.0\n#define VBB_ARC_CIRCULAR     32.0\n#define VBB_ARC_ELLIPTICAL   48.0\n#define VBB_TEX_QUAD         64.0\n#define VBB_ONE_TRIANGLE     80.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  1.0\n#define VBB_SEG_START_LEFT   2.0\n#define VBB_SEG_END_RIGHT    3.0\n#define VBB_SEG_END_LEFT     4.0\nattribute vec3 fields1;\nattribute vec3 fields2;\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nattribute vec4 flags4b;\n#ifdef HAS_ELLIPTICALS\nattribute vec3 extraParams;\n#endif\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\nvarying vec4 outColor;\nvarying vec4 dbId;\nvec2 centralVertex;\nvec2 offsetPosition;\nvarying vec2 offsetDirection;\nvarying vec4 multipurpose;\nvarying float halfWidth;\nvoid strokeLineSegment(float vertexId) {\nfloat distanceAlong = fields2.x;\nfloat isStartCapVertex = (vertexId < VBB_SEG_END_RIGHT) ? -1.0 : 1.0;\nfloat isLeftSide = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? 1.0 : -1.0;\nfloat angleTransverse = fields1.z + isLeftSide * HALF_PI;\nfloat st = sin(angleTransverse);\nfloat ct = cos(angleTransverse);\nfloat lwAdjustment = halfWidth + aaRange;\nvec2 transverseOffset = vec2(ct, st) * lwAdjustment;\noffsetPosition.xy += transverseOffset;\nvec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\noffsetPosition.xy -= moveOffset;\ncentralVertex.xy -= moveOffset;\nfloat distanceFromStart = max(isStartCapVertex, 0.0) * distanceAlong;\nvec2 along = distanceFromStart * vec2(cos(fields1.z), sin(fields1.z));\noffsetPosition.xy += along;\ncentralVertex.xy += along;\nmultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\nmultipurpose.y = distanceAlong;\nmultipurpose.z = 0.0;\n}\n#ifdef HAS_TRIANGLE_GEOMS\nvoid strokeOneTriangle(float vertexId) {\nhalfWidth = 0.0;\nif (vertexId == VBB_SEG_END_RIGHT)\noffsetPosition.xy = vec2(fields1.z, fields2.x);\nelse if (vertexId == VBB_SEG_END_LEFT)\noffsetPosition.xy = fields2.yz;\n}\n#endif\n#ifdef HAS_RASTER_QUADS\nvoid strokeTexQuad(float vertexId) {\nfloat distanceAlong = fields2.x;\nbool isStartCapVertex = (vertexId < VBB_SEG_END_RIGHT);\nfloat isLeftSide = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? 1.0 : -1.0;\nfloat angleTransverse = fields1.z + isLeftSide * HALF_PI;\nmultipurpose.y = distanceAlong;\nfloat st = sin(angleTransverse);\nfloat ct = cos(angleTransverse);\nfloat moveDist = halfWidth;\nvec2 offset = vec2(ct, st) * moveDist;\noffsetPosition.xy += offset;\nmultipurpose.z = 1.0;\nhalfWidth = 0.0;\nif (isStartCapVertex) {\noffsetPosition.xy += isLeftSide * vec2(0.0, offset.x);\nmultipurpose.x = 0.0;\nmultipurpose.y = max(0.0, isLeftSide);\n}\nelse {\nvec2 along = vec2(cos(fields1.z), sin(fields1.z));\noffsetPosition.xy += distanceAlong * along;\ncentralVertex.xy += distanceAlong * along;\noffsetPosition.xy += isLeftSide * vec2(0.0, -offset.x);\nmultipurpose.x = 1.0;\nmultipurpose.y = max(0.0, isLeftSide);\n}\n}\n#endif\n#ifdef HAS_CIRCLES\nvoid strokeCircularArc(float vertexId) {\nvec2 angles = vec2(fields1.z, fields2.x);\nfloat r = fields2.z;\nif (r * pixelsPerUnit < 0.125)\nr = 0.25 * aaRange;\nfloat isStart = (vertexId < VBB_SEG_END_RIGHT) ? -1.0 : 1.0;\nfloat isLeft = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? -1.0 : 1.0;\nvec2 minPt;\nvec2 maxPt;\nvec2 endsX = vec2(fields1.x) + r * cos(angles);\nvec2 endsY = vec2(fields1.y) + r * sin(angles);\nminPt = maxPt = vec2(endsX.x, endsY.x);\nminPt = min(minPt, vec2(endsX.y, endsY.y));\nmaxPt = max(maxPt, vec2(endsX.y, endsY.y));\nfloat start = angles.x;\nfloat end = angles.y;\nif (end > start) {\nif (start < (0.5 * PI) && end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + r));\n}\nif (start < PI && end > PI) {\nminPt = min(minPt, vec2(fields1.x - r, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - r, fields1.y));\n}\nif (start < (1.5 * PI) && end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - r));\n}\n}\nelse {\nminPt = min(minPt, vec2(fields1.x + r, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x + r, fields1.y));\nif (start < (0.5 * PI) || end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + r));\n}\nif (start < PI || end > PI) {\nminPt = min(minPt, vec2(fields1.x - r, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - r, fields1.y));\n}\nif (start < (1.5 * PI) || end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - r));\n}\n}\nminPt -= halfWidth + aaRange;\nmaxPt += halfWidth + aaRange;\nif (isStart<0.0)\noffsetPosition.x = minPt.x;\nelse\noffsetPosition.x = maxPt.x;\nif (isLeft<0.0)\noffsetPosition.y = minPt.y;\nelse\noffsetPosition.y = maxPt.y;\nmultipurpose.x = angles.x;\nmultipurpose.y = -r;\nmultipurpose.z = angles.y;\nmultipurpose.w = -r;\n}\n#endif\n#ifdef HAS_ELLIPTICALS\nvoid strokeEllipticalArc(float vertexId) {\nvec2 angles = vec2(fields1.z, fields2.x);\nfloat isStart = (vertexId < VBB_SEG_END_RIGHT) ? -1.0 : 1.0;\nfloat isLeft = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? -1.0 : 1.0;\nfloat major = fields2.z;\nfloat minor = extraParams.x;\nvec2 minPt;\nvec2 maxPt;\nvec2 endsX = vec2(fields1.x) + major * cos(angles);\nvec2 endsY = vec2(fields1.y) + minor * sin(angles);\nminPt = maxPt = vec2(endsX.x, endsY.x);\nminPt = min(minPt, vec2(endsX.y, endsY.y));\nmaxPt = max(maxPt, vec2(endsX.y, endsY.y));\nfloat start = angles.x;\nfloat end = angles.y;\nif (end > start) {\nif (start < (0.5 * PI) && end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + minor));\n}\nif (start < PI && end > PI) {\nminPt = min(minPt, vec2(fields1.x - major, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - major, fields1.y));\n}\nif (start < (1.5 * PI) && end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - minor));\n}\n}\nelse {\nminPt = min(minPt, vec2(fields1.x + major, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x + major, fields1.y));\nif (start < (0.5 * PI) || end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + minor));\n}\nif (start < PI || end > PI) {\nminPt = min(minPt, vec2(fields1.x - major, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - major, fields1.y));\n}\nif (start < (1.5 * PI) || end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - minor));\n}\n}\nminPt -= halfWidth + aaRange;\nmaxPt += halfWidth + aaRange;\nif (isStart < 0.0)\noffsetPosition.x = minPt.x;\nelse\noffsetPosition.x = maxPt.x;\nif (isLeft < 0.0)\noffsetPosition.y = minPt.y;\nelse\noffsetPosition.y = maxPt.y;\nmultipurpose.x = angles.x;\nmultipurpose.y = -major;\nmultipurpose.z = angles.y;\nmultipurpose.w = minor;\n}\n#endif\n#ifdef SELECTION_RENDERER\nbool isSelected() {\nvec3 oid = dbId4b.rgb * 255.0;\nfloat id01 = oid.r + oid.g * 256.0;\nfloat t = (id01 + 0.5) * (1.0 / 4096.0);\nfloat flrt = floor(t);\nfloat texU = t - flrt;\nfloat id23 = oid.b * (65536.0 / 4096.0) + flrt;\nt = (id23 + 0.5) / vSelTexSize.y;\nfloat texV = fract(t);\nvec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\nreturn selBit.r == 1.0;\n}\n#endif\nbool isLayerOff() {\n#ifdef HAS_LAYERS\nvec4 layerBit = texture2D(tLayerMask, flags4b.ba / 255.0);\nreturn layerBit.r == 0.0;\n#else\nreturn false;\n#endif\n}\nvoid main() {\ncentralVertex = offsetPosition = fields1.xy;\nif (isLayerOff()) {\noutColor = vec4(0.0);\n}\nelse {\nfloat vertexId = mod(flags4b.x, 16.0);\nfloat geomType = flags4b.x - vertexId;\n#ifdef USE_INSTANCING\nvertexId = instFlags4b.x;\n#endif\nfloat lineWeight = fields2.y;\nif (lineWeight > 0.0) {\nif (lineWeight * pixelsPerUnit < 0.5)\nlineWeight = aaRange;\n}\nelse {\nlineWeight = abs(lineWeight) * aaRange * 2.0;\n}\n#ifdef SELECTION_RENDERER\nif (isSelected())\noutColor = vec4(0.0,0.0,1.0,1.0);\nelse\noutColor = vec4(0.0);\n#else\noutColor = color4b;\n#endif\nhalfWidth = lineWeight;\ndbId = dbId4b;\nif (geomType == VBB_LINE_SEGMENT)\nstrokeLineSegment(vertexId);\n#ifdef HAS_CIRCLES\nelse if (geomType == VBB_ARC_CIRCULAR)\nstrokeCircularArc(vertexId);\n#endif\n#ifdef HAS_ELLIPTICALS\nelse if (geomType == VBB_ARC_ELLIPTICAL)\nstrokeEllipticalArc(vertexId);\n#endif\n#ifdef HAS_RASTER_QUADS\nelse if (geomType == VBB_TEX_QUAD)\nstrokeTexQuad(vertexId);\n#endif\n#ifdef HAS_TRIANGLE_GEOMS\nelse if (geomType == VBB_ONE_TRIANGLE)\nstrokeOneTriangle(vertexId);\n#endif\nelse {\nhalfWidth = 0.0;\nmultipurpose.z = 0.0;\n}\n}\noffsetDirection = offsetPosition - centralVertex;\ngl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n}",
fragmentShader:"#define TAU 6.28318530717958\n#define PI  3.14159265358979\nuniform float pixelsPerUnit;\nuniform float aaRange;\n#ifdef HAS_RASTER_QUADS\nuniform sampler2D tRaster;\n#endif\nvarying vec4 outColor;\nvarying vec4 dbId;\nvarying vec2 offsetDirection;\nvarying vec4 multipurpose;\nvarying float halfWidth;\nfloat curveGaussian(float r, float invWidth) {\nfloat amt = clamp(r * invWidth, 0.0, 1.0);\nfloat exponent = amt * 3.5;\nreturn exp(-exponent*exponent);\n}\nvoid fillLineSegment() {\nfloat radius = halfWidth;\nfloat parametricDistance = multipurpose.x;\nfloat segmentLength = multipurpose.y;\nfloat dist;\nfloat offsetLength2 = dot(offsetDirection, offsetDirection);\nfloat ltz = max(0.0, sign(-parametricDistance));\nfloat gtsl = max(0.0, sign(parametricDistance - segmentLength));\nfloat d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\ndist = sqrt(max(0.0, offsetLength2 + d*d));\nfloat range =  dist - radius;\nif (range > aaRange) {\ndiscard;\n}\ngl_FragColor = outColor;\ngl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\n#ifdef HAS_CIRCLES\nvoid fillCircularArc() {\nfloat dist = length(offsetDirection);\nfloat radius = abs(multipurpose.y);\nfloat range =  abs(dist - radius);\nrange -= halfWidth;\nif (range > aaRange) {\ndiscard;\n}\nvec2 angles = multipurpose.xz;\nvec2 direction = offsetDirection;\nfloat angle = atan(direction.y, direction.x);\nif (angles.x > angles.y)\nangles.x -= TAU;\nelse if (angle < 0.0)\nangle += TAU;\nif (angle > angles.x && angle < angles.y) {\ngl_FragColor = outColor;\ngl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\nelse {\ndiscard;\n}\n}\n#endif\n#ifdef HAS_ELLIPTICALS\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\nfloat dist;\nvec2 esqr = e * e;\nvec2 ey = e * y;\nfloat t0 = -esqr[1] + ey[1];\nfloat t1 = -esqr[1] + length(ey);\nfloat t;\nvec2 r;\nfor (int i = 0; i < 6; ++i) {\nt = mix(t0, t1, 0.5);//0.5*(t0 + t1);\nr = ey / (vec2(t) + esqr);\nvec2 rsq = r * r;\nfloat f = rsq[0] + rsq[1] - 1.0;\nfloat fsign = sign(f);\nt0 = mix(t0, t, max(0.0, fsign));\nt1 = mix(t1, t, max(0.0, -fsign));\n}\nx = e * r;\ndist = distance(x, y);\nif (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\nreturn dist;\nfor (int i = 0; i < 6; ++i) {\nt = mix(t0, t1, 0.5);//0.5*(t0 + t1);\nr = ey / (vec2(t) + esqr);\nvec2 rsq = r * r;\nfloat f = rsq[0] + rsq[1] - 1.0;\nfloat fsign = sign(f);\nt0 = mix(t0, t, max(0.0, fsign));\nt1 = mix(t1, t, max(0.0, -fsign));\n}\nx = e * r;\ndist = distance(x, y);\nfloat ecc = 1.0 +  0.1 * e[0] / e[1];\nif (dist > max(ecc * (width + aaRange), e[0] * 0.001))\nreturn dist;\nif (dist < (width - aaRange) / ecc)\nreturn dist;\nfor (int i = 0; i < 10; ++i) {\nt = mix(t0, t1, 0.5);//0.5*(t0 + t1);\nr = ey / (vec2(t) + esqr);\nvec2 rsq = r * r;\nfloat f = rsq[0] + rsq[1] - 1.0;\nfloat fsign = sign(f);\nt0 = mix(t0, t, max(0.0, fsign));\nt1 = mix(t1, t, max(0.0, -fsign));\n}\nx = e * r;\ndist = distance(x, y);\nreturn dist;\n}\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\nvec2 locE, locY;\nfloat diff = sign(e[0] - e[1]);\nvec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\nlocE.x = dot(e, swizzle.xy);\nlocE.y = dot(e, swizzle.yx);\nlocY.x = dot(y, swizzle.xy);\nlocY.y = dot(y, swizzle.yx);\nvec2 refl = sign(locY);\nlocY *= refl;\nvec2 x;\nfloat distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\nx *= refl;\nlocX.x = dot(x, swizzle.xy);\nlocX.y = dot(x, swizzle.yx);\nreturn distance;\n}\nvoid fillEllipticalArc() {\nvec2 radii = abs(multipurpose.yw);\nvec2 dir = offsetDirection;\nvec2 pos;\nfloat range = DistancePointEllipse(radii, dir, pos, halfWidth, aaRange);\nrange -= halfWidth;\nif (range > aaRange)\ndiscard;\nfloat ar = radii[0] / radii[1];\nvec2 angles = multipurpose.xz;\nfloat angle = atan(ar * pos.y, pos.x);\nif (angles.x > angles.y)\nangles.x -= TAU;\nelse if (angle < 0.0)\nangle += TAU;\nif (angle > angles.x && angle < angles.y) {\ngl_FragColor = outColor;\ngl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\nelse {\ndiscard;\n}\n}\n#endif\nvoid main() {\nif (outColor.a == 0.0) {\ndiscard;\n}\nif (halfWidth == 0.0) {\n#ifdef HAS_RASTER_QUADS\nif (multipurpose.z != 0.0)\ngl_FragColor = texture2D(tRaster, multipurpose.xy);\nelse\n#endif\ngl_FragColor = outColor;\n}\nelse if (multipurpose.y < 0.0) {\n#ifdef HAS_CIRCLES\n#ifdef HAS_ELLIPTICALS\nif (multipurpose.y == multipurpose.w)\n#endif\nfillCircularArc();\n#endif\n#ifdef HAS_ELLIPTICALS\n#ifdef HAS_CIRCLES\nelse\n#endif\nfillEllipticalArc();\n#endif\n}\nelse\nfillLineSegment();\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(0, 0, 0, 0.0);\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, 1.0);\n#elif defined(ID_COLOR)\ngl_FragColor = dbId;\n#endif\n}"})}
FireflyWebGLProgram=function(){var a=0,b=function(a,b,g,d,h){d=d?"1.0-":"";var k="texture2D("+a+", (UV))",m="";h=h||"vec4(0.0)";b&&g?m="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+h+" : ":b?m="((UV).x < 0.0 || (UV).x > 1.0) ? "+h+" : ":g&&(m="((UV).y < 0.0 || (UV).y > 1.0) ? "+h+" : ");return"#define GET_"+a.toUpperCase()+"(UV) ("+m+d+k+")"};return function(c,f,g,d){var h=c.context,k=g.defines,m=g.__webglShader.uniforms,n=g.attributes,q=g.__webglShader.vertexShader,l=g.__webglShader.fragmentShader,
p=g.index0AttributeName;void 0===p&&!0===d.morphTargets&&(p="position");var r="SHADOWMAP_TYPE_BASIC";d.shadowMapType===THREE.PCFShadowMap?r="SHADOWMAP_TYPE_PCF":d.shadowMapType===THREE.PCFSoftShadowMap&&(r="SHADOWMAP_TYPE_PCF_SOFT");var A=0<c.gammaFactor?c.gammaFactor:1,C,H;C=[];for(var z in k)H=k[z],!1!==H&&(H="#define "+z+" "+H,C.push(H));C=C.join("\n");k=h.createProgram();g instanceof THREE.RawShaderMaterial?c=g="":(g=["precision "+d.precision+" float;","precision "+d.precision+" int;",C,d.supportsVertexTextures?
"#define VERTEX_TEXTURES":"",c.gammaInput?"#define GAMMA_INPUT":"",c.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+A,d.mrtNormals?"#define MRT_NORMALS":"",d.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,"#define MAX_SPOT_LIGHTS "+d.maxSpotLights,"#define MAX_HEMI_LIGHTS "+d.maxHemiLights,"#define MAX_SHADOWS "+d.maxShadows,"#define MAX_BONES "+d.maxBones,"#define NUM_CUTPLANES "+d.numCutplanes,d.map?"#define USE_MAP":
"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define ENVMAP_MODE_REFLECTION":"",d.irradianceMap?"#define USE_IRRADIANCEMAP":"",d.lightMap?"#define USE_LIGHTMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.skinning?"#define USE_SKINNING":"",d.useVertexTexture?"#define BONE_TEXTURE":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals?"#define USE_MORPHNORMALS":
"",d.wrapAround?"#define WRAP_AROUND":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+r:"",d.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",d.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",d.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\n#ifdef UNPACK_NORMALS\nattribute vec2 normal;\n#else\nattribute vec3 normal;\n#endif\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n"].join("\n"),
c=[d.bumpMap||d.normalMap?"#extension GL_OES_standard_derivatives : enable":"",!d.mrtIdBuffer&&!d.mrtNormals||"undefined"!==typeof _isIE11&&_isIE11?"":"#extension GL_EXT_draw_buffers : enable",d.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",d.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",C,"#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,"#define MAX_SPOT_LIGHTS "+d.maxSpotLights,"#define MAX_HEMI_LIGHTS "+d.maxHemiLights,"#define MAX_SHADOWS "+d.maxShadows,
"#define NUM_CUTPLANES "+d.numCutplanes,d.alphaTest?"#define ALPHATEST "+d.alphaTest:"",c.gammaInput?"#define GAMMA_INPUT":"",c.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+A,d.mrtNormals?"#define MRT_NORMALS":"",d.mrtIdBuffer?"#define MRT_ID_BUFFER":"",d.tonemapOutput?"#define TONEMAP_OUTPUT":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define ENVMAP_TYPE_CUBE":"",d.envMap?
"#define ENVMAP_MODE_REFLECTION":"",d.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",d.irradianceMap?"#define USE_IRRADIANCEMAP":"",d.envGammaEncoded?"#define ENV_GAMMA":"",d.irrGammaEncoded?"#define IRR_GAMMA":"",d.envRGBM?"#define ENV_RGBM":"",d.irrRGBM?"#define IRR_RGBM":"",d.lightMap?"#define USE_LIGHTMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":
"",d.metal?"#define METAL":"",d.clearcoat?"#define CLEARCOAT":"",d.wrapAround?"#define WRAP_AROUND":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+r:"",d.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",d.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.hatchPattern?"#define HATCH_PATTERN":"",d.mapInvert?"#define MAP_INVERT":"",b("map",d.mapClampS,
d.mapClampT,!1,"vec4(vec3(0.0), 1.0)"),b("bumpMap",d.bumpMapClampS,d.bumpMapClampT),b("normalMap",d.normalMapClampS,d.normalMapClampT),b("specularMap",d.specularMapClampS,d.specularMapClampT),b("alphaMap",d.alphaMapClampS,d.alphaMapClampT,d.alphaMapInvert),"#ifdef USE_ENVMAP\n#ifdef HAVE_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#endif\n#extension GL_OES_standard_derivatives : enable","precision "+d.precision+" float;","precision "+d.precision+" int;","uniform highp mat4 viewMatrix;\nuniform highp mat4 projectionMatrix;\nuniform highp vec3 cameraPosition;\n#ifdef USE_ENVMAP\nuniform mat4 viewMatrixInverse;\n#endif\n"].join("\n"));
q=new THREE.WebGLShader(h,h.VERTEX_SHADER,g+q);l=new THREE.WebGLShader(h,h.FRAGMENT_SHADER,c+l);h.attachShader(k,q);h.attachShader(k,l);void 0!==p&&h.bindAttribLocation(k,0,p);h.linkProgram(k);!1===h.getProgramParameter(k,h.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",h.getProgramParameter(k,h.VALIDATE_STATUS)),console.error("gl.getError()",h.getError()));""!==h.getProgramInfoLog(k)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",
h.getProgramInfoLog(k));h.deleteShader(q);h.deleteShader(l);p="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition viewMatrixInverse mvpMatrix dbId".split(" ");d.logarithmicDepthBuffer&&p.push("logDepthBufFC");for(var t in m)p.push(t);d=p;m={};t=0;for(p=d.length;t<p;t++)c=d[t],m[c]=h.getUniformLocation(k,c);this.uniforms=m;var p="position normal uv uv2 tangent color lineDistance".split(" "),w;for(w in n)p.push(w);n=p;w={};d=0;for(m=n.length;d<m;d++)t=n[d],w[t]=h.getAttribLocation(k,
t);this.attributes=w;this.attributesKeys=Object.keys(this.attributes);this.id=a++;this.code=f;this.usedTimes=1;this.program=k;this.vertexShader=q;this.fragmentShader=l;return this}}();
FireflyWebGLRenderer=function(a){function b(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function c(a){return a instanceof THREE.MeshBasicMaterial&&!a.envMap||a instanceof THREE.MeshDepthMaterial?!1:a&&void 0!==a.shading&&a.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function f(a){return a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a instanceof THREE.ShaderMaterial?!0:!1}function g(a,b){var c=
Ea[a];c||(c=v.createBuffer(),Ea[a]=c);v.bindBuffer(v.ARRAY_BUFFER,c);v.bufferData(v.ARRAY_BUFFER,b,v.DYNAMIC_DRAW);return c}function d(a,b,c,d,f){var h=b.attributes;b=b.attributesKeys;var k=0,l=void 0;if(f)if(!f.buffer&&c.streamingDraw){var m=Ea.index;m||(m=v.createBuffer(),Ea.index=m);v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,m);v.bufferData(v.ELEMENT_ARRAY_BUFFER,f.array||c.ib,v.DYNAMIC_DRAW)}else v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,c.ibbuffer||f.buffer);f=0;for(m=b.length;f<m;f++){var n=b[f],q=h[n];
if(0<=q){var z=c.attributes[n];if(z){var p=void 0!==z.itemOffset,t,w;p?(t=c.vbstride,w=z.itemOffset,k!==l&&(c.streamingDraw?k=g("interleavedVB",c.vb):(k=c.vbbuffer,v.bindBuffer(v.ARRAY_BUFFER,k)),l=k)):(t=z.itemSize,w=0,c.streamingDraw?k=g(n,z.array):(k=z.buffer,v.bindBuffer(v.ARRAY_BUFFER,k)));var n=v.FLOAT,L=z.bytesPerItem||4;1===L?n=v.UNSIGNED_BYTE:2===L&&(n=v.UNSIGNED_SHORT);p&&(L=4);ka.enableAttribute(q);v.vertexAttribPointer(q,z.itemSize,n,z.normalize,t*L,(w+d*t)*L);wa&&c.numInstances&&wa.vertexAttribDivisorANGLE(q,
z.divisor||0)}else a.defaultAttributeValues&&((z=a.defaultAttributeValues[n])&&2===z.length?v.vertexAttrib2fv(q,a.defaultAttributeValues[n]):z&&3===z.length&&v.vertexAttrib3fv(q,a.defaultAttributeValues[n]))}}ka.disableUnusedAttributes()}function h(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-
b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function m(a){q(a,!0)}function n(a){q(a,!1)}function q(a,b,c){if(c||!1!==a.visible){if(!(a instanceof THREE.Scene||a instanceof THREE.Group))if(a instanceof RenderBatch)a.forEach(b?m:n);else{void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("removed",Ra));var d=a.geometry;if(void 0!==d&&void 0===d.__webglInit&&(d.__webglInit=!0,d.addEventListener("dispose",Pa),!(d instanceof THREE.BufferGeometry)))if(a instanceof THREE.Mesh)r(a,d);else if(a instanceof
THREE.Line&&void 0===d.__webglVertexBuffer){d.__webglVertexBuffer=v.createBuffer();d.__webglColorBuffer=v.createBuffer();d.__webglLineDistanceBuffer=v.createBuffer();ba.info.memory.geometries++;var f=d.vertices.length;d.__vertexArray=new Float32Array(3*f);d.__colorArray=new Float32Array(3*f);d.__lineDistanceArray=new Float32Array(1*f);d.__webglLineCount=f;var f=d.vertices.length,g=a.material;if(g.attributes){void 0===d.__webglCustomAttributesList&&(d.__webglCustomAttributesList=[]);for(var h in g.attributes){var k=
g.attributes[h];if(!k.__webglInitialized||k.createUniqueBuffers){k.__webglInitialized=!0;var l=1;"v2"===k.type?l=2:"v3"===k.type?l=3:"v4"===k.type?l=4:"c"===k.type&&(l=3);k.size=l;k.array=new Float32Array(f*l);k.buffer=v.createBuffer();k.buffer.belongsToAttribute=h;k.needsUpdate=!0}d.__webglCustomAttributesList.push(k)}}d.verticesNeedUpdate=!0;d.colorsNeedUpdate=!0;d.lineDistancesNeedUpdate=!0}if(void 0===a.__webglActive)if(a.__webglActive=!0,a instanceof THREE.Mesh)if(d instanceof THREE.BufferGeometry)A(V,
d,a);else{if(d instanceof THREE.Geometry)for(d=ab[d.id],h=0,f=d.length;h<f;h++)A(V,d[h],a)}else a instanceof THREE.Line||a instanceof THREE.PointCloud?A(V,d,a):(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)&&ca.push({id:null,object:a,opaque:null,transparent:null,z:0});if(a instanceof THREE.Light)ea.push(a);else if((d=V[a.id])&&(!1===a.frustumCulled||!0===Na.intersectsObject(a)))for(h=0,f=d.length;h<f;h++){var k=g=d[h],z=k.object,l=k.buffer,p=z.geometry,z=z.material;z instanceof
THREE.MeshFaceMaterial?(z=z.materials[p instanceof THREE.BufferGeometry?0:l.materialIndex],k.material=z,z.transparent?da.push(k):ha.push(k)):z&&(k.material=z,z.transparent?da.push(k):ha.push(k));g.render=!0;!0===b&&(ga.setFromMatrixPosition(a.matrixWorld),ga.applyProjection(na),g.z=ga.z)}}if(a.children)for(h=0,f=a.children.length;h<f;h++)q(a.children[h],b,c)}}function l(a,b,c,d,f){for(var g,h=0,k=a.length;h<k;h++){g=a[h];var l=g.object,m=g.buffer;if(f)g=f;else{g=g.material;if(!g)continue;t(g)}ba.setMaterialFaces(g);
m instanceof THREE.BufferGeometry?ba.renderBufferDirect(b,c,d,g,m,l):ba.renderBuffer(b,c,d,g,m,l)}}function p(a,b){if(a.visible){var c;if($a)c=$a;else{c=a.material;if(!c)return;t(c)}ba.setMaterialFaces(c);ba.renderBufferDirect(lb,gb,zb,c,a.geometry,a)}}function r(a,d){var g=a.material,h=!1;if(void 0===ab[d.id]||!0===d.groupsNeedUpdate){delete V[a.id];for(var k=ab,l=d.id,g=g instanceof THREE.MeshFaceMaterial,m=ma.get("OES_element_index_uint")?4294967296:65535,n,h={},q=d.morphTargets?d.morphTargets.length:
0,z=d.morphNormals?d.morphNormals.length:0,p,t={},w=[],L=0,r=d.faces.length;L<r;L++){n=d.faces[L];var da=g?n.materialIndex:0;da in h||(h[da]={hash:da,counter:0});n=h[da].hash+"_"+h[da].counter;n in t||(p={id:yb++,faces3:[],materialIndex:da,vertices:0,numMorphTargets:q,numMorphNormals:z},t[n]=p,w.push(p));t[n].vertices+3>m&&(h[da].counter+=1,n=h[da].hash+"_"+h[da].counter,n in t||(p={id:yb++,faces3:[],materialIndex:da,vertices:0,numMorphTargets:q,numMorphNormals:z},t[n]=p,w.push(p)));t[n].faces3.push(L);
t[n].vertices+=3}k[l]=w;d.groupsNeedUpdate=!1}k=ab[d.id];l=0;for(g=k.length;l<g;l++){m=k[l];if(void 0===m.__webglVertexBuffer){h=m;h.__webglVertexBuffer=v.createBuffer();h.__webglNormalBuffer=v.createBuffer();h.__webglTangentBuffer=v.createBuffer();h.__webglColorBuffer=v.createBuffer();h.__webglUVBuffer=v.createBuffer();h.__webglUV2Buffer=v.createBuffer();h.__webglSkinIndicesBuffer=v.createBuffer();h.__webglSkinWeightsBuffer=v.createBuffer();h.__webglFaceBuffer=v.createBuffer();h.__webglLineBuffer=
v.createBuffer();ba.info.memory.geometries++;h=m;w=a;L=w.geometry;z=h.faces3;q=3*z.length;t=1*z.length;r=3*z.length;z=b(w,h);n=f(z);p=c(z);da=z.vertexColors?z.vertexColors:!1;h.__vertexArray=new Float32Array(3*q);p&&(h.__normalArray=new Float32Array(3*q));L.hasTangents&&(h.__tangentArray=new Float32Array(4*q));da&&(h.__colorArray=new Float32Array(3*q));n&&(0<L.faceVertexUvs.length&&(h.__uvArray=new Float32Array(2*q)),1<L.faceVertexUvs.length&&(h.__uv2Array=new Float32Array(2*q)));w.geometry.skinWeights.length&&
w.geometry.skinIndices.length&&(h.__skinIndexArray=new Float32Array(4*q),h.__skinWeightArray=new Float32Array(4*q));w=null!==ma.get("OES_element_index_uint")&&21845<t?Uint32Array:Uint16Array;h.__typeArray=w;h.__faceArray=new w(3*t);h.__lineArray=new w(2*r);h.__webglFaceCount=3*t;h.__webglLineCount=2*r;if(z.attributes)for(t in void 0===h.__webglCustomAttributesList&&(h.__webglCustomAttributesList=[]),t=void 0,z.attributes){var w=z.attributes[t],L={},B;for(B in w)L[B]=w[B];if(!L.__webglInitialized||
L.createUniqueBuffers)L.__webglInitialized=!0,r=1,"v2"===L.type?r=2:"v3"===L.type?r=3:"v4"===L.type?r=4:"c"===L.type&&(r=3),L.size=r,L.array=new Float32Array(q*r),L.buffer=v.createBuffer(),L.buffer.belongsToAttribute=t,w.needsUpdate=!0,L.__original=w;h.__webglCustomAttributesList.push(L)}h.__inittedArrays=!0;d.verticesNeedUpdate=!0;d.morphTargetsNeedUpdate=!0;d.elementsNeedUpdate=!0;d.uvsNeedUpdate=!0;d.normalsNeedUpdate=!0;d.tangentsNeedUpdate=!0;h=d.colorsNeedUpdate=!0}else h=!1;(h||void 0===a.__webglActive)&&
A(V,m,a)}a.__webglActive=!0}function A(a,b,c){var d=c.id;a[d]=a[d]||[];a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function C(a){var d=a.geometry,g,h;if(d instanceof THREE.BufferGeometry)if(d.streamingDraw){if(!d.streamingIndex){var k=d.attributes.index;k&&(k.buffer=v.createBuffer(),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,k.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,k.array||d.ib,v.STATIC_DRAW))}}else{d.vb&&void 0===d.vbbuffer&&(d.vbbuffer=v.createBuffer(),d.vbNeedsUpdate=!0);d.ib&&void 0===
d.ibbuffer&&(d.ibbuffer=v.createBuffer(),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,d.ibbuffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.ib,v.STATIC_DRAW));for(var l=d.attributes,m=d.attributesKeys,n=0,q=m.length;n<q;n++){var p=m[n],t=l[p],w="index"===p;t.array&&void 0===t.buffer&&(t.buffer=v.createBuffer(),t.needsUpdate=!0);if(!0===t.needsUpdate){var L=w?v.ELEMENT_ARRAY_BUFFER:v.ARRAY_BUFFER;v.bindBuffer(L,t.buffer);v.bufferData(L,t.array,v.STATIC_DRAW);t.needsUpdate=!1}}d.vbNeedsUpdate&&(v.bindBuffer(v.ARRAY_BUFFER,
d.vbbuffer),v.bufferData(v.ARRAY_BUFFER,d.vb,v.STATIC_DRAW),d.vbNeedsUpdate=!1)}else if(a instanceof THREE.Mesh){!0===d.groupsNeedUpdate&&r(a,d);for(var da=ab[d.id],B=0,E=da.length;B<E;B++){var K=da[B];h=b(a,K);g=h.attributes&&H(h);if(d.verticesNeedUpdate||d.morphTargetsNeedUpdate||d.elementsNeedUpdate||d.uvsNeedUpdate||d.normalsNeedUpdate||d.colorsNeedUpdate||d.tangentsNeedUpdate||g){var D=K,ba=a,ha=v.DYNAMIC_DRAW,J=!d.dynamic,A=h;if(D.__inittedArrays){var C=c(A),ea=A.vertexColors?A.vertexColors:
!1,O=f(A),R=C===THREE.SmoothShading,F=void 0,V=void 0,za=void 0,G=void 0,X=void 0,ca=void 0,I=void 0,Ha=void 0,aa=void 0,W=void 0,M=void 0,Y=void 0,P=void 0,la=void 0,N=void 0,fa=void 0,U=void 0,Fa=void 0,qa=void 0,Z=void 0,S=void 0,sa=void 0,xa=void 0,ga=void 0,Ka=void 0,ia=0,ja=0,Ja=0,Ba=0,Da=0,Aa=0,na=0,Ea=0,ma=0,T=0,ka=void 0,oa=D.__vertexArray,Na=D.__uvArray,Ga=D.__uv2Array,ua=D.__normalArray,wa=D.__tangentArray,ya=D.__colorArray,Oa=D.__webglCustomAttributesList,Q=void 0,Ma=D.__faceArray,Ia=
D.__lineArray,Qa=ba.geometry,Ra=Qa.elementsNeedUpdate,Pa=Qa.uvsNeedUpdate,Wa=Qa.normalsNeedUpdate,Xa=Qa.tangentsNeedUpdate,bb=Qa.colorsNeedUpdate,Va=Qa.vertices,pa=D.faces3,Za=Qa.faces,Ya=Qa.faceVertexUvs[0],$a=Qa.faceVertexUvs[1];if(Qa.verticesNeedUpdate){F=0;for(V=pa.length;F<V;F++)G=Za[pa[F]],Y=Va[G.a],P=Va[G.b],la=Va[G.c],oa[ja]=Y.x,oa[ja+1]=Y.y,oa[ja+2]=Y.z,oa[ja+3]=P.x,oa[ja+4]=P.y,oa[ja+5]=P.z,oa[ja+6]=la.x,oa[ja+7]=la.y,oa[ja+8]=la.z,ja+=9;v.bindBuffer(v.ARRAY_BUFFER,D.__webglVertexBuffer);
v.bufferData(v.ARRAY_BUFFER,oa,ha)}if(bb&&ea){F=0;for(V=pa.length;F<V;F++)G=Za[pa[F]],I=G.vertexColors,Ha=G.color,3===I.length&&ea===THREE.VertexColors?(Fa=I[0],qa=I[1],Z=I[2]):Z=qa=Fa=Ha,ya[ma]=Fa.r,ya[ma+1]=Fa.g,ya[ma+2]=Fa.b,ya[ma+3]=qa.r,ya[ma+4]=qa.g,ya[ma+5]=qa.b,ya[ma+6]=Z.r,ya[ma+7]=Z.g,ya[ma+8]=Z.b,ma+=9;0<ma&&(v.bindBuffer(v.ARRAY_BUFFER,D.__webglColorBuffer),v.bufferData(v.ARRAY_BUFFER,ya,ha))}if(Xa&&Qa.hasTangents){F=0;for(V=pa.length;F<V;F++)G=Za[pa[F]],aa=G.vertexTangents,N=aa[0],fa=
aa[1],U=aa[2],wa[na]=N.x,wa[na+1]=N.y,wa[na+2]=N.z,wa[na+3]=N.w,wa[na+4]=fa.x,wa[na+5]=fa.y,wa[na+6]=fa.z,wa[na+7]=fa.w,wa[na+8]=U.x,wa[na+9]=U.y,wa[na+10]=U.z,wa[na+11]=U.w,na+=12;v.bindBuffer(v.ARRAY_BUFFER,D.__webglTangentBuffer);v.bufferData(v.ARRAY_BUFFER,wa,ha)}if(Wa&&C){F=0;for(V=pa.length;F<V;F++)if(G=Za[pa[F]],X=G.vertexNormals,ca=G.normal,3===X.length&&R)for(S=0;3>S;S++)xa=X[S],ua[Aa]=xa.x,ua[Aa+1]=xa.y,ua[Aa+2]=xa.z,Aa+=3;else for(S=0;3>S;S++)ua[Aa]=ca.x,ua[Aa+1]=ca.y,ua[Aa+2]=ca.z,Aa+=
3;v.bindBuffer(v.ARRAY_BUFFER,D.__webglNormalBuffer);v.bufferData(v.ARRAY_BUFFER,ua,ha)}if(Pa&&Ya&&O){F=0;for(V=pa.length;F<V;F++)if(za=pa[F],W=Ya[za],void 0!==W)for(S=0;3>S;S++)ga=W[S],Na[Ja]=ga.x,Na[Ja+1]=ga.y,Ja+=2;0<Ja&&(v.bindBuffer(v.ARRAY_BUFFER,D.__webglUVBuffer),v.bufferData(v.ARRAY_BUFFER,Na,ha))}if(Pa&&$a&&O){F=0;for(V=pa.length;F<V;F++)if(za=pa[F],M=$a[za],void 0!==M)for(S=0;3>S;S++)Ka=M[S],Ga[Ba]=Ka.x,Ga[Ba+1]=Ka.y,Ba+=2;0<Ba&&(v.bindBuffer(v.ARRAY_BUFFER,D.__webglUV2Buffer),v.bufferData(v.ARRAY_BUFFER,
Ga,ha))}if(Ra){F=0;for(V=pa.length;F<V;F++)Ma[Da]=ia,Ma[Da+1]=ia+1,Ma[Da+2]=ia+2,Da+=3,Ia[Ea]=ia,Ia[Ea+1]=ia+1,Ia[Ea+2]=ia,Ia[Ea+3]=ia+2,Ia[Ea+4]=ia+1,Ia[Ea+5]=ia+2,Ea+=6,ia+=3;v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,D.__webglFaceBuffer);v.bufferData(v.ELEMENT_ARRAY_BUFFER,Ma,ha);v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,D.__webglLineBuffer);v.bufferData(v.ELEMENT_ARRAY_BUFFER,Ia,ha)}if(Oa)for(S=0,sa=Oa.length;S<sa;S++)if(Q=Oa[S],Q.__original.needsUpdate){T=0;if(1===Q.size)if(void 0===Q.boundTo||"vertices"===
Q.boundTo)for(F=0,V=pa.length;F<V;F++)G=Za[pa[F]],Q.array[T]=Q.value[G.a],Q.array[T+1]=Q.value[G.b],Q.array[T+2]=Q.value[G.c],T+=3;else{if("faces"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)ka=Q.value[pa[F]],Q.array[T]=ka,Q.array[T+1]=ka,Q.array[T+2]=ka,T+=3}else if(2===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)G=Za[pa[F]],Y=Q.value[G.a],P=Q.value[G.b],la=Q.value[G.c],Q.array[T]=Y.x,Q.array[T+1]=Y.y,Q.array[T+2]=P.x,Q.array[T+3]=P.y,Q.array[T+4]=la.x,Q.array[T+
5]=la.y,T+=6;else{if("faces"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)la=P=Y=ka=Q.value[pa[F]],Q.array[T]=Y.x,Q.array[T+1]=Y.y,Q.array[T+2]=P.x,Q.array[T+3]=P.y,Q.array[T+4]=la.x,Q.array[T+5]=la.y,T+=6}else if(3===Q.size){var va;va="c"===Q.type?["r","g","b"]:["x","y","z"];if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)G=Za[pa[F]],Y=Q.value[G.a],P=Q.value[G.b],la=Q.value[G.c],Q.array[T]=Y[va[0]],Q.array[T+1]=Y[va[1]],Q.array[T+2]=Y[va[2]],Q.array[T+3]=P[va[0]],Q.array[T+4]=
P[va[1]],Q.array[T+5]=P[va[2]],Q.array[T+6]=la[va[0]],Q.array[T+7]=la[va[1]],Q.array[T+8]=la[va[2]],T+=9;else if("faces"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)la=P=Y=ka=Q.value[pa[F]],Q.array[T]=Y[va[0]],Q.array[T+1]=Y[va[1]],Q.array[T+2]=Y[va[2]],Q.array[T+3]=P[va[0]],Q.array[T+4]=P[va[1]],Q.array[T+5]=P[va[2]],Q.array[T+6]=la[va[0]],Q.array[T+7]=la[va[1]],Q.array[T+8]=la[va[2]],T+=9;else if("faceVertices"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)ka=Q.value[pa[F]],Y=ka[0],P=ka[1],la=ka[2],Q.array[T]=
Y[va[0]],Q.array[T+1]=Y[va[1]],Q.array[T+2]=Y[va[2]],Q.array[T+3]=P[va[0]],Q.array[T+4]=P[va[1]],Q.array[T+5]=P[va[2]],Q.array[T+6]=la[va[0]],Q.array[T+7]=la[va[1]],Q.array[T+8]=la[va[2]],T+=9}else if(4===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)G=Za[pa[F]],Y=Q.value[G.a],P=Q.value[G.b],la=Q.value[G.c],Q.array[T]=Y.x,Q.array[T+1]=Y.y,Q.array[T+2]=Y.z,Q.array[T+3]=Y.w,Q.array[T+4]=P.x,Q.array[T+5]=P.y,Q.array[T+6]=P.z,Q.array[T+7]=P.w,Q.array[T+8]=la.x,Q.array[T+
9]=la.y,Q.array[T+10]=la.z,Q.array[T+11]=la.w,T+=12;else if("faces"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)la=P=Y=ka=Q.value[pa[F]],Q.array[T]=Y.x,Q.array[T+1]=Y.y,Q.array[T+2]=Y.z,Q.array[T+3]=Y.w,Q.array[T+4]=P.x,Q.array[T+5]=P.y,Q.array[T+6]=P.z,Q.array[T+7]=P.w,Q.array[T+8]=la.x,Q.array[T+9]=la.y,Q.array[T+10]=la.z,Q.array[T+11]=la.w,T+=12;else if("faceVertices"===Q.boundTo)for(F=0,V=pa.length;F<V;F++)ka=Q.value[pa[F]],Y=ka[0],P=ka[1],la=ka[2],Q.array[T]=Y.x,Q.array[T+1]=Y.y,Q.array[T+2]=Y.z,
Q.array[T+3]=Y.w,Q.array[T+4]=P.x,Q.array[T+5]=P.y,Q.array[T+6]=P.z,Q.array[T+7]=P.w,Q.array[T+8]=la.x,Q.array[T+9]=la.y,Q.array[T+10]=la.z,Q.array[T+11]=la.w,T+=12;v.bindBuffer(v.ARRAY_BUFFER,Q.buffer);v.bufferData(v.ARRAY_BUFFER,Q.array,ha)}J&&(delete D.__inittedArrays,delete D.__colorArray,delete D.__normalArray,delete D.__tangentArray,delete D.__uvArray,delete D.__uv2Array,delete D.__faceArray,delete D.__vertexArray,delete D.__lineArray,delete D.__skinIndexArray,delete D.__skinWeightArray)}}}d.verticesNeedUpdate=
!1;d.morphTargetsNeedUpdate=!1;d.elementsNeedUpdate=!1;d.uvsNeedUpdate=!1;d.normalsNeedUpdate=!1;d.colorsNeedUpdate=!1;d.tangentsNeedUpdate=!1;h.attributes&&z(h)}else if(a instanceof THREE.Line){h=b(a,d);g=h.attributes&&H(h);if(d.verticesNeedUpdate||d.colorsNeedUpdate||d.lineDistancesNeedUpdate||g){var Sa=v.DYNAMIC_DRAW,ob,pb,qb,Ta,ta,Ua,cb=d.vertices,db=d.colors,eb=d.lineDistances,hb=cb.length,jb=db.length,lb=eb.length,rb=d.__vertexArray,sb=d.__colorArray,gb=d.__lineDistanceArray,mb=d.colorsNeedUpdate,
nb=d.lineDistancesNeedUpdate,fb=d.__webglCustomAttributesList,tb,ib,Ca,kb,La,ra;if(d.verticesNeedUpdate){for(ob=0;ob<hb;ob++)Ta=cb[ob],ta=3*ob,rb[ta]=Ta.x,rb[ta+1]=Ta.y,rb[ta+2]=Ta.z;v.bindBuffer(v.ARRAY_BUFFER,d.__webglVertexBuffer);v.bufferData(v.ARRAY_BUFFER,rb,Sa)}if(mb){for(pb=0;pb<jb;pb++)Ua=db[pb],ta=3*pb,sb[ta]=Ua.r,sb[ta+1]=Ua.g,sb[ta+2]=Ua.b;v.bindBuffer(v.ARRAY_BUFFER,d.__webglColorBuffer);v.bufferData(v.ARRAY_BUFFER,sb,Sa)}if(nb){for(qb=0;qb<lb;qb++)gb[qb]=eb[qb];v.bindBuffer(v.ARRAY_BUFFER,
d.__webglLineDistanceBuffer);v.bufferData(v.ARRAY_BUFFER,gb,Sa)}if(fb)for(tb=0,ib=fb.length;tb<ib;tb++)if(ra=fb[tb],ra.needsUpdate&&(void 0===ra.boundTo||"vertices"===ra.boundTo)){ta=0;kb=ra.value.length;if(1===ra.size)for(Ca=0;Ca<kb;Ca++)ra.array[Ca]=ra.value[Ca];else if(2===ra.size)for(Ca=0;Ca<kb;Ca++)La=ra.value[Ca],ra.array[ta]=La.x,ra.array[ta+1]=La.y,ta+=2;else if(3===ra.size)if("c"===ra.type)for(Ca=0;Ca<kb;Ca++)La=ra.value[Ca],ra.array[ta]=La.r,ra.array[ta+1]=La.g,ra.array[ta+2]=La.b,ta+=3;
else for(Ca=0;Ca<kb;Ca++)La=ra.value[Ca],ra.array[ta]=La.x,ra.array[ta+1]=La.y,ra.array[ta+2]=La.z,ta+=3;else if(4===ra.size)for(Ca=0;Ca<kb;Ca++)La=ra.value[Ca],ra.array[ta]=La.x,ra.array[ta+1]=La.y,ra.array[ta+2]=La.z,ra.array[ta+3]=La.w,ta+=4;v.bindBuffer(v.ARRAY_BUFFER,ra.buffer);v.bufferData(v.ARRAY_BUFFER,ra.array,Sa)}}d.verticesNeedUpdate=!1;d.colorsNeedUpdate=!1;d.lineDistancesNeedUpdate=!1;h.attributes&&z(h)}}function H(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;
return!1}function z(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function t(a){!0===a.transparent&&ka.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha);ka.setDepthTest(a.depthTest);ka.setDepthWrite(a.depthWrite);ka.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function w(a,b,c,d,f){var g,h,k,l;Ka=0;if(d.needsUpdate){d.program&&xb(d);d.addEventListener("dispose",ub);var m=Ab[d.type];m?(g=
THREE.ShaderLib[m],d.__webglShader={uniforms:THREE.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}):d.__webglShader={uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader};for(var n=l=k=h=g=0,q=b.length;n<q;n++){var z=b[n];z.onlyShadow||(z instanceof THREE.DirectionalLight&&g++,z instanceof THREE.PointLight&&h++,z instanceof THREE.SpotLight&&k++,z instanceof THREE.HemisphereLight&&l++)}q=n=0;for(z=b.length;q<z;q++){var p=b[q];
p.castShadow&&(p instanceof THREE.SpotLight&&n++,p instanceof THREE.DirectionalLight&&!p.shadowCascade&&n++)}g={precision:W,supportsVertexTextures:Va,haveTextureLod:!!ma.get("EXT_shader_texture_lod"),map:!!d.map,envMap:!!d.envMap,irradianceMap:!!d.irradianceMap,envIsSpherical:d.envMap&&d.envMap.mapping==THREE.SphericalReflectionMapping,envGammaEncoded:d.envMap&&d.envMap.GammaEncoded,irrGammaEncoded:d.irradianceMap&&d.irradianceMap.GammaEncoded,envRGBM:d.envMap&&d.envMap.RGBM,irrRGBM:d.irradianceMap&&
d.irradianceMap.RGBM,lightMap:!!d.lightMap,bumpMap:ma.get("OES_standard_derivatives")&&!!d.bumpMap,normalMap:ma.get("OES_standard_derivatives")&&!!d.normalMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,vertexColors:d.vertexColors,fog:c,useFog:d.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:S,maxDirLights:g,maxPointLights:h,maxSpotLights:k,maxHemiLights:l,maxShadows:n,shadowMapEnabled:ba.shadowMapEnabled&&f.receiveShadow,shadowMapType:ba.shadowMapType,
shadowMapDebug:ba.shadowMapDebug,shadowMapCascade:ba.shadowMapCascade,alphaTest:d.alphaTest,metal:d.metal,clearcoat:d.clearcoat,wrapAround:d.wrapAround,doubleSided:d.side===THREE.DoubleSide,flipSided:d.side===THREE.BackSide,mrtNormals:d.mrtNormals,mrtIdBuffer:d.mrtIdBuffer,tonemapOutput:d.tonemapOutput,packedNormals:d.packedNormals,hatchPattern:!!d.hatchParams,numCutplanes:d.cutplanes?d.cutplanes.length:0,mapInvert:d.map&&d.map.invert,mapClampS:d.map&&d.map.clampS,mapClampT:d.map&&d.map.clampT,bumpMapClampS:d.bumpMap&&
d.bumpMap.clampS,bumpMapClampT:d.bumpMap&&d.bumpMap.clampT,normalMapClampS:d.normalMap&&d.normalMap.clampS,normalMapClampT:d.normalMap&&d.normalMap.clampT,specularMapClampS:d.specularMap&&d.specularMap.clampS,specularMapClampT:d.specularMap&&d.specularMap.clampT,alphaMapInvert:d.alphaMap&&d.alphaMap.invert,alphaMapClampS:d.alphaMap&&d.alphaMap.clampS,alphaMapClampT:d.alphaMap&&d.alphaMap.clampT};h=[];m?h.push(m):(h.push(d.fragmentShader),h.push(d.vertexShader));for(var t in d.defines)h.push(t),h.push(d.defines[t]);
for(var w in g)h.push(w),h.push(g[w]);var m=h.join(),r;w=0;for(t=za.length;w<t;w++)if(h=za[w],h.code===m){r=h;r.usedTimes++;break}void 0===r&&(r=new FireflyWebGLProgram(ba,m,d,g),za.push(r),ba.info.memory.programs=za.length);d.program=r;d.uniformsList=[];for(u in d.__webglShader.uniforms)(w=d.program.uniforms[u])&&d.uniformsList.push([d.__webglShader.uniforms[u],w]);d.needsUpdate=!1}h=g=t=!1;w=d.program;r=w.uniforms;m=d.__webglShader.uniforms;w.id!==Ha&&(v.useProgram(w.program),Ha=w.id,h=g=t=!0);
d.id!==Fa&&(-1===Fa&&(h=!0),Fa=d.id,g=!0);if(t||a!==qa)if(v.uniformMatrix4fv(r.projectionMatrix,!1,a.projectionMatrix.elements),S&&v.uniform1f(r.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==qa&&(qa=a),(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)&&null!==r.cameraPosition&&(ga.setFromMatrixPosition(a.matrixWorld),v.uniform3f(r.cameraPosition,ga.x,ga.y,ga.z)),d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||
d.skinning)null!==r.viewMatrix&&v.uniformMatrix4fv(r.viewMatrix,!1,a.matrixWorldInverse.elements),null!==r.viewMatrixInverse&&v.uniformMatrix4fv(r.viewMatrixInverse,!1,oa.elements),r.mvpMatrix&&v.uniformMatrix4fv(r.mvpMatrix,!1,na.elements),h?(B(m,d),D(m,!0)):D(m,!1);if(g){c&&d.fog&&(m.fogColor.value=c.color,c instanceof THREE.Fog?(m.fogNear.value=c.near,m.fogFar.value=c.far):c instanceof THREE.FogExp2&&(m.fogDensity.value=c.density));if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||
d.lights)Ga&&(h=!0,M(b),Ga=!1),h?(c=Oa,m.ambientLightColor.value=c.ambient,m.directionalLightColor.value=c.directional.colors,m.directionalLightDirection.value=c.directional.positions,m.pointLightColor.value=c.point.colors,m.pointLightPosition.value=c.point.positions,m.pointLightDistance.value=c.point.distances,m.spotLightColor.value=c.spot.colors,m.spotLightPosition.value=c.spot.positions,m.spotLightDistance.value=c.spot.distances,m.spotLightDirection.value=c.spot.directions,m.spotLightAngleCos.value=
c.spot.anglesCos,m.spotLightExponent.value=c.spot.exponents,m.hemisphereLightSkyColor.value=c.hemi.skyColors,m.hemisphereLightGroundColor.value=c.hemi.groundColors,m.hemisphereLightDirection.value=c.hemi.positions,J(m,!0)):J(m,!1);if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)E(m,d),B(m,d);d instanceof THREE.LineBasicMaterial?(m.diffuse.value=d.color,m.opacity.value=d.opacity):d instanceof THREE.LineDashedMaterial?(m.diffuse.value=
d.color,m.opacity.value=d.opacity,m.dashSize.value=d.dashSize,m.totalSize.value=d.dashSize+d.gapSize,m.scale.value=d.scale):d instanceof THREE.MeshPhongMaterial?(m.shininess.value=d.shininess,c=Math.log(Math.max(1+1E-10,d.shininess)),m.reflMipIndex.value=Math.max(0,-.72134752*c+5.5),m.emissive.value.copy(d.emissive),m.specular.value.copy(d.specular),d.wrapAround&&m.wrapRGB.value.copy(d.wrapRGB),m.exposureBias.value=d.exposureBias):d instanceof THREE.MeshLambertMaterial?(m.emissive.value.copy(d.emissive),
d.wrapAround&&m.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshDepthMaterial?(m.mNear.value=a.near,m.mFar.value=a.far,m.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial&&(m.opacity.value=d.opacity);if(f.receiveShadow&&!d._shadowPass&&m.shadowMatrix)for(t=c=0,g=b.length;t<g;t++)h=b[t],h.castShadow&&(h instanceof THREE.SpotLight||h instanceof THREE.DirectionalLight&&!h.shadowCascade)&&(m.shadowMap.value[c]=h.shadowMap,m.shadowMapSize.value[c]=h.shadowMapSize,m.shadowMatrix.value[c]=
h.shadowMatrix,m.shadowDarkness.value[c]=h.shadowDarkness,m.shadowBias.value[c]=h.shadowBias,c++);d.cutplanes&&0<d.cutplanes.length&&(m.cutplanes.value=d.cutplanes,m.cutplanesOutlineColor&&d.cutplanesOutlineColor&&(m.cutplanesOutlineColor.value=d.cutplanesOutlineColor),m.cutplanesOutlineThickness&&d.cutplanesOutlineThickness&&(m.cutplanesOutlineThickness.value=d.cutplanesOutlineThickness));d.hatchParams&&m.hatchParams&&m.hatchParams.value.copy(d.hatchParams);b=d.uniformsList;d=0;for(c=b.length;d<
c;d++)if(m=b[d][0],!1!==m.needsUpdate)switch(h=m.type,g=m.value,t=b[d][1],h){case "1i":v.uniform1i(t,g);break;case "1f":v.uniform1f(t,g);break;case "2f":v.uniform2f(t,g[0],g[1]);break;case "3f":v.uniform3f(t,g[0],g[1],g[2]);break;case "4f":v.uniform4f(t,g[0],g[1],g[2],g[3]);break;case "1iv":v.uniform1iv(t,g);break;case "3iv":v.uniform3iv(t,g);break;case "1fv":v.uniform1fv(t,g);break;case "2fv":v.uniform2fv(t,g);break;case "3fv":v.uniform3fv(t,g);break;case "4fv":v.uniform4fv(t,g);break;case "Matrix3fv":v.uniformMatrix3fv(t,
!1,g);break;case "Matrix4fv":v.uniformMatrix4fv(t,!1,g);break;case "i":v.uniform1i(t,g);break;case "f":v.uniform1f(t,g);break;case "v2":v.uniform2f(t,g.x,g.y);break;case "v3":v.uniform3f(t,g.x,g.y,g.z);break;case "v4":v.uniform4f(t,g.x,g.y,g.z,g.w);break;case "c":v.uniform3f(t,g.r,g.g,g.b);break;case "iv1":v.uniform1iv(t,g);break;case "iv":v.uniform3iv(t,g);break;case "fv1":v.uniform1fv(t,g);break;case "fv":v.uniform3fv(t,g);break;case "v2v":void 0===m._array&&(m._array=new Float32Array(2*g.length));
h=0;for(k=g.length;h<k;h++)l=2*h,m._array[l]=g[h].x,m._array[l+1]=g[h].y;v.uniform2fv(t,m._array);break;case "v3v":void 0===m._array&&(m._array=new Float32Array(3*g.length));h=0;for(k=g.length;h<k;h++)l=3*h,m._array[l]=g[h].x,m._array[l+1]=g[h].y,m._array[l+2]=g[h].z;v.uniform3fv(t,m._array);break;case "v4v":void 0===m._array&&(m._array=new Float32Array(4*g.length));h=0;for(k=g.length;h<k;h++)l=4*h,m._array[l]=g[h].x,m._array[l+1]=g[h].y,m._array[l+2]=g[h].z,m._array[l+3]=g[h].w;v.uniform4fv(t,m._array);
break;case "m3":v.uniformMatrix3fv(t,!1,g.elements);break;case "m3v":void 0===m._array&&(m._array=new Float32Array(9*g.length));h=0;for(k=g.length;h<k;h++)g[h].flattenToArrayOffset(m._array,9*h);v.uniformMatrix3fv(t,!1,m._array);break;case "m4":v.uniformMatrix4fv(t,!1,g.elements);break;case "m4v":void 0===m._array&&(m._array=new Float32Array(16*g.length));h=0;for(k=g.length;h<k;h++)g[h].flattenToArrayOffset(m._array,16*h);v.uniformMatrix4fv(t,!1,m._array);break;case "t":l=g;g=F();v.uniform1i(t,g);
if(!l)continue;if(l instanceof THREE.CubeTexture||l.image instanceof Array&&6===l.image.length){if(m=l,t=g,6===m.image.length)if(m.needsUpdate){m.image.__webglTextureCube||(m.addEventListener("dispose",Ia),m.image.__webglTextureCube=v.createTexture(),ba.info.memory.textures++);v.activeTexture(v.TEXTURE0+t);v.bindTexture(v.TEXTURE_CUBE_MAP,m.image.__webglTextureCube);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,m.flipY);t=m instanceof THREE.CompressedTexture;g=m.image[0]instanceof THREE.DataTexture;h=[];for(k=
0;6>k;k++)h[k]=!ba.autoScaleCubemaps||t||g?g?m.image[k].image:m.image[k]:L(m.image[k],fb);k=h[0];l=THREE.Math.isPowerOfTwo(k.width)&&THREE.Math.isPowerOfTwo(k.height);n=O(m.format);q=O(m.type);I(v.TEXTURE_CUBE_MAP,m,l);for(k=0;6>k;k++)if(t)for(var p=h[k].mipmaps,da=0,K=p.length;da<K;da++)z=p[da],m.format!==THREE.RGBAFormat&&m.format!==THREE.RGBFormat?-1<Ya().indexOf(n)?v.compressedTexImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,da,n,z.width,z.height,0,z.data):console.warn("Attempt to load unsupported compressed texture format"):
v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,da,n,z.width,z.height,0,n,q,z.data);else g?v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,n,h[k].width,h[k].height,0,n,q,h[k].data):v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,n,n,q,h[k]);m.generateMipmaps&&l&&v.generateMipmap(v.TEXTURE_CUBE_MAP);m.needsUpdate=!1;if(m.onUpdate)m.onUpdate()}else v.activeTexture(v.TEXTURE0+t),v.bindTexture(v.TEXTURE_CUBE_MAP,m.image.__webglTextureCube)}else l instanceof THREE.WebGLRenderTargetCube?(m=l,v.activeTexture(v.TEXTURE0+
g),v.bindTexture(v.TEXTURE_CUBE_MAP,m.__webglTexture)):ba.setTexture(l,g);break;case "tv":void 0===m._array&&(m._array=[]);h=0;for(k=m.value.length;h<k;h++)m._array[h]=F();v.uniform1iv(t,m._array);h=0;for(k=m.value.length;h<k;h++)l=m.value[h],g=m._array[h],l&&ba.setTexture(l,g);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}Y.multiplyMatrices(a.matrixWorldInverse,f.matrixWorld);v.uniformMatrix4fv(r.modelViewMatrix,!1,Y.elements);r.normalMatrix&&(sa.getNormalMatrix(Y),
v.uniformMatrix3fv(r.normalMatrix,!1,sa.elements));null!==r.modelMatrix&&v.uniformMatrix4fv(r.modelMatrix,!1,f.matrixWorld.elements);null!==r.dbId&&(a=f.dbId||f.fragId||0,v.uniform4f(r.dbId,(a&255)/255,(a>>8&255)/255,(a>>16&255)/255,(a>>24&255)/255));return w}function E(a,b){function c(a,b,d){var f=d.offset,g=d.repeat;b?(a=b.value,d.matrix?a.copy(d.matrix):a.identity(),a.elements[6]+=f.x,a.elements[7]+=f.y,a.elements[0]*=g.x,a.elements[3]*=g.x,a.elements[1]*=g.y,a.elements[4]*=g.y):a.offsetRepeat.value.set(f.x,
f.y,g.x,g.y)}a.opacity.value=b.opacity;a.diffuse.value.copy(b.color);a.map.value=b.map;a.lightMap.value=b.lightMap;a.specularMap.value=b.specularMap;a.alphaMap.value=b.alphaMap;b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.alphaMap&&c(a,a.texMatrixAlpha,b.alphaMap);var d;b.normalMap?d=b.normalMap:b.bumpMap&&(d=b.bumpMap);void 0!==d&&c(a,a.texMatrixBump,d);var f;b.map?f=b.map:b.specularMap&&
(f=b.specularMap);void 0!==f&&c(a,a.texMatrix,f);a.envMap.value=b.envMap;a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap);a.reflectivity.value=b.reflectivity;a.refractionRatio.value=b.refractionRatio}function B(a,b){a.envMap&&(a.envMap.value=b.envMap);a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap);a.envMapExposure&&(a.envMapExposure.value=b.envMapExposure)}function D(a,b){a.envMap&&(a.envMap.needsUpdate=b);a.irradianceMap&&(a.irradianceMap.needsUpdate=b);a.envMapExposure&&(a.envMapExposure.needsUpdate=
b)}function J(a,b){a.ambientLightColor.needsUpdate=b;a.directionalLightColor.needsUpdate=b;a.directionalLightDirection.needsUpdate=b;a.pointLightColor.needsUpdate=b;a.pointLightPosition.needsUpdate=b;a.pointLightDistance.needsUpdate=b;a.spotLightColor.needsUpdate=b;a.spotLightPosition.needsUpdate=b;a.spotLightDistance.needsUpdate=b;a.spotLightDirection.needsUpdate=b;a.spotLightAngleCos.needsUpdate=b;a.spotLightExponent.needsUpdate=b;a.hemisphereLightSkyColor.needsUpdate=b;a.hemisphereLightGroundColor.needsUpdate=
b;a.hemisphereLightDirection.needsUpdate=b}function F(){var a=Ka;a>=hb&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+hb);Ka+=1;return a}function G(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d}function M(a){var b,c,d,f=0,g=0,h=0,k,l,m,n=Oa,q=n.directional.colors,z=n.directional.positions,t=n.point.colors,p=n.point.positions,w=n.point.distances,L=n.spot.colors,r=n.spot.positions,da=n.spot.distances,B=n.spot.directions,E=n.spot.anglesCos,K=n.spot.exponents,
D=n.hemi.skyColors,v=n.hemi.groundColors,H=n.hemi.positions,ba=0,ha=0,J=0,A=0,C=0,F=0,ea=0,V=0,O=d=0;b=m=O=0;for(c=a.length;b<c;b++)d=a[b],d.onlyShadow||(k=d.color,l=d.intensity,m=d.distance,d instanceof THREE.AmbientLight?d.visible&&(f+=k.r,g+=k.g,h+=k.b):d instanceof THREE.DirectionalLight?(C+=1,d.visible&&(ja.setFromMatrixPosition(d.matrixWorld),ga.setFromMatrixPosition(d.target.matrixWorld),ja.sub(ga),ja.normalize(),d=3*ba,z[d]=ja.x,z[d+1]=ja.y,z[d+2]=ja.z,G(q,d,k,l),ba+=1)):d instanceof THREE.PointLight?
(F+=1,d.visible&&(O=3*ha,G(t,O,k,l),ga.setFromMatrixPosition(d.matrixWorld),p[O]=ga.x,p[O+1]=ga.y,p[O+2]=ga.z,w[ha]=m,ha+=1)):d instanceof THREE.SpotLight?(ea+=1,d.visible&&(O=3*J,G(L,O,k,l),ga.setFromMatrixPosition(d.matrixWorld),r[O]=ga.x,r[O+1]=ga.y,r[O+2]=ga.z,da[J]=m,ja.copy(ga),ga.setFromMatrixPosition(d.target.matrixWorld),ja.sub(ga),ja.normalize(),B[O]=ja.x,B[O+1]=ja.y,B[O+2]=ja.z,E[J]=Math.cos(d.angle),K[J]=d.exponent,J+=1)):d instanceof THREE.HemisphereLight&&(V+=1,d.visible&&(ja.setFromMatrixPosition(d.matrixWorld),
ja.normalize(),m=3*A,H[m]=ja.x,H[m+1]=ja.y,H[m+2]=ja.z,k=d.color,d=d.groundColor,G(D,m,k,l),G(v,m,d,l),A+=1)));b=3*ba;for(c=Math.max(q.length,3*C);b<c;b++)q[b]=0;b=3*ha;for(c=Math.max(t.length,3*F);b<c;b++)t[b]=0;b=3*J;for(c=Math.max(L.length,3*ea);b<c;b++)L[b]=0;b=3*A;for(c=Math.max(D.length,3*V);b<c;b++)D[b]=0;b=3*A;for(c=Math.max(v.length,3*V);b<c;b++)v[b]=0;n.directional.length=ba;n.point.length=ha;n.spot.length=J;n.hemi.length=A;n.ambient[0]=f;n.ambient[1]=g;n.ambient[2]=h}function I(a,b,c){c?
(v.texParameteri(a,v.TEXTURE_WRAP_S,O(b.wrapS)),v.texParameteri(a,v.TEXTURE_WRAP_T,O(b.wrapT)),v.texParameteri(a,v.TEXTURE_MAG_FILTER,O(b.magFilter)),v.texParameteri(a,v.TEXTURE_MIN_FILTER,O(b.minFilter))):(v.texParameteri(a,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(a,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),b.wrapS===THREE.ClampToEdgeWrapping&&b.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+
b.sourceFile+" )"),v.texParameteri(a,v.TEXTURE_MAG_FILTER,K(b.magFilter)),v.texParameteri(a,v.TEXTURE_MIN_FILTER,K(b.minFilter)),b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+b.sourceFile+" )"));(c=ma.get("EXT_texture_filter_anisotropic"))&&b.type!==THREE.FloatType&&b.type!==THREE.HalfFloatType&&(1<b.anisotropy||b.__oldAnisotropy)&&
(v.texParameterf(a,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,ba.getMaxAnisotropy())),b.__oldAnisotropy=b.anisotropy)}function L(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),c=Math.floor(a.height*b/c),f=document.createElement("canvas");f.width=d;f.height=c;f.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d,c);return f}function K(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?
v.NEAREST:v.LINEAR}function O(a){var b;if(a===THREE.RepeatWrapping)return v.REPEAT;if(a===THREE.ClampToEdgeWrapping)return v.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return v.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return v.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return v.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return v.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return v.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return v.LINEAR_MIPMAP_NEAREST;if(a===
THREE.LinearMipMapLinearFilter)return v.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return v.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return v.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return v.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return v.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return v.BYTE;if(a===THREE.ShortType)return v.SHORT;if(a===THREE.UnsignedShortType)return v.UNSIGNED_SHORT;if(a===THREE.IntType)return v.INT;if(a===THREE.UnsignedIntType)return v.UNSIGNED_INT;
if(a===THREE.FloatType)return v.FLOAT;if(a===THREE.HalfFloatType)return 36193;if(a===THREE.AlphaFormat)return v.ALPHA;if(a===THREE.RGBFormat)return v.RGB;if(a===THREE.RGBAFormat)return v.RGBA;if(a===THREE.LuminanceFormat)return v.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return v.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return v.FUNC_ADD;if(a===THREE.SubtractEquation)return v.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return v.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return v.ZERO;
if(a===THREE.OneFactor)return v.ONE;if(a===THREE.SrcColorFactor)return v.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return v.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return v.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return v.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return v.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return v.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return v.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return v.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return v.SRC_ALPHA_SATURATE;
b=ma.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=ma.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=ma.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var R=void 0!==a.canvas?a.canvas:document.createElement("canvas"),X=window.devicePixelRatio||1,W=void 0!==a.precision?a.precision:"highp",aa=void 0!==
a.alpha?a.alpha:!1,fa=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,U=void 0!==a.antialias?a.antialias:!1,P=void 0!==a.stencil?a.stencil:!0,Z=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!0,S=void 0!==a.logarithmicDepthBuffer?a.logarithmicDepthBuffer:!1,N=new THREE.Color(0),ia=0,ea=[],V={},ca=[],Y=new THREE.Matrix4,sa=new THREE.Matrix3,ha=[],da=[];this.domElement=R;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;
this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapAutoUpdate=!0;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var ba=this,za=[],Ha=null,la=null,Fa=-1,qa=null,xa="";new THREE.Frustum;new THREE.Matrix4;new THREE.Matrix4;var Ka=0,
Ja=0,Ba=0,Da=R.width,Aa=R.height,Ea={},Na=new THREE.Frustum,na=new THREE.Matrix4,oa=new THREE.Matrix4,ga=new THREE.Vector3,ja=new THREE.Vector3,Ga=!0,Oa={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},v,ya,wa,ua;try{var Ma={alpha:aa,premultipliedAlpha:fa,antialias:U,stencil:P,preserveDrawingBuffer:Z};
v=R.getContext("webgl",Ma)||R.getContext("experimental-webgl",Ma);if(null===v){if(null!==R.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}R.addEventListener("webglcontextlost",function(a){a.preventDefault();eb();Ta();V={}},!1)}catch(Sa){console.error(Sa)}var ka=new THREE.WebGLState(v,O);void 0===v.getShaderPrecisionFormat&&(v.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ma=new THREE.WebGLExtensions(v);
ma.get("OES_texture_float");ma.get("OES_texture_float_linear");ma.get("OES_texture_half_float");ma.get("OES_texture_half_float_linear");ma.get("OES_standard_derivatives");ma.get("EXT_shader_texture_lod");ma.get("EXT_texture_filter_anisotropic");ma.get("WEBGL_compressed_texture_s3tc");ya=ma.get("WEBGL_draw_buffers");wa=null;ua=ma.get("OES_vertex_array_object");S&&ma.get("EXT_frag_depth");var bb=function(a,b,c,d){!0===fa&&(a*=d,b*=d,c*=d);v.clearColor(a,b,c,d)},Ta=function(){v.clearColor(0,0,0,1);v.clearDepth(1);
v.clearStencil(0);v.enable(v.DEPTH_TEST);v.depthFunc(v.LEQUAL);v.frontFace(v.CCW);v.cullFace(v.BACK);v.enable(v.CULL_FACE);v.enable(v.BLEND);v.blendEquation(v.FUNC_ADD);v.blendFunc(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA);v.viewport(Ja,Ba,Da,Aa);bb(N.r,N.g,N.b,ia)},eb=function(){qa=Ha=null;xa="";Fa=-1;Ga=!0;ka.reset()};Ta();this.context=v;this.state=ka;var hb=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS),Ua=v.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),cb=v.getParameter(v.MAX_TEXTURE_SIZE),fb=v.getParameter(v.MAX_CUBE_MAP_TEXTURE_SIZE),
Va=0<Ua;Va&&ma.get("OES_texture_float");var mb=v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.HIGH_FLOAT),ib=v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.MEDIUM_FLOAT);v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.LOW_FLOAT);var nb=v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_FLOAT),jb=v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.MEDIUM_FLOAT);v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.LOW_FLOAT);var Ya=function(){var a;return function(){if(void 0!==a)return a;a=[];if(ma.get("WEBGL_compressed_texture_pvrtc")||
ma.get("WEBGL_compressed_texture_s3tc"))for(var b=v.getParameter(v.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),db=0<mb.precision&&0<nb.precision,Xa=0<ib.precision&&0<jb.precision;"highp"!==W||db||(Xa?(W="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(W="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp")));"mediump"!==W||Xa||(W="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp"));this.getContext=
function(){return v};this.forceContextLoss=function(){ma.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return Va};this.supportsFloatTextures=function(){return ma.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return ma.get("OES_texture_half_float_linear")};this.supportsStandardDerivatives=function(){return ma.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return ma.get("WEBGL_compressed_texture_s3tc")};this.supportsMRT=
function(){return ya};this.supportsBlendMinMax=function(){return ma.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ma.get("EXT_texture_filter_anisotropic");return a=null!==b?v.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return W};this.getPixelRatio=function(){return X};this.setPixelRatio=function(a){X=a};this.setSize=function(a,b,c){R.width=a*X;R.height=b*X;!1!==c&&(R.style.width=a+"px",R.style.height=
b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){Ja=a*X;Ba=b*X;Da=c*X;Aa=d*X;v.viewport(Ja,Ba,Da,Aa)};this.setScissor=function(a,b,c,d){v.scissor(a*X,b*X,c*X,d*X)};this.enableScissorTest=function(a){a?v.enable(v.SCISSOR_TEST):v.disable(v.SCISSOR_TEST)};this.getClearColor=function(){return N};this.setClearColor=function(a,b){N.set(a);ia=void 0!==b?b:1;bb(N.r,N.g,N.b,ia)};this.getClearAlpha=function(){return ia};this.setClearAlpha=function(a){ia=a;bb(N.r,N.g,N.b,ia)};this.clear=
function(a,b,c){var d=0;if(void 0===a||a)d|=v.COLOR_BUFFER_BIT;if(void 0===b||b)d|=v.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=v.STENCIL_BUFFER_BIT;v.clear(d)};this.clearColor=function(){v.clear(v.COLOR_BUFFER_BIT)};this.clearDepth=function(){v.clear(v.DEPTH_BUFFER_BIT)};this.clearStencil=function(){v.clear(v.STENCIL_BUFFER_BIT)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=eb;this.updateShadowMap=function(a,b){Ha=null;_oldDepthWrite=_oldDepthTest=_oldBlending=
-1;xa="";Fa=-1;Ga=!0;_oldFlipSided=_oldDoubleSided=-1;initObjects(a)};var Ra=function(a){a.target.traverse(function(a){a.removeEventListener("remove",Ra);if(a instanceof THREE.Mesh||a instanceof THREE.PointCloud||a instanceof THREE.Line)delete V[a.id];else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)for(var b=ca,c=b.length-1;0<=c;c--)b[c].object===a&&b.splice(c,1);delete a.__webglInit;delete a.__webglActive})},Pa=function(a){a=a.target;a.removeEventListener("dispose",Pa);
wb(a)},Ia=function(a){a=a.target;a.removeEventListener("dispose",Ia);a.image&&a.image.__webglTextureCube?v.deleteTexture(a.image.__webglTextureCube):a.__webglInit&&(a.__webglInit=!1,v.deleteTexture(a.__webglTexture));ba.info.memory.textures--},Wa=function(a){a=a.target;a.removeEventListener("dispose",Wa);a&&a.__webglTexture&&(v.deleteTexture(a.__webglTexture),v.deleteFramebuffer(a.__webglFramebuffer),v.deleteRenderbuffer(a.__webglRenderbuffer));ba.info.memory.textures--},ub=function(a){a=a.target;
a.removeEventListener("dispose",ub);xb(a)},vb=function(a){void 0!==a.__webglVertexBuffer&&v.deleteBuffer(a.__webglVertexBuffer);void 0!==a.__webglNormalBuffer&&v.deleteBuffer(a.__webglNormalBuffer);void 0!==a.__webglTangentBuffer&&v.deleteBuffer(a.__webglTangentBuffer);void 0!==a.__webglColorBuffer&&v.deleteBuffer(a.__webglColorBuffer);void 0!==a.__webglUVBuffer&&v.deleteBuffer(a.__webglUVBuffer);void 0!==a.__webglUV2Buffer&&v.deleteBuffer(a.__webglUV2Buffer);void 0!==a.__webglSkinIndicesBuffer&&
v.deleteBuffer(a.__webglSkinIndicesBuffer);void 0!==a.__webglSkinWeightsBuffer&&v.deleteBuffer(a.__webglSkinWeightsBuffer);void 0!==a.__webglFaceBuffer&&v.deleteBuffer(a.__webglFaceBuffer);void 0!==a.__webglLineBuffer&&v.deleteBuffer(a.__webglLineBuffer);void 0!==a.__webglLineDistanceBuffer&&v.deleteBuffer(a.__webglLineDistanceBuffer);if(void 0!==a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)v.deleteBuffer(a.__webglCustomAttributesList[b].buffer);ba.info.memory.geometries--},
wb=function(a){a.__webglInit=void 0;if(a instanceof THREE.BufferGeometry){void 0!==a.vbbuffer&&v.deleteBuffer(a.vbbuffer);void 0!==a.ibbuffer&&v.deleteBuffer(a.ibbuffer);if(a.vaos)for(var b=0;b<a.vaos.length;b++)ua.deleteVertexArrayOES(a.vaos[b].vao);a=a.attributes;for(var c in a)void 0!==a[c].buffer&&v.deleteBuffer(a[c].buffer);ba.info.memory.geometries--}else if(c=ab[a.id],void 0!==c){for(var b=0,d=c.length;b<d;b++){var f=c[b];if(void 0!==f.numMorphTargets){for(var g=0,h=f.numMorphTargets;g<h;g++)v.deleteBuffer(f.__webglMorphTargetsBuffers[g]);
delete f.__webglMorphTargetsBuffers}if(void 0!==f.numMorphNormals){g=0;for(h=f.numMorphNormals;g<h;g++)v.deleteBuffer(f.__webglMorphNormalsBuffers[g]);delete f.__webglMorphNormalsBuffers}vb(f)}delete ab[a.id]}else vb(a)};this.deallocateGeometry=wb;var xb=function(a){var b=a.program.program;if(void 0!==b){a.program=void 0;var c,d,f=!1;a=0;for(c=za.length;a<c;a++)if(d=za[a],d.program===b){d.usedTimes--;0===d.usedTimes&&(f=!0);break}if(!0===f){f=[];a=0;for(c=za.length;a<c;a++)d=za[a],d.program!==b&&
f.push(d);za=f;v.deleteProgram(b);ba.info.memory.programs--}}};this.renderBufferDirect=function(a,b,c,f,g,h){if(!1!==f.visible){C(h);a=w(a,b,c,f,h);c=g.attributes;b=!1;var k="direct_"+g.id+"_"+a.id+"_"+(f.wireframe?1:0);k!==xa&&(xa=k,b=!0);a:{var l=g.vaos;if(l)for(var m=0;m<l.length;m++)if(l[m].geomhash===k){ua.bindVertexArrayOES(l[m].vao);k=!0;break a}if(null===l)k=!1;else b:if(g.streamingDraw)g.vaos=null,k=!1;else if(g.offsets&&1<g.offsets.length)g.vaos=null,k=!1;else if(ua){void 0===g.vaos&&(g.vaos=
[]);l=ua.createVertexArrayOES();g.vaos.push({geomhash:k,vao:l});ua.bindVertexArrayOES(l);(k=g.attributes.index)&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,g.ibbuffer||k.buffer);for(var k=null,l=a.attributes,m=a.attributesKeys,n=g.vbstride,q=g.offsets&&g.offsets.length?g.offsets[0].index:0,z=0,t=m.length;z<t;z++){var p=m[z],L=l[p];if(0<=L)if(p=g.attributes[p]){var r=v.FLOAT,da=p.bytesPerItem||4;1===da?r=v.UNSIGNED_BYTE:2===da&&(r=v.UNSIGNED_SHORT);v.enableVertexAttribArray(L);void 0!==p.itemOffset?(k!=g.vbbuffer&&
(v.bindBuffer(v.ARRAY_BUFFER,g.vbbuffer),k=g.vbbuffer),v.vertexAttribPointer(L,p.itemSize,r,p.normalize,4*n,4*(p.itemOffset+q*n))):(v.bindBuffer(v.ARRAY_BUFFER,p.buffer),k=p.buffer,v.vertexAttribPointer(L,p.itemSize,r,p.normalize,0,q*p.itemSize*da));wa&&g.numInstances&&wa.vertexAttribDivisorANGLE(L,p.divisor||0)}else{ua.bindVertexArrayOES(null);for(z=0;z<g.vaos.length;z++)ua.deleteVertexArrayOES(g.vaos[z].vao);g.vaos=null;k=!1;break b}}k=!0}else g.vaos=null,k=!1}(b=b&&!k)&&ka.initAttributes();if(h instanceof
THREE.Mesh)if(h=c.index){m=h.array?h.array:g.ib;m instanceof Uint32Array&&ma.get("OES_element_index_uint")?(c=v.UNSIGNED_INT,l=4):(c=v.UNSIGNED_SHORT,l=2);(n=g.offsets)&&1<n.length&&(b=!0);q=0;do{var B;n&&n.length?(B=n[q].index,z=n[q].start,t=n[q].count):(z=B=0,t=m.length);b&&d(f,a,g,B,h);g.numInstances?wa.drawElementsInstancedANGLE(g.isLines?v.LINES:v.TRIANGLES,t,c,z*l,g.numInstances):v.drawElements(g.isLines?v.LINES:v.TRIANGLES,t,c,z*l)}while(n&&++q<n.length)}else b&&d(f,a,g,B),f=g.attributes.position,
g.numInstances?wa.drawArraysInstancedANGLE(g.isLines?v.LINE_STRIP:v.TRIANGLES,0,f.array.length/3,g.numInstances):v.drawArrays(g.isLines?v.LINE_STRIP:v.TRIANGLES,0,f.array.length/f.itemSize);else console.log("Only THREE.Mesh can be rendered by the Firefly renderer. Use THREE.Mesh to draw lines.");k&&ua.bindVertexArrayOES(null)}};this.renderBuffer=function(a,b,c,d,f,g){if(!1!==d.visible){C(g);c=w(a,b,c,d,g);b=c.attributes;a=!1;c=f.id+"_"+c.id+"_"+(d.wireframe?1:0);c!==xa&&(xa=c,a=!0);a&&ka.initAttributes();
!d.morphTargets&&0<=b.position&&a&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglVertexBuffer),ka.enableAttribute(b.position),v.vertexAttribPointer(b.position,3,v.FLOAT,!1,0,0));if(a){if(f.__webglCustomAttributesList){c=0;for(var h=f.__webglCustomAttributesList.length;c<h;c++){var k=f.__webglCustomAttributesList[c];0<=b[k.buffer.belongsToAttribute]&&(v.bindBuffer(v.ARRAY_BUFFER,k.buffer),ka.enableAttribute(b[k.buffer.belongsToAttribute]),v.vertexAttribPointer(b[k.buffer.belongsToAttribute],k.size,v.FLOAT,
!1,0,0))}}0<=b.color&&(0<g.geometry.colors.length||0<g.geometry.faces.length?(v.bindBuffer(v.ARRAY_BUFFER,f.__webglColorBuffer),ka.enableAttribute(b.color),v.vertexAttribPointer(b.color,3,v.FLOAT,!1,0,0)):d.defaultAttributeValues&&v.vertexAttrib3fv(b.color,d.defaultAttributeValues.color));0<=b.normal&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglNormalBuffer),ka.enableAttribute(b.normal),v.vertexAttribPointer(b.normal,3,v.FLOAT,!1,0,0));0<=b.tangent&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglTangentBuffer),
ka.enableAttribute(b.tangent),v.vertexAttribPointer(b.tangent,4,v.FLOAT,!1,0,0));0<=b.uv&&(g.geometry.faceVertexUvs[0]?(v.bindBuffer(v.ARRAY_BUFFER,f.__webglUVBuffer),ka.enableAttribute(b.uv),v.vertexAttribPointer(b.uv,2,v.FLOAT,!1,0,0)):d.defaultAttributeValues&&v.vertexAttrib2fv(b.uv,d.defaultAttributeValues.uv));0<=b.uv2&&(g.geometry.faceVertexUvs[1]?(v.bindBuffer(v.ARRAY_BUFFER,f.__webglUV2Buffer),ka.enableAttribute(b.uv2),v.vertexAttribPointer(b.uv2,2,v.FLOAT,!1,0,0)):d.defaultAttributeValues&&
v.vertexAttrib2fv(b.uv2,d.defaultAttributeValues.uv2));0<=b.lineDistance&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglLineDistanceBuffer),ka.enableAttribute(b.lineDistance),v.vertexAttribPointer(b.lineDistance,1,v.FLOAT,!1,0,0))}ka.disableUnusedAttributes();g instanceof THREE.Mesh?(g=f.__typeArray===Uint32Array?v.UNSIGNED_INT:v.UNSIGNED_SHORT,d.wireframe?(ka.setLineWidth(d.wireframeLinewidth*X),a&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),v.drawElements(v.LINES,f.__webglLineCount,g,0)):(a&&
v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),v.drawElements(v.TRIANGLES,f.__webglFaceCount,g,0))):g instanceof THREE.Line&&(g=g.mode===THREE.LineStrip?v.LINE_STRIP:v.LINES,ka.setLineWidth(d.linewidth*X),v.drawArrays(g,0,f.__webglLineCount))}};this.render=function(a,b,c,d,f){if(!1===b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{xa="";Fa=-1;qa=null;void 0!==f&&(ea.length=0,Ga=!0);var g=a.fog;!0===a.autoUpdate&&a.updateMatrixWorld();
void 0===b.parent&&b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);b.worldUpTransform?oa.multiplyMatrices(b.worldUpTransform,b.matrixWorld):oa.copy(b.matrixWorld);na.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);Na.setFromMatrix(na);var m=a instanceof RenderBatch&&a.renderImmediate;m||(ha.length=0,da.length=0,q(a,!0===ba.sortObjects,!0===a.forceVisible),!0===ba.sortObjects&&(ha.sort(k),da.sort(h)));Ga&&(f&&f.length&&(ea=f.slice()),M(ea));this.resetGLState();this.setRenderTarget(c);
(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);if(a.overrideMaterial){var n=a.overrideMaterial;t(n);m?(d=ea,lb=b,gb=d,$a=n||null,a.forEach(p,a.forceVisible?1:128,!1)):(l(ha,b,ea,g,n),l(da,b,ea,g,n))}else m?(d=ea,lb=b,gb=d,$a=n||null,a.forEach(p,a.forceVisible?1:128,!1)):(ka.setBlending(THREE.NoBlending),l(ha,b,ea,g,null),l(da,b,ea,g,null));this.resetGLState();c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&
(v.bindTexture(v.TEXTURE_2D,c.__webglTexture),v.generateMipmap(v.TEXTURE_2D),v.bindTexture(v.TEXTURE_2D,null));ka.setDepthTest(!0);ka.setDepthWrite(!0)}};var lb,gb,zb,$a,ab={},yb=0,Ab={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?v.disable(v.CULL_FACE):(b===
THREE.FrontFaceDirectionCW?v.frontFace(v.CW):v.frontFace(v.CCW),a===THREE.CullFaceBack?v.cullFace(v.BACK):a===THREE.CullFaceFront?v.cullFace(v.FRONT):v.cullFace(v.FRONT_AND_BACK),v.enable(v.CULL_FACE))};this.setMaterialFaces=function(a){ka.setDoubleSided(a.side===THREE.DoubleSide);ka.setFlipSided(a.side===THREE.BackSide)};this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",Ia),a.__webglTexture=v.createTexture(),ba.info.memory.textures++);v.bindTexture(v.TEXTURE_2D,
a.__webglTexture);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,a.flipY);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);v.pixelStorei(v.UNPACK_ALIGNMENT,a.unpackAlignment);a.image=L(a.image,cb);var b=a.image,c=THREE.Math.isPowerOfTwo(b.width)&&THREE.Math.isPowerOfTwo(b.height),d=O(a.format),f=O(a.type);I(v.TEXTURE_2D,a,c);var g=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<g.length&&c){for(var h=0,k=g.length;h<k;h++)b=g[h],v.texImage2D(v.TEXTURE_2D,h,d,b.width,b.height,0,d,f,b.data);
a.generateMipmaps=!1}else v.texImage2D(v.TEXTURE_2D,0,d,b.width,b.height,0,d,f,b.data);else if(a instanceof THREE.CompressedTexture)for(h=0,k=g.length;h<k;h++)b=g[h],a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?-1<Ya().indexOf(d)?v.compressedTexImage2D(v.TEXTURE_2D,h,d,b.width,b.height,0,b.data):console.warn("Attempt to load unsupported compressed texture format"):v.texImage2D(v.TEXTURE_2D,h,d,b.width,b.height,0,d,f,b.data);else if(0<g.length&&c){h=0;for(k=g.length;h<k;h++)b=g[h],v.texImage2D(v.TEXTURE_2D,
h,d,d,f,b);a.generateMipmaps=!1}else v.texImage2D(v.TEXTURE_2D,0,d,d,f,a.image);a.generateMipmaps&&c&&v.generateMipmap(v.TEXTURE_2D);a.needsUpdate=!1;if(a.onUpdate)a.onUpdate()};this.setTexture=function(a,b){v.activeTexture(v.TEXTURE0+b);a.needsUpdate?ba.uploadTexture(a):v.bindTexture(v.TEXTURE_2D,a.__webglTexture)};this.initFrameBufferMRT=function(a,b){var c=a[0],d=!1;if(c&&!c.__webglFramebuffer){void 0===c.depthBuffer&&(c.depthBuffer=!0);void 0===c.stencilBuffer&&(c.stencilBuffer=!0);c.__webglFramebuffer=
v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,c.__webglFramebuffer);var f;c.shareDepthFrom?f=c.__webglRenderbuffer=c.shareDepthFrom.__webglRenderbuffer:c.depthBuffer&&!c.stencilBuffer?(f=c.__webglRenderbuffer=v.createRenderbuffer(),v.bindRenderbuffer(v.RENDERBUFFER,f),v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,c.width,c.height)):c.depthBuffer&&c.stencilBuffer&&(f=c.__webglRenderbuffer=v.createRenderbuffer(),v.bindRenderbuffer(v.RENDERBUFFER,f),v.renderbufferStorage(v.RENDERBUFFER,
v.DEPTH_STENCIL,c.width,c.height));c.depthBuffer&&!c.stencilBuffer?v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,f):c.depthBuffer&&c.stencilBuffer&&v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,f);d=!0}f=la;v.bindFramebuffer(v.FRAMEBUFFER,c.__webglFramebuffer);for(var g=0;g<a.length;g++){var h=a[g];if(!h.__webglTexture){var k=THREE.Math.isPowerOfTwo(h.width)&&THREE.Math.isPowerOfTwo(h.height),l=O(h.format),m=O(h.type);h.addEventListener("dispose",
Wa);h.__webglTexture=v.createTexture();ba.info.memory.textures++;v.bindTexture(v.TEXTURE_2D,h.__webglTexture);I(v.TEXTURE_2D,h,k);v.texImage2D(v.TEXTURE_2D,0,l,h.width,h.height,0,l,m,null);k&&h.generateMipmaps&&v.generateMipmap(v.TEXTURE_2D)}v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0+g,v.TEXTURE_2D,h.__webglTexture,0)}if(ya){h=[ya.COLOR_ATTACHMENT0_WEBGL];for(g=1;g<a.length;g++)h.push(ya.COLOR_ATTACHMENT0_WEBGL+g);ya.drawBuffersWEBGL(h)}b&&(g=v.checkFramebufferStatus(v.FRAMEBUFFER),
g!==v.FRAMEBUFFER_COMPLETE&&(console.log("Can't use multiple render targets. Falling back to two passes. "+g),delete c.__webglFramebuffer,b=!1));v.bindFramebuffer(v.FRAMEBUFFER,f);d&&(v.bindTexture(v.TEXTURE_2D,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null));return b};this.setRenderTarget=function(a){var b;Array.isArray(a)?(this.initFrameBufferMRT(a),b=a[0]):a&&(this.initFrameBufferMRT([a]),b=a);var c,d,f;b?(a=b.__webglFramebuffer,c=b.width,b=b.height,f=d=0):(a=
null,c=Da,b=Aa,d=Ja,f=Ba);a!==la&&(v.bindFramebuffer(v.FRAMEBUFFER,a),v.viewport(d,f,c,b),la=a)};this.verifyMRTWorks=function(a){return ya?this.initFrameBufferMRT(a,!0):!1};this.readRenderTargetPixels=function(a,b,c,d,f,g){if(!(a instanceof THREE.WebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else if(a.__webglFramebuffer){var h=!1;a.__webglFramebuffer!==la&&(v.bindFramebuffer(v.FRAMEBUFFER,a.__webglFramebuffer),h=!0);v.checkFramebufferStatus(v.FRAMEBUFFER)===
v.FRAMEBUFFER_COMPLETE?v.readPixels(b,c,d,f,v.RGBA,v.UNSIGNED_BYTE,g):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.");h&&v.bindFramebuffer(v.FRAMEBUFFER,la)}}};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){function a(a){g[0]=a;var b=d[0];a=0;if(0==(b&2147483647))k[a++]=b>>16;else{var c=b&2147483648,f=b&2139095040,b=b&8388607;if(0==f)k[a++]=c>>16;else if(2139095040==f)0==b?k[a++]=c>>16|31744:k[a++]=65024;else{var m=c>>16,f=(0|f>>23)-127+15;31<=f?k[a++]=c>>16|31744:0>=f?(24<14-f?c=0:(b|=8388608,h[0]=b>>14-f,c=h[0],b>>13-f&1&&(c+=1)),k[a++]=m|c):(h[0]=f<<10,f=h[0],h[0]=b>>13,c=h[0],b&4096?k[a++]=(m|f|c)+1:k[a++]=m|f|c)}}return k[0]}var b=Autodesk.Viewing.Private;b.BackgroundPresets={"Fusion Grey":[230,
230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Infinity Pool":[164,175,179,164,175,179],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var c=b.BackgroundPresets;b.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,
E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.8,.9,1],lightMultiplier:1,bgColorGradient:c["Fusion Grey"],darkerFade:!1},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-7.145705069544681,directLightColor:[.5,.5,.5],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Photo Booth"],darkerFade:!0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:1,lightDirection:[.1,
-.55,-1],bgColorGradient:c["Dark Grey"],darkerFade:!1},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c["Grey Room"],darkerFade:!0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c["Photo Booth"],darkerFade:!0},
{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c.Tranquility,darkerFade:!1},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c["Infinity Pool"],darkerFade:!1},{name:"Simple White",path:null,tonemap:0,
E_bias:0,directLightColor:[1,1,1],ambientColor:[.9,.9,.9],lightMultiplier:1,bgColorGradient:c.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c.Midnight,darkerFade:!1},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",
tonemap:1,E_bias:-8.133084111281999,directLightColor:[.5,.5,.5],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Photo Booth"],darkerFade:!0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-8.152868970258611,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-8.152965210880433,directLightColor:[1,1,1],ambientColor:[.03125,
.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-8.092194064376047,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-7.8601965561109175,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},
{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-13,directLightColor:[.9,.9,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c.Plaza,darkerFade:!1},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-11.5,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1}];b.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,
bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c.Midnight,darkerFade:!1},
{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["RaaS SBS"],darkerFade:!1}];ENABLE_DEBUG&&(b.LightPresets=b.LightPresets.concat(b.DebugEnvironments));b.CreateCubeMapFromColors=function(a,b){for(var c=255*a.x,d=255*a.y,f=255*a.z,g=255*b.x,h=255*b.y,k=255*b.z,
m=new Uint8Array(16),n=new Uint8Array(16),E=new Uint8Array(16),B=0;4>B;B++)m[4*B]=c,m[4*B+1]=d,m[4*B+2]=f,m[4*B+3]=255,n[4*B]=g,n[4*B+1]=h,n[4*B+2]=k,n[4*B+3]=255,0|B/2?(E[4*B]=c,E[4*B+1]=d,E[4*B+2]=f):(E[4*B]=g,E[4*B+1]=h,E[4*B+2]=k),E[4*B+3]=255;c=new THREE.DataTexture(E,2,2,THREE.RGBAFormat);d=new THREE.DataTexture(E,2,2,THREE.RGBAFormat);n=new THREE.DataTexture(n,2,2,THREE.RGBAFormat);m=new THREE.DataTexture(m,2,2,THREE.RGBAFormat);f=new THREE.DataTexture(E,2,2,THREE.RGBAFormat);E=new THREE.DataTexture(E,
2,2,THREE.RGBAFormat);g=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);g.image=[d,c,m,n,E,f];g.needsUpdate=!0;return g};var f=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],g=new Float32Array(1),d=new Uint32Array(g.buffer),h=new Uint16Array(1),k=new Uint16Array(1),m=new Float32Array(4),n=new Float32Array(4);b.DecodeEnvMap=function(b,c,d){if(b.LogLuv){c=Math.pow(2,c);for(var g=
Array.isArray(b.image)?b.image:[k],h=0;h<g.length;h++)for(var k=g[h],H=0;H<k.mipmaps.length;H++){var z=k.mipmaps[H],t=z.data,w;d?(w=new Uint16Array(t.length/4*3),z.data=w):w=t.buffer;for(var E=z=0;E<t.length;E+=4){m[0]=t[E]/255;m[1]=t[E+1]/255;m[2]=t[E+2]/255;m[3]=t[E+3]/255;var B=n,D=m,J=Math.pow(2,(255*D[2]+D[3]-127)/2),F=J/D[1],G=D[0]*F,D=f[0]*G+f[3]*J+f[6]*F,M=f[1]*G+f[4]*J+f[7]*F,J=f[2]*G+f[5]*J+f[8]*F;0>D&&(D=0);0>M&&(M=0);0>J&&(J=0);B[0]=D;B[1]=M;B[2]=J;d?(B=m,D=n,M=c,J=Math.sqrt(D[0]*M),F=
Math.sqrt(D[1]*M),D=Math.sqrt(D[2]*M),65504<J&&(J=65504),65504<F&&(F=65504),65504<D&&(D=65504),B[0]=J,B[1]=F,B[2]=D,w[z++]=a(m[0]),w[z++]=a(m[1]),w[z++]=a(m[2])):(B=m,D=n,M=c,J=.0625*Math.sqrt(D[0]*M),F=.0625*Math.sqrt(D[1]*M),D=.0625*Math.sqrt(D[2]*M),M=Math.max(Math.max(J,F),Math.max(D,1E-6)),1<M&&(M=1),M=Math.ceil(255*M)/255,1<J&&(J=1),1<F&&(F=1),1<D&&(D=1),B[3]=M,M=1/M,B[0]=J*M,B[1]=F*M,B[2]=D*M,t[E]=Math.round(255*m[0]),t[E+1]=Math.round(255*m[1]),t[E+2]=Math.round(255*m[2]),t[E+3]=Math.round(255*
m[3]))}}b.LogLuv=!1;d?(b.type=THREE.HalfFloatType,b.format=THREE.RGBFormat,b.RGBM=!1,b.GammaEncoded=!0):b.RGBM=!0}else stderr("Environment map expected to be in LogLuv format.")};b.DefaultLightPreset=8;b.DefaultLightPreset2d=0})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.MaterialManager=function(a){function b(a){if("http://"==a.substr(0,7)||"https://"==a.substr(0,8)||"file:///"==a.substr(0,8)||"urn:"==a.substr(0,4))return a;var b=window.location.pathname,c=b.lastIndexOf("/"),b=b.substr(0,c+1);return window.location.protocol+"//"+window.location.host+b+a}function c(a){return-1!=a.indexOf("__lineMaterial__")}function f(a,b){return c(b)?b:a.basePath+"|mat|"+b}function g(a,b,c){auth&&(-1!=a.indexOf("/items/")?THREE.ImageUtils.crossOrigin="use-credentials":
THREE.ImageUtils.crossOrigin="");return THREE.ImageUtils.loadTexture(a,b,c)}var d=Autodesk.Viewing.Private,h=this,k=this.materials={},m=this.materialsNonHDR={};this.textures={};this.irradianceMap=this.reflectionCube=this.layerMaskTex=null;var n=1,q=[];this.hasPrism=!1;var l=[],p=new THREE.Vector3(0,1,0);this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0});this.findMaterial=function(a,b){var c=k[f(a,
b)];c||(stderr("Unknown material "+b+". Using default."),c=this.defaultMaterial);return c};var r=function(a,b){if(!a||!a.colors)return new THREE.Color(1,0,0);var c=a.colors[b];if(!c)return new THREE.Color(0,0,0);c=c.values;if(!c||!c.length)return new THREE.Color(1,0,0);c=c[0];return new THREE.Color(c.r,c.g,c.b)},A=function(a,b,c){return a&&a.scalars?(a=a.scalars[b])?a.values[0]:c:c},C=function(a,b,c){return a&&a.booleans?(a=a.booleans)?a[b]:c:c};this.convertMaterial=function(a){var b=new THREE.MeshPhongMaterial;
b.proteinMat=a;b.packedNormals=!0;if((a=a.materials[a.userassets[0]])&&"SimplePhong"==a.definition){var c=a.properties;b.tag=a.tag;b.proteinType=a.proteinType;void 0===b.proteinType&&(b.proteinType=null);var d=b.ambient=r(c,"generic_ambient"),f=b.color=r(c,"generic_diffuse"),g=b.specular=r(c,"generic_specular"),h=b.emissive=r(c,"generic_emissive");0==f.r&&0==f.g&&0==f.b&&0==g.r&&0==g.g&&0==g.b&&0==d.r&&0==d.g&&0==d.b&&0==h.r&&0==h.g&&0==h.b&&(f.r=f.g=f.b=.4);b.shininess=A(c,"generic_glossiness",30);
b.opacity=1-A(c,"generic_transparency",0);b.reflectivity=A(c,"generic_reflectivity_at_0deg",0);d=C(c,"generic_is_metal");void 0!==d&&(b.metal=d);c=C(c,"generic_backface_cull");void 0===c||c||(b.side=THREE.DoubleSide);b.transparent=a.transparent}else b.ambient=197379,b.color=7829367,b.specular=3355443,b.shininess=30,b.shading=THREE.SmoothShading;return b};this.convertMaterials=function(a){if(a.materials){var b=a.materials.materials,c;for(c in b){var d=this.convertMaterial(b[c]);!_isIE11&&a.doubleSided&&
(d.side=THREE.DoubleSide);var g=f(a,c);this.addMaterial(g,d)}}};this.updateMaterials=function(){for(;q.length;)for(var b=q.pop(),c=0;c<b.mats.length;c++)b.mats[c][b.slot]=b.tex,b.mats[c].needsUpdate=!0,a.invalidate(!0,!1,!1)};this.resizeImage=function(a){var b=a.width,c=a.height;if(0===(b&b-1)&&0===(c&c-1))return a;for(var d=1;2*d<b;)d*=2;for(b=1;2*b<c;)b*=2;var c=document.createElement("canvas"),f=c.getContext("2d");c.width=d;c.height=b;f.drawImage(a,0,0,d,b);return c};this.loadTexture=function(c,
d){if(c&&c.proteinMat){var f=c.proteinMat.materials,k=f[c.proteinMat.userassets[0]];if(k&&"SimplePhong"===k.definition){var l=k.properties,k=k.textures,m;for(m in k){var n=f[k[m].connections[0]].properties,p=n.uris.unifiedbitmap_Bitmap.values[0];if(p){var r;if("generic_diffuse"==m)r="map",(!c.color||0==c.color.r&&0==c.color.g&&0==c.color.b)&&c.color.setRGB(1,1,1);else if("generic_bump"==m)r=C(l,"generic_bump_is_normal")?"normalMap":"bumpMap",c.bumpScale=A(l,"generic_bump_amount",0),c.bumpScale&&1<=
c.bumpScale&&(c.bumpScale=.03);else if("generic_specular"==m)r="specularMap";else if("generic_alpha"==m)r="alphaMap",c.transparent=!0;else continue;var G=c.proteinType&&c.proteinType.length,M=G&&0===c.proteinType.indexOf("Prism"),I=(M&&PRISM_ROOT||G&&PROTEIN_ROOT)&&(0===p.indexOf("1/Mats")||0===p.indexOf("2/Mats")||0===p.indexOf("3/Mats")),G=d.basePath+p,L=h.textures[G];if(L)L.tex?(c[r]=L.tex,c.needsUpdate=!0):(h.textures[G].mats.push(c),h.textures[G].slots.push(r));else{var K=null;if(I)K=M?PRISM_ROOT+
p:PROTEIN_ROOT+p;else{for(M=0;M<d.manifest.assets.length;++M)if(I=d.manifest.assets[M],I.id==p){K=b(d.basePath+I.URI);break}K||(K=b(G))}p=K.indexOf("urn:");-1!=p&&(K=K.substr(0,p)+encodeURIComponent(K.substr(p)),K+="?domain="+encodeURIComponent(window.location.origin),Autodesk.Viewing.ACM_SESSION_ID&&(K+="&acmsession="+Autodesk.Viewing.ACM_SESSION_ID));h.textures[G]={mats:[c],slots:[r],tex:null};p=function(a){return g(K,THREE.UVMapping,function(b){b.image=h.resizeImage(b.image);var c=h.textures[a];
if(c){c.tex||(c.tex=b);for(var d=0;d<c.mats.length;d++)c.mats[d][c.slots[d]]=b;q.push(c)}})}(G);"alphaMap"==r&&(c.transparent=!0);p.anisotropy="bumpMap"==r||"normalMap"==r?0:a.renderer().getMaxAnisotropy();p.flipY=!0;p.wrapS=THREE.RepeatWrapping;p.wrapT=THREE.RepeatWrapping;p.invert=C(n,"unifiedbitmap_Invert");p.clampS=!C(n,"texture_URepeat",!0);p.clampT=!C(n,"texture_VRepeat",!0);r=A(n,"texture_UScale",1);G=A(n,"texture_VScale",1);M=A(n,"texture_UOffset",0);I=A(n,"texture_VOffset",0);n=A(n,"texture_WAngle",
0);p.matrix={elements:[Math.cos(n)*r,Math.sin(n)*G,0,-Math.sin(n)*r,Math.cos(n)*G,0,M,I,1]}}}}}}};this.loadTextures=function(a){for(var b in k)this.loadTexture(k[b],a)};this.create2DMaterial=function(b,c,d,l){var m="__lineMaterial__";c.image&&(m+="|image:"+c.image.name);c.clip&&(m+="|clip:"+JSON.stringify(c.clip));d&&(m+="|id");l&&(m+="|selection");c.skipEllipticals&&(m+="|skipEllipticals");c.skipCircles&&(m+="|skipCircles");c.skipTriangleGeoms&&(m+="|skipTriangleGeoms");c.useInstancing&&(m+="|useInstancing");
b&&(m+="|"+b?b.basePath:"runtime");m=f(null,m);if(!k.hasOwnProperty(m)){var n=new THREE.ShaderMaterial({fragmentShader:LineShader.fragmentShader,vertexShader:LineShader.vertexShader,uniforms:THREE.UniformsUtils.clone(LineShader.uniforms),attributes:LineShader.attributes,defines:THREE.UniformsUtils.clone(LineShader.defines),transparent:!0});n.depthWrite=!1;n.depthTest=!1;n.side=THREE.DoubleSide;n.blending=THREE.NormalBlending;d?(n.defines.ID_COLOR=1,n.blending=THREE.NoBlending):l?n.defines.SELECTION_RENDERER=
1:a.renderer().hasMRT()&&(n.mrtIdBuffer=1);c.skipEllipticals||(n.defines.HAS_ELLIPTICALS=1);c.skipCircles||(n.defines.HAS_CIRCLES=1);c.skipTriangleGeoms||(n.defines.HAS_TRIANGLE_GEOMS=1);c.useInstancing&&(n.defines.USE_INSTANCING=1);this.layerMaskTex&&(n.defines.HAS_LAYERS=1,n.uniforms.tLayerMask.value=h.layerMaskTex);if(c.image){n.defines.HAS_RASTER_QUADS=1;var q=this;g(c.image.dataURI,THREE.UVMapping,function(b){b.image=q.resizeImage(b.image);b.wrapS=THREE.ClampToEdgeWrapping;b.wrapT=THREE.ClampToEdgeWrapping;
b.minFilter=THREE.LinearMipMapLinearFilter;b.magFilter=THREE.LinearFilter;b.anisotropy=1;b.flipY=!0;b.generateMipmaps=!0;b.needsUpdate=!0;n.uniforms.tRaster.value=b;-1!=c.image.dataURI.indexOf("png")&&(n.transparent=!0);n.needsUpdate=!0;a.invalidate(!1,!0,!1)})}k[m]=n}return m};this.addMaterial=function(b,c,d){function f(a){return.299*a.r+.587*a.g+.114*a.b}var g=c.proteinMat?c.proteinMat:null,m=c.proteinType&&-1!=c.proteinType.indexOf("Prism");this.hasPrism=m||this.hasPrism;if(!d){if(c.metal){if(c.reflectivity||
(c.reflectivity=f(c.specular)),g&&(1===c.reflectivity&&(c.reflectivity=f(c.specular)),0!==c.color.r||0!==c.color.g||0!==c.color.b))c.color.r*=.1,c.color.g*=.1,c.color.b*=.1}else g?m?(d=!1,"PrismLayered"==c.proteinType&&(c.clearcoat=!0,c.reflectivity=.06,g&&(g=g.materials[g.userassets[0]].categories)&&g.length&&-1!=g[0].indexOf("Metal")&&(d=!0)),c.reflectivity=Math.sqrt(c.reflectivity),d?c.specular.copy(c.color):(c.specular.r=c.reflectivity,c.specular.g=c.reflectivity,c.specular.b=c.reflectivity)):
(c.reflectivity||(c.reflectivity=.01+.06*f(c.specular)),c.specular.r*=c.reflectivity,c.specular.g*=c.reflectivity,c.specular.b*=c.reflectivity,1>c.opacity&&(c.reflectivity=1)):c.reflectivity?(c.metal=!0,c.specular.r=c.color.r*c.reflectivity,c.specular.g=c.color.g*c.reflectivity,c.specular.b=c.color.b*c.reflectivity,c.color.r*=.1,c.color.g*=.1,c.color.b*=.1):1!==c.color.r||1!==c.color.g||1!==c.color.b||1!==c.specular.r||1!==c.specular.g||1!==c.specular.b||c.uri_map||c.uri_specularMap||(c.metal=!0,
c.reflectivity=.7,c.specular.r=c.specular.g=c.specular.b=c.reflectivity,c.color.r*=.1,c.color.g*=.1,c.color.b*=.1);if(c.transparent||c.uri_map&&-1!=c.uri_map.toLowerCase().indexOf(".png")||c.uri_opacityMap)c.alphaTest=.01}if(c.uri_normalMap){g=c.bumpScale;if(void 0===g||1<=g)g=1;c.normalScale=new THREE.Vector2(g,g)}else void 0===c.bumpScale&&(c.uri_map||c.uri_bumpMap)?c.bumpScale=.03:1<=c.bumpScale&&(c.bumpScale=.03);c.shininess*=.25;h.reflectionCube&&(c.envMap=h.reflectionCube);h.irradianceMap&&
(c.irradianceMap=h.irradianceMap);c.exposureBias=Math.pow(2,a.renderer().getExposureBias());c.tonemapOutput=a.renderer().getToneMapMethod();c.envMapExposure=n;a.renderer().applyMRTFlags(c);c.side==THREE.DoubleSide&&a.renderer().toggleTwoSided(!0);c.cutplanes=l;c.cutplanesOutlineColor=p;k[b]=c};this.addMaterialNonHDR=function(a,b){b.cutplanes=l;b.cutplanesOutlineColor=p;m[a]=b};this.togglePolygonOffset=function(a){for(var b in k){var c=k[b];c instanceof THREE.MeshPhongMaterial&&(c.polygonOffset=!0,
c.polygonOffsetFactor=a?1:0,c.polygonOffsetUnits=a?1:0,c.needsUpdate=!0)}};this.applyGeometryFlagsToMaterial=function(a,b){b.attributes.color&&(a.vertexColors=THREE.VertexColors,a.needsUpdate=!0);!a.proteinType&&b.attributes.uv&&b.attributes.uv.isPattern&&(a.map&&!a.bumpMap&&(a.bumpMap=a.map,a.needsUpdate=!0),a.uri_map&&!a.uri_bumpMap&&(a.uri_bumpMap=a.uri_map,a.needsUpdate=!0))};this.toggleMRTSetting=function(){for(var b in k){var d=k[b];c(b)||a.renderer().applyMRTFlags(d)}};this.updatePixelScale=
function(a){var b=k,d;for(d in b)c(d)&&(b[d].uniforms.aaRange.value=.5/a,b[d].uniforms.pixelsPerUnit.value=a)};this.setCubeMapFromColors=function(b,c){var f=d.CreateCubeMapFromColors(b,c);h.reflectionCube=f;h.reflectionCube.isBgColor=!0;for(var g in k){var m=k[g];m.envMap=f;m.needsUpdate=!0}a.invalidate(!0)};this.setCubeMap=function(b,c){var f=function(f){f&&(f.mapping=THREE.CubeReflectionMapping,f.LogLuv=-1!=b.indexOf("logluv"),f.RGBM=-1!=b.indexOf("rgbm"),d.DecodeEnvMap(f,c,!1));h.reflectionCube=
f;if(h.reflectionCube)for(var g in k)f=k[g],f.envMap=h.reflectionCube,f.needsUpdate=!0;else h.setCubeMapFromColors(a.clearColorTop,a.clearColorBottom);a.invalidate(!0)};Array.isArray(b)?(h.reflectionCube=THREE.ImageUtils.loadTextureCube(b,THREE.CubeReflectionMapping,f),h.reflectionCube.format=THREE.RGBFormat):"string"==typeof b?-1!=b.toLowerCase().indexOf(".dds")?h.reflectionCube=(new THREE.DDSLoader).load(b,f):(h.reflectionCube=THREE.ImageUtils.loadTexture(b,THREE.SphericalReflectionMapping,f),h.reflectionCube.format=
THREE.RGBFormat):b?f(b):f(null)};this.setIrradianceMap=function(b,c){var f=function(f){if(f){f.mapping=THREE.CubeReflectionMapping;f.LogLuv=-1!=b.indexOf("logluv");f.RGBM=-1!=b.indexOf("rgbm");d.DecodeEnvMap(f,c,!1);for(var g in k){var m=k[g];m.irradianceMap=f;m.needsUpdate=!0}h.irradianceMap=f}else if(h.irradianceMap){for(g in k)m=k[g],m.irradianceMap=null,m.needsUpdate=!0;h.irradianceMap=null}a.invalidate(!0)};THREE.ImageUtils.crossOrigin="";Array.isArray(b)?(h.irradianceMap=THREE.ImageUtils.loadTextureCube(b,
THREE.CubeReflectionMapping,f),h.irradianceMap.format=THREE.RGBFormat):"string"==typeof b?-1!=b.toLowerCase().indexOf(".dds")&&(h.irradianceMap=(new THREE.DDSLoader).load(b,f)):b?f(b):f(null)};this.setTonemapMethod=function(a){for(var b in k){var c=k[b];c.tonemapOutput=a;c.needsUpdate=!0}};this.setEnvExposure=function(a){n=a=Math.pow(2,a);for(var b in k){var c=k[b];c.envMapExposure=a;c.needsUpdate=!0}};this.setTonemapExposureBias=function(a){a=Math.pow(2,a);for(var b in k){var c=k[b];c.exposureBias=
a;c.needsUpdate=!0}};this.initLayersTexture=function(a){for(var b=a.getData().layerCount,c=new Uint8Array(65536),d=0;d<b;d++)c[d]=255;b=new THREE.DataTexture(c,256,256,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);b.generateMipmaps=!1;b.flipY=!1;b.needsUpdate=!0;this.layerMaskTex=b;this.layersMap=a.getData().layersMap};this.init2DSelectionMaterial=function(a){for(var b=a.myData.maxObjectNumber||
1,c=0|Math.ceil(b/4096),d=1;d<c;)d*=2;for(var c=d,d=new Uint8Array(4096*c),f=0;f<b;f++)d[f]=0;b=new THREE.DataTexture(d,4096,c,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);b.generateMipmaps=!1;b.flipY=!1;b.needsUpdate=!0;this.selectionTex=b;a=this.create2DMaterial(a.getData(),{},!1,!0);a=k[a];a.uniforms.tSelectionTexture.value=this.selectionTex;a.uniforms.vSelTexSize.value.set(4096,c);a.needsUpdate=
!0;return a};this.setLayerVisible=function(b,d){for(var f=this.layerMaskTex,g=f.image.data,h=this.layersMap,m=d?255:0,l=0;l<b.length;++l)g[h[b[l]]]=m;f.needsUpdate=!0;for(var n in k)c(n)&&(k[n].needsUpdate=!0);a.invalidate(!0)};this.isLayerVisible=function(a){return!!this.layerMaskTex.image.data[this.layersMap[a]]};this.highlightObject2D=function(b,c){this.selectionTex.image.data[b]=c?255:0;this.selectionTex.needsUpdate=!0;a.invalidate(!1,!1,!0)};this.cloneMaterial=function(b){var c=b.clone();c instanceof
THREE.MeshPhongMaterial&&(c.exposureBias=b.exposureBias,c.irradianceMap=b.irradianceMap,c.envMapExposure=b.envMapExposure,c.proteinType=b.proteinType,c.proteinMat=b.proteinMat,c.tonemapOutput=b.tonemapOutput,c.cutplanes=b.cutplanes,c.cutplanesOutlineColor=b.cutplanesOutlineColor,c.cutplanesOutlineThickness=b.cutplanesOutlineThickness);a.renderer().applyMRTFlags(c);return c};this.getCutPlanes=function(){return l.slice()};this.getCutPlanesRaw=function(){return l};this.setCutPlanes=function(a){if(l.length!==
(a?a.length||0:0)){for(var b in k)k[b].needsUpdate=!0,a&&0<a.length&&(k[b].side=THREE.DoubleSide);for(b in m)m[b].needsUpdate=!0}for(;0<l.length;)l.pop();if(a)for(b=0;b<a.length;b++)l.push(a[b].clone())};this.setCutPlanesOutlineColor=function(a){p.set(a.r,a.g,a.b)};this.setCutPlanesOutlineThickness=function(a){for(var b in k)k[b].cutplanesOutlineThickness=a;for(b in m)m[b].cutplanesOutlineThickness=a};this.cleanup=function(a){var b={},c;for(c in this.textures){var d=this.textures[c];-1===c.indexOf(a.basePath)?
b[c]=d:d.tex&&d.tex.dispose()}this.textures=b;b={};c={type:"dispose"};for(var f in k)-1===f.indexOf(a.basePath)?b[f]=k[f]:(d=k[f],d.dispatchEvent(c),d.needsUpdate=!0);k=this.materials=b};this.addMaterial("__defaultMaterial__",this.defaultMaterial)};
function init_GroundShader(){"undefined"===typeof GroundDepthShader&&(GroundDepthShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:"#ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n        varying float vFragDepth;\n    #endif\n    uniform float logDepthBufFC;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n    #ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n    #else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n    #endif\n#endif\n}",fragmentShader:["#ifdef USE_LOGDEPTHBUF\n    uniform float logDepthBufFC;\n    #ifdef USE_LOGDEPTHBUF_EXT\n        #extension GL_EXT_frag_depth : enable\n        varying float vFragDepth;\n    #endif\n#endif",
PackDepthShaderChunk,"#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif",CutPlanesShaderChunk,"void main() {\n#if NUM_CUTPLANES > 0\nif (checkCutPlanes()) return;\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef USE_LOGDEPTHBUF_EXT\nfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n#else\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#endif\ndepth = 1.0 - depth;\ngl_FragColor = packDepth(depth);\n}"].join("\n")},
GroundShadowAOShader={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new THREE.Vector3(1,1,1)}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2(uv.x, uv.y);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:["#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif",
PackDepthShaderChunk,"#define PI 3.14159265358979\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\nreturn rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\nfloat alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\nfloat angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\nssR = alpha;\nreturn vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\nvec2 sampleOffset = unitDirection * radius;\nfloat idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\nfloat depth = 1.0 - idepth;\nif (depth < 1e-6) {\nif (radius == 0.0)\nreturn vec2(1.0, 1.0);\nelse\nreturn vec2(0.0, 1.0);\n}\nvec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\nfloat distance2 = dot(dir,dir);\nfloat idistance = 1.0 / sqrt(distance2);\nvec3 ndir = dir * idistance;\n#ifdef PRESET_2\nfloat importance = ndir.y * idistance;\n#else\nfloat importance = ndir.y / distance2;\n#endif\nvec2 ret;\nret.x = (idepth == 0.0) ? 0.0 : importance;\nret.y = importance;\nreturn ret;\n}\nvoid main() {\nvec2 sum = vec2(0.0);\nfloat angle = getRandomAngle(vUv);\nfor (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\nfloat ssR;\nvec2 uv = tapLocation(i, angle, ssR);\nsum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n}\nfloat ao = sum.x / sum.y;\ngl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}"].join("\n")},
GroundShadowBlurShader={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2(uv.x, uv.y);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:["uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif",PackDepthShaderChunk,"#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\nfloat depthVal = 0.0;\nfloat sum = 0.0;\nfor (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\ndepthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\nsum += KERNEL_VAL(x);\n}\ngl_FragColor = packDepth(depthVal/sum);\n}"].join("\n")},
GroundShadowColorShader={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new THREE.Vector4(0,0,0,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n    vUv = vec2(uv.x, uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:["uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;",PackDepthShaderChunk,"void main() {\nfloat depthVal = unpackDepth(texture2D(tDepth, vUv));\ngl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}"].join("\n")})}
var GroundShadow=function(a,b){function c(a){return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)})}init_GroundShader();var f,g,d,h,k,m,n,q,l,p,r,A,C=!1,H={texSize:64,pixScale:1,blurRadius:7,debug:!1};this.setTransform=function(a,b,c,g){f.left=-b.z/2;f.right=b.z/2;f.top=b.x/2;f.bottom=-b.x/2;f.near=1;f.far=b.y+f.near;f.updateProjectionMatrix();f.position.addVectors(a,
c.clone().multiplyScalar(-b.y/2-f.near));g&&f.up.set(g.x,g.y,g.z);f.lookAt(a);d.position.set(a.x,a.y,a.z);d.rotation.set(f.rotation.x,f.rotation.y,f.rotation.z);d.scale.set(b.z,b.x,b.y);H.debug&&(A.position.set(a.x,a.y,a.z),A.rotation.set(f.rotation.x,f.rotation.y,f.rotation.z),A.scale.set(b.z,b.x,b.y));r.uniforms.worldSize.value.copy(b)};this.renderIntoShadow=function(b){if(!b.overrideMaterial||!b.overrideMaterial.transparent){var c=b.overrideMaterial;b.overrideMaterial=n;a.render(b,f,k,!1);b.overrideMaterial=
c}};this.renderShadow=function(b,c){C&&(c?a.render(g,b,c,!1):a.render(g,b))};this.postprocess=function(){p.render(a,m,k);l.render(a,k,m);C=!0};this.clear=function(){var b=a.getClearColor().getHex(),c=a.getClearAlpha();a.setClearColor(0,0);a.clearTarget(k,!0,!0,!1);a.setClearColor(b,c);C=!1};this.setColor=function(a){q.uniforms.uShadowColor.value.x=a.r;q.uniforms.uShadowColor.value.y=a.g;q.uniforms.uShadowColor.value.z=a.b};this.getColor=function(){return new THREE.Color(q.uniforms.uShadowColor.value.x,
q.uniforms.uShadowColor.value.y,q.uniforms.uShadowColor.value.z)};this.setAlpha=function(a){q.uniforms.uShadowColor.value.w=a};this.getAlpha=function(){return q.uniforms.uShadowColor.value.w};this.isValid=function(){return C};this.getDepthMaterial=function(){return n};if(b)for(h in H)H[h]=b[h]||H[h];g=new THREE.Scene;f=new THREE.OrthographicCamera;k=new THREE.WebGLRenderTarget(H.texSize,H.texSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});
k.generateMipmaps=!1;m=new THREE.WebGLRenderTarget(H.texSize,H.texSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});m.generateMipmaps=!1;n=c(GroundDepthShader);n.side=THREE.DoubleSide;n.blending=THREE.NoBlending;l=new LmvShaderPass(GroundShadowBlurShader,"tDepth");p=new LmvShaderPass(GroundShadowBlurShader,"tDepth");r=new LmvShaderPass(GroundShadowAOShader,"tDepth");l.material.defines.KERNEL_SCALE=p.material.defines.KERNEL_SCALE=(H.pixScale/
H.texSize).toFixed(4);l.material.defines.KERNEL_RADIUS=p.material.defines.KERNEL_RADIUS=H.blurRadius.toFixed(2);r.material.blending=l.material.blending=p.material.blending=THREE.NoBlending;r.material.depthWrite=l.material.depthWrite=p.material.depthWrite=!1;r.material.depthTest=l.material.depthTest=p.material.depthTest=!1;l.material.defines.HORIZONTAL=1;q=c(GroundShadowColorShader);q.uniforms.tDepth.value=k;q.depthWrite=!1;q.transparent=!0;h=new THREE.BufferGeometry;h.addAttribute("position",new THREE.BufferAttribute(new Float32Array([-.5,
-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5]),3));h.addAttribute("uv",new THREE.BufferAttribute(new Float32Array([0,0,0,1,1,1,1,0]),2));h.addAttribute("index",new THREE.BufferAttribute(new Uint16Array([0,1,2,2,3,0]),1));d=new THREE.Mesh(h,q);g.add(d);H.debug&&(A=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:65280,wireframe:!0})),g.add(A));this.setTransform(new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0))};GroundShadow.prototype.constructor=GroundShadow;
function init_GroundReflectionShader(){"undefined"===typeof GroundReflectionCompShader&&(GroundReflectionCompShader={uniforms:{tDiffuse:{type:"t",value:null},tBackground:{type:"t",value:null},uColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tBackground;\nuniform vec4 uColor;\nvarying vec2 vUv;\nvoid main() {\nvec4 bgCol = texture2D( tBackground, vUv );\nvec4 diffCol = uColor * texture2D( tDiffuse, vUv );\ngl_FragColor = mix(bgCol, diffCol, diffCol.a);\n}"},
GroundReflectionDrawShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = texel;\n}"})}
var createShaderMaterial=function(a){return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)})},GroundReflection=function(a,b,c,f){init_GroundReflectionShader();var g=a.getContext(),d=b||512,h=c||512,k,m,n,q,l,p=!1,r=new THREE.Color(0,0,0),A,C=!1;this.outTarget=this.inTarget=void 0;var H={color:new THREE.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/
18};this.setTransform=function(a,b,c){q=a;n.normal=b;n.constant=-a.dot(b)};this.cleanup=function(){k&&k.cleanup();this.inTarget&&this.inTarget.dispose();this.outTarget&&this.outTarget.dispose()};this.setSize=function(a,b){d=a;h=b;this.cleanup();this.inTarget=new THREE.WebGLRenderTarget(d*H.texScale,h*H.texScale,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});this.inTarget.generateMipmaps=!1;this.outTarget=new THREE.WebGLRenderTarget(d*H.texScale,
h*H.texScale,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});this.outTarget.generateMipmaps=!1;k?k.setSize(d*H.texScale*H.blurTexScale,h*H.texScale*H.blurTexScale):k=new GaussianPass(d*H.texScale*H.blurTexScale,h*H.texScale*H.blurTexScale,H.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})};this.updateCamera=function(a){var b=a.position.clone().sub(q).normalize(),b=Math.PI/2-b.angleTo(n.normal);p=0>b;if(!p){0<H.fadeAngle&&(b=Math.min(H.fadeAngle,
b)/H.fadeAngle,k.setAlpha(b*H.alpha));var b=n.normal,c=n.constant,b=(new THREE.Matrix4).set(1-2*b.x*b.x,-2*b.y*b.x,-2*b.x*b.z,-2*c*b.x,-2*b.x*b.y,1-2*b.y*b.y,-2*b.y*b.z,-2*c*b.y,-2*b.x*b.z,-2*b.y*b.z,1-2*b.z*b.z,-2*c*b.z,0,0,0,1);l=a.clone();l.applyMatrix(b);l.projectionMatrix.elements[5]*=-1;l.matrixWorldNeedsUpdate=!0;l.worldUpTransform=a.worldUpTransform?a.worldUpTransform.clone():new THREE.Matrix4}};this.renderIntoReflection=function(b){p||a.render(b,l,this.inTarget)};this.renderReflection=function(b,
c){p||(g.depthRange(.9999,1),m.render(a,c,this.outTarget),g.depthRange(0,1))};this.postprocess=function(){p||(C?(A.render(a,this.outTarget),a.clearTarget(this.outTarget,!1,!0,!1)):(a.setClearColor(r,1),a.clearTarget(this.outTarget,!0,!0,!1)),k.render(a,this.outTarget,this.inTarget))};this.clear=function(){a.setClearColor(r,0);a.clearTarget(this.inTarget,!0,!0,!1)};this.setClearColors=function(a,b){b?(r.setRGB(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)),C=!a.equals(b)&&!isAndroidDevice()&&!isIOSDevice()):
(r.copy(a),C=!1);C&&(A.uniforms.color1.value.copy(a),A.uniforms.color2.value.copy(b))};this.isGroundCulled=function(){return p};this.setColor=function(a){k.setColor(H.color);H.color.set(a)};this.setAlpha=function(a){k.setAlpha(H.alpha);H.alpha=a};if(f)for(var z in H)H[z]=void 0!==f[z]?f[z]:H[z];m=new LmvShaderPass(GroundReflectionDrawShader);m.material.blending=THREE.NoBlending;m.material.depthTest=!0;m.material.depthWrite=!1;A=new LmvShaderPass(BackgroundShader);A.material.blending=THREE.NoBlending;
A.material.depthWrite=!1;A.material.depthTest=!1;this.setSize(d,h);k.setAlpha(H.color);k.setAlpha(H.alpha);n=new THREE.Plane(new THREE.Vector3(0,1,0),0);q=new THREE.Vector3(0,0,0)};GroundReflection.prototype.constructor=GroundReflection;
function init_GaussianShader(){"undefined"===typeof GaussianShader&&(GaussianShader={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n    #define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n    #define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n        #ifdef HAS_ALPHA\n            texCol.rgb *= texCol.a;\n        #endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n    #ifdef HAS_ALPHA\n        texColSum.rgb /= texColSum.a;\n    #endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}"})}
var GaussianPass=function(a,b,c,f,g){init_GaussianShader();var d=a,h=b;c=c||3;var k=f||1,m,n,q;f=g.hasAlpha||!1;var l=g.blending||!1;g=g.flipUV||!1;this.render=function(a,b,c){m.render(a,q,c);n.render(a,b,q)};this.setSize=function(a,b){this.cleanup();d=a;h=b;q=new THREE.WebGLRenderTarget(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});q.generateMipmaps=!1;m.material.defines.KERNEL_SCALE_H=n.material.defines.KERNEL_SCALE_H=(k/d).toFixed(4);
m.material.defines.KERNEL_SCALE_V=n.material.defines.KERNEL_SCALE_V=(k/h).toFixed(4);m.material.needsUpdate=n.material.needsUpdate=!0};this.cleanup=function(){q&&q.dispose()};this.setColor=function(a){n.material.uniforms.uColor.value.x=a.r;n.material.uniforms.uColor.value.y=a.g;n.material.uniforms.uColor.value.z=a.b};this.setAlpha=function(a){n.material.uniforms.uColor.value.w=a};m=new LmvShaderPass(GaussianShader);n=new LmvShaderPass(GaussianShader);this.setSize(a,b);m.material.blending=n.material.blending=
THREE.NoBlending;m.material.depthWrite=n.material.depthWrite=!1;m.material.depthTest=n.material.depthTest=!1;m.material.defines.HORIZONTAL=1;m.material.defines.KERNEL_RADIUS=n.material.defines.KERNEL_RADIUS=c.toFixed(1);l&&(n.material.transparent=!0,n.material.blending=THREE.NormalBlending);f&&(m.material.defines.HAS_ALPHA=n.material.defines.HAS_ALPHA="");g&&(m.material.defines.FLIP_UV="")};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.AnimationHandler=function(){this.animations=[]};a.AnimationHandler.prototype.init=function(a){if(!0===a.initialized)return a;for(var c=0;c<a.hierarchy.length;c++){for(var f=0;f<a.hierarchy[c].keys.length;f++)if(0>a.hierarchy[c].keys[f].time&&(a.hierarchy[c].keys[f].time=0),void 0!==a.hierarchy[c].keys[f].rot&&!(a.hierarchy[c].keys[f].rot instanceof THREE.Quaternion)){var g=a.hierarchy[c].keys[f].rot;Array.isArray(g)||(g=[g._x,g._y,g._z,g._w]);a.hierarchy[c].keys[f].rot=
(new THREE.Quaternion).fromArray(g)}for(f=1;f<a.hierarchy[c].keys.length;f++)a.hierarchy[c].keys[f].time===a.hierarchy[c].keys[f-1].time&&(a.hierarchy[c].keys.splice(f,1),f--);for(f=0;f<a.hierarchy[c].keys.length;f++)a.hierarchy[c].keys[f].index=f}a.initialized=!0;return a};a.AnimationHandler.prototype.parse=function(a){function c(a,b){b.push(a);if(a.children&&!(a instanceof THREE.Camera))for(var f=0;f<a.children.length;f++)c(a.children[f],b)}var f=[];c(a,f);return f};a.AnimationHandler.prototype.play=
function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)};a.AnimationHandler.prototype.stop=function(a){a=this.animations.indexOf(a);-1!==a&&this.animations.splice(a,1)};a.AnimationHandler.prototype.update=function(a){for(var c=0;c<this.animations.length;c++)this.animations[c].update(a)};a.Animation=function(a,c,f){this.root=a;this.handler=f.animationHandler;this.data=this.handler.init(c);this.hierarchy=this.handler.parse(a);this.viewer=f.viewer;this.animator=f;this.currentTime=0;this.timeScale=
1;this.isPlaying=!1;this.isPaused=!0;this.loop=!1;this.delta=.5;this.interpolationType=0;this.setStartAndEndKeyTime()};a.Animation.prototype.setStartAndEndKeyTime=function(){if(0<this.data.hierarchy.length){var a=this.data.hierarchy[0].keys;this.startKeyTime=a[0].time;this.endKeyTime=a[a.length-1].time}else this.startKeyTime=this.endKeyTime=0};a.Animation.prototype.keyTypes=[];a.Animation.prototype.defaultKey={};a.Animation.prototype.play=function(a){this.currentTime=void 0!==a?a:0;this.isPlaying=
!0;this.isPaused=!1;this.reset();this.handler.play(this)};a.Animation.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this);this.isPaused=!this.isPaused};a.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;this.handler.stop(this)};a.Animation.prototype.goto=function(a){this.isPlaying||this.play();this.isPaused||this.pause();this.update(a-this.currentTime)};a.Animation.prototype.reset=function(){for(var a=0,c=this.hierarchy.length;a<c;a++){var f=
this.hierarchy[a];void 0===f.animationCache&&(f.animationCache={});void 0===f.animationCache[this.data.name]&&(f.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:f.matrix});for(var f=f.animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){for(var d=this.keyTypes[g],h=this.data.hierarchy[a].keys[0],k=this.getNextKeyWith(d,a,1);k.time<this.currentTime&&k.index>h.index;)h=k,k=this.getNextKeyWith(d,a,k.index+1);f.prevKey[d]=h;f.nextKey[d]=k}}this.setStartAndEndKeyTime()};
a.Animation.prototype.getNextKeyWith=function(a,c,f){var g=this.data.hierarchy[c].keys;for(f=1===this.interpolationType||2===this.interpolationType?f<g.length-1?f:g.length-1:f%g.length;f<g.length;f++)if(void 0!==g[f][a])return g[f];return this.data.hierarchy[c].keys[0]};a.Animation.prototype.getPrevKeyWith=function(a,c,f){var g=this.data.hierarchy[c].keys;for(f=1===this.interpolationType||2===this.interpolationType?0<f?f:0:0<=f?f:f+g.length;0<=f;f--)if(void 0!==g[f][a])return g[f];return this.data.hierarchy[c].keys[g.length-
1]};a.Animation.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)};a.Animation.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())};a.MeshAnimation=function(b,c,f){a.Animation.call(this,b,c,f);this.localMatrix=new THREE.Matrix4;this.root.getAnimTransform();this.relativeTransform=c.custom&&c.custom.transform&&
"abs"===c.custom.transform?!1:!0};a.MeshAnimation.prototype=Object.create(a.Animation.prototype);a.MeshAnimation.prototype.constructor=a.MeshAnimation;a.MeshAnimation.prototype.keyTypes=["pos","rot","scl"];a.MeshAnimation.prototype.defaultKey={pos:0,rot:0,scl:0};a.MeshAnimation.prototype.update=function(){var a=[],c,f,g;return function(d){if(!1!==this.isPlaying&&(this.currentTime+=d*this.timeScale,c||(c=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Quaternion),this.resetIfLooped(),!this.isPlayingOutOfRange())){d=
0;for(var h=this.hierarchy.length;d<h;d++){for(var k=this.hierarchy[d],m=k.animationCache[this.data.name],n=0;n<this.keyTypes.length;n++){var q=this.keyTypes[n],l=m.prevKey[q],p=m.nextKey[q];if(p.time<=this.currentTime||l.time>=this.currentTime){l=this.data.hierarchy[d].keys[0];for(p=this.getNextKeyWith(q,d,1);p.time<this.currentTime&&p.index>l.index;)l=p,p=this.getNextKeyWith(q,d,p.index+1);m.prevKey[q]=l;m.nextKey[q]=p}var r=l[q],A=p[q];if(p.time!==l.time&&void 0!==r&&void 0!==A){var C=(this.currentTime-
l.time)/(p.time-l.time);0>C&&(C=0);1<C&&(C=1);"pos"===q?0===this.interpolationType?(f.x=r[0]+(A[0]-r[0])*C,f.y=r[1]+(A[1]-r[1])*C,f.z=r[2]+(A[2]-r[2])*C,k.position.copy(f)):(a[0]=this.getPrevKeyWith("pos",d,l.index-1).pos,a[1]=r,a[2]=A,a[3]=this.getNextKeyWith("pos",d,p.index+1).pos,C=.33*C+.33,q=interpolateCatmullRom(a,C),f.x=q[0],f.y=q[1],f.z=q[2],k.position.copy(f),2===this.interpolationType&&(C=interpolateCatmullRom(a,1.01*C),c.set(C[0],C[1],C[2]),c.sub(vector),c.y=0,c.normalize(),C=Math.atan2(c.x,
c.z),k.rotation.set(0,C,0))):"rot"===q?(THREE.Quaternion.slerp(r,A,g,C),k.quaternion.copy(g)):"scl"===q&&(f.x=r[0]+(A[0]-r[0])*C,f.y=r[1]+(A[1]-r[1])*C,f.z=r[2]+(A[2]-r[2])*C,k.scale.copy(f))}}this.relativeTransform&&k.updateAnimTransform()}}}}();a.CameraAnimation=function(b,c,f){a.Animation.call(this,b,c,f)};a.CameraAnimation.prototype=Object.create(a.Animation.prototype);a.CameraAnimation.prototype.constructor=a.CameraAnimation;a.CameraAnimation.prototype.keyTypes=["pos","up","target","fov","perspective"];
a.CameraAnimation.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0};a.CameraAnimation.prototype.update=function(){var a=[],c,f;return function(g){if(!1!==this.isPlaying&&(this.currentTime+=g*this.timeScale,c||(c=new THREE.Vector3,f=new THREE.Vector3),this.resetIfLooped(),!this.isPlayingOutOfRange())){g=0;for(var d=this.hierarchy.length;g<d;g++){for(var h=this.hierarchy[g],k=h.animationCache[this.data.name],m=0;m<this.keyTypes.length;m++){var n=this.keyTypes[m],q=k.prevKey[n],l=k.nextKey[n];
if(l.time<=this.currentTime||q.time>=this.currentTime){q=this.data.hierarchy[g].keys[0];for(l=this.getNextKeyWith(n,g,1);l.time<this.currentTime&&l.index>q.index;)q=l,l=this.getNextKeyWith(n,g,l.index+1);k.prevKey[n]=q;k.nextKey[n]=l}var p=q[n],r=l[n];if(l.time!==q.time&&void 0!==p&&void 0!==r){var A=(this.currentTime-q.time)/(l.time-q.time);0>A&&(A=0);1<A&&(A=1);var C;if("pos"===n)C=h.position;else if("up"===n)C=h.up;else if("target"===n)C=h.target;else if("fov"===n){h.setFov(p+(r-p)*A);continue}else if("perspective"===
n){(.5<A?r:p)?h.toPerspective():h.toOrthographic();continue}0===this.interpolationType?(f.x=p[0]+(r[0]-p[0])*A,f.y=p[1]+(r[1]-p[1])*A,f.z=p[2]+(r[2]-p[2])*A,C.copy(f)):(a[0]=this.getPrevKeyWith(n,g,q.index-1)[n],a[1]=p,a[2]=r,a[3]=this.getNextKeyWith(n,g,l.index+1)[n],A=.33*A+.33,n=interpolateCatmullRom(a,A),f.x=n[0],f.y=n[1],f.z=n[2],C.copy(f),2===this.interpolationType&&(A=interpolateCatmullRom(a,1.01*A),c.set(A[0],A[1],A[2]),c.sub(C),c.y=0,c.normalize(),A=Math.atan2(c.x,c.z),h.rotation.set(0,A,
0)))}}h.matrixAutoUpdate=!0;h.matrixWorldNeedsUpdate=!0}h.lookAt(h.target);this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}();a.VisibilityAnimation=function(b,c,f,g){a.Animation.call(this,b,c,g);this.nodeId=f;this.epsilon=.1;this.root.setMaterial(this.viewer.matman().cloneMaterial(b.getMaterial()))};a.VisibilityAnimation.prototype=Object.create(a.Animation.prototype);a.VisibilityAnimation.prototype.constructor=a.VisibilityAnimation;a.VisibilityAnimation.prototype.keyTypes=["vis","opa"];a.VisibilityAnimation.prototype.defaultKey=
{viz:1,opa:1};a.VisibilityAnimation.prototype.update=function(){return function(a){if(!1!==this.isPlaying&&(this.currentTime+=a*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){a=0;for(var c=this.hierarchy.length;a<c;a++)for(var f=this.hierarchy[a],g=f.animationCache[this.data.name],d=0;d<this.keyTypes.length;d++){var h=this.keyTypes[d],k=g.prevKey[h],m=g.nextKey[h];if(m.time<=this.currentTime||k.time>=this.currentTime){k=this.data.hierarchy[a].keys[0];for(m=this.getNextKeyWith(h,
a,1);m.time<this.currentTime&&m.index>k.index;)k=m,m=this.getNextKeyWith(h,a,m.index+1);g.prevKey[h]=k;g.nextKey[h]=m}var n=k[h],q=m[h];if(m.time!==k.time&&void 0!==n&&void 0!==q){var l=f.getMaterial();"vis"===h?(k=(h=Math.abs(this.currentTime-m.time)<this.epsilon)?m:k,n=h?q:n,1===n&&void 0===k.opa&&(l.transparent=!1,l.opacity=1),this.viewer.visibilityManager.setNodeOff(this.nodeId,!n)):"opa"===h&&(k=(this.currentTime-k.time)/(m.time-k.time),0>k&&(k=0),1<k&&(k=1),n+=(q-n)*k,l.transparent=1!==n,l.opacity=
n,0<n&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1))}}}}}();a.AnnotationAnimation=function(b,c,f){function g(a,b,c){var f=d.container=document.createElement("div"),g=a.name;f.id=g;f.style.cursor="pointer";f.style.visibility=c;var l=document.createElement("div");l.id=g+"-txt";l.style.cssText="display: none;position: absolute;z-index: 1;";f.appendChild(l);c=document.createElement("img");c.src=a.custom&&a.custom.att&&1===a.custom.att?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==";
c.id=g+"-img";c.style.cssText="display: block;position: absolute;z-index: 1;";f.appendChild(c);b.api.container.appendChild(f);f.addEventListener("click",function(){l.style.display="none"===l.style.display?"block":"none"});a=new THREE.SphereGeometry(.01);f=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0});a=new THREE.Mesh(a,f);a.visible=!1;void 0===b.overlayScenes.annotation&&b.createOverlayScene("annotation");b.addOverlay("annotation",a);return a}var d=this;null===
b&&(b=g(c,f.viewer,"hidden"));a.Animation.call(this,b,c,f);this.id=c.name;this.text="";this.state="hidden";this.epsilon=.1;this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(a){d.updateText(b.position,d.text)})};a.AnnotationAnimation.prototype=Object.create(a.Animation.prototype);a.AnnotationAnimation.prototype.constructor=a.AnnotationAnimation;a.AnnotationAnimation.prototype.keyTypes=["pos","text","vis"];a.AnnotationAnimation.prototype.defaultKey={pos:0,text:"",vis:1};
a.AnnotationAnimation.prototype.stop=function(){a.Animation.prototype.stop.call(this);this.container.parentNode.removeChild(this.container);this.viewer.removeOverlay("annotation",this.root);this.root=null};a.AnnotationAnimation.prototype.updateText=function(a,c){var f;f=this.viewer.camera;var g=this.viewer.canvas,d=a.clone(),h=new THREE.Matrix4;f.updateMatrixWorld();f.matrixWorldInverse.getInverse(f.matrixWorld);h.multiplyMatrices(f.projectionMatrix,f.matrixWorldInverse);d.applyProjection(h);f={x:(d.x+
1)*g.width/2+g.offsetLeft,y:(-d.y+1)*g.height/2+g.offsetTop};if(g=document.getElementById(this.id+"-txt"))g.innerHTML=c,g.style.left=f.x+"px",g.style.top=f.y+"px",this.text=c;if(g=document.getElementById(this.id+"-img"))g.style.left=f.x+"px",g.style.top=f.y-24+"px"};a.AnnotationAnimation.prototype.update=function(){var a=[],c,f;return function(g){if(!1!==this.isPlaying&&(this.currentTime+=g*this.timeScale,c||(c=new THREE.Vector3,f=new THREE.Vector3),this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&
this.currentTime<this.startKeyTime){var d=document.getElementById(this.id);d&&(d.style.visibility=this.state)}else{g=0;for(var h=this.hierarchy.length;g<h;g++){for(var k=this.hierarchy[g],m=k.animationCache[this.data.name],n=0;n<this.keyTypes.length;n++){var q=this.keyTypes[n],l=m.prevKey[q],p=m.nextKey[q];if(p.time<=this.currentTime||l.time>=this.currentTime){l=this.data.hierarchy[g].keys[0];for(p=this.getNextKeyWith(q,g,1);p.time<this.currentTime&&p.index>l.index;)l=p,p=this.getNextKeyWith(q,g,
p.index+1);m.prevKey[q]=l;m.nextKey[q]=p}var r=l[q],A=p[q];if(p.time!==l.time&&void 0!==r&&void 0!==A)if(d=(this.currentTime-l.time)/(p.time-l.time),0>d&&(d=0),1<d&&(d=1),"pos"===q)if(0===this.interpolationType)f.x=r[0]+(A[0]-r[0])*d,f.y=r[1]+(A[1]-r[1])*d,f.z=r[2]+(A[2]-r[2])*d,k.position.copy(f);else{if(1===this.interpolationType||2===this.interpolationType)a[0]=this.getPrevKeyWith("pos",g,l.index-1).pos,a[1]=r,a[2]=A,a[3]=this.getNextKeyWith("pos",g,p.index+1).pos,d=.33*d+.33,p=interpolateCatmullRom(a,
d),f.x=p[0],f.y=p[1],f.z=p[2],k.position.copy(f),2===this.interpolationType&&(p=interpolateCatmullRom(a,1.01*d),c.set(p[0],p[1],p[2]),c.sub(vector),c.y=0,c.normalize(),p=Math.atan2(c.x,c.z),k.rotation.set(0,p,0))}else"text"===q?(p=Math.abs(this.currentTime-p.time)<this.epsilon?A:r,this.updateText(k.position,p)):"vis"===q&&(d=document.getElementById(this.id))&&(p=Math.abs(this.currentTime-p.time)<this.epsilon?A:r,d.style.visibility=p?"visible":"hidden")}k.matrixAutoUpdate=!0;k.matrixWorldNeedsUpdate=
!0}}}}();a.PolylineAnimation=function(b,c,f){this.viewer=f.viewer;null===b&&(b=this.createPolyline([]));a.Animation.call(this,b,c,f);this.epsilon=.1};a.PolylineAnimation.prototype=Object.create(a.Animation.prototype);a.PolylineAnimation.prototype.constructor=a.PolylineAnimation;a.PolylineAnimation.prototype.keyTypes=["points","vis"];a.PolylineAnimation.prototype.defaultKey={points:[],vis:1};a.PolylineAnimation.prototype.stop=function(){a.Animation.prototype.stop.call(this);this.viewer.removeOverlay("polyline",
this.root);this.root=null};a.PolylineAnimation.prototype.update=function(){function a(b){b.root&&(b.viewer.removeOverlay("polyline",b.root),b.root=null)}return function(c){if(!1!==this.isPlaying&&(this.currentTime+=c*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)a(this);else{c=0;for(var f=this.hierarchy.length;c<f;c++)for(var g=this.hierarchy[c].animationCache[this.data.name],d=0;d<this.keyTypes.length;d++){var h=this.keyTypes[d],
k=g.prevKey[h],m=g.nextKey[h];if(m.time<=this.currentTime||k.time>=this.currentTime){k=this.data.hierarchy[c].keys[0];for(m=this.getNextKeyWith(h,c,1);m.time<this.currentTime&&m.index>k.index;)k=m,m=this.getNextKeyWith(h,c,m.index+1);g.prevKey[h]=k;g.nextKey[h]=m}var n=k[h],q=m[h];if(m.time!==k.time&&void 0!==n&&void 0!==q)if(k=(this.currentTime-k.time)/(m.time-k.time),0>k&&(k=0),1<k&&(k=1),"points"===h){h=.5>k?n:q;this.viewer.removeOverlay("polyline",this.root);this.root=null;for(var m=[],l=0;l<
h.length;l++){var p=h[l].slice();if(0===l)p[0]=n[l][0]+(q[l][0]-n[l][0])*k,p[1]=n[l][1]+(q[l][1]-n[l][1])*k,p[2]=n[l][2]+(q[l][2]-n[l][2])*k;else if(l===h.length-1){var r=n.length-1,A=q.length-1;p[0]=n[r][0]+(q[A][0]-n[r][0])*k;p[1]=n[r][1]+(q[A][1]-n[r][1])*k;p[2]=n[r][2]+(q[A][2]-n[r][2])*k}p=new THREE.Vector3(p[0],p[1],p[2]);m.push(p)}this.root=this.createPolyline(m)}else"vis"===h&&(n=Math.abs(this.currentTime-m.time)<this.epsilon?q:n,(this.root.visible=n)||a(this))}}}}();a.PolylineAnimation.prototype.createPolyline=
function(a){for(var c=new THREE.Geometry,f=0;f<a.length;f++)c.vertices.push(a[f]);c.computeLineDistances();a=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1});c=new THREE.Line(c,a,THREE.LineStrip);void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline");this.viewer.addOverlay("polyline",c);return c};a.interpolateCatmullRom=function(a,c){function f(a,b,c,d,f,g,h){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*h+(-3*(b-c)-2*a-d)*g+a*f+b}var g=[],d=[],
h,k,m,n,q,l;h=(a.length-1)*c;k=Math.floor(h);h-=k;g[0]=0===k?k:k-1;g[1]=k;g[2]=k>a.length-2?k:k+1;g[3]=k>a.length-3?k:k+2;k=a[g[0]];n=a[g[1]];q=a[g[2]];l=a[g[3]];g=h*h;m=h*g;d[0]=f(k[0],n[0],q[0],l[0],h,g,m);d[1]=f(k[1],n[1],q[1],l[1],h,g,m);d[2]=f(k[2],n[2],q[2],l[2],h,g,m);return d}})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.KeyFrameAnimator=function(a,b){this.animations=[];this.viewer=a;this.keys=[];this.isPlaying=!1;this.isPaused=!0;this.updateFlag=0;this.duration=b;this.currentTime=0;this.onPlayCallback=null;this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler;this.areCameraAnimationsPaused=!1;this.UPDATE_SCENE=1;this.UPDATE_CAMERA=2};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.add=function(a){if(!(!a.hierarchy||1>a.hierarchy.length||!a.hierarchy[0].keys||2>a.hierarchy[0].keys.length)){var b=null,c=this;"camera"===a.type?(b=new Autodesk.Viewing.Private.CameraAnimation(c.viewer.camera,a,c),c.animations.push(b)):"annotation"===a.type?(b=new Autodesk.Viewing.Private.AnnotationAnimation(null,a,c),c.animations.push(b)):"polyline"===a.type?(b=new Autodesk.Viewing.Private.PolylineAnimation(null,a,c),c.animations.push(b)):"mesh"!==
a.type&&"visibility"!==a.type||c.viewer.model.getData().instanceTree.enumNodeFragments(a.id,function(d){if(d=c.viewer.getFragmentProxy(c.viewer.model,d))b="mesh"===a.type?new Autodesk.Viewing.Private.MeshAnimation(d,a,c):new Autodesk.Viewing.Private.VisibilityAnimation(d,a,a.id,c),c.animations.push(b)},!0);if(b){for(var f=0,g=a.hierarchy.length;f<g;f++)for(var d=a.hierarchy[f].keys,h=0;h<d.length;h++)void 0===d[h].xk&&c.keys.push(d[h].time);(function(a){a.sort(function(a,b){return a-b});(function(a,
b,c){for(b=a.length;c=--b;)for(;c--;)a[b]!==a[c]||a.splice(c,1)})(a)})(c.keys)}this.updateFlag|=this.UPDATE_SCENE}};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.update=function(a){this.animationHandler.update(a);var b=this.updateFlag;if(this.isPlaying&&!this.isPaused){this.currentTime+=a;this.currentTime=Math.min(this.currentTime,this.duration);if(this.onPlayCallback)this.onPlayCallback(0<this.duration?this.currentTime/this.duration*100:0);this.currentTime>=this.duration&&this.pause();b|=this.UPDATE_SCENE}this.updateFlag=0;return b};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.play=function(a,b){this.onPlayCallback=b;this.currentTime>=this.duration&&this.goto(0);if(this.isPlaying)this.pause();else{for(var c=0;c<this.animations.length;c++)this.animations[c].play(a);this.isPlaying=!0;this.isPaused=!1}};Autodesk.Viewing.Private.KeyFrameAnimator.prototype.pause=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b.isPaused===this.isPaused&&b.pause()}this.areCameraAnimationsPaused=this.isPaused=!this.isPaused};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.pauseCameraAnimations=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b instanceof Autodesk.Viewing.Private.CameraAnimation&&b.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused};Autodesk.Viewing.Private.KeyFrameAnimator.prototype.stop=function(){for(var a=0;a<this.animations.length;a++)this.animations[a].stop();this.isPaused=this.isPlaying=!1};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.goto=function(a){if(void 0!==a){for(var b=0;b<this.animations.length;b++)this.animations[b].goto(a);this.isPaused=this.isPlaying=!0;this.currentTime=a;this.updateFlag|=this.UPDATE_SCENE}};Autodesk.Viewing.Private.KeyFrameAnimator.prototype.next=function(){for(var a=this.keys,b=-1,c=0;c<a.length;c++)if(a[c]>this.currentTime){b=a[c];break}this.goto(0>b?a[a.length-1]:b)};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.prev=function(){for(var a=this.keys,b=-1,c=a.length-1;-1<c;c--)if(a[c]<this.currentTime){b=a[c];break}this.goto(0>b?a[0]:b)};AutodeskNamespace("Autodesk.Viewing.Private");void 0===ENABLE_DEBUG&&(ENABLE_DEBUG=!0);void 0===ENABLE_TRACE&&(ENABLE_TRACE=!0);var RENDER_NORMAL=0,RENDER_HIGHLIGHTED=1,RENDER_HIDDEN=2,RENDER_FINISHED=3;
Autodesk.Viewing.Private.Viewer3DImpl=function(a,b){function c(a){var b=l,c=b==RENDER_NORMAL,d=F.settings.idbuffer&&b!=RENDER_HIDDEN;b==RENDER_HIDDEN?a.overrideMaterial=h.fadeMaterial:b==RENDER_HIGHLIGHTED&&(a.overrideMaterial=h.highlightMaterial);F.renderScenePart(a,!0,c,d);a.overrideMaterial=null}function f(){if((U.enabled||P)&&!h.is2d){var a;if(a=h.model&&!h.model.isLoadDone()?h.model.getData().bbox:h.getVisibleBounds(!0,!1)){U.needClear=!0;var b=h.camera,c=a.clone(),d=new THREE.Vector3(1,0,0),
f=c.center();a=c.size();b.worldUpTransform&&(d.applyMatrix4(b.worldUpTransform),c.applyMatrix4(b.worldUpTransform),a=c.size());a.multiply(new THREE.Vector3(1.25,1.01,1.25));a.x=a.z=Math.max(a.x,a.z);U.setTransform(f,a,b.worldup,d);P&&(c=(new THREE.Vector3).subVectors(f,b.worldup.clone().multiplyScalar(a.y/2)),P.setTransform(c,b.worldup,a))}}}function g(a,b){b.updateMatrixWorld(!0);b.traverse(function(b){var c=b.geometry;void 0!==c&&(c.boundingBox||c.computeBoundingBox(),N.copy(c.boundingBox),N.applyMatrix4(b.matrixWorld),
a.union(N))})}function d(a){if(-1==a.indexOf(";base64,")){var b=a.split(",");a=b[0].split(":")[1];b=decodeURIComponent(b[1]);return new Blob([b],{type:a})}b=a.split(";base64,");a=b[0].split(":")[1];for(var b=window.atob(b[1]),c=b.length,d=new Uint8Array(c),f=0;f<c;++f)d[f]=b.charCodeAt(f);return new Blob([d],{type:a})}var h=this,k=Autodesk.Viewing.Private,m=1E3/15,n=1E3/30,q=1E3/120,l=RENDER_NORMAL,p=-1,r=-1,A=!1,C=new THREE.Vector3(0,1,0),H="y",z,t,w,E,B,D,J,F,G=!1,M=!1,I=!1,L=!1,K,O=0,R=0,X=0,W=
0,aa=1E3/60,fa=!0,U,P,Z=function(){var a,b=0,c=0,d=0;return function(f){if(U.enabled&&!h.is2d&&B&&!fa)if(f&&(U.rendered=!1),a!=B.getGeomScenes()&&(U.needClear=!0),U.needClear&&(U.clear(),U.needClear=!1,a=B.getGeomScenes(),b=a.length,c=0,d=Math.max(Math.ceil(b/10),10)),U.isValid())U.rendered||P&&P.progressive||(U.renderShadow(h.camera,F.getColorTarget()),U.rendered=!0);else{for(f=0;f<d&&c<b;){var g=a[c];g&&(g.forceVisible=!0,U.renderIntoShadow(g),g.forceVisible=!1,f++);c++}c>=b&&U.postprocess()}}}(),
S=function(){var a,b=0,c=0,d=0;return function(f){if(P&&(!P.finished||f)&&!h.is2d&&B&&!fa){if(f){P.clear();P.updateCamera(h.camera);P.rendered=!1;P.finished=!1;if(P.isGroundCulled())return;a=B.getGeomScenes();b=a.length;c=0;d=Math.max(Math.ceil(b/20),1)}if(!P.isGroundCulled()){for(f=0;f<d&&c<b;){var g=a[c];g&&(g.forceVisible=!0,P.renderIntoReflection(g),g.forceVisible=!1,f++);c++}c<b?P.rendered=!1:P.finished=!0;P.rendered||P.isGroundCulled()||!(P.finished||P.progressive&&!B.isDone())||(P.postprocess(),
U.enabled&&U.isValid()&&(U.renderShadow(h.camera,P.outTarget),U.rendered=!0),P.renderReflection(h.camera,F.getColorTarget()),P.rendered=!0,B.isDone()&&(h.showGhosting&&!B.areAllVisible()?(l=RENDER_HIDDEN,B.reset(h.camera,l)):F.presentBuffer()))}}}}();this.run=function(){z=0;(function V(a){z=window.requestAnimationFrame(V);t&&t&&(h.camera.aspect=w/E,F.setSize(w,E),h.controls.handleResize(),P&&P.setSize(w,E),h.invalidate(!0,!0,!0),t=!1,h.api.fireEvent({type:Autodesk.Viewing.VIEWER_RESIZE_EVENT}));D.updateMaterials();
var b;if(h.keyFrameAnimator)a:{if(h.keyFrameAnimator&&(b=h.keyFrameAnimator.update(0<W?(a-W)/1E3:0))&&(h.sceneUpdated(!0),b&h.keyFrameAnimator.UPDATE_CAMERA)){b=!0;break a}b=!1}else b=!1;b=h.controls.update(a)||b||K;G=G||b;if((I=I||b)&&B){var d=B.getFragmentList(),g;for(g in h.selectionMeshes)d.getWorldMatrix(g,h.selectionMeshes[g].matrix)}I=I||F.overlayUpdate(a);g=h.model&&(h.model.isLoadDone()||1==h.model.myData.partPacksLoadDone);var k=d=h.progressiveRender?h.targetFrameTime:1E10,p=B;L&&L&&(f(),
L=!1);G||M?(g&&h.signalProgress(0,null),0<R&&(X=.75*X+.25*(a-R)),R=a,X<n&&d<m?h.targetFrameTime+=1:X>n&&d>q&&--h.targetFrameTime,h.updateCameraMatrices(),F.beginScene(h.scene,h.camera,h.lights,G),b&&h.api.fireEvent(h.cameraChangedEvent),p&&(l=p.hasHighlighted()?RENDER_HIGHLIGHTED:RENDER_NORMAL,p.reset(h.camera,l,b|G))):R=-1;Z(G);S(G);if(p&&!p.isDone())if(k=p.renderSome(c,k),p.isDone()&&l===RENDER_HIGHLIGHTED&&(l=RENDER_NORMAL,p.reset(h.camera,l),p.renderSome(c,k)),b||I||(0<W&&(aa=.8*aa+.2*(a-W)),
F.composeFinalFrame()),p.isDone()){if(l===RENDER_NORMAL&&!p.areAllVisible()&&h.showGhosting){if(!P||P.finished)l=RENDER_HIDDEN,p.reset(h.camera,l)}else l=RENDER_FINISHED,F.renderScenePart(h.sceneAfter,!0,!0,!0),F.composeFinalFrame(b&&h.skipAOWhenMoving,!0);g&&h.signalProgress(100,null)}else g&&h.signalProgress(100*p.getRenderProgress(),null);I&&(p&&p.isDone()||h.showOverlaysWhileMoving?(h.renderOverlays(),p&&!p.isDone()&&(I=!0)):F.clearAllOverlays(),F.renderScenePart(h.sceneAfter,!0,!0,!0),F.composeFinalFrame((b||
!p||!p.isDone())&&h.skipAOWhenMoving,p&&p.isDone()),0<W&&(aa=.8*aa+.2*(a-W)));A&&!b&&h.skipAOWhenMoving&&F.composeFinalFrame();A=b;W=a;p&&p.needsRender()?(M=!0,p.resetNeedsRender()):M=!1;K=G=!1})()};this.toggleProgressive=function(a){this.progressiveRender=a;G=!0};this.toggleGhosting=function(a){this.showGhosting=a;G=!0};this.toggleOverlaysWhileMoving=function(a){this.showOverlaysWhileMoving=a};this.togglePostProcess=function(a,b){F.initPostPipeline(a,b);this.fireRenderOptionChanged();G=!0};this.toggleCelShading=
function(a){F.toggleCelShading(a);this.fireRenderOptionChanged();G=!0};this.toggleGroundShadow=function(a){U.enabled!==a&&(U.enabled=a,U.needClear=!0,f(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))};this.setGroundShadowColor=function(a){U.enabled&&(U.setColor(a),this.invalidate(!0,!1,!1))};this.setGroundShadowAlpha=function(a){U.enabled&&(U.setAlpha(a),this.invalidate(!0,!1,!1))};this.toggleGroundReflection=function(a){a&&P||!a&&!P||(a?(P=new GroundReflection(J,this.canvas.clientWidth,
this.canvas.clientHeight),P.setClearColors(this.clearColorTop,this.clearColorBottom),P.progressive=!0,f()):(P.cleanup(),P=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))};this.setGroundReflectionColor=function(a){P&&(P.setColor(a),this.invalidate(!0,!1,!1))};this.setGroundReflectionAlpha=function(a){P&&(P.setAlpha(a),this.invalidate(!0,!1,!1))};this.setOptimizeNavigation=function(a){this.skipAOWhenMoving=a};this.renderOverlays=function(){var a=this.lightsOn;a||this.toggleLights(!0,
!0);var b;this.dir_light1&&(b=this.dir_light1.intensity,this.dir_light1.intensity=1);F.renderOverlays(this.overlayScenes,this.lights);a||this.toggleLights(!1,!0);this.dir_light1&&(this.dir_light1.intensity=b);I=!1};this.setLayerVisible=function(a,b){this.matman().setLayerVisible(a,b)};this.isLayerVisible=function(a){return this.matman().isLayerVisible(a)};this.updateCameraMatrices=function(){var a=new THREE.Matrix4,b=new THREE.Matrix4,c=new THREE.Box3;return function(){var d=this.camera;a.compose(d.position,
d.quaternion,d.scale);b.getInverse(a);d.worldup&&this.setWorldUp(d.worldup);if(this.model){var f=this.getVisibleBounds(!0,!1);c.copy(f);c.applyMatrix4(b);var g=1E-5*(c.max.z-c.min.z),h=.5*(c.max.y-c.min.y),k=-(c.max.z+g)-h,g=-(c.min.z-g)+h;d.isPerspective&&(k=Math.max(k,Math.min(1,1E-4*Math.abs(g-k))));g=Math.max(g,k);d.near=k;d.far=g;d.updateProjectionMatrix();this.model.is2d()?f=(k=this.intersectGroundViewport(new THREE.Vector3(0,0,1)))?d.position.distanceTo(k):d.position.distanceTo(f.center()):
((k=D.getCutPlanesRaw())&&k.length?(g=k[0],k=d.target.clone().sub(d.position).normalize(),h=k.dot(g),0===h?f=f.center():(f=-(d.position.clone().dot(g)+g.w)/h,f=k.multiplyScalar(f).add(d.position))):f=f.center(),f=d.position.distanceTo(f));d=F.settings.deviceHeight/(2*f*Math.tan(THREE.Math.degToRad(.5*d.fov)));D.updatePixelScale(.5*d)}}}();this.initLights=function(a){var b=k.LightPresets[p].lightMultiplier;this.lightNode=new THREE.Object3D;this.dir_light1=new THREE.DirectionalLight((new THREE.Color).setRGB(1,
1,1),b);this.dir_light1.position.set(-1,0,1);this.dir_light1.position.multiplyScalar(1E3*a);this.lightNode.add(this.dir_light1);this.amb_light=new THREE.AmbientLight((new THREE.Color).setRGB(1,1,1));this.camera.add(this.lightNode);this.toggleLights(0!==b)};this.toggleLights=function(a,b){if(this.amb_light&&this.lightNode){a&&!this.lightsOn?(this.lights=[this.dir_light1,this.amb_light],this.lightsOn=!0):!a&&this.lightsOn&&(this.lightsOn=!1,this.lights=[]);var c=k.LightPresets[p],d=c.ambientLightColor,
c=c.directLightColor;this.lightsOn?(b&&this.amb_light?this.amb_light.color.setRGB(.5*c[0],.5*c[1],.5*c[2]):d&&this.amb_light&&this.amb_light.color.setRGB(d[0],d[1],d[2]),c&&this.dir_light1&&this.dir_light1.color.setRGB(c[0],c[1],c[2])):d&&this.amb_light&&b&&this.amb_light.color.setRGB(d[0],d[1],d[2])}};this.syncCamera=function(a){this.camera.updateProjectionMatrix();a&&this.setWorldUp(this.api.navigation.getWorldUpVector());K=!0};this.setViewFromFile=function(a,b){var c;c=a.getDefaultCamera();if(!c){c=
{};var d=a.getBoundingBox(),f=d.size();c.target=d.center();a.is2d()?(c.isPerspective=!1,d=this.camera.aspect,c.orthoScale=d>f.x/f.y?f.y:f.x/d,c.up=new THREE.Vector3(0,0,1),c.position=c.target.clone(),c.position.z+=c.orthoScale,c.target.y+=1E-6*f.y):(c.isPerspective=!0,c.fov=this.camera.fov,c.up=this.camera.up.clone(),c.position=c.target.clone(),c.position.z+=1.5*Math.max(f.x,f.y,f.z))}this.setViewFromCamera(c,b)};this.adjustOrthoCamera=function(a){if(!a.isPerspective&&this.model){var b=this.model.getBoundingBox(),
c=b.size(),d=a.target.clone().sub(a.position);d.length()>1E3*c.length()?(b=a.position.distanceTo(b.center()),a.target.copy(a.position).add(d.normalize().multiplyScalar(b))):a.position.copy(a.target).add(d.normalize().multiplyScalar(-a.orthoScale))}};this.setViewFromCamera=function(a,b){this.adjustOrthoCamera(a);var c=this.model?this.model.getUpVector():null;this.model&&-1!=this.model.getData().basePath.indexOf("SaRang")&&(c=[0,0,1]);var d;d=c?(new THREE.Vector3).fromArray(c):Autodesk.Viewing.Navigation.snapToAxis(a.up.clone());
a.up=d;c=this.api.navigation;b?(d=this.camera,d.up.copy(a.up),d.position.copy(a.position),d.target.copy(a.target),a.isPerspective?d.fov=a.fov:(d.saveFov=a.fov,d.fov=Autodesk.Viewing.UnifiedCamera.ORTHO_FOV),d.isPerspective=a.isPerspective,d.orthoScale=a.orthoScale,d.dirty=!0,c.setWorldUpVector(d.up),c.setView(d.position,d.target),c.setPivotPoint(d.target),this.syncCamera(!0)):(this.camera.isPerspective=a.isPerspective,d=c.computeOrthogonalUp(a.position,a.target),c.setRequestTransitionWithUp(!0,a.position,
a.target,a.fov,d,a.up));K=!0};this.setViewFromViewBox=function(a,b,c,d){if(a.is2d()){c={};a=a.getBoundingBox();var f=b[2]-b[0],g=b[3]-b[1],h;h=b[0]+f/2;b=b[1]+g/2;var k=this.camera.aspect;c.orthoScale=k>f/g?g:f/k;c.isPerspective=!1;c.position=new THREE.Vector3(h,b,a.center().z+c.orthoScale);c.target=new THREE.Vector3(h,b,a.center().z);c.target.y+=1E-6*g;c.up=new THREE.Vector3(0,0,1);this.setViewFromCamera(c,d)}};this.setWorldUp=function(a){if(!C.equals(a)){C.copy(a);var b=Math.abs(a.x);H="x";Math.abs(a.y)>
b&&(H="y",b=Math.abs(a.y));Math.abs(a.z)>b&&(H="z");var c=new THREE.Vector3(0,1,0),b=h.camera,d=(new THREE.Vector3).crossVectors(a,c).normalize();a=Math.acos(c.dot(a));a=(new THREE.Matrix4).makeRotationAxis(d,a);b.worldUpTransform=a;this.sceneUpdated(!1)}};this.setModel=function(a){a&&(this.model=a,this.selector.setModel(this.model),this.visibilityManager.setModel(this.model),this.model.setLoader(this.loader),this.initScene())};this.initScene=function(){if(this.model){var a=this.model,b=a.getBoundingBox();
F.setUnitScale(a.getUnitScale());var c=a.is2d();c&&this.enter2DMode();this.api.navigation.setIs2D(c);this.api.setActiveNavigationTool();B=new RenderQueue(a);this.setViewFromFile(a,!0);this.controls.recordHomeView();a=.5*b.size().length();this.initLights(a);c||this.setLightPresetFromFile()||this.setLightPreset(p,!0);this.invalidate(!0)}};this.getSvfMaterialId=function(a){return B.getSvfMaterialId(a)};this.addGeometry=function(a,b,c){return B.getGeometryList().addGeometry(a,b,c)};this.getMaterials=
function(){return D};this.addMeshInstance=function(a,b,c,d,f){var g=this.model.getData();a=B.getGeometryList().getGeometry(a);if(0===b&&-1!=g.basePath.indexOf("SaRang"))return 0;var h;if(a.isLines){var k=!!a.attributes.color;h=new THREE.LineBasicMaterial({vertexColors:k});k||(c=D.findMaterial(g,c),h.color=c.color);h=new THREE.Mesh(a,h,!g.animations);h.isLine=!0;g.hasLines=!0}else{if(h=D.findMaterial(g,c))h.svfMatId=c;D.applyGeometryFlagsToMaterial(h,a);h=new THREE.Mesh(a,h,!g.animations);h.materialId=
parseInt(c);a.is2d&&(h.is2d=!0)}d&&(h.matrix&&h.matrix.copy(d),h.matrixWorld.copy(d));h.matrixAutoUpdate=!1;return B.addMeshInstance(b,h,f)};this.onLoadComplete=function(){function a(){if(b.animations){c.keyFrameAnimator=new Autodesk.Viewing.Private.KeyFrameAnimator(c,b.animations.duration);for(var d in b.animations.animations)c.keyFrameAnimator.add(b.animations.animations[d]);c.keyFrameAnimator.goto(0);c.api.fireEvent({type:Autodesk.Viewing.ANIMATION_READY_EVENT})}c.api.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,
a)}fa=!1;this.signalProgress(100,"");this.sceneUpdated(!1);this.is2d&&(this.selectionMaterial2d=D.init2DSelectionMaterial(this.model),this.createOverlayScene("selection2d",this.selectionMaterial2d));var b=this.model.getData();B.getGeometryList().printStats();b.hasLines&&D.togglePolygonOffset(!0);var c=this;this.model.isObjectTreeCreated()?a():this.api.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,a);this.api.fireEvent({type:Autodesk.Viewing.GEOMETRY_LOADED_EVENT})};this.setBVH=function(a,
b){B.setBVH(a,b)};this.signalProgress=function(a,b){this.api.fireEvent({type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,percent:a,message:b})};this.resize=function(a,b){t=!0;w=a;E=b};this.enter2DMode=function(){this.is2d=!0;D.initLayersTexture(this.model);var a=D.create2DMaterial(this.model.getData(),{},!0),a=D.findMaterial(this.model.getData(),a);F.enter2DMode(a);r=p;this.setLightPreset(k.DefaultLightPreset2d);a=this.model.getData();if(a.hidePaper){var b=a.bgColor,a=b>>16&255,c=b>>8&255,b=b&255;this.setClearColors(a,
c,b,a,c,b)}this.fireRenderOptionChanged();G=!0};this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlay("selection2d"),F.exit2DMode());F.beginScene(this.scene,this.camera,this.lights,!0);F.composeFinalFrame();B&&(B.cleanup(this.glrenderer()),B=null);this.model&&(D.cleanup(this.model.getData()),this.model=null);0<=r&&(p=r)};this.createOverlayScene=function(a,b,c,d){b&&D.addMaterialNonHDR(a+"_pre",b);c&&D.addMaterialNonHDR(a+"_post",c);var f=
new THREE.Scene;f.__lights=this.scene.__lights;this.overlayScenes[a]={scene:f,camera:d,materialPre:b,materialPost:c}};this.removeOverlayScene=function(a){this.overlayScenes[a]&&(delete this.overlayScenes[a],this.invalidate(!1,!1,!0))};this.addOverlay=function(a,b){this.overlayScenes[a].scene.add(b);this.invalidate(!1,!1,!0)};this.removeOverlay=function(a,b){this.overlayScenes[a].scene.remove(b);this.invalidate(!1,!1,!0)};this.clearOverlay=function(a){if(this.overlayScenes[a]){a=this.overlayScenes[a].scene;
var b,c;for(c=a.children.length-1;0<=c;--c)(b=a.children[c])&&a.remove(b);this.invalidate(!1,!1,!0)}};this.setClearColors=function(a,b,c,d,f,g){this.clearColorTop=new THREE.Vector3(a/255,b/255,c/255);this.clearColorBottom=new THREE.Vector3(d/255,f/255,g/255);D.reflectionCube&&!D.reflectionCube.isBgColor||D.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);F.setClearColors(this.clearColorTop,this.clearColorBottom);P&&P.setClearColors(this.clearColorTop,this.clearColorBottom);G=!0;this.fireRenderOptionChanged()};
var N=new THREE.Box3;this.getVisibleBounds=function(a,b){var c=null;if(B&&(c=new THREE.Box3,g(c,this.scene),c=B.getVisibleBounds(a).union(c),b)){var d=new THREE.Box3,f=h.overlayScenes,k;for(k in f)f.hasOwnProperty(k)&&g(d,f[k].scene);g(d,h.scene);c=d.union(c)}return c};this.getFitBounds=function(a){var b;this.is2d&&(a=!0);a||null===this.selector||(b=this.selector.getSelectionBounds());if(!b||b.empty())b=this.getVisibleBounds();return b};this.getRenderProxy=function(a,b){return B?B.getFragmentList().getVizmesh(b):
null};this.getFragmentProxy=function(a,b){return B?new FragmentPointer(B.getFragmentList(),b):null};this.getRenderProxyCount=function(a){return B?B.getFragmentList().getCount():0};this.getRenderProxyDbIds=function(a,b){return B?B.getFragmentList().getDbIds(b):null};this.setFragmentVisibility=function(a,b,c){B&&(B.setVisibility(b,c),this.sceneUpdated(!0))};this.setFragmentOff=function(a,b,c){B&&(B.setFragOff(b,c),this.sceneUpdated(!0))};this.setModelVisibility=function(a,b){B&&(B.setAllVisibility(b),
this.sceneUpdated(!0))};this.isWholeModelVisible=function(a){return B?B.areAllVisible():!0};this.resetIsolation=function(a){B&&(this.needGhostedPass=!1,this.invalidate(!0))};this.highlightObjectNode=function(a,b,c,d){a.is2d()&&D.highlightObject2D(b,c);var f=this,g=a.getData().instanceTree;if(g&&!a.is2d())g.enumNodeFragments(b,function(b){f.highlightFragment(a,b,c,d)},!1);else if(g=b,a.is2d()&&(g=a.getData().fragments.dbId2fragId[b]),Array.isArray(g))for(b=0;b<g.length;b++)f.highlightFragment(a,g[b],
c,d);else f.highlightFragment(a,g,c,d)};this.highlightFragment=function(a,b,c,d){var f=this.getRenderProxy(a,b);if(f){if(d=!d||f.is2d)if(a=a.is2d()?"selection2d":"selection",c){var g=new THREE.Mesh(f.geometry,f.material);g.matrix.copy(f.matrixWorld);g.matrixAutoUpdate=!1;g.matrixWorldNeedsUpdate=!0;g.frustumCulled=!1;this.addOverlay(a,g);this.selectionMeshes[b]=g}else this.selectionMeshes[b]&&(this.removeOverlay(a,this.selectionMeshes[b]),delete this.selectionMeshes[b]);d&&c||B.setHighlighted(b,c)&&
this.invalidate(!0)}};this.explode=function(a){if(a!=O&&this.model){O=a;var b=this.model.getData();if(b.instanceTree){var c=this.getVisibleBounds(!0).center(),d=b.fragments,f=a*(b.instanceTree.maxDepth-1)+1,g=0|f,h=f-g,k=B.getFragmentList(),m=new THREE.Vector3;a*=2;if(b.instanceTree&&b.instanceTree.boxes&&0!==a){var l=b.instanceTree.boxes;(function Ja(c,d,f,n,q,p,L,t){var w=2*a;d==g&&(w*=h);var z=6*c,r=.5*(l[z]+l[z+3]),K=.5*(l[z+1]+l[z+4]),B=.5*(l[z+2]+l[z+5]);0<d&&d<=g&&(p+=(r-f)*w,L+=(K-n)*w,t+=
(B-q)*w);b.instanceTree.enumNodeChildren(c,function(a){Ja(a,d+1,r,K,B,p,L,t)},!1);b.instanceTree.enumNodeFragments(c,function(a){m.x=p;m.y=L;m.z=t;k.updateAnimTransform(a,null,null,m)},!1)})(b.instanceTree.getRootId(),0,c.x,c.y,c.x,0,0,0)}else for(var f=d.boxes,n=0,d=d.length;n<d;n++)if(0==a)k.updateAnimTransform(n);else{var q=6*n,p=.5*(f[q]+f[q+3]),L=.5*(f[q+1]+f[q+4]),q=.5*(f[q+2]+f[q+5]),p=a*(p-c.x),L=a*(L-c.y),q=a*(q-c.z);m.x=p;m.y=L;m.z=q;k.updateAnimTransform(n,null,null,m)}this.sceneUpdated(!0);
this.api.fireEvent({type:Autodesk.Viewing.EXPLODE_CHANGE_EVENT})}}};this.getExplodeScale=function(){return O};this.setGhostingBrightness=function(a){this.fadeMaterial.color=a?new THREE.Color(1052688):new THREE.Color(16777215);this.fadeMaterial.needsUpdate=!0};this.setLightPreset=function(a,b){if(p!=a||b){if(0>a||k.LightPresets.length<=a)a=k.DefaultLightPreset;p=a;var c=k.LightPresets[a];if(c&&c.path){var d="res/environments/"+c.path,f=k.getResourceUrl(d+"_mipdrop."+(c.type||"")+".dds"),d=k.getResourceUrl(d+
"_irr."+(c.type||"")+".dds");D.setIrradianceMap(d,c.E_bias);D.setCubeMap(f,c.E_bias);D.setEnvExposure(-c.E_bias);this.setTonemapExposureBias(c.E_bias);this.setTonemapMethod(c.tonemap);this.setGhostingBrightness(c.darkerFade)}else D.setIrradianceMap(null),D.setCubeMap(null),D.setEnvExposure(0),this.setTonemapExposureBias(0),this.setTonemapMethod(0),this.setGhostingBrightness(!1);f=SAOShader.uniforms.radius.value;d=SAOShader.uniforms.intensity.value;c.hasOwnProperty("saoRadius")&&(f=c.saoRadius);c.hasOwnProperty("saoIntensity")&&
(d=c.saoIntensity);F.setAOOptions(f,d);(f=c.bgColorGradient)||(f=k.BackgroundPresets.Custom);this.setClearColors(f[0],f[1],f[2],f[3],f[4],f[5]);f=1;null!==c.lightMultiplier&&void 0!==c.lightMultiplier&&(f=c.lightMultiplier);this.dir_light1&&(this.toggleLights(0!==f),this.dir_light1.intensity=f,c.lightDirection&&(this.dir_light1.position.set(-c.lightDirection[0],-c.lightDirection[1],-c.lightDirection[2]),this.dir_light1.position.multiplyScalar(1E3*this.model.getData().bbox.size().length())));this.invalidate(!0,
!1,!0);this.fireRenderOptionChanged()}};this.setLightPresetFromFile=function(){var a=this.model.getMetadata("renderEnvironmentStyle","value",null);if(null===a||""===a)return!1;for(var b=this.model.getMetadata("renderEnvironmentExposureBias","value",null),c=this.model.getMetadata("renderEnvironmentExposureBase","value",null),d=0;d<k.LightPresets.length;d++)if(a===k.LightPresets[d].name)return null!==b&&null!==c&&(k.LightPresets[d].E_bias=b+c),this.setLightPreset(d),!0;return!1};this.setTonemapMethod=
function(a){a!=F.getToneMapMethod()&&(F.setTonemapMethod(a),D.setTonemapMethod(a),this.fireRenderOptionChanged(),this.invalidate(!0))};this.setTonemapExposureBias=function(a){a!=F.getExposureBias()&&(F.setTonemapExposureBias(a),D.setTonemapExposureBias(a),this.fireRenderOptionChanged(),this.invalidate(!0))};this.uninitialize=function(){window.cancelAnimationFrame(z);this.canvas=this.controls=null;this.loader.uninitialize();this.loader=null;this.selector.uninitialize();D=F=B=this.visibilityManager=
this.model=this.selector=null};this.hideLines=function(a){return B?(B.hideLines(a),this.sceneUpdated(!0),!0):!1};this.getCutPlanes=function(){return D.getCutPlanes()};this.setCutPlanes=function(a){D.setCutPlanes(a);this.sceneUpdated();this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})};this.setCutPlanesOutlineColor=function(a){D.setCutPlanesOutlineColor(a);this.invalidate(!0,!1,!1);this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})};this.setCutPlanesOutlineThickness=
function(a){D.setCutPlanesOutlineThickness(a);this.invalidate(!0,!1,!1);this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})};this.fireRenderOptionChanged=function(){D.toggleMRTSetting();this.api.fireEvent({type:Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT})};this.viewportToRay=function(a,b){var c=this.camera;a.z=-1;var d=new THREE.Vector3(a.x,a.y,1);a=a.unproject(c);d=d.unproject(c);d.sub(a).normalize();b||(b=new THREE.Ray);b.set(c.isPerspective?c.position:a,d);return b};this.rayIntersect=
function(a,b,c){c=B.rayIntersect(a.origin,a.direction,b,c);if(!c)return null;a=c[0];b=c[1];c=c[2];var d;void 0!==a&&(d=B.getFragmentList().getDbIds(a),this.model.getData().instanceTree||(d=a));return{dbId:d,fragId:a,intersectPoint:b,face:c}};this.castRayViewport=function(){var a=new THREE.Ray;return function(b,c,d){if(!B)return{};this.viewportToRay(b,a);return this.rayIntersect(a,c,d)}}();this.clientToViewport=function(a,b){var c=h.canvas.getBoundingClientRect();return new THREE.Vector3((a+.5)/c.width*
2-1,2*-((b+.5)/c.height)+1,1)};this.viewportToClient=function(a,b){var c=h.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(a+1)*c.width-.5,-.5*(b-1)*c.height-.5,0)};this.castRay=function(a,b,c){return this.castRayViewport(this.clientToViewport(a,b),c)};this.intersectGroundViewport=function(a){var b=this.camera,c="z";this.is2d||(c=H);var d=a;d.z=-1;a=new THREE.Vector3(d.x,d.y,1);d=d.unproject(b);a=a.unproject(b);a.sub(d).normalize();if(1E-6>Math.abs(a[c]))return null;b=b.isPerspective?
b.position:d;c=((this.model?this.model.getBoundingBox().min[c]:0)-b[c])/a[c];a.multiplyScalar(c);a.add(b);return a};this.intersectGround=function(a,b){return this.intersectGroundViewport(this.clientToViewport(a,b))};this.hitTestViewport=function(a,b){var c;if(h.is2d){c=F.idAtPixel(a.x,a.y);if(0>=c)return null;c={intersectPoint:this.intersectGroundViewport(a),dbId:c,fragId:h.model.getData().fragments.dbId2fragId[c]}}else c=this.castRayViewport(a,b);return c};this.hitTest=function(a,b,c){return h.hitTestViewport(this.clientToViewport(a,
b),c)};this.snappingHitTestViewport=function(a,b){var c;if(h.is2d)c=F.idAtPixel(a.x,a.y),c={intersectPoint:this.intersectGroundViewport(a),dbId:c,fragId:h.model.getData().fragments.dbId2fragId[c]};else{c=F.idAtPixel(a.x,a.y);var d;c&&(d=[],this.model.getData().instanceTree.enumNodeFragments(c,function(a){d.push(a)},!0));c=this.castRayViewport(a,b,d)}return c};this.snappingHitTest=function(a,b,c){return this.snappingHitTestViewport(this.clientToViewport(a,b),c)};this.rolloverObjectViewport=function(a){F.rolloverObjectViewport(a.x,
a.y)&&this.invalidate(!1,!1,!0)};this.rolloverObject=function(a,b){this.rolloverObjectViewport(this.clientToViewport(a,b))};this.getScreenShot=function(a,b,c){F.presentBuffer();var f=window.URL.createObjectURL(d(h.canvas.toDataURL("image/png")));if(!a||!b)return f;var g,k,m=0,l=0;a>b||w/E<a/b?(g=a,k=E/w*a,l=b/2-k/2):(k=b,g=w/E*b,m=a/2-g/2);var n=new Image;n.src=f;var q=document.createElement("canvas"),p=q.getContext("2d");q.width=a;q.height=b;n.onload=function(){p.drawImage(n,m,l,g,k);var a=window.URL.createObjectURL(d(q.toDataURL("image/png")));
c?c(a):window.open(a)}};this.modelQueue=function(){return B};this.glrenderer=function(){return J};this.renderer=function(){return F};this.worldUp=function(){return C};this.worldUpName=function(){return H};this.setUserRenderContext=function(a){F=a?a:new RenderContext;F.init(J,this.canvas.clientWidth,this.canvas.clientHeight);F.setClearColors(this.clearColorTop,this.clearColorBottom);this.invalidate(!0);this.sceneUpdated(!1)};this.invalidate=function(a,b,c){G=G||a;M=M||b;I=I||c};this.sceneUpdated=function(a){this.invalidate(!0,
!1,!0);B&&a&&(B.visibleBoundsDirty=!0);L=!0};this.currentLightPreset=function(){return p};this.matman=function(){return D};this.fps=function(){return 1E3/aa};this.api=b;this.canvas=a;this.loader=this.svfloader=new k.SvfLoader(this);J=function(a){var b=window.devicePixelRatio;b||(b=1);a=new FireflyWebGLRenderer({canvas:a,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1,depth:!1,devicePixelRatio:b});a.autoClear=!1;a.sortObjects=!1;return a}(a);F=new RenderContext;F.init(J,
a.clientWidth,a.clientHeight);D=new k.MaterialManager(this);init_UnifiedCamera();this.camera=new Autodesk.Viewing.UnifiedCamera(a.clientWidth,a.clientHeight);this.lights=[];this.cameraChangedEvent=this.camera.getCameraChangedEvent();this.scene=new THREE.Scene;this.sceneAfter=new THREE.Scene;this.sceneAfter.sortObjects=!1;this.overlayScenes={};this.selectionMaterial2d=null;this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1});
this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0});this.selectionMaterialTop.packedNormals=!0;this.selectionMaterialBase.packedNormals=!0;(function(a,b,c){b.depthWrite=!1;b.depthTest=!0;b.side=THREE.DoubleSide;c.depthWrite=!1;c.depthTest=!0;c.side=THREE.DoubleSide;h.createOverlayScene(a,b,c)})("selection",this.selectionMaterialBase,this.selectionMaterialTop);this.selectionMeshes={};this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,
opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1});this.fadeMaterial.packedNormals=!0;D.addMaterial("__fadeMaterial__",this.fadeMaterial,!0);this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1});this.highlightMaterial.packedNormals=!0;D.addMaterial("__highlightMaterial__",this.highlightMaterial,!0);this.progressiveRender=!0;if(isAndroidDevice()||isIOSDevice())m*=2,q*=2,n*=2;this.targetFrameTime=n;this.controls=
{update:function(a){},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){}};this.selector=new k.Selector(this);this.visibilityManager=new k.VisibilityManager(this);this.showOverlaysWhileMoving=this.showGhosting=!0;this.skipAOWhenMoving=!1;this.keyFrameAnimator=null;var ia=k.LightPresets[k.DefaultLightPreset].bgColorGradient;this.setClearColors(ia[0],ia[1],ia[2],ia[3],ia[4],ia[5]);U=new GroundShadow(J);U.enabled=!0;D.addMaterialNonHDR("groundShadowDepthMaterial",U.getDepthMaterial());
D.addMaterialNonHDR("normalsMaterial",F.getDepthMaterial());F.beginScene(this.scene,this.camera,this.lights,!0);F.composeFinalFrame();this.interceptor=this.viewtx=this.p2p=this.presenceChannelId=this.messageClient=null;this.joinLiveReviewSession=function(a){(function(){var a=Autodesk.Viewing,b=a.Private;b.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]};this.getName=function(){return"intercept"};this.activate=function(a){};this.deactivate=function(a){};this.update=
function(a){return!1};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};this.handleDoubleTap=function(a,b){return!1};this.handleKeyDown=function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(b){a.takeControl();return!1};this.handleButtonDown=function(b,c){a.takeControl();return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(b){a.updatePointer(b);
return!1};this.handleGesture=function(b){a.takeControl();return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}};b.ViewTransceiver=function(c){function d(a){p=!0;a=JSON.parse(a.data.msg);D.restoreState(a);q.impl.invalidate(!0,!1,!0);p=!1}function f(a){for(var b=0;b<a.length;b++)a[b]=Math.round(1E3*a[b])/1E3}function g(a){var b=a.data.msg;!0===b[1]||t||(b[0]!=w&&(w=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),L=!1,
q.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),q.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(L||t)a=a.camera,a=[a.position.x,a.position.y,a.position.z,a.target.x,a.target.y,a.target.z,a.up.x,a.up.y,a.up.z],f(a),a.unshift(t),a.unshift(c.getLocalId()),z.sendMessage("camera",a,n.channelId),w!=a[0]&&(w=a[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:w}}))}function k(a,
b,c){a&&!K&&(K=document.createElement("div"),K.classList.add("collabPointer"));a&&!B?(q.container.appendChild(K),B=!0):!a&&B&&(q.container.removeChild(K),B=!1);a&&(K.style.left=b-6+"px",K.style.top=c-6+"px")}function m(a){L||t||(a=a.data.msg,r.origin.set(a[1],a[2],a[3]),r.direction.set(a[4],a[5],a[6]),a=r.at(q.getCamera().near),a.project(q.getCamera()),a=q.impl.viewportToClient(a.x,a.y),k(!0,a.x,a.y))}function l(a){p||(a=D.getState(E),c.sendMessage("state",JSON.stringify(a),n.channelId))}var n=this,
q=this.viewer=null,p=!1,L=!1,t=!1,w,z=this.client=c,r=new THREE.Ray,K=null,B=!1;this.channelId=null;var D,E={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){L=!0;k(!1)};this.updatePointer=function(a){L&&(a=q.impl.clientToViewport(a.canvasX,a.canvasY),q.impl.viewportToRay(a,r),a=[r.origin.x,r.origin.y,r.origin.z,r.direction.x,r.direction.y,r.direction.z],f(a),a.unshift(c.getLocalId()),
z.sendMessage("pointer",a,n.channelId))};this.connectCamera=function(a){t=!a};this.attach=function(c){q&&this.detach();this.viewer=q=c;D=new b.ViewerState(q);z.addEventListener("cameraChange",g);z.addEventListener("pointerMove",m);z.addEventListener("viewerState",d);q.hasEventListener(a.CAMERA_CHANGE_EVENT,h)||q.addEventListener(a.CAMERA_CHANGE_EVENT,h);q.hasEventListener(a.SELECTION_CHANGED_EVENT,l)||(q.addEventListener(a.SELECTION_CHANGED_EVENT,l),q.addEventListener(a.ISOLATE_EVENT,l),q.addEventListener(a.HIDE_EVENT,
l),q.addEventListener(a.SHOW_EVENT,l),q.addEventListener(a.HIGHLIGHT_EVENT,l),q.addEventListener(a.EXPLODE_CHANGE_EVENT,l),q.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),q.addEventListener(a.CUTPLANES_CHANGE_EVENT,l))};this.detach=function(){z&&(z.removeEventListener("cameraChange",g),z.removeEventListener("viewerState",d));q&&(q.removeEventListener(a.CAMERA_CHANGE_EVENT,h),q.removeEventListener(a.SELECTION_CHANGED_EVENT,l),q.removeEventListener(a.ISOLATE_EVENT,l),q.removeEventListener(a.HIDE_EVENT,
l),q.removeEventListener(a.SHOW_EVENT,l),q.removeEventListener(a.HIGHLIGHT_EVENT,l),q.removeEventListener(a.EXPLODE_CHANGE_EVENT,l),q.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),q.removeEventListener(a.CUTPLANES_CHANGE_EVENT,l),D=this.viewer=q=null)}};b.ViewTransceiver.prototype.constructor=b.ViewTransceiver;Autodesk.Viewing.EventDispatcher.prototype.apply(b.ViewTransceiver.prototype)})();this.messageClient||(this.messageClient=k.MessageClient.GetInstance());this.presenceChannelId||(this.presenceChannelId=
window.location.host);this.messageClient.isConnected()||this.messageClient.connect(a);this.viewtx||(this.viewtx=new k.ViewTransceiver(this.messageClient));this.viewtx.channelId=a;this.viewtx.attach(global_viewer_instance);this.p2p||(this.p2p=new k.P2PClient(this.messageClient));this.messageClient.join(this.viewtx.channelId);this.interceptor||(this.interceptor=new k.InteractionInterceptor(this.viewtx));b.toolController.registerTool(this.interceptor);b.toolController.activateTool(this.interceptor.getName())};
this.leaveLiveReviewSession=function(){this.p2p.hangup();this.viewtx.detach(b);this.messageClient.disconnect()}};Autodesk.Viewing.Private.Viewer3DImpl.prototype.constructor=Autodesk.Viewing.Private.Viewer3DImpl;AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ViewerState=function(a){this.getState=function(b){var c=a.navigation,f=Autodesk.Viewing.Private,g={},d;d=Math.round(4294967295*Math.random());var h=Date.now();d=d.toString(16)+h.toString(16);g.guid=d;g.seedURN=a.impl.loader.svfUrn;g.overrides=this.getTransformsOverrides();d=g.objectSet;Array.isArray(d)||(g.objectSet=d=[]);a.model&&!a.model.is2d()&&(d[0]={id:this.getSelectedNodes(),isolated:a.getIsolatedNodes(),hidden:a.getHiddenNodes(),explodeScale:a.getExplodeScale(),idType:"lmv"});
a.model&&a.model.is2d()&&(d[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),hidden:[],idType:"lmv"});(d=g.viewport)||(d=g.viewport={});h=c.getCamera().isPerspective;d.name="";d.eye=c.getPosition().toArray();d.target=c.getTarget().toArray();d.up=c.getCamera().up.toArray();d.worldUpVector=c.getWorldUpVector().toArray();d.pivotPoint=c.getPivotPoint().toArray();d.distanceToOrbit=c.getPivotPlaneDistance();d.aspectRatio=this.getAspectRatio();d.projection=h?"perspective":"orthographic";
d.isOrthographic=!h;h?d.fieldOfView=c.getVerticalFov():d.orthographicHeight=this.getOrthographicHeight();(c=g.renderOptions)||(c=g.renderOptions={});c.environment=f.LightPresets[a.impl.currentLightPreset()].name;c.ambientOcclusion={enabled:a.impl.renderer().settings.sao,radius:a.impl.renderer().getAORadius(),intensity:a.impl.renderer().getAOIntensity()};c.toneMap={method:a.impl.renderer().getToneMapMethod(),exposure:a.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()};c.appearance=
{ghostHidden:a.impl.showGhosting,ambientShadow:a.prefs.ambientShadows,antiAliasing:a.impl.renderer().settings.antialias,progressiveDisplay:a.prefs.progressiveRendering,displayLines:a.prefs.lineRendering};if(a.model&&!a.model.is2d())for(f=g.cutplanes=[],c=a.getCutPlanes(),d=0;d<c.length;d++)f.push(c[d].toArray());for(var k in a.loadedExtensions)a.loadedExtensions[k].getState(g);b&&!0!==b&&this.applyFilter(g,b);return g};this.restoreState=function(b,c,f){if(!b)return stderr("restoreState has no viewer state to restore from."),
!1;if(!a||!a.model)return stderr("restoreState has no viewer or model to restore."),!1;c&&!0!==c&&(b=JSON.parse(JSON.stringify(b)),this.applyFilter(b,c));c=a.navigation;if(c.getTransitionActive())return stderr("Abort restoreState, animation in progress..."),!1;if(a.model&&Array.isArray(b.objectSet)&&0<b.objectSet.length){var g=b.objectSet[0],d=a.impl?a.impl.selector:null;if(a.model.getRootId()){var h=g.id;h&&d&&(h=this.toIntArray(h),d.setSelectionIds(h));h=g.isolated||[];h=this.toIntArray(h);a.isolate(h);
0===h.length&&(h=g.hidden||null)&&0<h.length&&(h=this.toIntArray(h),a.hide(h));"explodeScale"in g&&(h=parseFloat(g.explodeScale),a.explode&&(a.explode(h),a.explodeSlider&&(a.explodeSlider.value=h)))}a.model.is2d()&&(h=g.id||[],d&&(h=h.map(function(a){return{dbId:a,fragIds:0}}),d.setSelection(h)),g=g.isolated,Array.isArray(g)&&0<g.length?(a.setLayerVisible(null,!1),a.impl.setLayerVisible(g,!0)):a.setLayerVisible(null,!0))}if(g=b.viewport){var d=this.getVector3FromArray(g.eye,c.getPosition()),h=this.getVector3FromArray(g.up,
c.getCamera().up),k=this.getVector3FromArray(g.target,c.getTarget()),m="fieldOfView"in g?parseFloat(g.fieldOfView):c.getVerticalFov(),n=this.getVector3FromArray(g.worldUpVector,null);n||(n=(n=a.model?a.model.getUpVector():null)?(new THREE.Vector3).fromArray(n):new THREE.Vector3(0,1,0));c=c.getCamera().isPerspective;"isOrthographic"in g&&(c=!g.isOrthographic);var q=this.getOrthographicHeight();"orthographicHeight"in g&&(q=Number(g.orthographicHeight));this.restoreCameraState({position:d,target:k,up:h,
worldup:n,aspect:a.impl.camera.aspect,fov:m,orthoScale:q,isPerspective:c},f)}if(d=b.renderOptions){c=a.prefs.ambientShadows;g=a.prefs.antialiasing;if(k=d.ambientOcclusion)"enabled"in k&&(c=k.enabled),h="radius"in k?k.radius:null,k="intensity"in k?k.intensity:null,null!==h&&null!==k&&(a.impl.renderer().setAOOptions(h,k),a.impl.renderer().composeFinalFrame(!1));"environment"in d&&(h=this.getLightPresetIndex(d.environment),-1!==h&&a.setLightPreset(h));if(k=d.toneMap)h="lightMultiplier"in k?k.lightMultiplier:
null,k="exposure"in k?k.exposure:null,null!==h&&null!==k&&(a.impl.dir_light1&&(a.impl.dir_light1.intensity=Math.pow(2,h)),a.impl.renderer().setTonemapExposureBias(k,h),a.impl.invalidate(!0));if(d=d.appearance)"antiAliasing"in d&&(g=d.antiAliasing),"progressiveDisplay"in d&&a.setProgressiveRendering(d.progressiveDisplay),"ghostHidden"in d&&a.setGhosting(d.ghostHidden),"displayLines"in d&&a.hideLines(!d.displayLines);a.setQualityLevel(c,g)}if(Array.isArray(b.cutplanes)&&a.model&&!a.model.is2d()){c=
[];for(g=0;g<b.cutplanes.length;g++)d=b.cutplanes[g],Array.isArray(d)&&4<=d.length&&c.push(new THREE.Vector4(d[0],d[1],d[2],d[3]));a.setCutPlanes(c)}for(var l in a.loadedExtensions)a.loadedExtensions[l].restoreState(b,f);return!0};this.restoreCameraState=function(b,c){a.impl.adjustOrthoCamera(b);var f=a.navigation;c?(b.isPerspective?f.toPerspective():f.toOrthographic(),f.setCameraUpVector(b.up),f.setWorldUpVector(b.worldup),f.setView(b.position,b.target),f.setPivotPoint(b.target),f.setVerticalFov(b.fov,
!1),a.impl.syncCamera(!0)):(a.impl.camera.isPerspective=b.isPerspective,f.setRequestTransitionWithUp(!0,b.position,b.target,b.fov,b.up,b.worldup))};this.toIntArray=function(a){var c=[];if(Array.isArray(a))for(var f=0,g=a.length;f<g;++f)c.push(parseInt(a[f]));return c};this.extractSelectedNodeIds=function(a){return a&&Array.isArray(a.objectSet)&&0<a.objectSet.length?this.toIntArray(a.objectSet[0].id):[]};this.extractIsolatedNodeIds=function(a){return a&&Array.isArray(a.objectSet)&&0<a.objectSet.length?
this.toIntArray(a.objectSet[0].isolated):[]};this.getVector3FromArray=function(a,c){return a instanceof Array&&2<a.length?(a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),(new THREE.Vector3).fromArray(a)):c};this.getSelectedNodes=function(){return a.impl&&a.impl.selector?a.impl.selector.getSelection():[]};this.getVisibleLayers2d=function(){var b=[],c=a.impl.matman(),f=c.layersMap,g;for(g in f)f.hasOwnProperty(g)&&c.isLayerVisible(g)&&b.push(g);return b};this.getAspectRatio=function(){var b=
a.navigation.getScreenViewport();return b.width/b.height};this.getOrthographicHeight=function(){var b=a.navigation.getCamera();return b.isPerspective?0:Math.abs(2*b.orthographicCamera.top)};this.getTransformsOverrides=function(){return{transformations:[]}};this.getToneMapIntensity=function(){var b=0;a.impl.dir_light1&&(b=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1E-20);return b};this.getLightPresetIndex=function(a){for(var c=Autodesk.Viewing.Private,f=0;f<c.LightPresets.length;f++)if(c.LightPresets[f].name===
a)return f;return-1};this.applyFilter=function(a,c){if(!0!==c)for(var f in a)if(a.hasOwnProperty(f)){var g=c[f];void 0===g?(delete a[f],stderr("[applyFilter] C - skipping key ["+f+"] from viewerState; unspecified in filter.")):"boolean"===typeof g?!1===g&&(delete a[f],stderr("[applyFilter] D - skipping key ["+f+"] from viewerState; explicit filtering.")):g instanceof Object?a[f]instanceof Object?this.applyFilter(a[f],c[f]):stderr("[applyFilter] A - Invalid filter Object for key ["+f+"]"):stderr("[applyFilter] B - Invalid filter value for key ["+
f+"]")}}};Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState;AutodeskNamespace("Autodesk.Viewing.i18n");
(function(){function a(a,b){if(!b||"function"===typeof b)return a;for(var c in b)a[c]=b[c];return a}function b(a,b,c){var d,f=0,g=a.length,h=void 0===g||"[object Array]"!==Object.prototype.toString.apply(a)||"function"===typeof a;if(c)if(h)for(d in a){if(!1===b.apply(a[d],c))break}else for(;f<g&&!1!==b.apply(a[f++],c););else if(h)for(d in a){if(!1===b.call(a[d],d,a[d]))break}else for(;f<g&&!1!==b.call(a[f],f,a[f++]););return a}function c(a){var b=function(a){if(window.XMLHttpRequest)return a(null,
new XMLHttpRequest);if(window.ActiveXObject)try{return a(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(b){return a(null,new ActiveXObject("Microsoft.XMLHTTP"))}return a(Error())},c=function(a){if("string"===typeof a)return a;var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},d=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},f=function(a,
g,h,k){"function"===typeof h&&(k=h,h={});h.doNotCache=h.doNotCache||!1;h.data=h.data||{};h.headers=h.headers||{};h.jsonp=h.jsonp||!1;h.async=void 0===h.async?!0:h.async;var l=d({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},f.headers,h.headers),m;m="application/json"===l["content-type"]?JSON.stringify(h.data):c(h.data);if("GET"===a){var n=[];m&&(n.push(m),m=null);h.doNotCache&&n.push("_="+(new Date).getTime());h.jsonp&&(n.push("callback="+h.jsonp),n.push("jsonp="+
h.jsonp));n=n.join("&");1<n.length&&(g=-1<g.indexOf("?")?g+("&"+n):g+("?"+n));if(h.jsonp){var n=document.getElementsByTagName("head")[0],q=document.createElement("script");q.type="text/javascript";q.src=g;n.appendChild(q);return}}b(function(b,c){if(b)return k(b);c.open(a,g,h.async);for(var d in l)l.hasOwnProperty(d)&&c.setRequestHeader(d,l[d]);c.onreadystatechange=function(){if(4===c.readyState){var a=c.responseText||"";k&&k(c.status,a)}};c.send(m)})};({authBasic:function(a,b){var c=f.headers,d;d=
a+":"+b;d=d.replace(/\r\n/g,"\n");for(var g="",h=0;h<d.length;h++){var k=d.charCodeAt(h);128>k?g+=String.fromCharCode(k):(127<k&&2048>k?g+=String.fromCharCode(k>>6|192):(g+=String.fromCharCode(k>>12|224),g+=String.fromCharCode(k>>6&63|128)),g+=String.fromCharCode(k&63|128))}d=g;var g="",l,m,n,q,p=0;do l=d.charCodeAt(p++),h=d.charCodeAt(p++),k=d.charCodeAt(p++),m=l>>2,l=(l&3)<<4|h>>4,n=(h&15)<<2|k>>6,q=k&63,isNaN(h)?n=q=64:isNaN(k)&&(q=64),g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q);while(p<d.length);c.Authorization="Basic "+g},connect:function(a,b,c){return f("CONNECT",a,b,c)},del:function(a,b,c){return f("DELETE",a,b,c)},get:function(a,b,c){return f("GET",a,b,c)},head:function(a,b,c){return f("HEAD",a,b,c)},headers:function(a){f.headers=a||{}},
isAllowed:function(a,b,c){this.options(a,function(a,d){c(-1!==d.text().indexOf(b))})},options:function(a,b,c){return f("OPTIONS",a,b,c)},patch:function(a,b,c){return f("PATCH",a,b,c)},post:function(a,b,c){return f("POST",a,b,c)},put:function(a,b,c){return f("PUT",a,b,c)},trace:function(a,b,c){return f("TRACE",a,b,c)}})[a.type?a.type.toLowerCase():"get"](a.url,a,function(b,c){200===b?a.success(c,b,null):a.error(c,b,null)})}function f(a,b){"function"===typeof a&&(b=a,a={});a=a||{};J.extend(w,a);delete w.fixLng;
"string"==typeof w.ns&&(w.ns={namespaces:[w.ns],defaultNs:w.ns});"string"==typeof w.fallbackNS&&(w.fallbackNS=[w.fallbackNS]);if("string"==typeof w.fallbackLng||"boolean"==typeof w.fallbackLng)w.fallbackLng=[w.fallbackLng];w.interpolationPrefixEscaped=J.regexEscape(w.interpolationPrefix);w.interpolationSuffixEscaped=J.regexEscape(w.interpolationSuffix);w.lng||(w.lng=J.detectLanguage());w.lng?w.useCookie&&J.cookie.create(w.cookieName,w.lng,w.cookieExpirationTime,w.cookieDomain):(w.lng=w.fallbackLng[0],
w.useCookie&&J.cookie.remove(w.cookieName));z=J.toLanguages(w.lng);C=z[0];J.log("currentLng set to: "+C);var c=m;a.fixLng&&(c=function(a,b){b=b||{};b.lng=b.lng||c.lng;return m(a,b)},c.lng=C);G.setCurrentLng(C);if(w.resStore)A=w.resStore,t=!0,b&&b(c);else{var d=J.toLanguages(w.lng);"string"===typeof w.preload&&(w.preload=[w.preload]);for(var f=0,g=w.preload.length;f<g;f++)for(var h=J.toLanguages(w.preload[f]),k=0,l=h.length;k<l;k++)0>d.indexOf(h[k])&&d.push(h[k]);Autodesk.Viewing.i18n.sync.load(d,
w,function(a,d){A=d;t=!0;b&&b(c)})}}function g(a,b){var c={dynamicLoad:w.dynamicLoad,resGetPath:w.resGetPath,getAsync:w.getAsync,customLoad:w.customLoad,ns:{namespaces:a,defaultNs:""}},d=J.toLanguages(w.lng);"string"===typeof w.preload&&(w.preload=[w.preload]);for(var f=0,g=w.preload.length;f<g;f++)for(var h=J.toLanguages(w.preload[f]),k=0,l=h.length;k<l;k++)0>d.indexOf(h[k])&&d.push(h[k]);for(var m=[],f=0,g=d.length;f<g;f++){h=!1;if(k=A[d[f]])for(var l=0,n=a.length;l<n;l++)k[a[l]]||(h=!0);else h=
!0;h&&m.push(d[f])}m.length?r.sync._fetch(m,c,function(c,d){var f=a.length*m.length;J.each(a,function(a,c){0>w.ns.namespaces.indexOf(c)&&w.ns.namespaces.push(c);J.each(m,function(a,g){A[g]=A[g]||{};A[g][c]=d[g][c];f--;0===f&&b&&(w.useLocalStorage&&r.sync._storeLocal(A),b())})})}):b&&b()}function d(a,b,c,f){if(!a)return a;f=f||b;if(0>a.indexOf(f.interpolationPrefix||w.interpolationPrefix))return a;var g=f.interpolationPrefix?J.regexEscape(f.interpolationPrefix):w.interpolationPrefixEscaped,h=f.interpolationSuffix?
J.regexEscape(f.interpolationSuffix):w.interpolationSuffixEscaped,k="HTML"+h;J.each(b,function(b,l){var m=c?c+w.keyseparator+b:b;"object"===typeof l&&null!==l?a=d(a,l,m,f):f.escapeInterpolation||w.escapeInterpolation?(a=a.replace(new RegExp([g,m,k].join(""),"g"),l),a=a.replace(new RegExp([g,m,h].join(""),"g"),J.escape(l))):a=a.replace(new RegExp([g,m,h].join(""),"g"),l)});return a}function h(a,b){var c=J.extend({},b);for(delete c.postProcess;-1!=a.indexOf(w.reusePrefix);){H++;if(H>w.maxRecursion)break;
var d=a.lastIndexOf(w.reusePrefix),f=a.indexOf(w.reuseSuffix,d)+w.reuseSuffix.length,d=a.substring(d,f),f=d.replace(w.reusePrefix,"").replace(w.reuseSuffix,"");if(-1!=f.indexOf(",")){var g=f.indexOf(",");if(-1!=f.indexOf("{",g)&&-1!=f.indexOf("}",g)){var h=f.indexOf("{",g),k=f.indexOf("}",h)+1;try{c=J.extend(c,JSON.parse(f.substring(h,k))),f=f.substring(0,g)}catch(l){}}}f=q(f,c);a=a.replace(d,f)}return a}function k(a,b){b=b||{};var c=void 0!==b.defaultValue?b.defaultValue:a,d=l(a,b);return void 0!==
d||d===c}function m(a,b){b=b||{};if(!t){J.log("i18next not finished initialization. you might have called t function before loading resources finished.");var c=a.indexOf(":");0>c?c=0:c++;(c=b.defaultValue||a.substr(c))&&(c=d(c,b));return c}H=0;return q.apply(null,arguments)}function n(){for(var a=[],b=1;b<arguments.length;b++)a.push(arguments[b]);return{postProcess:"sprintf",sprintf:a}}function q(a,b){b&&"object"!==typeof b?"sprintf"===w.shortcutFunction?b=n.apply(null,arguments):"defaultValue"===
w.shortcutFunction&&(b={defaultValue:b}):b=b||{};if(void 0===a||null===a)return"";"string"==typeof a&&(a=[a]);var c=a[0];if(1<a.length)for(var f=0;f<a.length&&(c=a[f],!k(c,b));f++);var f=void 0!==b.defaultValue?b.defaultValue:c,g=l(c,b),m=b.lng?J.toLanguages(b.lng):z,q=b.ns||w.ns.defaultNs,p;-1<c.indexOf(w.nsseparator)&&(p=c.split(w.nsseparator),q=p[0],c=p[1]);void 0===g&&w.sendMissing&&(b.lng?F.postMissing(m[0],q,c,f,m):F.postMissing(w.lng,q,c,f,m));m=b.postProcess||w.postProcess;void 0!==g&&m&&
M[m]&&(g=M[m](g,c,b));p=f;-1<f.indexOf(w.nsseparator)&&(p=f.split(w.nsseparator),p=p[1]);p===c&&w.parseMissingKey&&(f=w.parseMissingKey(f));void 0===g&&(f=d(f,b),f=h(f,b),m&&M[m]&&(g=M[m](void 0!==b.defaultValue?b.defaultValue:c,c,b)));return void 0!==g?g:f}function l(a,b){b=b||{};var c,f=void 0!==b.defaultValue?b.defaultValue:a,g=z;if(!A||"cimode"===g[0].toLowerCase())return f;if(b.lng&&(g=J.toLanguages(b.lng),!A[g[0]])){var k=w.getAsync;w.getAsync=!1;Autodesk.Viewing.i18n.sync.load(g,w,function(a,
b){J.extend(A,b);w.getAsync=k})}var n=b.ns||w.ns.defaultNs;-1<a.indexOf(w.nsseparator)&&(c=a.split(w.nsseparator),n=c[0],a=c[1]);if(b.context&&("string"==typeof b.context||"number"==typeof b.context)&&(c=J.extend({},b),delete c.context,c.defaultValue=w.contextNotFound,c=m(n+w.nsseparator+a+"_"+b.context,c),c!=w.contextNotFound))return d(c,{context:b.context});if(void 0!==b.count&&"string"!=typeof b.count&&1!==b.count){c=J.extend({},b);delete c.count;c.defaultValue=w.pluralNotFound;var p=n+w.nsseparator+
a+w.pluralSuffix,t=G.get(g[0],b.count);0<=t?p=p+"_"+t:1===t&&(p=n+w.nsseparator+a);c=m(p,c);if(c!=w.pluralNotFound)return d(c,{count:b.count,interpolationPrefix:b.interpolationPrefix,interpolationSuffix:b.interpolationSuffix})}var r;c=a.split(w.keyseparator);p=0;for(t=g.length;p<t&&void 0===r;p++){for(var B=g[p],D=0,E=A[B]&&A[B][n];c[D];)E=E&&E[c[D]],D++;if(void 0!==E){r=Object.prototype.toString.apply(E);if("string"===typeof E)E=d(E,b),E=h(E,b);else if("[object Array]"===r&&!w.returnObjectTrees&&
!b.returnObjectTrees)E=E.join("\n"),E=d(E,b),E=h(E,b);else if(null===E&&!0===w.fallbackOnNull)E=void 0;else if(null!==E)if(!w.returnObjectTrees&&!b.returnObjectTrees)w.objectTreeKeyHandler&&"function"==typeof w.objectTreeKeyHandler?E=w.objectTreeKeyHandler(a,E,B,n,b):(E="key '"+n+":"+a+" ("+B+")' returned an object instead of string.",J.log(E));else if("[object Number]"!==r&&"[object Function]"!==r&&"[object RegExp]"!==r){var C="[object Array]"===r?[]:{};J.each(E,function(c){C[c]=q(n+w.nsseparator+
a+w.keyseparator+c,b)});E=C}"string"===typeof E&&""===E.trim()&&!0===w.fallbackOnEmpty&&(E=void 0);r=E}}if(void 0===r&&!b.isFallbackLookup&&(!0===w.fallbackToDefaultNS||w.fallbackNS&&0<w.fallbackNS.length))if(b.isFallbackLookup=!0,w.fallbackNS.length)for(g=0,c=w.fallbackNS.length;g<c;g++){if(r=l(w.fallbackNS[g]+w.nsseparator+a,b))if(p=-1<r.indexOf(w.nsseparator)?r.split(w.nsseparator)[1]:r,t=-1<f.indexOf(w.nsseparator)?f.split(w.nsseparator)[1]:f,p!==t)break}else r=l(a,b);return r}Array.prototype.indexOf||
(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&Infinity!=d&&-Infinity!=d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1});Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===
c)return-1;var d=c;1<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(0<d||-1)*Math.floor(Math.abs(d))));for(c=0<=d?Math.min(d,c-1):c-Math.abs(d);0<=c;c--)if(c in b&&b[c]===a)return c;return-1});"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var p=this.jQuery||this.Zepto,r={},A={},C,H=0,z=[],t=!1;"undefined"!==typeof module&&module.exports?module.exports=r:(p&&(p.i18n=p.i18n||r),this.i18n=this.i18n||
r);var w={lng:void 0,load:"all",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048E5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",
sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},E={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},B={create:function(a,b,c,d){if(c){var f=new Date;f.setTime(f.getTime()+6E4*c);c="; expires="+f.toGMTString()}else c="";document.cookie=a+"="+b+c+";"+(d?"domain="+d+";":"")+"path=/"},read:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return null},remove:function(a){this.create(a,"",-1)}},D={create:function(a,
b,c,d){},read:function(a){return null},remove:function(a){}},J={extend:p?p.extend:a,each:p?p.each:b,ajax:p?p.ajax:"undefined"!==typeof document?c:function(){},cookie:"undefined"!==typeof document?B:D,detectLanguage:function(){var a,b=[];if("undefined"!==typeof window){for(var c=window.location.search.substring(1).split("&"),d=0;d<c.length;d++){var f=c[d].indexOf("=");if(0<f){var g=c[d].substring(0,f),f=c[d].substring(f+1);b[g]=f}}b[w.detectLngQS]&&(a=b[w.detectLngQS])}!a&&"undefined"!==typeof document&&
w.useCookie&&(b=J.cookie.read(w.cookieName))&&(a=b);a||"undefined"===typeof navigator||(a=navigator.language?navigator.language:navigator.userLanguage);return a},escape:function(a){return"string"===typeof a?a.replace(/[&<>"'\/]/g,function(a){return E[a]}):a},log:function(a){w.debug&&"undefined"!==typeof console&&console.log(a)},toLanguages:function(a){var b=[];if("string"===typeof a&&-1<a.indexOf("-")){var c=a.split("-");a=w.lowerCaseLng?c[0].toLowerCase()+"-"+c[1].toLowerCase():c[0].toLowerCase()+
"-"+c[1].toUpperCase();"unspecific"!==w.load&&b.push(a);"current"!==w.load&&b.push(c[0])}else b.push(a);for(a=0;a<w.fallbackLng.length;a++)-1===b.indexOf(w.fallbackLng[a])&&w.fallbackLng[a]&&b.push(w.fallbackLng[a]);return b},regexEscape:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};J.applyReplacement=d;var F={load:function(a,b,c){b.useLocalStorage?F._loadLocal(a,b,function(d,f){for(var g=[],h=0,k=a.length;h<k;h++)f[a[h]]||g.push(a[h]);0<g.length?F._fetch(g,b,function(a,
b){J.extend(f,b);F._storeLocal(b);c(null,f)}):c(null,f)}):F._fetch(a,b,function(a,b){c(null,b)})},_loadLocal:function(a,b,c){var d={},f=(new Date).getTime();if(window.localStorage){var g=a.length;J.each(a,function(a,h){var k=window.localStorage.getItem("res_"+h);k&&(k=JSON.parse(k),k.i18nStamp&&k.i18nStamp+b.localStorageExpirationTime>f&&(d[h]=k));g--;0===g&&c(null,d)})}},_storeLocal:function(a){if(window.localStorage)for(var b in a)a[b].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+
b,JSON.stringify(a[b]))},_fetch:function(a,b,c){var f=b.ns,g={};if(b.dynamicLoad){var h=function(a,b){c(null,b)};if("function"==typeof b.customLoad)b.customLoad(a,f.namespaces,b,h);else{var k=d(b.resGetPath,{lng:a.join("+"),ns:f.namespaces.join("+")}),k=Autodesk.Viewing.Private.getResourceUrl(k);J.ajax({url:k,success:function(a,b,d){J.log("loaded: "+k);a=a.json();c(null,a)},error:function(a,b,d){J.log("failed loading: "+k);c(null,void 0)},dataType:"text",async:b.getAsync})}}else{var l=f.namespaces.length*
a.length,m;J.each(f.namespaces,function(d,f){J.each(a,function(a,d){var h=function(a,b){a&&(m=m||[],m.push(a));g[d]=g[d]||{};g[d][f]=b;l--;0===l&&c(m,g)};"function"==typeof b.customLoad?b.customLoad(d,f,b,h):F._fetchOne(d,f,b,h)})})}},_fetchOne:function(a,b,c,f){var g=d(c.resGetPath,{lng:a,ns:b}),g=Autodesk.Viewing.Private.getResourceUrl(g);J.ajax({url:g,success:function(a,b,c){J.log("loaded: "+g);for(var d=!1,h=!1,k="",l=0;l<a.length;l++)if(b=a[l],c=a[l+1],h||"\\"===a[l-1]||'"'!==b||(d=!d),d)k+=
b;else{if(!h&&"//"===b+c)h="single",l++;else if("single"===h&&"\r\n"===b+c)h=!1,l++;else if("single"===h&&"\n"===b)h=!1;else if(!h&&"/*"===b+c){h="multi";l++;continue}else if("multi"===h&&"*/"===b+c){h=!1;l++;continue}h||(k+=b)}f(null,JSON.parse(k))},error:function(a,b,c){b&&200==b||a&&a.status&&200==a.status?J.log("There is a typo in: "+g):b&&404==b||a&&a.status&&404==a.status?J.log("Does not exist: "+g):J.log((b?b:a&&a.status?a.status:null)+" when loading "+g);f(c,{})},dataType:"text",async:c.getAsync})},
postMissing:function(a,b,c,f,g){var h={};h[c]=f;var k=[];if("fallback"===w.sendMissingTo&&!1!==w.fallbackLng[0])for(a=0;a<w.fallbackLng.length;a++)k.push({lng:w.fallbackLng[a],url:d(w.resPostPath,{lng:w.fallbackLng[a],ns:b})});else if("current"===w.sendMissingTo||"fallback"===w.sendMissingTo&&!1===w.fallbackLng[0])k.push({lng:a,url:d(w.resPostPath,{lng:a,ns:b})});else if("all"===w.sendMissingTo){a=0;for(var l=g.length;a<l;a++)k.push({lng:g[a],url:d(w.resPostPath,{lng:g[a],ns:b})})}g=0;for(a=k.length;g<
a;g++){var m=k[g];J.ajax({url:m.url,type:w.sendType,data:h,success:function(a,d,g){J.log("posted missing key '"+c+"' to: "+m.url);a=c.split(".");d=0;for(g=A[m.lng][b];a[d];)g=d===a.length-1?g[a[d]]=f:g[a[d]]=g[a[d]]||{},d++},error:function(a,b,d){J.log("failed posting missing key '"+c+"' to: "+m.url)},dataType:"json",async:w.postAsync})}}},G={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(a){return Number(1<a)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(a){return Number(1!=a)}},
ak:{name:"Akan",numbers:[1,2],plurals:function(a){return Number(1<a)}},am:{name:"Amharic",numbers:[1,2],plurals:function(a){return Number(1<a)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(a){return Number(0===a?0:1==a?1:2==a?2:3<=a%100&&10>=a%100?3:11<=a%100?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(a){return Number(1<a)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},ay:{name:"Aymar\u00e1",numbers:[1],plurals:function(a){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(a){return Number(1!=a)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bo:{name:"Tibetan",numbers:[1],plurals:function(a){return 0}},
br:{name:"Breton",numbers:[1,2],plurals:function(a){return Number(1<a)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},cgg:{name:"Chiga",numbers:[1],plurals:function(a){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:2<=a&&4>=a?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(a){return Number(1==
a?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(a){return Number(1==a?0:2==a?1:8!=a&&11!=a?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},de:{name:"German",numbers:[1,2],plurals:function(a){return Number(1!=a)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(a){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(a){return Number(1!=a)}},en:{name:"English",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es:{name:"Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},et:{name:"Estonian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eu:{name:"Basque",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fa:{name:"Persian",numbers:[1],plurals:function(a){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(a){return Number(1<a)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fr:{name:"French",numbers:[1,2],plurals:function(a){return Number(1<a)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(a){return Number(1==a?0:2==a?1:7>a?2:11>a?3:4)}},gd:{name:"Scottish Gaelic",
numbers:[1,2,3,20],plurals:function(a){return Number(1==a||11==a?0:2==a||12==a?1:2<a&&20>a?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gun:{name:"Gun",numbers:[1,2],plurals:function(a){return Number(1<a)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(a){return Number(1!=a)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(a){return Number(1!=a)}},id:{name:"Indonesian",numbers:[1],plurals:function(a){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(a){return Number(1!=
a%10||11==a%100)}},it:{name:"Italian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ja:{name:"Japanese",numbers:[1],plurals:function(a){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(a){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(a){return Number(0!==a)}},ka:{name:"Georgian",numbers:[1],plurals:function(a){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(a){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(a){return 0}},kn:{name:"Kannada",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},ko:{name:"Korean",numbers:[1],plurals:function(a){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(a){return Number(1==a?0:2==a?1:3==a?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(a){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(a){return Number(1<a)}},lo:{name:"Lao",
numbers:[1],plurals:function(a){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&(10>a%100||20<=a%100)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(a){return Number(1==a%10&&11!=a%100?0:0!==a?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(a){return Number(1<a)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(a){return Number(1<
a)}},mi:{name:"Maori",numbers:[1,2],plurals:function(a){return Number(1<a)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(a){return Number(1==a||1==a%10?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(a){return Number(1==a?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ms:{name:"Malay",numbers:[1],
plurals:function(a){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(a){return Number(1==a?0:0===a||1<a%100&&11>a%100?1:10<a%100&&20>a%100?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nl:{name:"Dutch",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(a){return Number(1!=a)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(a){return Number(1!=a)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(a){return Number(1<a)}},or:{name:"Oriya",numbers:[2,1],plurals:function(a){return Number(1!=a)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(a){return Number(1==a?0:0===a||0<a%100&&20>a%100?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(a){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(a){return Number(1!=a)}},se:{name:"Northern Sami",numbers:[1,2],
plurals:function(a){return Number(1!=a)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:2<=a&&4>=a?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(a){return Number(1==a%100?1:2==a%100?2:3==a%100||4==a%100?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},son:{name:"Songhay",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sq:{name:"Albanian",
numbers:[1,2],plurals:function(a){return Number(1!=a)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(a){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(a){return Number(1!=a)}},te:{name:"Telugu",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(a){return Number(1<a)}},th:{name:"Thai",numbers:[1],plurals:function(a){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(a){return Number(1<a)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(a){return Number(1<a)}},tt:{name:"Tatar",numbers:[1],plurals:function(a){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(a){return 0}},
uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(a){return Number(1<a)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(a){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(a){return Number(1<a)}},wo:{name:"Wolof",numbers:[1],plurals:function(a){return 0}},yo:{name:"Yoruba",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},zh:{name:"Chinese",numbers:[1],plurals:function(a){return 0}}},addRule:function(a,b){G.rules[a]=b},setCurrentLng:function(a){if(!G.currentRule||G.currentRule.lng!==a){var b=a.split("-");G.currentRule={lng:a,rule:G.rules[b[0]]}}},get:function(a,b){var c=a.split("-");if(c=G.currentRule&&G.currentRule.lng===a?G.currentRule.rule:G.rules[c[0]]){var d=c.plurals(b),d=c.numbers[d];2===c.numbers.length&&1===c.numbers[0]&&(2===d?d=-1:1===d&&(d=1));c=d}else c=1===
b?"1":"-1";return c}},M={},p=function(a,b){M[a]=b},I=function(){function a(b){return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()}var b=function(){b.cache.hasOwnProperty(arguments[0])||(b.cache[arguments[0]]=b.parse(arguments[0]));return b.format.call(null,b.cache[arguments[0]],arguments)};b.format=function(b,c){var d=1,f=b.length,g="",h=[],k,l,m,n;for(k=0;k<f;k++)if(g=a(b[k]),"string"===g)h.push(b[k]);else if("array"===g){m=b[k];if(m[2])for(g=c[d],l=0;l<m[2].length;l++){if(!g.hasOwnProperty(m[2][l]))throw I('[sprintf] property "%s" does not exist',
m[2][l]);g=g[m[2][l]]}else g=m[1]?c[m[1]]:c[d++];if(/[^s]/.test(m[8])&&"number"!=a(g))throw I("[sprintf] expecting number but found %s",a(g));switch(m[8]){case "b":g=g.toString(2);break;case "c":g=String.fromCharCode(g);break;case "d":g=parseInt(g,10);break;case "e":g=m[7]?g.toExponential(m[7]):g.toExponential();break;case "f":g=m[7]?parseFloat(g).toFixed(m[7]):parseFloat(g);break;case "o":g=g.toString(8);break;case "s":g=(g=String(g))&&m[7]?g.substring(0,m[7]):g;break;case "u":g=Math.abs(g);break;
case "x":g=g.toString(16);break;case "X":g=g.toString(16).toUpperCase()}g=/[def]/.test(m[8])&&m[3]&&0<=g?"+"+g:g;l=m[4]?"0"==m[4]?"0":m[4].charAt(1):" ";n=m[6]-String(g).length;if(m[6]){for(var q=[];0<n;q[--n]=l);l=q.join("")}else l="";h.push(m[5]?g+l:l+g)}return h.join("")};b.cache={};b.parse=function(a){for(var b=[],c=[],d=0;a;){if(null!==(b=/^[^\x25]+/.exec(a)))c.push(b[0]);else if(null!==(b=/^\x25{2}/.exec(a)))c.push("%");else if(null!==(b=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a))){if(b[2]){var d=
d|1,f=[],g=b[2],h=[];if(null!==(h=/^([a-z_][a-z_\d]*)/i.exec(g)))for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else if(null!==(h=/^\[(\d+)\]/.exec(g)))f.push(h[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";b[2]=f}else d|=2;if(3===d)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";c.push(b)}else throw"[sprintf] huh?";a=a.substring(b[0].length)}return c};return b}();p("sprintf",function(a,b,
c){return c.sprintf?"[object Array]"===Object.prototype.toString.apply(c.sprintf)?(b=c.sprintf,b.unshift(a),I.apply(null,b)):"object"===typeof c.sprintf?I(a,c.sprintf):a:a});Autodesk.Viewing.i18n.init=f;Autodesk.Viewing.i18n.setLng=function(a,b,c){"function"===typeof b?(c=b,b={}):b||(b={});b.lng=a;return f(b,c)};Autodesk.Viewing.i18n.preload=function(a,b){"string"===typeof a&&(a=[a]);for(var c=0,d=a.length;c<d;c++)0>w.preload.indexOf(a[c])&&w.preload.push(a[c]);return f(b)};Autodesk.Viewing.i18n.addResourceBundle=
function(a,b,c){"string"!==typeof b?(c=b,b=w.ns.defaultNs):0>w.ns.namespaces.indexOf(b)&&w.ns.namespaces.push(b);A[a]=A[a]||{};A[a][b]=A[a][b]||{};J.extend(A[a][b],c)};Autodesk.Viewing.i18n.removeResourceBundle=function(a,b){"string"!==typeof b&&(b=w.ns.defaultNs);A[a]=A[a]||{};A[a][b]={}};Autodesk.Viewing.i18n.loadNamespace=function(a,b){g([a],b)};Autodesk.Viewing.i18n.loadNamespaces=g;Autodesk.Viewing.i18n.localize=function(){Array.prototype.forEach.call(document.querySelectorAll("[data-i18n]"),
function(a){var b,c,d=a.getAttribute("data-i18n").split(/\[|\]/);1===d.length?(c=null,b=d[0]):3===d.length&&(c=d[1],b=d[2]);b=[c,b];c=b[0];b=b[1];(d=Autodesk.Viewing.i18n.translate(b))?c?a.setAttribute(c,d):a.textContent=d:c?a.setAttribute(c,b):a.textContent=b})};Autodesk.Viewing.i18n.setDefaultNamespace=function(a){w.ns.defaultNs=a};Autodesk.Viewing.i18n.t=m;Autodesk.Viewing.i18n.translate=m;Autodesk.Viewing.i18n.exists=k;Autodesk.Viewing.i18n.detectLanguage=J.detectLanguage;Autodesk.Viewing.i18n.pluralExtensions=
G;Autodesk.Viewing.i18n.sync=F;Autodesk.Viewing.i18n.functions=J;Autodesk.Viewing.i18n.lng=function(){return C};Autodesk.Viewing.i18n.addPostProcessor=p;Autodesk.Viewing.i18n.options=w})();AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.DockingPanel=function(a,b,c,f){this.kMinHeight=this.kMinWdth=100;this.visibilityCallbacks=[];this.movedSinceLastClick=!1;this.parentContainer=a;this.container=document.createElement("div");this.container.id=b;this.container.lastWidth="";this.container.dockRight=!1;this.container.dockBottom=!1;this.titleLabel=c;f=f||{};f.hasOwnProperty("localizeTitle")||(f.localizeTitle=!0);this.options=f;this.container.classList.add("dockingPanel");a.appendChild(this.container);this.listeners=
[];this.initialize();this.setVisible(!1)};Autodesk.Viewing.UI.DockingPanel.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id);this.container.appendChild(this.title);this.initializeMoveHandlers(this.title);this.setTitle(this.titleLabel||this.container.id,this.options);this.closer=this.createCloseButton();this.container.appendChild(this.closer)};
Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize=function(){for(var a=0;a<this.listeners.length;++a){var b=this.listeners[a];b.target.removeEventListener(b.eventId,b.callback)}this.listeners=[];this.visibilityCallbacks=[];this.parentContainer.removeChild(this.container);this.closer=this.title=this.container=this.parentContainer=null};Autodesk.Viewing.UI.DockingPanel.prototype.addVisibilityListener=function(a){this.visibilityCallbacks.push(a)};
Autodesk.Viewing.UI.DockingPanel.prototype.setVisible=function(a){if(a){var b=this.getContainerBoundingRect();if(this.container.dockRight){var c=b.width,f=300,g=this.container.lastWidth||this.container.style.width;g||(g=this.container.getBoundingClientRect().width);g&&(f=parseInt(g));this.container.style.left=c-f+"px"}this.container.dockBottom&&(c=b.height,f=300,g=this.container.lastHeight||this.container.style.height,g||(g=this.container.getBoundingClientRect().height),g&&(f=parseInt(g)),this.container.style.top=
c-f+"px");this.container.style.maxHeight=b.height+"px";this.container.style.maxWidth=b.width+"px";this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(b=0;b<this.visibilityCallbacks.length;b++)this.visibilityCallbacks[b](a)};Autodesk.Viewing.UI.DockingPanel.prototype.isVisible=function(){return Boolean("block"===this.container.style.display)};
Autodesk.Viewing.UI.DockingPanel.prototype.visibilityChanged=function(){};
Autodesk.Viewing.UI.DockingPanel.prototype.initializeMoveHandlers=function(a){function b(a){var b=p.style.minWidth?parseInt(p.style.minWidth):r.kMinWdth,c=p.style.minHeight?parseInt(p.style.minHeight):r.kMinHeight,f=r.getContainerBoundingRect();p.style.maxWidth&&parseInt(p.style.width)>parseInt(p.style.maxWidth)&&(p.style.width=p.style.maxWidth);p.style.maxHeight&&parseInt(p.style.height)>parseInt(p.style.maxHeight)&&(p.style.height=p.style.maxHeight);parseInt(p.style.width)<b&&(p.style.width=b+"px");
parseInt(p.style.height)<c&&(p.style.height=c+"px");"touchmove"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY);q+=a.screenX-h;l+=a.screenY-k;g=m+q;d=n+l;b=parseInt(p.style.width);c=parseInt(p.style.height);isNaN(b)&&(b=r.container.getBoundingClientRect().width);isNaN(c)&&(c=r.container.getBoundingClientRect().height);5>g&&(g=0);5>d&&(d=0);p.dockRight=!1;p.dockBottom=!1;f.width-5<g+b&&(g=f.width-b,p.dockRight=!0);f.height-5<d+c&&(d=f.height-c,p.dockBottom=!0);p.style.left=
g+"px";p.style.top=d+"px";p.style.maxWidth=f.width-g+"px";p.style.maxHeight=f.height-d+"px";h=a.screenX;k=a.screenY;r.onMove(a,g,d)}function c(a){window.removeEventListener("mousemove",b);window.removeEventListener("mouseup",c);window.removeEventListener("touchmove",b);window.removeEventListener("touchend",c);r.onEndMove(a,g,d)}function f(a){"touchstart"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY);h=a.screenX;k=a.screenY;l=q=0;m=r.container.offsetLeft;n=r.container.offsetTop;
window.addEventListener("mousemove",b,!1);window.addEventListener("mouseup",c,!1);window.addEventListener("touchmove",b,!1);window.addEventListener("touchend",c,!1);a.preventDefault();r.onStartMove(a,m,n)}var g,d,h,k,m,n,q,l,p=this.container,r=this;r.addEventListener(a,"mousedown",f);r.addEventListener(a,"touchstart",f)};Autodesk.Viewing.UI.DockingPanel.prototype.initializeCloseHandler=function(a){var b=this;b.addEventListener(a,"click",function(a){b.setVisible(!1)},!1)};
Autodesk.Viewing.UI.DockingPanel.prototype.createScrollContainer=function(a){var b=document.createElement("div"),c=b.classList;c.add("dockingPanelScroll");c.add(a&&a.left?"left":"right");a&&a.heightAdjustment&&(b.style.height="calc(100% - "+a.heightAdjustment+"px)");a.marginTop&&(b.style.marginTop=a.marginTop+"px");b.id=this.container.id+"-scroll-container";this.container.appendChild(b);return this.scrollContainer=b};
Autodesk.Viewing.UI.DockingPanel.prototype.createTitleBar=function(a){var b=document.createElement("div");b.className="dockingPanelTitle";b.textContent=a;var c=this;c.addEventListener(b,"click",function(a){if(!c.movedSinceLastClick)c.onTitleClick(a);c.movedSinceLastClick=!1});c.addEventListener(b,"dblclick",function(a){c.onTitleDoubleClick(a)});return b};
Autodesk.Viewing.UI.DockingPanel.prototype.setTitle=function(a,b){b&&b.localizeTitle?(this.title.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a)):this.title.removeAttribute("data-i18n");this.title.textContent=a};Autodesk.Viewing.UI.DockingPanel.prototype.createCloseButton=function(){var a=document.createElement("div");a.className="dockingPanelClose";a.innerHTML="&times;";this.initializeCloseHandler(a);return a};Autodesk.Viewing.UI.DockingPanel.prototype.onStartMove=function(a,b,c){};
Autodesk.Viewing.UI.DockingPanel.prototype.onEndMove=function(a,b,c){};Autodesk.Viewing.UI.DockingPanel.prototype.onMove=function(a,b,c){this.movedSinceLastClick=!0};Autodesk.Viewing.UI.DockingPanel.prototype.onTitleClick=function(a){};Autodesk.Viewing.UI.DockingPanel.prototype.onTitleDoubleClick=function(a){};Autodesk.Viewing.UI.DockingPanel.prototype.addEventListener=function(a,b,c){a.addEventListener(b,c);this.listeners.push({target:a,eventId:b,callback:c})};
Autodesk.Viewing.UI.DockingPanel.prototype.removeEventListener=function(a,b,c){for(var f=0;f<this.listeners.length;++f){var g=this.listeners[f];if(g.target===a&&g.eventId===b&&g.callback===c)return a.removeEventListener(b,c),this.listeners.splice(f,1),!0}return!1};Autodesk.Viewing.UI.DockingPanel.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}};
Autodesk.Viewing.UI.DockingPanel.prototype.resizeToContent=function(a){if(this.isVisible()){var b=this.getContentSize().height,c=this.container.getBoundingClientRect(),f=this.getContainerBoundingRect();a=a&&a.maxHeight?a.maxHeight-c.top:f.height-c.top;a-=75;b>a&&(b=a);this.container.style.height=b.toString()+"px"}};Autodesk.Viewing.UI.DockingPanel.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.ModelStructurePanel=function(a,b,c,f){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,f);this.container.classList.add("modelStructurePanel");f=f||{};f.heightAdjustment||(f.heightAdjustment=40);f.marginTop||(f.marginTop=0);f.left=!0;this.createScrollContainer(f);this.options=f;this.tree=this.instanceTree=null;this.selectedNodes=[];this.uiCreated=!1;var g=this;this.addVisibilityListener(function(a){a&&(g.uiCreated||g.createUI(),g.resizeToContent())})};
Autodesk.Viewing.UI.ModelStructurePanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.UI.ModelStructurePanel.prototype.constructor=Autodesk.Viewing.UI.ModelStructurePanel;Autodesk.Viewing.UI.ModelStructurePanel.prototype.setModel=function(a,b){this.instanceTree=a;this.modelTitle=b;this.isVisible()?this.createUI():this.uiCreated=!1};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.createUI=function(){var a=this,b=a.instanceTree;if(b){a.selectedNodes=[];var c=a.modelTitle;!c&&a.options&&a.options.defaultTitle&&(c=a.options.defaultTitle);var f={};c||(c="Browser",f.localizeTitle=!0);a.setTitle(c,f);if(a.tree){for(;a.scrollContainer.hasChildNodes();)a.scrollContainer.removeChild(a.scrollContainer.lastChild);a.title.removeEventListener("click",a.onTitleClick);a.title.removeEventListener("dblclick",a.onTitleDoubleClick)}var c=this.rootId=
b.getRootId(),g=b.getNodeName(c),d,h=0,k=0;b.enumNodeChildren(c,function(a){k||(d=b.getNodeName(a),h=a);k++});this.myDelegate=f=function(){var b=new Autodesk.Viewing.UI.TreeDelegate;b.getTreeNodeId=function(a){return"object"==typeof a?(stderr("Object used instead of dbId. Fix it."),a.dbId):a};b.getTreeNodeLabel=function(b){b=this.getTreeNodeId(b);return a.instanceTree.getNodeName(b)||"Object "+b};b.getTreeNodeClass=function(b){return a.getNodeClass(b)};b.isTreeNodeGroup=function(b){return a.isGroupNode(b)};
b.shouldCreateTreeNode=function(b){return a.shouldInclude(b)};b.onTreeNodeClick=function(b,c,d){a.onClick(c,d)};b.onTreeNodeRightClick=function(b,c,d){a.onRightClick(c,d)};b.onTreeNodeDoubleClick=function(b,c,d){a.onDoubleClick(c,d)};b.onTreeNodeIconClick=function(b,c,d){a.onIconClick(c,d)};b.forEachChild=function(b,c){var d=this.getTreeNodeId(b);a.instanceTree.enumNodeChildren(d,c)};return b}();g=1===k&&g===d;a.tree=new Autodesk.Viewing.UI.Tree(f,c,a.scrollContainer,{excludeRoot:g});a.options&&a.options.hasOwnProperty("startCollapsed")&&
!a.options.startCollapsed||(a.tree.setAllCollapsed(!0),a.tree.setCollapsed(c,!1),g&&a.tree.setCollapsed(h,!1));this.uiCreated=!0}};Autodesk.Viewing.UI.ModelStructurePanel.prototype.getNodeLabel=function(a){return this.myDelegate.getNodeLabel(a)};Autodesk.Viewing.UI.ModelStructurePanel.prototype.getNodeClass=function(a){return""};Autodesk.Viewing.UI.ModelStructurePanel.prototype.isGroupNode=function(a){a=this.myDelegate.getTreeNodeId(a);return this.instanceTree.getChildCount(a)};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.shouldInclude=function(a){return!0};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onClick=function(a,b){this.setSelection([a])};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onDoubleClick=function(a,b){};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.setGroupCollapsed=function(a,b){this.tree.delegate().isTreeNodeGroup(a)&&(this.tree.setCollapsed(a,b),this.resizeToContent())};Autodesk.Viewing.UI.ModelStructurePanel.prototype.isGroupCollapsed=function(a){return this.tree.delegate().isTreeNodeGroup(a)?this.tree.isCollapsed(a):!1};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onRightClick=function(a,b){};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.onTitleClick=function(a){this.onClick(this.instanceTree.getRootId(),a)};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onTitleDoubleClick=function(a){this.onDoubleClick(this.instanceTree.getRootId(),a)};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.setSelection=function(a){if(this.tree){var b,c;for(b=0;b<this.selectedNodes.length;++b)for(c=this.selectedNodes[b].parent;c;)this.tree.removeClass(c,"ancestor-selected"),c=c.parent;var f=[];for(b=0;b<a.length;++b)for(f.push(a[b]),c=a[b].parent;c;)this.tree.addClass(c,"ancestor-selected"),c=c.parent;this.selectedNodes=a;this.tree.setSelection(f)}};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.getContentSize=function(){var a=this.tree;return a&&(a=a.getRootContainer())?{height:a.clientHeight+this.options.heightAdjustment+35,width:a.clientWidth}:{height:0,width:0}};Autodesk.Viewing.UI.ModelStructurePanel.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)};Autodesk.Viewing.UI.ModelStructurePanel.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.PropertyPanel=function(a,b,c,f){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,f);this.container.classList.add("propertyPanel");this.container.dockRight=!0;this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0});this.highlightableElements={};var g=this;a=function(){function a(b){return"category"===b.type}var b=new Autodesk.Viewing.UI.TreeDelegate;b.getTreeNodeId=function(a){return a.name+(a.hasOwnProperty("value")?a.value:"")+(a.hasOwnProperty("category")?a.category:
"")};b.getTreeNodeClass=function(b){return a(b)?g.getCategoryClass(b):g.getPropertyClass(b)};b.isTreeNodeGroup=function(b){return a(b)};b.onTreeNodeClick=function(b,c,f){if(a(c))g.onCategoryClick(c,f);else g.onPropertyClick(c,f)};b.onTreeNodeRightClick=function(b,c,f){if(a(c))g.onCategoryRightClick(c,f);else g.onPropertyRightClick(c,f)};b.onTreeNodeDoubleClick=function(b,c,f){if(a(c))g.onCategoryDoubleClick(c,f);else g.onPropertyDoubleClick(c,f)};b.onTreeNodeIconClick=function(b,c,f){if(a(c))g.onCategoryIconClick(c,
f);else g.onPropertyIconClick(c,f)};b.createTreeNode=function(b,c,f){var h=null;(h=a(b)?g.displayCategory(b,c,f):g.displayProperty(b,c,f))&&(g.highlightableElements[this.getTreeNodeId(b)]=h)};return b}();this.tree=new Autodesk.Viewing.UI.Tree(a,null,this.scrollContainer,{})};Autodesk.Viewing.UI.PropertyPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.UI.PropertyPanel.prototype.constructor=Autodesk.Viewing.UI.PropertyPanel;
Autodesk.Viewing.UI.PropertyPanel.prototype.setProperties=function(a,b){this.removeAllProperties();for(var c=[],f=[],g=0;g<a.length;g++){var d=a[g];if(!d.hidden){var h=a[g].displayCategory;h&&"string"===typeof h&&""!==h?c.push(d):f.push(d)}}if(0===c.length+f.length)this.showNoProperties();else{for(g=0;g<c.length;g++)d=c[g],h=Autodesk.Viewing.Private.formatValueWithUnits(d.displayValue,d.units,d.type),this.addProperty(d.displayName,h,d.displayCategory);c=0<c.length;for(g=0;g<f.length;g++)d=f[g],h=
Autodesk.Viewing.Private.formatValueWithUnits(d.displayValue,d.units,d.type),this.addProperty(d.displayName,h,c?"Other":"",c?{localizeCategory:!0}:{})}};Autodesk.Viewing.UI.PropertyPanel.prototype.showNoProperties=function(){this.removeAllProperties();var a=this.tree.myRootContainer,b=document.createElement("div");b.className="noProperties";b.setAttribute("data-i18n","No properties to display");b.textContent=Autodesk.Viewing.i18n.translate("No properties to display");a.appendChild(b)};
Autodesk.Viewing.UI.PropertyPanel.prototype.showDefaultProperties=function(){this.showNoProperties();this.resizeToContent()};Autodesk.Viewing.UI.PropertyPanel.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()};
Autodesk.Viewing.UI.PropertyPanel.prototype.addProperty=function(a,b,c,f){if(this.tree.getElementForNode({name:a,value:b,category:c}))return!1;var g=null;a={name:a,value:b,type:"property"};c?((g=this.tree.getElementForNode({name:c}))||(g=this.tree.createElement_({name:c,type:"category"},this.tree.myRootContainer,f&&f.localizeCategory?{localize:!0}:null)),a.category=c):g=this.tree.myRootContainer;this.tree.createElement_(a,g,f&&f.localizeProperty?{localize:!0}:null);return!0};
Autodesk.Viewing.UI.PropertyPanel.prototype.hasProperties=function(){for(var a in this.highlightableElements)return!0;return!1};Autodesk.Viewing.UI.PropertyPanel.prototype.removeProperty=function(a,b,c,f){a={name:a,value:b,category:c};return(b=this.tree.getElementForNode(a))?(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(a)],b.parentNode.removeChild(b),!0):!1};Autodesk.Viewing.UI.PropertyPanel.prototype.removeAllProperties=function(){this.highlightableElements={};this.tree.clear()};
Autodesk.Viewing.UI.PropertyPanel.prototype.setCategoryCollapsed=function(a,b){var c=this.tree.delegate().getTreeNodeId(a);this.tree.setCollapsed(c,b)};Autodesk.Viewing.UI.PropertyPanel.prototype.isCategoryCollapsed=function(a){a=this.tree.delegate().getTreeNodeId(a);return this.tree.isCollapsed(a)};Autodesk.Viewing.UI.PropertyPanel.prototype.getContentSize=function(){var a=this.tree.myRootContainer;return{height:a.clientHeight+55,width:a.clientWidth}};
Autodesk.Viewing.UI.PropertyPanel.prototype.highlight=function(a,b){for(var c in this.highlightableElements)for(var f=this.highlightableElements[c],g=0;g<f.length;++g){var d=f[g],h=d.innerHTML,k=h.replace(/(<highlight>|<\/highlight>)/igm,"");h!==k&&(d.innerHTML=k);a&&""!==a&&(h=k.replace(new RegExp("(\\b"+a+"\\b)","gim"),"<highlight>$1</highlight>"),d.innerHTML=h)}};
Autodesk.Viewing.UI.PropertyPanel.prototype.displayCategory=function(a,b,c){var f=document.createElement("div");a=a.name;c&&c.localize&&(f.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a));f.textContent=a;f.title=a;f.className="categoryName";b.appendChild(f);return[f]};
Autodesk.Viewing.UI.PropertyPanel.prototype.displayProperty=function(a,b,c){var f=document.createElement("div"),g=a.name;c&&c.localize&&(f.setAttribute("data-i18n",g),g=Autodesk.Viewing.i18n.translate(g));f.textContent=g;f.title=g;f.className="propertyName";c=document.createElement("div");c.className="separator";g=document.createElement("div");g.textContent=a.value;g.title=a.value;g.className="propertyValue";b.appendChild(f);b.appendChild(c);b.appendChild(g);return[f,g]};
Autodesk.Viewing.UI.PropertyPanel.prototype.getCategoryClass=function(a){return"category"};Autodesk.Viewing.UI.PropertyPanel.prototype.getPropertyClass=function(a){return"property"};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))};Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryIconClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))};
Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyIconClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryDoubleClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyDoubleClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryRightClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyRightClick=function(a,b){};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ContextMenu=function(a){this.viewer=a;this.menus=[];this.open=!1};Autodesk.Viewing.Private.ContextMenu.prototype.constructor=Autodesk.Viewing.Private.ContextMenu;
Autodesk.Viewing.Private.ContextMenu.prototype.show=function(a,b){var c=this.viewer.container.getBoundingClientRect(),f=a.clientX-c.left,c=a.clientY-c.top;if(!this.open){var g=this;this.showMenu(b,f,c);this.open=!0;this.hideEventListener=function(a){"menuItem"!==a.target.className&&g.hide(a)};this.isTouch="press"===a.type;document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}};
Autodesk.Viewing.Private.ContextMenu.prototype.showMenu=function(a,b,c){var f=document.createElement("div"),g,d=[];f.className="menu";this.viewer.container.appendChild(f);this.menus.push(f);for(var h=0;h<a.length;++h){g=a[h];var k=g.title,m=g.target;g=this.createMenuItem(f,k);"function"===typeof m?this.addCallbackToMenuItem(g,m):Array.isArray(m)?d.push({menuItem:g,target:m}):console.warn("Invalid context menu option:",k,m)}m=f.getBoundingClientRect();h=m.width;g=m.height;a=this.viewer.container.getBoundingClientRect();
var m=a.width,n=a.height;(k=isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput())&&(b-=h);0>b&&(b=0);m<b+h&&(b=m-h,0>b&&(b=0));0>c&&(c=0);n<c+g&&(c=n-g,0>c&&(c=0));f.style.top=Math.round(c)+"px";f.style.left=Math.round(b)+"px";for(h=0;h<d.length;++h)f=d[h],g=f.menuItem,m=g.getBoundingClientRect(),b=Math.round((k?m.left:m.right)-a.left),c=Math.round(m.top-a.top),this.addSubmenuCallbackToMenuItem(g,f.target,b,c)};
Autodesk.Viewing.Private.ContextMenu.prototype.createMenuItem=function(a,b){var c=document.createElement("div");c.className="menuItem";c.setAttribute("data-i18n",b);c.textContent=Autodesk.Viewing.i18n.translate(b);a.appendChild(c);return c};Autodesk.Viewing.Private.ContextMenu.prototype.addCallbackToMenuItem=function(a,b){var c=this;a.addEventListener("click",function(a){c.hide();b();a.preventDefault();return!1},!1)};
Autodesk.Viewing.Private.ContextMenu.prototype.addSubmenuCallbackToMenuItem=function(a,b,c,f){var g=this;a.addEventListener("click",function(){g.showMenu(b,c,f)},!1)};Autodesk.Viewing.Private.ContextMenu.prototype.hide=function(){if(this.open){for(var a=0;a<this.menus.length;++a)this.menus[a]&&this.menus[a].parentNode.removeChild(this.menus[a]);this.menus=[];this.open=!1;document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener);this.isTouch=!1;return!0}return!1};
AutodeskNamespace("Autodesk.Viewing.UI");Autodesk.Viewing.UI.ObjectContextMenu=function(a){this.viewer=a;this.contextMenu=new Autodesk.Viewing.Private.ContextMenu(a)};Autodesk.Viewing.UI.ObjectContextMenu.prototype.constructor=Autodesk.Viewing.UI.ObjectContextMenu;
Autodesk.Viewing.UI.ObjectContextMenu.prototype.show=function(a){var b=this.viewer.getSelectionCount(),c=this.viewer.getSelectionVisibility(),b={numSelected:b,hasSelected:0<b,hasVisible:c.hasVisible,hasHidden:c.hasHidden},c=this.buildMenu(a,b);this.viewer.runContextMenuCallbacks(c,b);c&&0<c.length&&this.contextMenu.show(a,c)};Autodesk.Viewing.UI.ObjectContextMenu.prototype.hide=function(){return this.contextMenu.hide()};Autodesk.Viewing.UI.ObjectContextMenu.prototype.buildMenu=function(a,b){return null};
AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.Preferences=function(a,b){function c(a,c){if(k)return a=b+a,"undefined"!==typeof c?localStorage[a]=c:c=localStorage[a],c}function f(a,b){if("string"!==typeof a||"function"===typeof m[a])stderr("Preferences: invalid name="+a);else{var d=c(a);ok=!1;if(void 0!==d)try{d=JSON.parse(d),ok=!0}catch(f){}m[a]=ok?d:b;h[a]={}}}b||(b="Autodesk.Viewing.Preferences.");var g={},d={},h={},k=function(){var a=b+"test",c=window.localStorage;try{return c.setItem(a,"1"),c.removeItem(a),!0}catch(d){return!1}}(),
m=this;a.addEventListener("PrefChanged",function(a){var b=d[a.name];b&&(b=b.changed)&&b(a.value)});a.addEventListener("PrefReset",function(a){for(var b in d)d.hasOwnProperty(b)&&(a=d[b].reset)&&a(m[b])});this.load=function(a){g=a;for(var b in g)g.hasOwnProperty(b)&&f(b,g[b])};this.tag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(g);for(var c=0;c<b.length;++c)h[b[c]][a]=!0}};this.untag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(g);for(var c=0;c<b.length;++c)h[b[c]][a]=
!1}};this.add=function(a,b,c){if(g.hasOwnProperty(a))stderr("Preferences: "+a+" already exists");else{g[a]=b;f(a,b);if(c)for(Array.isArray(c)||(c=[c]),b=0;b<c.length;++b)this.tag(c[b],a);return!0}return!1};this.remove=function(a,c){return g.hasOwnProperty(a)?(delete g[a],delete h[a],delete this[a],c&&k&&(a=b+a,delete localStorage[a]),!0):!1};this.reset=function(b,c){b&&void 0===c&&(c=!0);for(var d in g)if(g.hasOwnProperty(d)){if(b){var f=!!h[d][b];if(c&&!f||!c&&f)continue}this.set(d,g[d],!1)&&a.fireEvent({type:"PrefReset",
name:d,value:this[d]})}};this.get=function(a){return this[a]};this.set=function(b,d,f){return this[b]!==d?(this[b]=d,c(b,d),(void 0===f||f)&&a.fireEvent({type:"PrefChanged",name:b,value:d}),(f=Autodesk.Viewing.Private.logger)&&f.log({category:"pref_changed",name:b,value:d}),!0):!1};this.addListeners=function(a,b,c){d[a]={changed:b,reset:c}};this.removeListeners=function(a){void 0!==d[a]&&delete d[a]}};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.formatValueWithUnits=function(a,b,c,f){function g(a){var b=0<=a?Math.floor(a):Math.ceil(a);return{intPart:b,fracPart:a-b}}function d(a,b,c){var d="";c&&0===a&&(d+="-");0===g(a).fracPart?d+=a:0<b?(a=a.toFixed(b),b=/^\-?([0-9]+)\.0+$/.exec(a),d=null!==b?d+b[1]:d+a):d+=a.toFixed(0);return d}function h(a,b,c){for(var f="",h=1,k=0>a,A=0;A<b;++A)h*=2;a=0<a?a+.5/h:a-.5/h;c?k=a:(b=g(a/12).intPart,f+=d(b,0,k)+"' ",k=a-12*b,0>k&&(k=-k));a=g(k).intPart;k=g((k-a)*h).intPart;if(0===k||
0!==a)f+=d(a,0);if(0!==k){for(0>a&&0>k&&(k=-k);0===k%2;)k/=2,h/=2;0!==a&&(f+="-");f+=d(k,0)+"/"+d(h,0)}return f+'"'}function k(a,b){var c="";0>a&&(c="-",a=Math.abs(a));var f=g(a),h=100*f.fracPart;return c+d(f.intPart,0)+" m "+d(h,b)+" cm"}void 0===f&&(f=3);1===c?a=Autodesk.Viewing.i18n.translate(a?"Yes":"No"):2!==c&&3!==c||!isNaN(a)?"ft"===b||"feet"===b||"foot"===b?a=h(12*a,f):"ft^2"===b||"feet^2"===b||"foot^2"===b?a=h(12*a,f)+" "+String.fromCharCode(178):"in"===b||"inch"===b?a=h(a,f):"in^2"===b||
"inch^2"===b?a=h(a,f)+" "+String.fromCharCode(178):"decimal-in"===b?a=d(a,f)+'"':"decimal-in^2"===b?a=d(a,f)+'" '+String.fromCharCode(178):"decimal-ft"===b?a=d(a,f)+"'":"decimal-ft^2"===b?a=d(a,f)+"' "+String.fromCharCode(178):"fractional-in"===b?a=h(a,f,!0):"fractional-in^2"===b?a=h(a,f,!0)+" "+String.fromCharCode(178):"m-and-cm"===b?a=k(a,f):"m-and-cm^2"===b?a=k(a,f)+" "+String.fromCharCode(178):3===c&&b?(b=b.replace("^2",String.fromCharCode(178)),b=b.replace("^3",String.fromCharCode(179)),a=d(a,
f)+" "+b):a=b?a+" "+b:3===c?d(a,f):a:a="NaN";return a};
Autodesk.Viewing.Private.convertUnits=function(a,b,c,f){if(a===b)return c;var g=1;switch(b){case "mm":g=1E3;break;case "cm":g=100;break;case "m":g=1;break;case "in":g=39.37007874;break;case "ft":g=3.280839895;break;case "decimal-in":g=39.37007874;break;case "decimal-ft":g=3.280839895;break;case "fractional-in":g=39.37007874;break;case "m-and-cm":g=1}b=1;switch(a){case "mm":b=.001;break;case "cm":b=.01;break;case "m":b=1;break;case "in":b=.0254;break;case "ft":b=.3048;break;case "decimal-in":b=.0254;
break;case "decimal-ft":b=.3048;break;case "fractional-in":b=.0254;break;case "m-and-cm":b=1}return"square"===f?c*Math.pow(g*b,2):c*g*b};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;b.OptionSlider=function(b,f,g,d,h){function k(a){a.target!=m.stepperElement&&(m.stepperElement.value=m.sliderElement.value);m.fireChangeEvent()}var m=this;this.tbody=d;this.sliderRow=this.tbody.insertRow(h&&h.insertAtIndex?h.insertAtIndex:-1);d=this.sliderRow.insertCell(0);this.caption=document.createElement("div");this.caption.setAttribute("data-i18n",b);this.caption.textContent=a.i18n.translate(b);this.sliderElement=document.createElement("input");
this.sliderElement.type="range";this.sliderElement.id=b+"_slider";this.sliderElement.min=f;this.sliderElement.max=g;d.appendChild(this.caption);d.appendChild(this.sliderElement);d=this.sliderRow.insertCell(1);this.stepperElement=document.createElement("input");this.stepperElement.type="number";this.stepperElement.id=b+"_stepper";this.stepperElement.min=f;this.stepperElement.max=g;this.stepperElement.step=1;this.stepperElement.style.width="64px";d.appendChild(this.stepperElement);this.blockEvent=!1;
this.stepperElement.addEventListener("change",function(a){a.target!=m.sliderElement&&(m.sliderElement.value=m.stepperElement.value);m.fireChangeEvent()},!1);this.sliderElement.addEventListener("change",k,!1);this.sliderElement.addEventListener("input",k,!1)};b.OptionSlider.prototype.constructor=b.OptionSlider;a.EventDispatcher.prototype.apply(b.OptionSlider.prototype);b.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var a=new CustomEvent("change",
{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(a)}};b.OptionSlider.prototype.setValue=function(a){this.blockEvent=!0;this.value=a;this.sliderElement.value=a;this.stepperElement.value=a;this.blockEvent=!1};b.OptionSlider.prototype.setDisabled=function(a){this.sliderElement.disabled=a;this.stepperElement.disabled=a;this.caption.disabled=a};b.OptionCheckbox=function(b,f,g,d){var h=this;this.tbody=f;this.sliderRow=this.tbody.insertRow(d&&d.insertAtIndex?d.insertAtIndex:-1);
f=this.sliderRow.insertCell(0);this.caption=document.createElement("div");this.caption.setAttribute("data-i18n",b);this.caption.textContent=a.i18n.translate(b);f.appendChild(this.caption);f=this.sliderRow.insertCell(1);this.checkElement=document.createElement("input");this.checkElement.type="checkbox";this.checkElement.id=b+"_check";this.checkElement.checked=g;f.appendChild(this.checkElement);this.blockEvent=!1;this.checked=g;this.checkElement.addEventListener("change",function(a){h.fireChangeEvent()},
!1);isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(a){a.preventDefault();a.target.click()}));this.checkElement.addEventListener("click",function(a){a.stopPropagation()},!1);this.sliderRow.addEventListener("click",function(a){h.checkElement.disabled||(h.checkElement.checked=!h.checkElement.checked,h.fireChangeEvent())},!1)};b.OptionCheckbox.prototype.constructor=b.OptionCheckbox;
a.EventDispatcher.prototype.apply(b.OptionCheckbox.prototype);b.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var a=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(a)}};b.OptionCheckbox.prototype.setValue=function(a){this.blockEvent=!0;this.checked=a;this.checkElement.checked=a;this.blockEvent=!1};b.OptionCheckbox.prototype.setDisabled=function(a){this.checkElement.disabled=a;this.caption.disabled=
a};b.OptionCheckbox.prototype.setVisibility=function(a){this.sliderRow.style.display=a?"table-row":"none"};b.OptionDropDown=function(b,f,g,d,h){var k=this;this.tbody=f;this.sliderRow=this.tbody.insertRow(h&&h.insertAtIndex?h.insertAtIndex:-1);f=this.sliderRow.insertCell(0);this.caption=document.createElement("div");this.caption.setAttribute("data-i18n",b);this.caption.textContent=a.i18n.translate(b);f.appendChild(this.caption);f=this.sliderRow.insertCell(1);this.dropdownElement=document.createElement("select");
this.dropdownElement.id=b+"_dropdown";this.dropdownElement.className="optionDropDown";for(b=0;b<g.length;b++)h=document.createElement("option"),h.value=b,h.setAttribute("data-i18n",g[b]),h.textContent=a.i18n.translate(g[b]),this.dropdownElement.add(h);this.selectedIndex=this.dropdownElement.selectedIndex=d;f.appendChild(this.dropdownElement);f.style.paddingLeft="5px";f.style.paddingRight="5px";this.blockEvent=!1;this.dropdownElement.addEventListener("change",function(a){k.fireChangeEvent()},!1)};
b.OptionDropDown.prototype.constructor=b.OptionDropDown;a.EventDispatcher.prototype.apply(b.OptionDropDown.prototype);b.OptionDropDown.prototype.setSelectedIndex=function(a){this.blockEvent=!0;this.selectedIndex=this.dropdownElement.selectedIndex=a;this.blockEvent=!1};b.OptionDropDown.prototype.setSelectedValue=function(a){this.blockEvent=!0;this.dropdownElement.selectedValue=a;this.selectedIndex=this.dropdownElement.selectedIndex;this.blockEvent=!1};b.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=
this.dropdownElement.selectedIndex;var a=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(a)}};b.OptionDropDown.prototype.setDisabled=function(a){this.dropdownElement.disabled=a;this.caption.disabled=a}})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ProgressBar=function(a){this.bg=document.createElement("div");this.bg.className="progressbg";this.fg=document.createElement("div");this.fg.className="progressfg";this.bg.appendChild(this.fg);this.lastValue=-1;a.appendChild(this.bg);this.widthScale=this.fg.clientWidth};
Autodesk.Viewing.Private.ProgressBar.prototype.setPercent=function(a){a!=this.lastValue&&(this.lastValue=a,99<=a?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*a*.01+"px"))};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.RenderOptionsPanel=function(a){var b=this,c=Autodesk.Viewing.Private;this.viewer=a;Autodesk.Viewing.UI.DockingPanel.call(this,a.container,"RenderOptionsPanel","Rendering Options");this.table=document.createElement("table");this.table.className="tftable";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.createScrollContainer({heightAdjustment:70,marginTop:20});this.scrollContainer.appendChild(this.table);this.container.style.width="320px";this.container.style.top=
"260px";this.container.style.left="220px";this.container.style.height="460px";this.container.dockRight=!0;var f=[],g;for(g in a.impl.BackgroundPresets)f.push(g);this.bgSelect=new c.OptionDropDown("Background Color",this.tbody,f,-1);this.updateBgColorIndex();this.addEventListener(this.bgSelect,"change",function(c){c=a.BackgroundPresets[b.bgSelect.value];a.prefs.set("backgroundColorPreset",JSON.stringify(c));a.impl.setClearColors(c[0],c[1],c[2],c[3],c[4],c[5])});this.celToggle=new c.OptionCheckbox("Cel Shaded",
this.tbody,!0);this.addEventListener(this.celToggle,"change",function(c){c=b.celToggle.checked;a.prefs.set("celShaded",c);a.impl.toggleCelShading(c)});this.saoToggle=new c.OptionCheckbox("AO Enabled",this.tbody,!0);this.addEventListener(this.saoToggle,"change",function(c){c=b.saoToggle.checked;a.prefs.set("ambientShadows",c);a.setQualityLevel(c,a.impl.renderer().settings.antialias)});this.saoRadius=new c.OptionSlider("AO Radius",0,100,this.tbody);this.saoRadius.setValue(10);this.saoRadius.sliderElement.step=
this.saoRadius.stepperElement.step=1;this.addEventListener(this.saoRadius,"change",function(c){a.impl.renderer().setAOOptions(parseInt(b.saoRadius.value),parseFloat(b.saoIntensity.value));a.impl.renderer().composeFinalFrame(!1)});this.saoIntensity=new c.OptionSlider("AO Intensity",0,3,this.tbody);this.saoIntensity.setValue(.75);this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.1;this.addEventListener(this.saoIntensity,"change",function(c){a.impl.renderer().setAOOptions(parseInt(b.saoRadius.value),
parseFloat(b.saoIntensity.value));a.impl.renderer().composeFinalFrame(!1)});this.groundShadowAlpha=new c.OptionSlider("Shadow Alpha",0,2,this.tbody);this.groundShadowAlpha.setValue(1);this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1;this.addEventListener(this.groundShadowAlpha,"change",function(c){a.setGroundShadowAlpha(parseFloat(b.groundShadowAlpha.value))});this.groundShadowColor=new c.OptionCheckbox("Shadow Color",this.tbody);_isIE11||(this.groundShadowColor.checkElement.type=
"color");this.addEventListener(this.groundShadowColor,"change",function(c){a.setGroundShadowColor(new THREE.Color(parseInt(b.groundShadowColor.checkElement.value.substr(1,7),16)))});this.groundReflectionAlpha=new c.OptionSlider("Reflection Alpha",0,2,this.tbody);this.groundReflectionAlpha.setValue(1);this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1;this.addEventListener(this.groundReflectionAlpha,"change",function(c){a.setGroundReflectionAlpha(parseFloat(b.groundReflectionAlpha.value))});
this.groundReflectionColor=new c.OptionCheckbox("Reflection Color",this.tbody);_isIE11||(this.groundReflectionColor.checkElement.type="color");this.addEventListener(this.groundReflectionColor,"change",function(c){a.setGroundReflectionColor(new THREE.Color(parseInt(b.groundReflectionColor.checkElement.value.substr(1,7),16)))});f=[];for(g=0;g<c.LightPresets.length;g++)f.push(c.LightPresets[g].name);this.envSelect=new c.OptionDropDown("Environment",this.tbody,f,a.impl.currentLightPreset());this.addEventListener(this.envSelect,
"change",function(c){a.setLightPreset(b.envSelect.selectedIndex)});f=a.impl.renderer().getToneMapMethod();this.toneMapMethod=new c.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-RGB","Canon-Lum"],f);this.addEventListener(this.toneMapMethod,"change",function(){a.impl.setTonemapMethod(b.toneMapMethod.selectedIndex)});this.exposureBias=new c.OptionSlider("Exposure Bias",-30,30,this.tbody);this.exposureBias.setValue(a.impl.renderer().getExposureBias());this.exposureBias.sliderElement.step=
this.exposureBias.stepperElement.step=.1;this.addEventListener(this.exposureBias,"change",function(c){a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)});this.exposureBias.setDisabled(0==f);this.whiteScale=new c.OptionSlider("Light Intensity",-5,20,this.tbody);f=0;a.impl.dir_light1&&(f=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1E-20);this.whiteScale.setValue(f);this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1;this.addEventListener(this.whiteScale,
"change",function(c){a.impl.dir_light1.intensity=Math.pow(2,b.whiteScale.value);a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)});this.fovAngle=new c.OptionSlider("FOV-degrees",6.88,100,this.tbody);this.fovAngle.setValue(a.getFOV());this.addEventListener(this.fovAngle,"change",function(c){a.setFOV(parseFloat(b.fovAngle.value))});this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(c){c=parseFloat(b.fovAngle.value);var f=a.getFOV();c!=f&&b.fovAngle.setValue(f)});
this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(a){b.syncUI()});this.addVisibilityListener(function(){b.resizeToContent()})};Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel;
Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}};
Autodesk.Viewing.Private.RenderOptionsPanel.prototype.updateBgColorIndex=function(){var a=this.viewer.impl,b=a.clearColorTop,a=a.clearColorBottom,b=[255*b.x|0,255*b.y|0,255*b.z|0,255*a.x|0,255*a.y|0,255*a.z|0],c,f;for(f in Autodesk.Viewing.Private.BackgroundPresets){var a=Autodesk.Viewing.Private.BackgroundPresets[f],g;for(g=0;6>g&&a[g]==b[g];g++);if(6==g){c=f;break}}if(!c)for(c="Custom",f=Autodesk.Viewing.Private.BackgroundPresets[c],a=0;6>a;a++)f[a]=b[a];this.bgSelect.setSelectedValue(c)};
Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var a=this.viewer.impl,b=0;a.dir_light1&&(b=0!=a.dir_light1.intensity?Math.log(a.dir_light1.intensity)/Math.log(2):-1E-20);this.whiteScale.setValue(b);this.exposureBias.setValue(a.renderer().getExposureBias());this.updateBgColorIndex();b=a.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(b);this.envSelect.setSelectedIndex(a.currentLightPreset());this.exposureBias.setDisabled(0==b);this.saoToggle.setValue(a.renderer().settings.sao);
this.saoRadius.setDisabled(!a.renderer().settings.sao);this.saoIntensity.setDisabled(!a.renderer().settings.sao);this.saoRadius.setValue(a.renderer().getAORadius());this.saoIntensity.setValue(a.renderer().getAOIntensity());this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow"));this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow"));this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection"));this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection"));
this.fovAngle.setValue(this.viewer.getFOV());this.celToggle.setValue(a.renderer().settings.toonShaded)};Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this);this.viewer=this.fovAngle=this.whiteScale=this.exposureBias=this.toneMapMethod=this.envSelect=this.groundShadowAlpha=this.saoIntensity=this.saoRadius=this.saoToggle=this.bgSelect=this.tbody=this.table=null};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.LayersPanel=function(a,b,c){this.viewer=a;this.layersRoot=this.tree=null;this.visibilityImages={};this.isMac=-1!==navigator.userAgent.search("Mac OS");b="Layer Manager";var f=a.config.viewableName;f&&"W2D"!==f&&(b=Autodesk.Viewing.i18n.translate(b)+": "+f);this.filterImageId=c+"-layerFilterImageId";Autodesk.Viewing.UI.DockingPanel.call(this,a.container,c,b,{localizeTitle:!1});this.container.classList.add("layersPanel");this.filterContainer=document.createElement("div");this.filterContainer.className=
"filterBox";this.filterContainer.id=this.container.id+"-search-container";this.container.appendChild(this.filterContainer);this.createScrollContainer({heightAdjustment:105,marginTop:5});var g=this;a.model?g.build():g.addEventListener(a,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,function(){g.build()});this.addVisibilityListener(function(){g.resizeToContent()})};Autodesk.Viewing.UI.LayersPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);
Autodesk.Viewing.UI.LayersPanel.prototype.constructor=Autodesk.Viewing.UI.LayersPanel;Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this);this.filterContainer=this.scrollContainer=this.visibilityImages=this.layersRoot=this.tree=this.viewer=null};
Autodesk.Viewing.UI.LayersPanel.prototype.build=function(){function a(){if(g.value){var a=function(c){var d=[];if(-1!==c.name.toLowerCase().indexOf(b))d.push(c);else if(!c.isLayer){c=c.children;for(var f=0;f<c.length;++f)d=d.concat(a(c[f]))}return d},b=g.value.toLowerCase();k&&0<k.childCount&&h.setLayerVisible(a(k),!0,!0)}else h.setLayerVisible(null,!0);d=null}var b=this,c=document.createElement("div");c.className="filterSearch";b.filterContainer.appendChild(c);var f=document.createElement("div");
f.className="filterImage";f.id=b.filterImageId;f.title=Autodesk.Viewing.i18n.translate("Show/hide all layers");c.appendChild(f);b.visibilityImages[b.filterImageId]=f;b.addEventListener(f,"click",function(a){b.onImageClick(null,a);a.stopPropagation()});var g=this.filterField=document.createElement("input");g.className="filterInput";g.placeholder=Autodesk.Viewing.i18n.translate("Enter filter term");g.setAttribute("data-i18n","[placeholder]Enter filter term");g.type="search";g.incremental="incremental";
c.appendChild(g);var d=null,h=b.viewer;g.addEventListener("keyup",function(b){d&&clearTimeout(d);d=setTimeout(a,500)});g.addEventListener("click",function(a){""===g.value?h.setLayerVisible(null,!0):setTimeout(function(){""===g.value&&(h.setLayerVisible(null,!0),a.preventDefault())},1)});var c=function(){var a=new Autodesk.Viewing.UI.TreeDelegate;a.getTreeNodeId=function(a){return a.id};a.getTreeNodeLabel=function(a){return b.getNodeLabel(a)};a.getTreeNodeClass=function(a){return b.getNodeClass(a)};
a.isTreeNodeGroup=function(a){return b.isGroupNode(a)};a.shouldCreateTreeNode=function(a){return b.shouldInclude(a)};a.onTreeNodeClick=function(a,c,d){b.onClick(c,d)};a.onTreeNodeRightClick=function(a,c,d){b.onRightClick(c,d)};a.onTreeNodeDoubleClick=function(a,c,d){b.onDoubleClick(c,d)};a.onTreeNodeIconClick=function(a,c,d){b.onIconClick(c,d)};a.createTreeNode=function(a,c){b.createNode(a,c)};return a}(),k=b.layersRoot=b.viewer.model.getLayersRoot();k&&(b.tree=new Autodesk.Viewing.UI.Tree(c,k,b.scrollContainer,
{excludeRoot:!0}),b.resizeToContent(),b.update(),b.addEventListener(b.viewer,Autodesk.Viewing.LAYER_VISIBILITY_CHANGED_EVENT,function(){b.update()}))};
Autodesk.Viewing.UI.LayersPanel.prototype.update=function(){function a(a,b){var c;c=1===b?"layerVisible":0===b?"layerHidden":"layerMixed";a.classList.remove("layerVisible","layerHidden","layerMixed");a.classList.add(c)}function b(a,b){0===b?g.tree.addClass(a.id,"dim"):g.tree.removeClass(a.id,"dim")}function c(a){var b;if(0<a.length)for(var c=0;c<a.length;++c){var d=a[c];void 0===b?b=d:0===d&&1===b?b=-1:1===d&&0===b&&(b=-1);if(-1===b)break}else b=0;return b}function f(d){var k=g.visibilityImages[d.id];
if(!d.isLayer){for(var m=d.children,n=[],q=0;q<m.length;++q)n=n.concat(f(m[q]));m=c(n);a(k,m);b(d,m);return n}n=g.viewer.isLayerVisible(d)?1:0;a(k,n);b(d,n);return[n]}var g=this,d=this.layersRoot&&0<this.layersRoot.childCount?f(g.layersRoot):[];a(g.visibilityImages[g.filterImageId],c(d))};Autodesk.Viewing.UI.LayersPanel.prototype.setLayerVisible=function(a,b){this.viewer.setLayerVisible(a,"layerVisible"!==this.visibilityImages[a?a.id:this.filterImageId].className,b);this.filterField.value=""};
Autodesk.Viewing.UI.LayersPanel.prototype.getNodeLabel=function(a){return a.isLayer||0===a.childCount?a.name:a.name+" ("+a.childCount+")"};Autodesk.Viewing.UI.LayersPanel.prototype.getNodeClass=function(a){return""};Autodesk.Viewing.UI.LayersPanel.prototype.isGroupNode=function(a){return!a.isLayer};Autodesk.Viewing.UI.LayersPanel.prototype.shouldInclude=function(a){return!0};Autodesk.Viewing.UI.LayersPanel.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))};
Autodesk.Viewing.UI.LayersPanel.prototype.setGroupCollapsed=function(a,b){var c=this.tree.delegate();c.isTreeNodeGroup(a)&&(c=c.getTreeNodeId(a),this.tree.setCollapsed(c,b),this.resizeToContent())};Autodesk.Viewing.UI.LayersPanel.prototype.isGroupCollapsed=function(a){var b=this.tree.delegate();return b.isTreeNodeGroup(a)?(a=b.getTreeNodeId(a),this.tree.isCollapsed(a)):!1};Autodesk.Viewing.UI.LayersPanel.prototype.onClick=function(a,b){};
Autodesk.Viewing.UI.LayersPanel.prototype.onDoubleClick=function(a,b){};Autodesk.Viewing.UI.LayersPanel.prototype.onRightClick=function(a,b){};Autodesk.Viewing.UI.LayersPanel.prototype.onImageClick=function(a,b){};Autodesk.Viewing.UI.LayersPanel.prototype.getContentSize=function(){var a=this.filterContainer,b=a.clientHeight+80,a=a.clientWidth,c=this.tree;return c&&(c=c.getRootContainer())?{height:c.clientHeight+b,width:Math.max(c.clientWidth,a)}:{height:b,width:a}};
Autodesk.Viewing.UI.LayersPanel.prototype.createNode=function(a,b){var c=document.createElement("div");b.children&&0<b.children.length?b.insertBefore(c,b.children[0]):b.appendChild(c);c.title=Autodesk.Viewing.i18n.translate("Show/hide this layer");this.visibilityImages[a.id]=c;var f=document.createElement("label");f.textContent=this.getNodeLabel(a);b.appendChild(f);var g=this;this.addEventListener(c,"click",function(b){g.onImageClick(a,b);b.stopPropagation()})};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.SettingsPanel=function(a,b,c,f){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,f);this.panelTabs=[];this.tabIdToIndex={};this.controls={};this.controlIdCount=0;var g=this;this.container.style.maxWidth="800px";this.container.style.minWidth="340px";this.container.style.top="100px";this.container.style.left=a.offsetWidth/2-170+"px";this.container.style.position="absolute";this.tabContainer=document.createElement("div");this.tabContainer.className="settings-tabs";this.container.appendChild(this.tabContainer);
this.tabs=document.createElement("ul");this.tabContainer.appendChild(this.tabs);this.heightAdjustment=f&&f.heightAdjustment?f.heightAdjustment:110;this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0});this.mouseOver=!1;this.addEventListener(this.container,"mouseover",function(a){a=a.toElement||a.relatedTarget;if(g.mouseOver)return!0;for(var b=0;a&&a.parentNode&&a.parentNode!=window;){if(a.parentNode==this||a==this){a.preventDefault&&a.preventDefault();g.mouseOver=
!0;for(b=0;b<g.panelTabs.length;b++)g.panelTabs[b].classList.remove("selectedmouseout");return!0}a=a.parentNode}});this.addEventListener(this.container,"mouseout",function(a){a=a.toElement||a.relatedTarget;if(g.mouseOver){for(;a&&a.parentNode&&a.parentNode!=window;){if(a.parentNode==this||a==this)return a.preventDefault&&a.preventDefault(),!1;a=a.parentNode}g.mouseOver=!1;for(a=0;a<g.panelTabs.length;a++)g.panelTabs[a].classList.contains("tabselected")&&g.panelTabs[a].classList.add("selectedmouseout")}})};
Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel;Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(a){a&&(this.container.style.display="block");Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(a,b,c){var f=this;if(void 0!==this.tabIdToIndex[a])return!1;var g=c&&void 0!==c.className?c.className:null,d=c&&void 0!==c.width?c.width:200;c=c&&void 0!==c.index?c.index:this.panelTabs.length;var h=document.createElement("li");h.id=a;var k=document.createElement("a"),m=document.createElement("span");m.setAttribute("data-i18n",b);m.textContent=Autodesk.Viewing.i18n.translate(b);k.appendChild(m);h.appendChild(k);this.tabs.appendChild(h);b=
document.createElement("table");b.id=a+"-table";b.className="settings-table tftable "+g;g=document.createElement("tbody");b.appendChild(g);this.scrollContainer.appendChild(b);this.addEventListener(h,"touchstart",touchStartToClick);this.addEventListener(h,"click",function(b){f.selectTab(a)});this.panelTabs.push(h);this.tabIdToIndex[a]=c;g=this.container.style.minWidth?parseInt(this.container.style.minWidth):0;d>g&&(this.container.style.minWidth=d+"px");return!0};
Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(a){a=this.tabIdToIndex[a];if(!a)return!1;this.panelTabs.splice(a,1);this.tabs.removeChild(tabDom);this.tabIdToIndex={};a=this.panelTabs.length;for(var b=0;b<a;b++)this.tabIdToIndex[this.panelTabs[b].id]=b;return!0};Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(a){return void 0!==this.panelTabs[this.tabIdToIndex[a]]};
Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(a){if(this.isTabSelected(a))return!1;for(var b=this.panelTabs.length,c=0;c<b;c++){var f=this.panelTabs[c],g=document.getElementById(f.id+"-table");a===f.id?(f.classList.add("tabselected"),g.style.display="table",this.mouseOver||f.classList.add("selectedmouseout")):(f.classList.remove("tabselected"),g.style.display="none",this.mouseOver||this.panelTabs[c].classList.remove("selectedmouseout"))}this.resizeToContent();return!0};
Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(a){return(a=this.panelTabs[this.tabIdToIndex[a]])&&a.classList.contains("tabselected")};
Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(a,b,c,f,g){if(void 0===this.tabIdToIndex[a])return null;var d=document.getElementById(a+"-table");b=new Autodesk.Viewing.Private.OptionCheckbox(b,d.tBodies[0],c,g);b.changeListener=function(a){f(a.detail.target.checked)};this.addEventListener(b,"change",b.changeListener);return this.addControl(a,b)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(a,b,c,f,g,d,h){if(void 0===this.tabIdToIndex[a])return null;var k=document.getElementById(a+"-table");b=new Autodesk.Viewing.Private.OptionSlider(b,c,f,k.tBodies[0],h);b.setValue(g);b.sliderElement.step=b.stepperElement.step=1;this.addEventListener(b,"change",function(a){d(a)});return this.addControl(a,b)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(a,b,c,f,g,d){if(void 0===this.tabIdToIndex[a])return null;var h=document.getElementById(a+"-table");b=new Autodesk.Viewing.Private.OptionDropDown(b,h.tBodies[0],c,f,d);this.addEventListener(b,"change",function(a){g(a)});return this.addControl(a,b)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(a,b,c){if(void 0===this.tabIdToIndex[a])return null;if(!b.hasOwnProperty("sliderRow")){var f=c&&c.insertAtIndex?c.insertAtIndex:-1;c=c&&c.caption?c.caption:null;a=document.getElementById(a+"-table");f>a.length&&(f=-1);var f=a.tBodies[0].insertRow(f),g=f.insertCell(0);if(c){var d=document.createElement("div");d.setAttribute("data-i18n",c);d.textContent=Autodesk.Viewing.i18n.translate(c);g.appendChild(d);g=f.insertCell(1)}else g.colSpan=
2;g.appendChild(b);b.sliderRow=f;b.tbody=a.tBodies[0]}c="adsk_settings_control_id_"+this.controlIdCount.toString();this.controlIdCount+=1;this.controls[c]=b;this.resizeToContent();return c};Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)};Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(a){return this.removeControl(a)};Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)};
Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(a){var b=this.controls[a];if(void 0===b)return!1;b.tbody.deleteRow(b.sliderRow.rowIndex);delete this.controls[a];this.resizeToContent();return!0};Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(a){return void 0!==this.controls[a]?this.controls[a]:null};
Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var a=this.heightAdjustment,b=this.panelTabs.length>this.panelTabs[0]?0:null,c=0;c<this.panelTabs.length;c++){var f=this.panelTabs[c];if(this.isTabSelected(f.id)){b=f;break}}b&&(b=document.getElementById(f.id+"-table"),a+=b.clientHeight);return{height:a,width:this.container.clientWidth}};AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.AlertBox=function(){};Autodesk.Viewing.Private.AlertBox.instances=[];
Autodesk.Viewing.Private.AlertBox.displayError=function(a,b,c,f,g){var d=document.createElement("div");d.className="alertBox error";a.appendChild(d);f||(f="img-item-not-found");var h=document.createElement("div");h.className="alertBoxImage "+f;d.appendChild(h);f=document.createElement("div");f.className="alertBoxMsg";d.appendChild(f);c||(c=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));h=document.createElement("div");h.className="alertBoxTitle";h.textContent=c;
f.appendChild(h);c=document.createElement("div");c.className="alertBoxText";c.textContent=b;f.appendChild(c);if(g){b=document.createElement("div");b.className="alertBoxContent";f.appendChild(b);f=document.createElement("ul");f.className="alertBoxContent";for(c=0;c<g.length;c++){var k=g[c];if(k){h=document.createElement("li");f.appendChild(h);k=this.extractList(k);if(k.list.length){var m=this.generateListElement(list);f.appendChild(m)}h.innerHTML=k.msg}}b.appendChild(f)}g=document.createElement("div");
g.className="alertBoxOK";g.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var n={alertBox:d,container:a};g.addEventListener("click",function(b){d.style.visibility="hidden";a.removeChild(d);Autodesk.Viewing.Private.AlertBox.instances.splice(Autodesk.Viewing.Private.AlertBox.instances.indexOf(n),1)});d.appendChild(g);d.style.visibility="visible";Autodesk.Viewing.Private.AlertBox.instances.push(n)};
Autodesk.Viewing.Private.AlertBox.displayErrors=function(a,b,c){var f=document.createElement("div");f.className="alertBox errors";a.appendChild(f);b||(b="img-item-not-found");var g=document.createElement("div");g.className="alertBoxImage "+b;f.appendChild(g);b=document.createElement("div");b.className="alertBoxMsg errors";f.appendChild(b);for(g=0;g<c.length;g++){var d=c[g].header;d||(d=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var h=document.createElement("div");h.className=
"alertBoxTitle errors";h.textContent=d;b.appendChild(h);var k=document.createElement("div");k.className="alertBoxText errors";h=c[g].msg;d=this.extractList(h);if(d.list.length){var m=document.createElement("div"),h=this.generateListElement(d.list);m.appendChild(h);k.textContent=d.msg;k.appendChild(m)}else k.textContent=h;b.appendChild(k);if(c[g].hints){k=document.createElement("ul");k.className="alertBoxContent";for(var m=c[g].hints,n=0;n<m.length;n++)if(d=m[n]){var q=document.createElement("li");
k.appendChild(q);d=this.extractList(d);d.list.length&&(h=this.generateListElement(d.list),k.appendChild(h));q.innerHTML=d.msg}b.appendChild(k)}}c=document.createElement("div");c.className="alertBoxOK";c.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var l={alertBox:f,container:a};c.addEventListener("click",function(b){f.style.visibility="hidden";a.removeChild(f);Autodesk.Viewing.Private.AlertBox.instances.splice(Autodesk.Viewing.Private.AlertBox.instances.indexOf(l),1)});f.appendChild(c);
f.style.visibility="visible";Autodesk.Viewing.Private.AlertBox.instances.push(l)};Autodesk.Viewing.Private.AlertBox.extractList=function(a){var b={msg:a,list:[]};a&&-1!=a.indexOf("<ul>")&&(a=a.split("<ul>"),b.msg=a[0],a=a[1].split("</ul>"),b.list=a[0].split(", "),1===b.list.length&&(b.list=a[0].split(",")));return b};Autodesk.Viewing.Private.AlertBox.generateListElement=function(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var f=document.createElement("li");f.textContent=a[c];b.appendChild(f)}return b};
Autodesk.Viewing.Private.AlertBox.dismiss=function(){if(0<Autodesk.Viewing.Private.AlertBox.instances.length){var a=Autodesk.Viewing.Private.AlertBox.instances.pop();a.alertBox.style.visibility="hidden";a.container.removeChild(a.alertBox);return!0}return!1};AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.HudMessage=function(){};Autodesk.Viewing.Private.HudMessage.instances=[];
Autodesk.Viewing.Private.HudMessage.displayMessage=function(a,b,c,f,g){if(!(0<Autodesk.Viewing.Private.HudMessage.instances.length)){var d=b.msgTitleKey,h=b.msgTitleDefaultValue?b.msgTitleDefaultValue:d,k=b.messageKey,m=b.messageDefaultValue?b.messageDefaultValue:k,n=b.buttonText,q=b.checkboxChecked?b.checkboxChecked:!1;b=document.createElement("div");b.className="hud";a.appendChild(b);var l=document.createElement("div");l.className="hudTitle";l.textContent=Autodesk.Viewing.i18n.translate(d,{defaultValue:h});
l.setAttribute("data-i18n",d);b.appendChild(l);c&&(d=document.createElement("div"),d.className="hudClose",d.innerHTML="&times;",d.addEventListener("click",function(a){Autodesk.Viewing.Private.HudMessage.dismiss();c&&c(a)}),b.appendChild(d));d=document.createElement("div");d.className="hudMessage";d.textContent=Autodesk.Viewing.i18n.translate(k,{defaultValue:m});d.setAttribute("data-i18n",k);b.appendChild(d);f&&(k=document.createElement("div"),k.className="hudButton",k.textContent=Autodesk.Viewing.i18n.translate(n,
{defaultValue:n}),k.setAttribute("data-i18n",n),k.addEventListener("click",f),b.appendChild(k));g&&(f=document.createElement("div"),n=document.createElement("input"),n.className="hudCheckbox",n.type="checkbox",n.checked=q,f.appendChild(n),q=document.createElement("label"),q.setAttribute("for","Do not show this message again"),q.setAttribute("data-i18n","Do not show this message again"),q.textContent=Autodesk.Viewing.i18n.translate("Do not show this message again",{defaultValue:"Do not show this message again"}),
f.appendChild(q),n.addEventListener("change",g),b.appendChild(f));Autodesk.Viewing.Private.HudMessage.instances.push({hudMessage:b,container:a})}};Autodesk.Viewing.Private.HudMessage.dismiss=function(){if(0<Autodesk.Viewing.Private.HudMessage.instances.length){var a=Autodesk.Viewing.Private.HudMessage.instances.pop();a.hudMessage.style.visibility="hidden";a.container.removeChild(a.hudMessage);return!0}return!1};"use strict";AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.TreeDelegate=function(){};Autodesk.Viewing.UI.TreeDelegate.prototype.constructor=Autodesk.Viewing.UI.TreeDelegate;Autodesk.Viewing.UI.TreeDelegate.prototype.isTreeNodeGroup=function(a){throw"isTreeNodeGroup is not implemented.";};Autodesk.Viewing.UI.TreeDelegate.prototype.getTreeNodeId=function(a){throw"getTreeNodeId is not implemented.";};Autodesk.Viewing.UI.TreeDelegate.prototype.getTreeNodeLabel=function(a){return a.name};
Autodesk.Viewing.UI.TreeDelegate.prototype.shouldCreateTreeNode=function(a){return!0};Autodesk.Viewing.UI.TreeDelegate.prototype.forEachChild=function(a,b){for(var c=a.children?a.children.length:0,f=0;f<c;++f)b(a.children[f])};Autodesk.Viewing.UI.TreeDelegate.prototype.createTreeNode=function(a,b,c){var f=document.createElement("label");b.appendChild(f);a=this.getTreeNodeLabel(a);c&&c.localize&&(f.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a));f.textContent=a};
Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeClick=function(a,b,c){};Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeIconClick=function(a,b,c){a.delegate().isTreeNodeGroup(b)&&a.setCollapsed(b,!a.isCollapsed(b))};Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeDoubleClick=function(a,b,c){};Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeRightClick=function(a,b,c){};Autodesk.Viewing.UI.TreeDelegate.prototype.getTreeNodeClass=function(a){return""};
Autodesk.Viewing.UI.Tree=function(a,b,c,f){this.myDelegate=a;this.mySelectedNodes=[];this.myOptions=f||{};this.myGroupNodes=[];this.nodeToElement=[];a=this.myRootContainer=this.createHtmlElement_(c,"div","treeview");b=this.rootElem=this.createElement_(b,a,null,0);f&&f.excludeRoot&&b.classList.add("exclude")};Autodesk.Viewing.UI.Tree.prototype.constructor=Autodesk.Viewing.UI.Tree;Autodesk.Viewing.UI.Tree.prototype.show=function(a){this.myRootContainer.style.display=a?"block":"none"};
Autodesk.Viewing.UI.Tree.prototype.getRootContainer=function(){return this.myRootContainer};Autodesk.Viewing.UI.Tree.prototype.getElementForNode=function(a){"number"!==typeof a&&"string"!==typeof a&&(a=this.myDelegate.getTreeNodeId(a));return this.nodeToElement[a]};Autodesk.Viewing.UI.Tree.prototype.delegate=function(){return this.myDelegate};Autodesk.Viewing.UI.Tree.prototype.isCollapsed=function(a){return this.hasClass(a,"collapsed")};
Autodesk.Viewing.UI.Tree.prototype.setCollapsed=function(a,b,c){b?(this.addClass(a,"collapsed",c),this.removeClass(a,"expanded",c)):(this.addClass(a,"expanded",c),this.removeClass(a,"collapsed",c))};
Autodesk.Viewing.UI.Tree.prototype.setAllCollapsed=function(a){var b;a?(a=function(a){return a.classList.contains("expanded")},b=function(a){a.classList.add("collapsed");a.classList.remove("expanded")}):(a=function(a){return a.classList.contains("collapsed")},b=function(a){a.classList.add("expanded");a.classList.remove("collapsed")});for(var c=0;c<this.myGroupNodes.length;++c){var f=this.myGroupNodes[c];a(f)&&b(f)}};
Autodesk.Viewing.UI.Tree.prototype.addToSelection=function(a){for(var b=a.length,c=0;c<b;++c){var f=a[c],g;g=f;-1===this.mySelectedNodes.indexOf(g)?(this.mySelectedNodes.push(g),g=!0):g=!1;g&&this.addClass(f,"selected")}};Autodesk.Viewing.UI.Tree.prototype.removeFromSelection=function(a){for(var b=a.length-1;0<=b;--b){var c=a[b],f;f=this.mySelectedNodes.indexOf(c);-1!==f?(this.mySelectedNodes.splice(f,1),f=!0):f=!1;f&&this.removeClass(c,"selected")}};
Autodesk.Viewing.UI.Tree.prototype.setSelection=function(a){this.removeFromSelection(this.mySelectedNodes);this.addToSelection(a);return this.mySelectedNodes};Autodesk.Viewing.UI.Tree.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)};Autodesk.Viewing.UI.Tree.prototype.isSelected=function(a){return this.hasClass(a,"selected")};
Autodesk.Viewing.UI.Tree.prototype.scrollTo=function(a){if(a=this.getElementForNode(a)){var b=a.offsetTop;for(a=a.parentNode;a&&a!=this.myRootContainer;)b+=a.offsetTop,a=a.parentNode;this.myRootContainer.parentNode.scrollTop=b}};Autodesk.Viewing.UI.Tree.prototype.addClass=function(a,b,c){if(a=this.getElementForNode(a)){if(c)for(a=a.parentNode,c=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;a&&a!==c;)a.classList.add(b),a=a.parentNode;else a.classList.add(b);return!0}return!1};
Autodesk.Viewing.UI.Tree.prototype.removeClass=function(a,b,c){if(a=this.getElementForNode(a)){if(c)for(a=a.parentNode,c=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;a&&a!==c;)a.classList.remove(b),a=a.parentNode;else a.classList.remove(b);return!0}return!1};Autodesk.Viewing.UI.Tree.prototype.hasClass=function(a,b){return this.getElementForNode(a).classList.contains(b)};
Autodesk.Viewing.UI.Tree.prototype.clear=function(){for(var a=this.myRootContainer;a.hasChildNodes();)a.removeChild(a.lastChild);this.nodeToElement={}};
Autodesk.Viewing.UI.Tree.prototype.createElement_=function(a,b,c,f){function g(b,f,g){b=d.createHtmlElement_(b,f,g);f=d.createHtmlElement_(b,"header");d.createHtmlElement_(f,"icon").addEventListener("click",function(b){d.myDelegate.onTreeNodeIconClick(d,a,b);b.stopPropagation();b.preventDefault()},!1);d.myDelegate.createTreeNode(a,f,c);return b}if(!a||!this.myDelegate.shouldCreateTreeNode(a))return null;var d=this,h;d.myDelegate.isTreeNodeGroup(a)?(h=g(b,"group","expanded"),d.nodeToElement[this.myDelegate.getTreeNodeId(a)]=
h,b=d.myOptions.excludeRoot?1:0,f==b&&(h.style.left="0px"),d.myGroupNodes.push(h),d.myDelegate.forEachChild(a,function(a){d.createElement_(a,h,c,f+1)})):(h=g(b,"leaf","expanded"),d.nodeToElement[this.myDelegate.getTreeNodeId(a)]=h,b=d.myOptions.excludeRoot?1:0,f==b&&(h.style.marginLeft="0px"));isTouchDevice()&&(h.hammer=new Hammer.Manager(h,{recognizers:[[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Tap],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),
h.hammer.on("doubletap",function(b){d.myDelegate.onTreeNodeDoubleClick(d,a,b);b.srcEvent.stopPropagation();b.preventDefault()}),h.hammer.on("tap",function(b){d.myDelegate.onTreeNodeClick(d,a,b);b.srcEvent.stopPropagation();b.preventDefault()}),h.hammer.on("press",function(b){d.myDelegate.onTreeNodeRightClick(d,a,b);b.srcEvent.stopPropagation();b.preventDefault()}));h.addEventListener("click",function(b){d.myDelegate.onTreeNodeClick(d,a,b);b.stopPropagation();b.preventDefault()},!1);h.addEventListener("dblclick",
function(b){d.myDelegate.onTreeNodeDoubleClick(d,a,b);b.stopPropagation();b.preventDefault()},!1);h.addEventListener("contextmenu",function(b){d.myDelegate.onTreeNodeRightClick(d,a,b);b.stopPropagation();b.preventDefault()},!1);(b=d.myDelegate.getTreeNodeClass(a))&&h.classList.add(b);return h};Autodesk.Viewing.UI.Tree.prototype.createHtmlElement_=function(a,b,c){b=document.createElement(b);a.appendChild(b);c&&(b.className=c);return b};
Autodesk.Viewing.UI.Tree.prototype.iterate=function(a,b){if(a&&this.myDelegate.shouldCreateTreeNode(a)){var c=this.getElementForNode(a);if(c){b(a,c);var f=this;this.myDelegate.forEachChild(a,function(a){f.iterate(a,b)})}}};AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.TreeDelegate=Autodesk.Viewing.UI.TreeDelegate;Autodesk.Viewing.Private.TreeDelegate.prototype=Autodesk.Viewing.UI.TreeDelegate.prototype;Autodesk.Viewing.Private.Tree=Autodesk.Viewing.UI.Tree;
Autodesk.Viewing.Private.Tree.prototype=Autodesk.Viewing.UI.Tree.prototype;"use strict";AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.BrowserDelegate=function(){};Autodesk.Viewing.Private.BrowserDelegate.prototype.constructor=Autodesk.Viewing.Private.BrowserDelegate;Autodesk.Viewing.Private.BrowserDelegate.prototype.getNodeId=function(a){throw"getId is not implemented.";};Autodesk.Viewing.Private.BrowserDelegate.prototype.getNodeLabel=function(a){return a.name};
Autodesk.Viewing.Private.BrowserDelegate.prototype.getNodeClass=function(a){return""};Autodesk.Viewing.Private.BrowserDelegate.prototype.hasThumbnail=function(a){return!1};Autodesk.Viewing.Private.BrowserDelegate.prototype.getThumbnail=function(a){return null};Autodesk.Viewing.Private.BrowserDelegate.prototype.onNodeClick=function(a,b,c){};Autodesk.Viewing.Private.BrowserDelegate.prototype.onNodeHover=function(a,b,c){};Autodesk.Viewing.Private.BrowserDelegate.prototype.selectItem=function(a){};
Autodesk.Viewing.Private.BrowserDelegate.prototype.deselectItem=function(a){};Autodesk.Viewing.Private.BrowserDelegate.prototype.hasContent=function(a){return!1};Autodesk.Viewing.Private.BrowserDelegate.prototype.addContent=function(a,b){};
Autodesk.Viewing.Private.Browser=function(a,b,c){this.myDelegate=a;this.mySelectedIds=[];this.myRootContainerId=c+"-browserview";this.idToElement={};this.myRootContainer=document.createElement("div");this.myRootContainer.id=this.myRootContainerId;this.myRootContainer.classList.add("browserview");document.getElementById(c).appendChild(this.myRootContainer);this.createElements(b,this.myRootContainer)};Autodesk.Viewing.Private.Browser.prototype.constructor=Autodesk.Viewing.Private.Browser;
Autodesk.Viewing.Private.Browser.prototype.show=function(a){a?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")};Autodesk.Viewing.Private.Browser.prototype.getRootContainer=function(){return this.myRootContainer};
Autodesk.Viewing.Private.Browser.prototype.delegate=function(){return this.myDelegate};Autodesk.Viewing.Private.Browser.prototype.addToSelection=function(a){for(var b=0,c=a.length;b<c;++b){var f=a[b],g;g=f;-1==this.mySelectedIds.indexOf(g)?(this.mySelectedIds.push(g),g=!0):g=!1;g&&(g=this.idToElement[f],void 0===g?this.myDelegate.selectItem(f):g.classList.add("selected"))}};
Autodesk.Viewing.Private.Browser.prototype.removeFromSelection=function(a){for(var b=a.length-1;0<=b;--b){var c=a[b],f;f=this.mySelectedIds.indexOf(c);-1!=f?(this.mySelectedIds.splice(f,1),f=!0):f=!1;f&&(f=this.idToElement[c],void 0===f?this.myDelegate.deselectItem(c):f.classList.remove("selected"))}};Autodesk.Viewing.Private.Browser.prototype.setSelection=function(a){this.removeFromSelection(this.mySelectedIds);this.addToSelection(a);return this.mySelectedIds};
Autodesk.Viewing.Private.Browser.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)};Autodesk.Viewing.Private.Browser.prototype.createElements=function(a,b){if(a)for(var c=0;c<a.length;c++)this.createElement(a[c],b)};
Autodesk.Viewing.Private.Browser.prototype.createElement=function(a,b){var c=this,f=c.myDelegate.getNodeId(a),g=document.createElement("item");b.appendChild(g);this.idToElement[f]=g;g.onmouseover=function(){c.myDelegate.onNodeHover(c,a)};g.onclick=function(b){c.myRootContainer.querySelector(".flipped").removeClass("flipped");c.myDelegate.onNodeClick(c,a,b)};f=document.createElement("div");f.classList.add("card");g.appendChild(f);var d=document.createElement("div");d.classList.add("browserElement");
f.appendChild(d);var h=c.myDelegate.getNodeLabel(a),k=document.createElement("label");k.innerHTML=h;d.appendChild(k);k.onclick=function(b){c.myDelegate.onNodeClick(c,a,b)};if(h=c.myDelegate.getThumbnail(a))k=document.createElement("img"),k.classList.add("thumb"),k.src=h,d.appendChild(k),k.onclick=function(b){c.myDelegate.onNodeClick(c,a,b)};c.myDelegate.hasContent(a)&&c.myDelegate.addContent(a,f);g.classList.add(c.myDelegate.getNodeClass(a))};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.WEBGL_HELP_LINK=null;a.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message> <hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},
3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You don\u2019t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},
5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We can\u2019t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},
6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},
8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>There\u2019s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},
10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldn\u2019t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"}};
a.currentError=null;a.currentErrors=null;a.ErrorHandler=function(){};a.ErrorHandler.prototype.constructor=a.ErrorHandler;a.ErrorHandler.getErrorCode=function(a){return 403===a||401===a?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===a?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:500<=a?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE};a.ErrorHandler.reportError=function(b,c,f,g){a.ErrorHandler.currentError=null;a.ErrorHandler.currentErrors=
null;if(c){a.logger&&a.logger.log({category:"error",code:c,message:f},!0);a.ErrorHandler.currentError=[b,c,f,g];var d=a.ErrorInfoData[c];if(d){var h={defaultValue:""};h.defaultValue=d["default-msg"];var k=d.img;f=this.parseErrorString(d["globalized-msg"],h);if(c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(c=a.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",g=0;g<f.hints.length;g++)-1!==f.hints[g].indexOf('href="WEBGL_HELP"')&&
(f.hints[g]=f.hints[g].replace('href="WEBGL_HELP"','href="'+c+'"'))}else k="img-unsupported",h={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},this.parseArguments(f,h),f=this.parseErrorString(c,h),f.header||(f.header="warning"===g?Autodesk.Viewing.i18n.translate("header-warning"):"");a.AlertBox.displayError(b,f.msg,f.header,k,f.hints)}};a.ErrorHandler.reportErrors=function(b,c){a.ErrorHandler.currentError=null;a.ErrorHandler.currentErrors=null;if(c){a.ErrorHandler.currentErrors=
[b,c];for(var f={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},g=[],d=0;d<c.length;d++)if(c[d].code){this.parseArguments(c[d].message,f);var h=this.parseErrorString(c[d].code,f);h.header||(h.header="warning"===c[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):"");g.push(h);a.logger&&a.logger.log({category:"error",code:c[d].code,message:c[d].message},!0)}g.length&&a.AlertBox.displayErrors(b,"img-unsupported",g)}};a.ErrorHandler.parseArguments=function(a,
c){if(a)if("string"===typeof a)c.defaultValue=a;else{c.defaultValue=a[0];for(var f=1;f<a.length;f++)c[(f-1).toString()]=a[f]}};a.ErrorHandler.parseErrorString=function(a,c){var f={msg:null,msgList:null,header:null,hints:null};if(!a)return f;var g=Autodesk.Viewing.i18n.translate(a,c);if(!g)return f;-1!=g.indexOf("<title>")&&(g=g.split("<title>")[1].split("</title>"),f.header=g[0],g=g[1]);g&&-1!=g.indexOf("<message>")?(g=g.split("<message>")[1].split("</message>"),f.msg=g[0],g=g[1]):f.msg=g;if(g&&-1!=
g.indexOf("<hint>")){f.hints=[];for(var g=g.split("<hint>"),d=0;d<g.length;d++){var h=g[d].split("</hint")[0];f.hints.push(h)}}return f};a.ErrorHandler.localize=function(){if(0<a.AlertBox.instances.length)if(a.AlertBox.dismiss(),a.ErrorHandler.currentError){var b=a.ErrorHandler.currentError.shift(),c=a.ErrorHandler.currentError;a.ErrorHandler.reportError(b,c[0],c[1],c[2])}else b=a.ErrorHandler.currentErrors.shift(),a.ErrorHandler.reportErrors(b,a.ErrorHandler.currentErrors[0])}})();"use strict";
Autodesk.Viewing.Extension=function(a,b){this.viewer=a;this.options=b};Autodesk.Viewing.Extension.prototype.load=function(){return!0};Autodesk.Viewing.Extension.prototype.unload=function(){return!0};Autodesk.Viewing.Extension.prototype.getState=function(a){};Autodesk.Viewing.Extension.prototype.restoreState=function(a,b){return!0};"use strict";AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.ExtensionManager=function(){var a={};return{registerExtension:function(b,c){return a.hasOwnProperty(b)?!1:(a[b]=c,!0)},getExtension:function(b){return a.hasOwnProperty(b)?a[b]:null},unregisterExtension:function(b){return a.hasOwnProperty(b)?(delete a[b],!0):!1}}};Autodesk.Viewing.theExtensionManager=new Autodesk.Viewing.ExtensionManager;Autodesk.Viewing.ExtensionMixin=function(){};
Autodesk.Viewing.ExtensionMixin.prototype={loadExtension:function(a,b){this.loadedExtensions||(this.loadedExtensions={});var c=!1;if(this.getExtension(a))stderr("Extension already loaded: "+a);else{var f=Autodesk.Viewing.theExtensionManager.getExtension(a);if(f){if(f=new f(this,b),c=f.load())this.loadedExtensions[a]=f,stderr("Extension loaded: "+a)}else stderr("Extension not found: "+a)}return c},getExtension:function(a){return this.loadedExtensions&&a in this.loadedExtensions?this.loadedExtensions[a]:
null},unloadExtension:function(a){var b=!1,c=this.getExtension(a);c?(b=c.unload(),stderr("Extension unloaded: "+a),delete this.loadedExtensions[a]):stderr("Extension not found: "+a);return b},apply:function(a){var b=Autodesk.Viewing.ExtensionMixin.prototype;a.loadExtension=b.loadExtension;a.getExtension=b.getExtension;a.unloadExtension=b.unloadExtension}};AutodeskNamespace("Autodesk.Viewing");Autodesk.Viewing.FileLoader=function(a){this.viewer=a};
Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader;Autodesk.Viewing.FileLoader.prototype.loadFile=function(a,b,c,f,g){return!1};Autodesk.Viewing.FileLoader.prototype.getObjectTree=function(a,b){};Autodesk.Viewing.FileLoader.prototype.getProperties=function(a,b,c){};"use strict";AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.FileLoaderManager=function(){var a={};return{registerFileLoader:function(b,c,f){return!a.hasOwnProperty(b)&&f instanceof Autodesk.Viewing.FileLoader?(a[b]={loader:f,extensions:c},!0):!1},getFileLoader:function(b){return a.hasOwnProperty(b)?a[b].loader:null},getFileLoaderForExtension:function(b){for(var c in a)if(a.hasOwnProperty(c))for(var f=a[c],g=0;g<f.extensions.length;g++)if(f.extensions[g]===b)return f.loader;return null},unregisterFileLoader:function(b){return a.hasOwnProperty(b)?
(delete a[b],!0):!1}}};Autodesk.Viewing.theFileLoaderManager=new Autodesk.Viewing.FileLoaderManager;
function init_UnifiedCamera(){"undefined"===typeof Autodesk.Viewing.UnifiedCamera&&(AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.UnifiedCamera=function(a,b){THREE.Camera.call(this);this.fov=45;this.near=.1;this.far=1E5;this.aspect=a/b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2;this.target=new THREE.Vector3(0,0,-1);this.worldup=new THREE.Vector3(0,1,0);this.orthographicCamera=new THREE.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far);this.perspectiveCamera=
new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far);this.zoom=1;this.toPerspective()},Autodesk.Viewing.UnifiedCamera.ORTHO_FOV=360*Math.atan(.5)/Math.PI,Autodesk.Viewing.UnifiedCamera.prototype=Object.create(THREE.Camera.prototype),Autodesk.Viewing.UnifiedCamera.prototype.clone=function(){var a=new Autodesk.Viewing.UnifiedCamera(2*this.right,2*this.top);THREE.Camera.prototype.clone.call(this,a);a.position.copy(this.position);a.up.copy(this.up);this.target&&(a.target=this.target.clone());
this.worldup&&(a.worldup=this.worldup.clone());a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.fov=this.fov;a.aspect=this.aspect;a.zoom=this.zoom;a.isPerspective=this.isPerspective;this.updateProjectionMatrix();return a},Autodesk.Viewing.UnifiedCamera.prototype.__computeFovPosition=function(a){if(1E-4>=Math.abs(this.fov-a))return this.position.clone();var b=this.target.clone().sub(this.position),c=THREE.Math.degToRad(this.fov);a=THREE.Math.degToRad(a);
c=b.length()*Math.tan(.5*c)/Math.tan(.5*a);b=b.normalize().multiplyScalar(-c);return this.target.clone().add(b)},Autodesk.Viewing.UnifiedCamera.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov);this.perspectiveCamera.aspect=this.aspect;this.perspectiveCamera.near=this.near;this.perspectiveCamera.far=this.far;this.perspectiveCamera.fov=this.fov/this.zoom;this.perspectiveCamera.updateProjectionMatrix();
this.projectionMatrix=this.perspectiveCamera.projectionMatrix;this.isPerspective=!0},Autodesk.Viewing.UnifiedCamera.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var a=Autodesk.Viewing.UnifiedCamera.ORTHO_FOV;this.position.copy(this.__computeFovPosition(a));this.fov=a}this.orthoScale=this.target.clone().sub(this.position).length();var a=.5*this.orthoScale,b=a*this.aspect;this.left=this.orthographicCamera.left=-b;this.right=this.orthographicCamera.right=b;this.top=
this.orthographicCamera.top=a;this.bottom=this.orthographicCamera.bottom=-a;this.orthographicCamera.near=this.near;this.orthographicCamera.far=this.far;this.orthographicCamera.updateProjectionMatrix();this.projectionMatrix=this.orthographicCamera.projectionMatrix;this.isPerspective=!1},Autodesk.Viewing.UnifiedCamera.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},Autodesk.Viewing.UnifiedCamera.prototype.setSize=function(a,b){this.aspect=a/
b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2},Autodesk.Viewing.UnifiedCamera.prototype.setFov=function(a){this.fov=a;this.updateProjectionMatrix()},Autodesk.Viewing.UnifiedCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.setFov(c);return c},Autodesk.Viewing.UnifiedCamera.prototype.getCameraChangedEvent=function(){return{type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:this}})}AutodeskNamespace("Autodesk.Viewing");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;a.ESCAPE_EVENT="escape";a.PROGRESS_UPDATE_EVENT="progress";a.FULLSCREEN_MODE_EVENT="fullScreenMode";a.NAVIGATION_MODE_CHANGED_EVENT="navmode";a.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored";a.VIEWER_RESIZE_EVENT="viewerResize";a.VIEWER_UNINITIALIZED="viewerUninitialized";a.MODEL_ROOT_LOADED_EVENT="svfLoaded";a.GEOMETRY_LOADED_EVENT="geometryLoaded";a.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded";a.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable";
a.SELECTION_CHANGED_EVENT="selection";a.ISOLATE_EVENT="isolate";a.HIDE_EVENT="hide";a.SHOW_EVENT="show";a.HIGHLIGHT_EVENT="highlight";a.CAMERA_CHANGE_EVENT="cameraChanged";a.EXPLODE_CHANGE_EVENT="explodeChanged";a.CUTPLANES_CHANGE_EVENT="cutplanesChanged";a.TOOL_CHANGE_EVENT="toolChanged";a.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged";a.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility";a.RESET_EVENT="reset";a.ANIMATION_READY_EVENT="animationReady";a.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,
FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};a.Viewer3D=function(a,f){this.clientContainer=a;this.container=document.createElement("div");this.container.className="adsk-viewing-viewer";this.container.style.height="100%";this.container.style.width="100%";this.container.style.overflow="hidden";this.container.classList.add(isTouchDevice()?"touch":"notouch");this.clientContainer.appendChild(this.container);this.config=f;this.contextMenu=null;this.contextMenuCallbacks={};this.started=this.__firefoxLMBfix=
!1;if("CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div");this.canvasWrap.classList.add("canvas-wrap");this.canvas=document.createElement("canvas");this.canvas.tabIndex=0;this.canvasWrap.appendChild(this.canvas);this.container.appendChild(this.canvasWrap);this.canvas.viewer=this;this.running=!1;this._defaultNavigationTool=this._pushedTool="";this.stats={category:"misc_stats",explode_count:0,get_props_count:0,isolate_count:0};
var g=this;window.addEventListener("beforeunload",function(){g.__logStats(!0)});this.prefs=new b.Preferences(this,"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.")};a.Viewer3D.prototype.constructor=a.Viewer3D;a.EventDispatcher.prototype.apply(a.Viewer3D.prototype);a.ScreenModeMixin.prototype.apply(a.Viewer3D.prototype);a.ExtensionMixin.prototype.apply(a.Viewer3D.prototype);a.Viewer3D.ScreenMode=a.ScreenMode;a.Viewer3D.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},
clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"],offObject:["deselectAll"]},clickShift:{onObject:["selectToggle"],offObject:["deselectAll"]}};a.Viewer3D.prototype.start=function(){if(this.started)return 0;var a=this.initialize();if(0===a&&(this.started=!0,this.config&&this.config.hasOwnProperty("extensions")))for(var b=this.config.extensions,g=0;g<b.length;++g)this.loadExtension(b[g],this.config);return a};a.Viewer3D.prototype.registerUniversalHotkeys=function(){var b=
this,f,g,d,h=a.theHotkeyManager.KEYCODES;a.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[h.f],onPress:function(){b.navigation.setRequestFitToView(!0);return!0}}]);f=function(){b.navigation.setRequestHomeView(!0);return!0};a.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[h.h],onPress:f},{keycodes:[h.HOME],onPress:f}]);a.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[h.ESCAPE],onRelease:function(){if(b.objectContextMenu&&b.objectContextMenu.hide())return!0;b.fireEvent({type:a.ESCAPE_EVENT});
return!0}}]);f=function(){d=b.getActiveNavigationTool();return b.setActiveNavigationTool("pan")};g=function(){return b.setActiveNavigationTool(d)};a.theHotkeyManager.pushHotkeys("Autodesk.Pan",[{keycodes:[h.SHIFT],onPress:f,onRelease:g},{keycodes:[h.SPACE],onPress:f,onRelease:g}],{tryUntilSuccess:!0})};a.Viewer3D.prototype.createControls=function(){var b=this.impl;this.navigation=new a.Navigation(b.camera);this.__initAutoCam(b);this.utilities=new a.ViewingUtilities(b,this.autocam,this.navigation);
this.clickHandler=new a.DefaultHandler(b,this.navigation,this.utilities);this.toolController=new a.ToolController(b,this,this.autocam,this.utilities,this.clickHandler);this.toolController.registerTool(new a.GestureHandler(this));this.toolController.registerTool(a.theHotkeyManager);this.toolController.activateTool(a.theHotkeyManager.getName());this.registerUniversalHotkeys();this.toolController.registerTool(new a.OrbitDollyPanTool(b,this));this.toolController.activateTool("gestures");return this.toolController};
a.Viewer3D.prototype.initialize=function(){var c=detectWebGL();if(0>=c)return-1===c?a.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:a.ErrorCodes.BROWSER_WEBGL_DISABLED;var f=this;this.onResizeCallback=function(a){f.resize()};window.addEventListener("resize",this.onResizeCallback,!1);this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);this.initContextMenu();this.localize();c=this.getDimensions();this.canvas.width=c.width;this.canvas.height=c.height;isIOSDevice()&&window.devicePixelRatio&&
(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio);this.impl=new b.Viewer3DImpl(this.canvas,this);this.impl.controls=this.createControls();this.setDefaultNavigationTool("orbit");this.defaultLoader=this.impl.loader;this.model=null;this.impl.controls&&this.impl.controls.setAutocam(this.autocam);c=this.config&&this.config.canvasConfig?this.config.canvasConfig:a.Viewer3D.kDefaultCanvasConfig;this.setCanvasClickBehavior(c);this.loader=document.createElement("div");
this.loader.id="loader";this.loader.className="spinner";this.container.appendChild(this.loader);if(!c.disableSpinner)for(c=1;3>=c;c++){var g=document.createElement("div");g.className="bounce"+c;this.loader.appendChild(g)}this.initSettings();this.viewerState=new b.ViewerState(this);this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run();window.NOP_VIEWER=this;return 0};a.Viewer3D.prototype.setUp=function(b){if((this.config=b)&&this.config.hasOwnProperty("extensions")){b=
this.config.extensions;for(var f=0;f<b.length;++f)this.loadExtension(b[f],this.config)}this.setCanvasClickBehavior(this.config&&this.config.canvasConfig?this.config.canvasConfig:a.Viewer3D.kDefaultCanvasConfig)};a.Viewer3D.prototype.tearDown=function(){this.clearSelection();if(this.loadedExtensions)for(var a in this.loadedExtensions)try{this.unloadExtension(a)}catch(f){stderr("Failed to unload extension: "+a);console.log("  error: "+f.message);console.error("  stack:\n"+f.stack);var g=b.logger;g&&
g.log({category:"error_unload_extension",extensionId:a,error_message:f.message,call_stack:f.stack})}this.__logStats();this.loader.style.display="block";this.model=null};a.Viewer3D.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())};a.Viewer3D.prototype.localize=function(){a.i18n.localize()};a.Viewer3D.prototype.__logStats=function(a){var f=b.logger;f&&(this.stats.explode_count||this.stats.get_props_count||this.stats.isolate_count)&&(f.log(this.stats,a),this.stats.explode_count=
0,this.stats.get_props_count=0,this.stats.isolate_count=0)};a.Viewer3D.prototype.__initAutoCam=function(a){var b=this,g=a.camera;g.pivot||(g.pivot=new THREE.Vector3(0,0,0));g.target||(g.target=new THREE.Vector3(0,0,0));g.worldup||(g.worldup=g.up.clone());b.autocamCamera=g.clone();b.autocamCamera.target=g.target.clone();b.autocamCamera.pivot=g.pivot.clone();b.autocamCamera.worldup=g.worldup.clone();b.autocam=new Autocam(b.autocamCamera,b.navigation,b.canvas,function(a){b.autocamCamera.isPerspective!==
g.isPerspective&&(b.autocamCamera.isPerspective?b.navigation.toPerspective():b.navigation.toOrthographic());b.navigation.setVerticalFov(b.autocamCamera.fov,!1);b.navigation.setView(b.autocamCamera.position,b.autocamCamera.target);b.navigation.setPivotPoint(b.autocamCamera.pivot);b.navigation.setCameraUpVector(b.autocamCamera.up);a&&b.navigation.setWorldUpVector(b.autocamCamera.worldup);b.impl.syncCamera(a)},function(a){b.utilities?b.utilities.pivotActive(a,!1):b.impl.controls.pivotActive(a,!1)});
b.addEventListener("cameraChanged",function(a){b.autocam.sync(a.camera)});b.autocam.sync(g)};a.Viewer3D.prototype.load=function(a,b,g,d){var h=this;return this.loadModel(a,null,b,function(){h.modelstructure&&h.model.getObjectTree(function(a){h.modelstructure.setModel(a,h.config.defaultModelStructureTitle?h.config.defaultModelStructureTitle:"")},function(a){});g&&g()},d)};a.Viewer3D.prototype.uninitialize=function(c){window.removeEventListener("resize",this.onResizeCallback,!1);this.canvas.parentNode.removeChild(this.canvas);
this.viewerState=this.canvas=this.canvas.viewer=null;this.__logStats();(c=b.logger)&&c.log({category:"viewer_destroy"},!0);this.toolController&&(this.toolController.uninitialize(),this.utilities=this.clickHandler=this.toolController=null);this.navigation&&(this.navigation.uninitialize(),this.navigation=null);this.impl&&(this.impl.uninitialize(),this.impl=null);this.prefs=this.model=this.loader=null;a.theHotkeyManager.popHotkeys("Autodesk.FitToView");a.theHotkeyManager.popHotkeys("Autodesk.Home");
a.theHotkeyManager.popHotkeys("Autodesk.Escape");a.theHotkeyManager.popHotkeys("Autodesk.Pan");a.theHotkeyManager.popHotkeys("Autodesk.Orbit");this.onDefaultContextMenu&&this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1);this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);this.container=null;this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null);this.config=this.clientContainer=null;this.listeners=
{};this.contextMenuCallbacks=this.contextMenu=null;this.fireEvent(a.VIEWER_UNINITIALIZED)};a.Viewer3D.prototype.finish=function(){this.tearDown();this.uninitialize()};a.Viewer3D.prototype.loadModel=function(b,f,g,d,h,k){function m(){if(n.model.is2d())a.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var b;a.theHotkeyManager.pushHotkeys("Autodesk.Orbit",[{keycodes:[a.theHotkeyManager.KEYCODES.ALT],onPress:function(){b=n.getActiveNavigationTool();return n.setActiveNavigationTool("orbit")},onRelease:function(){return n.setActiveNavigationTool(b)}}],
{tryUntilSuccess:!0})}}var n=this;this.addEventListener(a.GEOMETRY_LOADED_EVENT,function(b){this.impl.needsRender=!0;n.removeEventListener(a.GEOMETRY_LOADED_EVENT)});var q=b.toLowerCase().match(/\.([a-z0-9]+$)/),q=q?q[1]:null;this.impl.loader=k&&k.fileLoader?k.fileLoader:a.theFileLoaderManager.getFileLoaderForExtension(q)||this.defaultLoader;this.impl.unloadCurrentModel();return this.impl.loader.loadFile(b,f,g,function(b){n.model=new a.Model(b);n.impl.setModel(n.model);n.loader.style.display="None";
n.model.is2d()&&n.activateLayerState("Initial");m();d&&d()},function(a,b){n.loader.style.display="None";h&&h(a,b)})};a.Viewer3D.prototype.getDimensions=function(){if(this.container){var b={};this.getScreenMode()===a.ScreenMode.kFullScreen?(b.width=screen.width,b.height=screen.height):b=this.container.getBoundingClientRect();return{width:b.width,height:b.height}}return null};a.Viewer3D.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)};a.Viewer3D.prototype.getCamera=
function(){return this.impl.camera};a.Viewer3D.prototype.getState=function(a){return this.viewerState.getState(a)};a.Viewer3D.prototype.restoreState=function(b,f,g){(b=this.viewerState.restoreState(b,f,g))&&this.fireEvent({type:a.VIEWER_STATE_RESTORED_EVENT,value:b});return b};a.Viewer3D.prototype.setViewFromArray=function(a,b){this.setActiveNavigationTool("orbit");var g=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},g={position:new THREE.Vector3(a[0]-g.x,a[1]-g.y,a[2]-g.z),target:new THREE.Vector3(a[3]-
g.x,a[4]-g.y,a[5]-g.z),up:new THREE.Vector3(a[6],a[7],a[8]),aspect:a[9],fov:THREE.Math.radToDeg(a[10]),orthoScale:a[11],isPerspective:!a[12]};this.impl.setViewFromCamera(g)};a.Viewer3D.prototype.setViewFromViewBox=function(a,b){var g=this.model;if(g&&!g.is2d())console.warn("av.Viewer3D.setViewFromViewBox is not applicable to 3D");else{if(b&&b.length){var g=g.getData().metadata.views,d;for(d=0;d<g.length&&g[d].name!=b;d++);d<g.length&&(g=g[d].layer_state)&&this.activateLayerState(g)}this.impl.setViewFromViewBox(this.model,
a,b,!1)}};a.Viewer3D.prototype.activateLayerState=function(b){if(b&&b.length){var f=this.model.getData().metadata,g=f.layer_states;if(g){var d;for(d=0;d<g.length&&g[d].name!=b;d++);if(d<g.length){g=g[d].visible_layers;b={};if(g&&0<g.length)for(d=0;d<g.length;d++)b[g[d]]=1;g=[];d=[];for(var h in f.layers)1===b[f.layers[h].name]?g.push(h):d.push(h);this.impl.setLayerVisible(g,!0);this.impl.setLayerVisible(d,!1);this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}}}};a.Viewer3D.prototype.getLayerStates=
function(){function a(b,c){var d=Object.getOwnPropertyNames(b),f=Object.getOwnPropertyNames(c);if(d.length!==f.length)return!1;for(f=0;f<d.length;++f){var g=d[f];if(b[g]!==c[g])return!1}return!0}var b=this.model,g=(b=b?b.getData().metadata:null)?b.layers:null,b=b?b.layer_states:null;if(!g||!b)return null;var d,h={},k={},m;for(m in g)if(g.hasOwnProperty(m)){var n=parseInt(m);d=g[m];d="string"===typeof d?d:d.name;h[d]=!0;this.impl.isLayerVisible(n)&&(k[d]=!0)}m=[];for(g=0;g<b.length;++g){var q=b[g],
l=q.visible_layers,p={};if(!q.hidden){if(l&&0<l.length)for(n=0;n<l.length;++n)d=l[n],h.hasOwnProperty(d)&&(p[d]=!0);m.push({name:q.name,description:q.description,active:a(k,p)})}}return 0<m.length?m:null};a.Viewer3D.prototype.setViewFromFile=function(){this.setActiveNavigationTool();this.impl.setViewFromFile(this.model)};a.Viewer3D.prototype.getProperties=function(b,f,g){this.stats.get_props_count++;this.model?this.model.getProperties(b,f,g):g&&g(a.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist.")};
a.Viewer3D.prototype.getObjectTree=function(b,f){this.model?this.model.getObjectTree(b,f):f&&f(a.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist.")};a.Viewer3D.prototype.setCanvasClickBehavior=function(a){this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(a);this.clickHandler&&this.clickHandler.setClickBehavior(a)};a.Viewer3D.prototype.search=function(b,f,g,d){this.searchText=b;this.model?this.model.search(b,f,g,d):g&&g(a.ErrorCodes.BAD_DATA,
"Search failed since model does not exist.")};a.Viewer3D.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()};a.Viewer3D.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(console.warn("av.Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()};a.Viewer3D.prototype.isolate=function(a){if(this.model&&this.model.is2d())console.warn("av.Viewer3D.isolate is not yet implemented for 2D");else{var b=
this;this.model.getObjectTree(function(){b.stats.isolate_count++;b.impl.visibilityManager.isolate(a)})}};a.Viewer3D.prototype.isolateById=function(a){console.warn("isolateById() is deprecated. Use isolate() instead.");return this.isolate(a)};a.Viewer3D.prototype.setBackgroundColor=function(a,b,g,d,h,k){this.impl.setClearColors(a,b,g,d,h,k)};a.Viewer3D.prototype.toggleSelect=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(a)};
a.Viewer3D.prototype.select=function(a){"number"===typeof a&&(a=[a]);this.impl.selector.setSelectionIds(a)};a.Viewer3D.prototype.clearSelection=function(){this.impl.selector.clearSelection()};a.Viewer3D.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()};a.Viewer3D.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()};a.Viewer3D.prototype.setSelectionMode=function(a){this.impl.selector.setSelectionMode(a)};a.Viewer3D.prototype.getSelection=
function(){return this.impl.selector.getSelection()};a.Viewer3D.prototype.hide=function(a){if(this.model&&this.model.is2d())console.warn("av.Viewer3D.hide is not yet implemented for 2D");else{var f=b.logger;f&&f.log({category:"hide"});Array.isArray(a)?this.impl.visibilityManager.hideMultiple(a):this.impl.visibilityManager.hide(a)}};a.Viewer3D.prototype.hideById=function(a){this.hide(a)};a.Viewer3D.prototype.show=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.show is not yet implemented for 2D"):
Array.isArray(a)?this.impl.visibilityManager.showMultiple(a):this.impl.visibilityManager.show(a)};a.Viewer3D.prototype.showAll=function(){this.impl.visibilityManager.isolateNone();this.model.is2d()&&this.setLayerVisible(null,!0)};a.Viewer3D.prototype.toggleVisibility=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.toggleVisibility is not yet implemented for 2D"):this.impl.visibilityManager.toggleVisibility(a)};a.Viewer3D.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)};
a.Viewer3D.prototype.explode=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.explode is not applicable to 2D"):(this.stats.explode_count++,this.impl.explode(a))};a.Viewer3D.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(console.warn("av.Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()};a.Viewer3D.prototype.setQualityLevel=function(a,b){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setQualityLevel is not applicable to 2D"):
(this.prefs.set("ambientShadows",a),this.prefs.set("antialiasing",b),this.impl.togglePostProcess(a,b))};a.Viewer3D.prototype.setGhosting=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGhosting is not applicable to 2D"):(this.prefs.set("ghosting",a),this.impl.toggleGhosting(a))};a.Viewer3D.prototype.setGroundShadow=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundShadow is not applicable to 2D"):(this.prefs.set("groundShadow",a),this.impl.toggleGroundShadow(a))};
a.Viewer3D.prototype.setGroundReflection=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundReflection is not applicable to 2D"):(this.prefs.set("groundReflection",a),this.impl.toggleGroundReflection(a))};a.Viewer3D.prototype.setProgressiveRendering=function(a){this.prefs.set("progressiveRendering",a);this.impl.toggleProgressive(a)};a.Viewer3D.prototype.setOptimizeNavigation=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setOptimizeNaviation is not applicable to 2D"):
(this.prefs.set("optimizeNavigation",a),this.impl.setOptimizeNavigation(a))};a.Viewer3D.prototype.setActiveNavigationTool=function(c){if(c===this._pushedTool||!c&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this._pushedTool=null;var f=b.logger;f&&f.log({category:"tool_changed",name:c})}return c&&c!==this.getDefaultNavigationToolName()||null!==this._pushedTool?this.impl.controls.activateTool(c)?(this._pushedTool=c,this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,
id:this._pushedTool}),!0):!1:(this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0)};a.Viewer3D.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool};a.Viewer3D.prototype.setDefaultNavigationTool=function(a){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool);this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool);this.impl.controls.activateTool(a);
this._defaultNavigationTool=a;this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)};a.Viewer3D.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool};a.Viewer3D.prototype.getFOV=function(){return this.navigation.getVerticalFov()};a.Viewer3D.prototype.setFOV=function(a){this.navigation.setVerticalFov(a,!0)};a.Viewer3D.prototype.getFocalLength=function(){return this.navigation.getFocalLength()};a.Viewer3D.prototype.setFocalLength=function(a){this.navigation.setFocalLength(a,
!0)};a.Viewer3D.prototype.hideLines=function(b){this.prefs.set("lineRendering",!b);if(!this.impl.hideLines(b)){var f=function(){g.impl.hideLines(b);g.removeEventListener(a.GEOMETRY_LOADED_EVENT,f)},g=this;this.addEventListener(a.GEOMETRY_LOADED_EVENT,f)}};a.Viewer3D.prototype.applyCamera=function(a,b){this.impl.setViewFromCamera(a,!0);b&&this.fitToView()};a.Viewer3D.prototype.fitToView=function(b){var f=this,g=!0,d=function(){var k=null;if(Array.isArray(b)&&0<b.length){for(var n=new THREE.Box3,q=
new THREE.Box3,l=f.model.getData().instanceTree,p=f.impl.modelQueue().getFragmentList(),r=0;r<b.length;r++)l.enumNodeFragments(b[r],function(a){p.getWorldBounds(a,q);n.union(q)},!0);n.empty()||(k=n)}if(!k||k.empty())k=f.impl.getFitBounds();f.navigation.fitBounds(!1,k);f.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,h);f.removeEventListener(a.GEOMETRY_LOADED_EVENT,d);return g},h=function(){f.model&&f.model.isLoadDone()?d():(g=!1,f.addEventListener(a.GEOMETRY_LOADED_EVENT,d))},k=this.model.getData().propertydb,
k=k&&0<k.attrs.length;!this.model.is2d()&&k&&null!==b&&void 0!==b?this.model&&this.model.isObjectTreeCreated()?h():(g=!1,this.addEventListener(a.OBJECT_TREE_CREATED_EVENT,h)):this.navigation.fitBounds(!1,this.impl.getFitBounds(!0))};a.Viewer3D.prototype.setClickConfig=function(a,b,g){var d=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();return a in d&&(a=d[a],b in a)?(a[b]=g,!0):!1};a.Viewer3D.prototype.getClickConfig=function(a,b){var g=this.clickHandler?
this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();return a in g&&(g=g[a],b in g)?g[b]:null};a.Viewer3D.prototype.setClickToSetCOI=function(a,b){!1!==b&&this.prefs.set("clickToSetCOI",a);var g=this.getClickConfig("click","onObject");a?-1===g.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):0<=g.indexOf("setCOI")&&this.setClickConfig("click","onObject",["selectOnly"])};a.Viewer3D.prototype.initSettings=function(){var a=isIOSDevice()||isAndroidDevice();this.prefs.load({ambientShadows:!0,
antialiasing:!a,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,environmentMap:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!a,lineRendering:!0,lightPreset:b.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:a,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNav:!1});this.prefs.tag("3d");
this.prefs.tag("2d");this.prefs.untag("2d","viewCube alwaysUsePivot zoomTowardsPivot reverseHorizontalLookDirection reverseVerticalLookDirection orbitPastWorldPoles clickToSetCOI ghosting optimizeNavigation ambientShadows antialiasing groundShadow groundReflection lineRendering lightPreset".split(" "));this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing);this.setGroundShadow(this.prefs.groundShadow);this.setGroundReflection(this.prefs.groundReflection);this.setGhosting(this.prefs.ghosting);
this.setProgressiveRendering(this.prefs.progressiveRendering);this.setClickToSetCOI(this.prefs.clickToSetCOI);this.setOptimizeNavigation(this.prefs.optimizeNavigation);this.hideLines(!this.prefs.lineRendering);this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot);this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir);this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection);this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection);
this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot);this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles);this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);if(a=this.prefs.backgroundColorPreset)try{var f=JSON.parse(a);this.impl.setClearColors(f[0],f[1],f[2],f[3],f[4],f[5])}catch(g){this.prefs.set("backgroundColorPreset",null)}this.impl.setLightPreset(this.prefs.lightPreset)};a.Viewer3D.prototype.setLightPreset=function(a){this.model&&this.model.is2d()?
console.warn("av.Viewer3D.setLightPreset is not applicable to 2D"):(this.prefs.set("lightPreset",a),this.impl.setLightPreset(a))};a.Viewer3D.prototype.setUsePivotAlways=function(a){this.prefs.set("alwaysUsePivot",a);this.navigation.setUsePivotAlways(a)};a.Viewer3D.prototype.setReverseZoomDirection=function(a){this.prefs.set("reverseMouseZoomDir",a);this.navigation.setReverseZoomDirection(a)};a.Viewer3D.prototype.setReverseHorizontalLookDirection=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):
(this.prefs.set("reverseHorizontalLookDirection",a),this.navigation.setReverseHorizontalLookDirection(a))};a.Viewer3D.prototype.setReverseVerticalLookDirection=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):(this.prefs.set("reverseVerticalLookDirection",a),this.navigation.setReverseVerticalLookDirection(a))};a.Viewer3D.prototype.setZoomTowardsPivot=function(a){this.prefs.set("zoomTowardsPivot",a);this.navigation.setZoomTowardsPivot(a)};
a.Viewer3D.prototype.setOrbitPastWorldPoles=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):(this.prefs.set("orbitPastWorldPoles",a),this.navigation.setOrbitPastWorldPoles(a))};a.Viewer3D.prototype.setUseLeftHandedInput=function(a){this.prefs.set("leftHandedMouseSetup",a);this.navigation.setUseLeftHandedInput(a)};a.Viewer3D.prototype.preContextMenuShow=function(a){var b=this.impl.castRay(a.clientX,a.clientY),g;b?(b=b.dbId,this.impl.selector.isSelectedOrParentIsSelected(b)||
(a.ctrlKey||a.metaKey||a.shiftKey?(g=this.impl.selector.getSelection(),g.push(b)):g=[b])):g=[];g&&this.impl.selector.setSelection(g);return!0};a.Viewer3D.prototype.setLayerVisible=function(b,f,g){function d(a,b){var c=[];if(a.isLayer)c.push(a.index);else for(var f=a.children,g=0;g<f.length;++g)c=c.concat(d(f[g]));return c}if(this.model&&!this.model.is2d())console.warn("av.Viewer3D.setLayerVisible is not yet implemented for 3D");else{var h=this.model.getLayersRoot();if(h&&0!==h.childCount){null===
b&&(b=[h]);Array.isArray(b)||(b=[b]);g&&(this.impl.setLayerVisible(d(h),!1),f=!0);g=[];for(h=0;h<b.length;++h)g=g.concat(d(b[h]));this.impl.setLayerVisible(g,f);this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}}};a.Viewer3D.prototype.isLayerVisible=function(a){return this.model&&!this.model.is2d()?(console.warn("av.Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(a&&a.isLayer&&this.impl.isLayerVisible(a.index))};a.Viewer3D.prototype.anyLayerHidden=function(){function a(d){if(d.isLayer)return!b.impl.isLayerVisible(d.index);
d=d.children;for(var g=0;g<d.length;++g)if(a(d[g]))return!0;return!1}if(this.model&&!this.model.is2d())return console.warn("av.Viewer3D.anyLayerHidden is not yet implemented for 3D"),0;var b=this,g=b.model.getLayersRoot();return!(!g||!a(g))};a.Viewer3D.prototype.setGroundShadowColor=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(a)};a.Viewer3D.prototype.setGroundShadowAlpha=function(a){this.model&&this.model.is2d()?
console.warn("av.Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(a)};a.Viewer3D.prototype.setGroundReflectionColor=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(a)};a.Viewer3D.prototype.setGroundReflectionAlpha=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(a)};
a.Viewer3D.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(console.warn("av.Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()};a.Viewer3D.prototype.setCutPlanes=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlanes(a)};a.Viewer3D.prototype.setCutPlanesOutlineColor=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setCutPlanesOutlineColor is not applicable to 2D"):
this.impl.setCutPlanesOutlineColor(a)};a.Viewer3D.prototype.setCutPlanesOutlineThickness=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setCutPlanesOutlineThickness is not applicable to 2D"):this.impl.setCutPlanesOutlineThickness(a)};a.Viewer3D.prototype.getScreenShot=function(a,b,g){return this.impl.getScreenShot(a,b,g)};a.Viewer3D.prototype.setContextMenu=function(a){this.contextMenu&&this.contextMenu.hide();this.contextMenu=a};a.Viewer3D.prototype.triggerContextMenu=function(a){if(this.config&&
this.config.onTriggerContextMenuCallback)this.config.onTriggerContextMenuCallback(a);return this.contextMenu&&this.preContextMenuShow(a)?(this.contextMenu.show(a),!0):!1};a.Viewer3D.prototype.initContextMenu=function(){function a(c){var g=c.button;"buttons"in c&&(!b.__firefoxLMBfix||c.buttons&1?2===g&&c.buttons&1&&(g=0,b.__firefoxLMBfix=!0):(b.__firefoxLMBfix=!1,g=0));c=b.navigation&&b.navigation.getUseLeftHandedInput()?0:2;return g===c?!0:!1}if(!this.config||(this.config.hasOwnProperty("disableBrowserContextMenu")?
this.config.disableBrowserContextMenu:1))this.onDefaultContextMenu=function(a){a.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1);var b=this,g=this.canvas||this.container;g.addEventListener("mousedown",function(d){a(d)&&(b.startX=d.clientX,b.startY=d.clientY)});g.addEventListener("mouseup",function(d){a(d)&&d.clientX===b.startX&&d.clientY===b.startY&&b.triggerContextMenu(d);return!0},!1)};a.Viewer3D.prototype.preContextMenuShow=function(a){return!0};a.Viewer3D.prototype.registerContextMenuCallback=
function(a,b){this.contextMenuCallbacks[a]=b};a.Viewer3D.prototype.unregisterContextMenuCallback=function(a){return a in this.contextMenuCallbacks?(delete this.contextMenuCallbacks[a],!0):!1};a.Viewer3D.prototype.runContextMenuCallbacks=function(a,b){for(var g in this.contextMenuCallbacks)if(this.contextMenuCallbacks.hasOwnProperty(g))this.contextMenuCallbacks[g](a,b)};a.Viewer3D.prototype.playAnimation=function(a){var b=this.impl.keyFrameAnimator;b&&b.play(0,a)};a.Viewer3D.prototype.joinLiveReview=
function(a){this.impl.joinLiveReviewSession(a)};a.Viewer3D.prototype.leaveLiveReview=function(){this.impl.leaveLiveReviewSession()}})();AutodeskNamespace("Autodesk.Viewing");Autodesk.Viewing.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,RTC_ERROR:11};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.HTTP_REQUEST_HEADERS={};Autodesk.Viewing.ACM_SESSION_ID;
Autodesk.Viewing.Document=function(a,b){function c(a){if(a){var b=a.children?a.children.length:0;if("geometry"===a.type&&b){for(var f=0,m=0;m<b;m++){var n=a.children[m];n&&"view"===n.type&&(g.myViewGeometry[n.guid]=a,f++)}g.myNumViews[a.guid]=f}else if("application/autodesk-db"==a.mime&&a.urn)0===a.urn.indexOf("urn:adsk.objects:os.object")?g.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("%2F")+3):g.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("/")+1);else if(0<b)for(m=0;m<b;m++)c(a.children[m])}}
function f(a,b,c){if(a){var g=a.guid;if(g){c.apply(this,[g,b]);b=a.children?a.children.length:0;for(var n=0;n<b;n++)f(a.children[n],g,c)}}}this.myPath=b;this.myData=a;this.myViewGeometry={};this.myNumViews={};this.myPropertyDb=null;var g=this;c(a);this.parents={};f(this.myData,null,function(a,b){g.parents[a]=b})};Autodesk.Viewing.Document.prototype.constructor=Autodesk.Viewing.Document;
Autodesk.Viewing.Document.load=function(a,b,c,f){function g(a){var b={},c;for(c in a)-1!=c.indexOf("x-ads-acm")&&(b[c]=a[c]);return b}function d(a){for(var b in a)if("oauth2AccessToken"===b)return a[b];return null}function h(a,b){a.application="autodesk";var d=new XMLHttpRequest;d.open("POST",ACM_SESSION_URL,!0);d.setRequestHeader("Content-Type","application/json");d.setRequestHeader("Authorization","Bearer "+b);d.onload=function(){200===d.status&&(Autodesk.Viewing.ACM_SESSION_ID=JSON.parse(d.responseText).acmsession);
n()};d.onerror=c;d.ontimeout=c;d.send(JSON.stringify(a));delete a.application}function k(a){if(-1===a.indexOf("urn:")){if(0===a.indexOf("http"))return a;0!==a.indexOf("/")&&(a="/"+a);return window.location.protocol+"//"+window.location.host+a}return a}function m(a){var b=[],c=null;if(!a||!a.children)return b;if(a=1===a.children.length?a.children[0]:null)c=a.messages;a=c?c.length:0;for(var d=0;d<a;d++)b.push(c[d]);return b}function n(){var d=k(a);try{Autodesk.Viewing.Private.ViewingService.get(VIEWING_URL,
"bubbles",d,function(a){if(/<[^>]*script/.test(a))c&&c(Autodesk.Viewing.ErrorCodes.BAD_DATA,"Malicious document content detected. Abort loading.");else{a="string"===typeof a?JSON.parse(a):a;a=new Autodesk.Viewing.Document(a,d);var f=Autodesk.Viewing.Document.getSubItemsWithProperties(a.getRootItem(),{type:"folder",role:"viewable"},!0)[0];0<Autodesk.Viewing.Document.getSubItemsWithProperties(f,{type:"geometry"},!0).length?(f=m(a.getRootItem()),b&&b(a,f)):c&&(f=m(a.getRootItem()),c(Autodesk.Viewing.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT,
"No viewable content.",f))}},function(a,b,d){d=m(d);c&&(b="Error: "+a+" ("+b+")",a=Autodesk.Viewing.Private.ErrorHandler.getErrorCode(a),c(a,b,d))},{headers:Autodesk.Viewing.HTTP_REQUEST_HEADERS,withCredentials:!!auth})}catch(f){c&&c(Autodesk.Viewing.ErrorCodes.UNKNOWN_FAILURE,"An exception occurred while loading the document: "+f.toString(),null)}}"function"!==typeof b&&(console.log("Autodesk.Viewing.Document.load called with deprecated (auth) parameter"),"function"===typeof c&&(b=c),"function"===
typeof f&&(c=f));if(f){var q=g(f);f=d(f);Autodesk.Viewing.HTTP_REQUEST_HEADERS=q;h(q,f)}else n()};
Autodesk.Viewing.Document.prototype.getFullPath=function(a){if(!a)return a;var b=a;Autodesk.Viewing.Private.offline?b=decodeURIComponent(Autodesk.Viewing.Private.offlineResourcePrefix)+b.substr(b.indexOf("/")):0===a.indexOf("urn")?b=VIEWING_URL+"/items/"+a:0===a.indexOf("$file$")&&-1!==this.myPath.indexOf("/output/bubble.json")&&(b=this.myPath.replace("/output/bubble.json","")+a.replace("$file$",""));return b};
Autodesk.Viewing.Document.prototype.getThumbnailPath=function(a,b,c){b=b?b:200;c=c?c:200;a=VIEWING_URL+"/thumbnails/"+this.myData.urn+"?guid="+encodeURIComponent(a.guid)+"&width="+b+"&height="+c;Autodesk.Viewing.ACM_SESSION_ID&&(a+="&acmsession="+Autodesk.Viewing.ACM_SESSION_ID);return a};
Autodesk.Viewing.Document.prototype.getViewablePath=function(a){if("geometry"===a.type){var b=[];"3d"===a.role?b=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-svf"},!1):"2d"===a.role&&(b=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1),0==b.length&&(b=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{role:"tileRoot"},!0)));if(0<b.length)return this.getFullPath(b[0].urn)}else if("view"===a.type&&(a=this.getViewGeometry(a)))return this.getViewablePath(a);
return""};Autodesk.Viewing.Document.prototype.getPropertyDbPath=function(){return this.myPropertyDb};Autodesk.Viewing.Document.prototype.getRootItem=function(){return this.myData};Autodesk.Viewing.Document.prototype.getPath=function(){return this.myPath};Autodesk.Viewing.Document.prototype.getItemById=function(a){function b(c){if(!c)return null;for(var f in c){var g=c[f];if("guid"===f&&g===a)return c;if(null!==g&&"object"===typeof g&&(g=b(g)))return g}return null}return b(this.myData)};
Autodesk.Viewing.Document.getSubItemsWithProperties=function(a,b,c){var f=[];if(!a)return[];for(var g=a.children?a.children.length:0,d=0;d<g;d++){var h=a.children[d],k;a:{k=b;var m=void 0;for(m in k)if(!(m in h)||k[m]!==h[m]){k=!1;break a}k=!0}k&&f.push(h);c&&f.push.apply(f,Autodesk.Viewing.Document.getSubItemsWithProperties(h,b,c))}return f};Autodesk.Viewing.Document.prototype.getViewGeometry=function(a){return this.myViewGeometry[a.guid]};
Autodesk.Viewing.Document.prototype.getNumViews=function(a){return this.myNumViews[a.guid]||0};Autodesk.Viewing.Document.prototype.getParentId=function(a){return this.parents[a]};Autodesk.Viewing.Document.prototype.getMessages=function(a,b){var c=[];if(!a)return c;var f=null;b&&(f=this.getRootItem().guid);for(var g=a,d=this.parents[g];g&&(!b||d!==f);){if((g=this.getItemById(g))&&g.messages)for(var h=0;h<g.messages.length;h++)c.push(g.messages[h]);g=d;d=this.parents[g]}return c};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ModelUnits={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};Autodesk.Viewing.Model=function(a){this.myData=a;this.myLoader=this.propWorker=this.sharedPath=null};Autodesk.Viewing.EventDispatcher.prototype.apply(Autodesk.Viewing.Model.prototype);Autodesk.Viewing.Model.prototype.constructor=Autodesk.Viewing.Model;Autodesk.Viewing.Model.prototype.setData=function(a){this.myData=a};Autodesk.Viewing.Model.prototype.getData=function(){return this.myData};
Autodesk.Viewing.Model.prototype.setLoader=function(a){this.myLoader=a};Autodesk.Viewing.Model.prototype.getRoot=function(){return this.is2d()?(console.warn("Autodesk.Viewing.Model.getRoot is not yet implemented for 2D"),null):this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null};
Autodesk.Viewing.Model.prototype.getRootId=function(){return this.is2d()?(console.warn("Autodesk.Viewing.Model.getRootId is not yet implemented for 2D"),0):this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0};Autodesk.Viewing.Model.prototype.getBoundingBox=function(){return this.myData?this.myData.bbox:null};
Autodesk.Viewing.Model.prototype.getUnitScale=function(){switch(this.is2d()?this.getMetadata("page_dimensions","model_units",null):this.getMetadata("distance unit","value",null)){case "meter":case "m":return 1;case "foot":case "ft":return.3048;case "inch":case "in":return.0254;case "centimeter":case "cm":return.01;case "millimeter":case "mm":return.001;default:return 1}};
Autodesk.Viewing.Model.prototype.getUnitString=function(){switch(this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.getMetadata("distance unit","value",null)){case "meter":case "m":return Autodesk.Viewing.ModelUnits.METER;case "foot":case "ft":return Autodesk.Viewing.ModelUnits.FOOT;case "inch":case "in":return Autodesk.Viewing.ModelUnits.INCH;case "centimeter":case "cm":return Autodesk.Viewing.ModelUnits.CENTIMETER;case "millimeter":case "mm":return Autodesk.Viewing.ModelUnits.MILLIMETER;
default:return null}};Autodesk.Viewing.Model.prototype.getMetadata=function(a,b,c){if(this.myData){var f=this.myData.metadata;if(f&&(a=f[a],void 0!==a))if(b){if(b=a[b],void 0!==b)return b}else return a}return c};
Autodesk.Viewing.Model.prototype.getDefaultCamera=function(){var a=this.myData;if(!a)return null;var b=null,c=a.cameras?a.cameras.length:0;if(0<c){var f=this.getMetadata("default camera","index",null);if(null!==f&&a.cameras[f])b=a.cameras[f];else{for(f=0;f<c;f++){var g=a.cameras[f];if(g.isPerspective){b=g;break}}b||(b=a.cameras[0])}}return b};Autodesk.Viewing.Model.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)};
Autodesk.Viewing.Model.prototype.geomPolyCount=function(){return this.myData?this.myData.geomPolyCount:null};Autodesk.Viewing.Model.prototype.instancePolyCount=function(){return this.myData?this.myData.instancePolyCount:null};Autodesk.Viewing.Model.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(console.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)};
Autodesk.Viewing.Model.prototype.is2d=function(){return!(!this.myData||!this.myData.is2d)};Autodesk.Viewing.Model.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)};Autodesk.Viewing.Model.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree};Autodesk.Viewing.Model.prototype.getProperties=function(a,b,c){this.myData&&this.myLoader&&this.myLoader.getProperties(a,b,c)};
Autodesk.Viewing.Model.prototype.getExternalIdMapping=function(a,b){this.myData&&this.myLoader&&this.myLoader.getExternalIdMapping(a,b)};Autodesk.Viewing.Model.prototype.getObjectTree=function(a,b){this.myData&&this.myLoader&&this.myLoader.getObjectTree(a,b)};Autodesk.Viewing.Model.prototype.search=function(a,b,c,f){var g=this;this.isLoadDone()?this.myLoader.searchProperties(a,f,b,c):this.getObjectTree(function(){g.myLoader.searchProperties(a,f,b,c)})};
Autodesk.Viewing.Model.prototype.pageToModel=function(a,b){var c=this.myData.metadata.page_dimensions,f=this.myData.viewports,g=a.x/c.page_width*c.logical_width+c.logical_offset_x,d=a.y/c.page_height*c.logical_height+c.logical_offset_y;if(f[b]&&f[b].transform){for(var h=new THREE.Matrix4,k=0;16>k;k++)h.elements[k]=f[b].transform[k];c.inverse_xform=h.getInverse(h);c=c.inverse_xform.elements;a.x=c[0]*g+c[4]*d+0*c[8]+c[12];a.y=c[1]*g+c[5]*d+0*c[9]+c[13]}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.Navigation=function(a){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1};this.__transitionActive=this.__homeViewRequested=this.__fitToViewRequested=this.__pivotIsSetFlag=!1;this.__destinationView=null;this.__isTouchDevice=this.__is2D=!1;this.__kEpsilon=1E-6;var b=null,c={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)};this.setCamera=
function(a){a!==b&&(b=a)&&(a.hasOwnProperty("target")||(a.target=new THREE.Vector3(0,0,0)),a.hasOwnProperty("pivot")||(a.pivot=new THREE.Vector3(0,0,0)),a.worldup=a.up.clone(),a.dirty=!0)};this.getCamera=function(){return b};this.setScreenViewport=function(a){c=a};this.getScreenViewport=function(){return c};this.__setUp=function(a){return a&&b&&0!==a.clone().normalize().sub(b.worldup).lengthSq()?(b.worldup.copy(a).normalize(),b.dirty=!0):!1};this.__getUp=function(){return b?b.worldup:new THREE.Vector3(0,
1,0)};this.setView=function(a,c){b&&a&&c&&!this.__options.lockNavigation&&(b.position.copy(a),b.target.copy(c),b.dirty=!0)};this.orientCameraUp=function(){b&&!this.__options.lockNavigation&&(b.up.copy(this.getAlignedUpVector()),b.dirty=!0)};this.getPivotPoint=function(){return b?b.pivot.clone():new THREE.Vector3(0,0,0)};this.setPivotPoint=function(a){b&&a&&!this.__options.lockNavigation&&(b.pivot.copy(a),b.dirty=!0)};this.getPosition=function(){return b?b.position.clone():new THREE.Vector3(0,0,1)};
this.setPosition=function(a){b&&a&&!this.__options.lockNavigation&&(b.position.copy(a),b.dirty=!0)};this.setTarget=function(a){b&&a&&!this.__options.lockNavigation&&(b.target.copy(a),b.dirty=!0)};this.getTarget=function(){return b?b.target.clone():new THREE.Vector3(0,0,0)};this.getEyeVector=function(){return b?b.target.clone().sub(b.position):new THREE.Vector3(0,0,-1)};this.getFovMin=function(){return 6.88};this.getFovMax=function(){return 100};this.isPointVisible=function(a){return(new THREE.Frustum).setFromMatrix(b.projectionMatrix.clone().multiply(b.matrixWorldInverse)).containsPoint(a)};
this.setVerticalFov=function(a,c){if(!b||b.isPerspective)if(6.88>a?a=6.88:100<a&&(a=100),b&&!this.__options.lockNavigation&&!(1E-6>=Math.abs(b.fov-a))){if(c){var d=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),h=this.getPosition(),k=this.getEyeVector(),m=THREE.Math.degToRad(b.fov),n=THREE.Math.degToRad(a),q=d?this.getPivotPlaneDistance():k.length(),m=q*Math.tan(.5*m)/Math.tan(.5*n),k=k.normalize().multiplyScalar(q-m);this.setPosition(h.add(k));d&&this.setTarget(this.getTarget().add(k))}b.setFov(a);
b.dirty=!0}};this.computeFit=function(a,b,c,h){if(!h||h.empty())return{position:a,target:b};var k=h.center();h=h.size();h=.5*Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);0===h&&(h=1);if(!this.getIs2D()){var m=Math.max(1,.9+c/100*.5);h*=m}a=a.clone().sub(b).normalize();c=h/Math.tan(THREE.Math.degToRad(.5*c));a.multiplyScalar(c);return{position:k.clone().add(a),target:k}};this.computeOrthogonalUp=function(a,b){var c=this.__getUp(),h=b.clone().sub(a);if(0===h.lengthSq())return h.copy(c);var k=h.clone().cross(c);
0===k.lengthSq()&&(c.z>c.y?h.y-=1E-4:h.z-=1E-4,k.crossVectors(h,c));return k.cross(h).normalize()};this.fitBounds=function(a,c,d){var h=this.getTarget(),k=this.getPosition();if(this.__options.lockNavigation||!c||c.empty())return{position:k,target:h};var m=this.getVerticalFov();c=this.computeFit(k,h,m,c);d=d?this.computeOrthogonalUp(k,h):b.up;a?(b.up.copy(d),this.setView(c.position,c.target)):this.setRequestTransitionWithUp(!0,c.position,c.target,m,d);this.setPivotPoint(c.target);this.setPivotSetFlag(!0);
return c};this.updateCamera=function(){b&&(b.updateProjectionMatrix(),this.orient(b,b.target,b.position,b.up),b.dirty=!1)};this.setCamera(a)};Autodesk.Viewing.Navigation.prototype.constructor=Autodesk.Viewing.Navigation;Autodesk.Viewing.Navigation.prototype.setIs2D=function(a){this.__is2D=!!a};Autodesk.Viewing.Navigation.prototype.getIs2D=function(){return this.__is2D};Autodesk.Viewing.Navigation.prototype.setIsTouchDevice=function(a){this.__isTouchDevice=!!a};
Autodesk.Viewing.Navigation.prototype.getIsTouchDevice=function(){return this.__isTouchDevice};
Autodesk.Viewing.Navigation.prototype.orient=function(){var a,b,c,f;return function(g,d,h,k){a||(a=new THREE.Matrix4,b=new THREE.Vector3,c=new THREE.Vector3,f=new THREE.Vector3);var m=a.elements;f.subVectors(h,d).normalize();0===f.lengthSq()&&(f.z=1);b.crossVectors(k,f).normalize();0===b.lengthSq()&&(k.z>k.y?f.y-=1E-4:f.z+=1E-4,b.crossVectors(k,f).normalize());c.crossVectors(f,b);m[0]=b.x;m[4]=c.x;m[8]=f.x;m[1]=b.y;m[5]=c.y;m[9]=f.y;m[2]=b.z;m[6]=c.z;m[10]=f.z;g.setRotationFromMatrix(a)}}();
Autodesk.Viewing.Navigation.prototype.fov2fl=function(a){a=THREE.Math.degToRad(a);0>=a&&(a=1E-4);return Math.round(12/Math.tan(.5*a))};Autodesk.Viewing.Navigation.prototype.fl2fov=function(a){0>=a&&(a=1E-4);a=2*Math.atan(12/a);return THREE.Math.radToDeg(a)};Autodesk.Viewing.Navigation.prototype.setCameraUpVector=function(a){if(!this.__options.lockNavigation){var b=this.getCamera();b.up.copy(a);b.dirty=!0}};
Autodesk.Viewing.Navigation.prototype.getCameraUpVector=function(){var a=this.getCameraRightVector(!1),b=this.getEyeVector();return a.cross(b).normalize()};Autodesk.Viewing.Navigation.prototype.getAlignedUpVector=function(){var a=this.getCameraRightVector(!0),b=this.getEyeVector();return a.cross(b).normalize()};
Autodesk.Viewing.Navigation.prototype.getCameraRightVector=function(a){var b=new THREE.Vector3;a=a?this.getWorldUpVector():this.getCamera().up;var c=this.getEyeVector();b.crossVectors(c,a);0===b.lengthSq()&&(a.z>a.y?c.y-=1E-4:c.z+=1E-4,b.crossVectors(c,a));return b.normalize()};Autodesk.Viewing.Navigation.prototype.setWorldUpVector=function(a,b){this.__options.lockNavigation||(this.__setUp(a),b&&this.orientCameraUp())};Autodesk.Viewing.Navigation.prototype.getWorldUpVector=function(){return this.__getUp().clone()};
Autodesk.Viewing.Navigation.prototype.getWorldRightVector=function(){var a=new THREE.Vector3;a.copy(this.__getUp());Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):0<=a.z?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x);return a.normalize()};Autodesk.Viewing.Navigation.prototype.getVerticalFov=function(){return this.getCamera().fov};Autodesk.Viewing.Navigation.prototype.getHorizontalFov=function(){var a=this.getScreenViewport();return this.getCamera().fov*(a.width/a.height)};
Autodesk.Viewing.Navigation.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())};Autodesk.Viewing.Navigation.prototype.setFocalLength=function(a,b){this.setVerticalFov(this.fl2fov(a),b)};Autodesk.Viewing.Navigation.prototype.setReverseZoomDirection=function(a){this.__options.reverseDolly=!!a};
Autodesk.Viewing.Navigation.prototype.setReverseHorizontalLookDirection=function(a){this.getIs2D()?console.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!a};Autodesk.Viewing.Navigation.prototype.setReverseVerticalLookDirection=function(a){this.getIs2D()?console.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!a};
Autodesk.Viewing.Navigation.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly};Autodesk.Viewing.Navigation.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection};
Autodesk.Viewing.Navigation.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection};Autodesk.Viewing.Navigation.prototype.setZoomTowardsPivot=function(a){this.__options.dollyToPivot=!!a};Autodesk.Viewing.Navigation.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot};
Autodesk.Viewing.Navigation.prototype.setOrbitPastWorldPoles=function(a){this.getIs2D()?console.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!a};Autodesk.Viewing.Navigation.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles};
Autodesk.Viewing.Navigation.prototype.setUsePivotAlways=function(a){this.__options.usePivotAlways=!!a};Autodesk.Viewing.Navigation.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways};Autodesk.Viewing.Navigation.prototype.setUseLeftHandedInput=function(a){this.__options.useLeftHandedInput=!!a};Autodesk.Viewing.Navigation.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput};
Autodesk.Viewing.Navigation.prototype.setIsLocked=function(a){this.__options.lockNavigation=!!a};Autodesk.Viewing.Navigation.prototype.getIsLocked=function(){return this.__options.lockNavigation};Autodesk.Viewing.Navigation.prototype.setPivotSetFlag=function(a){this.__options.lockNavigation||(this.__pivotIsSetFlag=!!a)};Autodesk.Viewing.Navigation.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag};
Autodesk.Viewing.Navigation.prototype.setRequestFitToView=function(a){this.__options.lockNavigation||(this.__fitToViewRequested=!!a)};Autodesk.Viewing.Navigation.prototype.getRequestFitToView=function(){return this.__fitToViewRequested};Autodesk.Viewing.Navigation.prototype.setRequestHomeView=function(a){this.__options.lockNavigation||(this.__homeViewRequested=!!a)};Autodesk.Viewing.Navigation.prototype.getRequestHomeView=function(){return this.__homeViewRequested};
Autodesk.Viewing.Navigation.prototype.setRequestTransition=function(a,b,c,f,g){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:f,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:g}:null};Autodesk.Viewing.Navigation.prototype.setRequestTransitionWithUp=function(a,b,c,f,g,d){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:f,up:g.clone(),worldUp:d?d:this.getWorldUpVector(),reorient:!1}:null};
Autodesk.Viewing.Navigation.prototype.getRequestTransition=function(){return this.__destinationView};Autodesk.Viewing.Navigation.prototype.setTransitionActive=function(a){this.__transitionActive=!!a};Autodesk.Viewing.Navigation.prototype.getTransitionActive=function(){return this.__transitionActive};
Autodesk.Viewing.Navigation.prototype.getWorldSize=function(a){var b=this.getScreenViewport(),b=b.width/b.height;a=2*a*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov));return new THREE.Vector2(a*b,a)};
Autodesk.Viewing.Navigation.prototype.getWorldPoint=function(a,b){a=2*a-1;b=2*(1-b)-1;var c=this.getCamera(),f;c.isPerspective&&(f=new THREE.Vector3(a,b,1),f=f.unproject(c));var g=this.getEyeVector(),d=this.getPosition();if(!c.isPerspective||isNaN(f.x)){var h=this.getWorldSize(g.length());f=this.getCameraRightVector(!1).multiplyScalar(.5*a*h.x);h=this.getCameraUpVector().multiplyScalar(.5*b*h.y);f=g.clone().add(f).add(h).normalize()}else f=f.sub(d).normalize();h=this.getPivotPoint();this.__pivotIsSetFlag&&
(this.getIs2D()||c.isPerspective&&this.isPointVisible(h))?(c=f.dot(g),g=0!==c?Math.abs(h.sub(d).dot(g))/c:h.sub(d).length()):g=c.isPerspective?.5*(c.near+c.far):c.orthoScale;return f.multiplyScalar(g).add(d)};Autodesk.Viewing.Navigation.prototype.getPivotPlaneDistance=function(){var a=this.getPivotPoint(),b=this.getEyeVector(),c=this.getPosition();return a.sub(c).dot(b.normalize())};
Autodesk.Viewing.Navigation.prototype.panRelative=function(a,b,c){c=this.getWorldSize(c);a*=c.x;b*=c.y;a=this.getCameraRightVector(!1).multiplyScalar(a);b=this.getCameraUpVector().multiplyScalar(b);b=a.add(b);this.setView(this.getPosition().add(b),this.getTarget().add(b))};
Autodesk.Viewing.Navigation.prototype.dollyFromPoint=function(a,b){if(!(Math.abs(a)<=this.__kEpsilon)){var c=this.getPosition(),c=b.clone().sub(c),f=c.length(),g=f+a,d=10*this.__kEpsilon;g<d&&(g=d);f=g/f;Math.abs(f-1)>this.__kEpsilon&&(c.multiplyScalar(f),c.set(-c.x,-c.y,-c.z),c=c.add(b),g=this.getEyeVector(),this.getCamera().isPerspective||g.multiplyScalar(f),this.setView(c,g.add(c)))}};
Autodesk.Viewing.Navigation.prototype.toPerspective=function(){if(this.getIs2D())console.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");else{var a=this.getCamera();this.__options.lockNavigation||a.isPerspective||(a.toPerspective(),a.dirty=!0)}};Autodesk.Viewing.Navigation.prototype.toOrthographic=function(){var a=this.getCamera();!this.__options.lockNavigation&&a.isPerspective&&(a.toOrthographic(),a.dirty=!0)};
Autodesk.Viewing.Navigation.snapToAxis=function(a){var b=new THREE.Vector3(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z));b.x>b.y&&b.x>b.z?a.set(0<a.x?1:-1,0,0):b.y>b.x&&b.y>b.z?a.set(0,0<a.y?1:-1,0):a.set(0,0,0<a.z?1:-1);return a};"use strict";AutodeskNamespace("Autodesk.Viewing");Autodesk.Viewing.ViewingApplication=function(a,b){this.appContainerId=a;this.container=document.getElementById(a);this.options=b;this.myRegisteredViewers={};this.selectedItem=this.urn=this.myCurrentViewer=this.myDocument=null};
Autodesk.Viewing.ViewingApplication.prototype.k3D="3D";Autodesk.Viewing.ViewingApplication.prototype.k2D="2D";Autodesk.Viewing.ViewingApplication.prototype.registerViewer=function(a,b,c){c=c||{};this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&!c.hasOwnProperty("disableBrowserContextMenu")&&(c.disableBrowserContextMenu=this.options.disableBrowserContextMenu);this.myRegisteredViewers[a]={};this.myRegisteredViewers[a].class=b;this.myRegisteredViewers[a].config=c};
Autodesk.Viewing.ViewingApplication.prototype.getViewerClass=function(a){return this.myRegisteredViewers.hasOwnProperty(a)?this.myRegisteredViewers[a].class:null};Autodesk.Viewing.ViewingApplication.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)};
Autodesk.Viewing.ViewingApplication.prototype.getViewer=function(a,b,c){if(a in this.myRegisteredViewers){var f={},g=this.myRegisteredViewers[a].config,d;for(d in g)g.hasOwnProperty(d)&&(f[d]=g[d]);for(d in b)if(b.hasOwnProperty(d)){var g=b[d],h=Array.isArray(g),k=f[d],m=Array.isArray(k);h&&m?(g?h||(g=[g]):g=[],k?m||(k=[k]):k=[],f[d]=k.concat(g)):f[d]=g}a=this.myRegisteredViewers[a].class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===a)return this.myCurrentViewer.tearDown(),
this.myCurrentViewer.setUp(f),this.myCurrentViewer;this.setCurrentViewer(null);for(b=this.getViewerContainer();b.hasChildNodes();)b.removeChild(b.lastChild);f=new a(b,f);a=f.start();if(0===a)return this.setCurrentViewer(f),f;c&&c(a,"Viewer failed to initialize.")}return null};Autodesk.Viewing.ViewingApplication.prototype.setCurrentViewer=function(a){this.myCurrentViewer&&this.myCurrentViewer.finish();this.myCurrentViewer=a};Autodesk.Viewing.ViewingApplication.prototype.getCurrentViewer=function(){return this.myCurrentViewer};
Autodesk.Viewing.ViewingApplication.prototype.loadDocument=function(a,b,c,f){var g=this;Autodesk.Viewing.Private.logger&&Autodesk.Viewing.Private.logger.log({category:"load_document",urn:0==a.indexOf("urn:")?a.substring(4):a});Autodesk.Viewing.Document.load(a,function(a,c){g.myDocument=a;g.onDocumentLoaded(a,c);b&&b(a,c)},function(a,b,f){g.onDocumentFailedToLoad(b,a,f);c&&c(a,b,f)},f)};Autodesk.Viewing.ViewingApplication.prototype.onDocumentLoaded=function(a,b){console.log(a,b)};
Autodesk.Viewing.ViewingApplication.prototype.onDocumentFailedToLoad=function(a,b,c){console.log(a,b,c)};
Autodesk.Viewing.ViewingApplication.prototype.selectItem=function(a,b,c){var f=this.myDocument.getViewablePath(a);if(f){var g,d,h,k;if("geometry"===a.type&&"3d"===a.role)g=this.k3D,h=a.name,k=a;else if("view"===a.type&&"3d"===a.role){if(d=a,g=this.k3D,k=this.myDocument.getViewGeometry(a))h=k.name}else"geometry"===a.type&&"2d"===a.role?(g=0<Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1).length?this.k3D:this.k2D,h=a.name,k=a):"view"===a.type&&"2d"===a.role&&
(d=a,g=this.k3D,k=this.myDocument.getViewGeometry(a))&&(h=k.name);var m=Autodesk.Viewing.Private.logger;if(m){var n=f.indexOf("urn:");m.log({category:"load_viewable",role:a.role,type:a.type,urn:-1!==n?f.substring(n+4):f})}var q=this.myDocument.getMessages(a.guid,!0);if(g){var l=this,p=this.myCurrentViewer&&this.urn===f,m=null,m=d&&d.camera?function(){l.myCurrentViewer.setViewFromArray(d.camera,d.name);b&&b(l.myCurrentViewer,a,q)}:d&&d.viewbox?function(){l.myCurrentViewer.setViewFromViewBox(d.viewbox,
d.name);b&&b(l.myCurrentViewer,a,q)}:p?function(){l.myCurrentViewer.setViewFromFile();b&&b(l.myCurrentViewer,a,q)}:function(){b&&b(l.myCurrentViewer,a,q)},n=function(a,b){c&&c(a,b,q)},r=!1;p?(m&&m(),r=!0):(this.urn=null,h={defaultModelStructureTitle:h,viewableName:h},a.hasOwnProperty("extensions")&&(h.extensions=Array.isArray(a.extensions)?a.extensions:[a.extensions]),(g=this.getViewer(g,h,c))&&g.load(this.myDocument.getFullPath(f),this.myDocument.getPropertyDbPath(),m,n)&&(this.urn=f,r=!0));if(r)return this.selectedItem=
a,this.onItemSelected(a,k),!0}}return!1};Autodesk.Viewing.ViewingApplication.prototype.onItemSelected=function(a,b){stderr("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(a.guid));if(this.itemSelectedObservers)for(var c=this.getCurrentViewer(),f=0;f<this.itemSelectedObservers.length;++f){var g=this.itemSelectedObservers[f];g.onItemSelected&&g.onItemSelected(c,a,b)}};
Autodesk.Viewing.ViewingApplication.prototype.addItemSelectedObserver=function(a){this.itemSelectedObservers||(this.itemSelectedObservers=[]);this.itemSelectedObservers.push(a)};Autodesk.Viewing.ViewingApplication.prototype.selectItemById=function(a,b,c){return(a=this.myDocument.getItemById(a))?this.selectItem(a,b,c):!1};Autodesk.Viewing.ViewingApplication.prototype.getSelectedItem=function(){return this.selectedItem};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ViewCubeUi=function(a){this.viewer=a;this.homeViewContainer=this.infoButton=this.viewcube=this.cube=null};
Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var a=this.viewer.config;(a&&void 0!==a.wantInfoButton?a.wantInfoButton:1)&&this.initInfoButton();this.initHomeButton()},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div");this.infoButton.className="infoButton";this.infoButton.style.cursor="pointer";this.viewer.container.appendChild(this.infoButton);var a=this;
this.infoButton.addEventListener("click",function(b){b=a.viewer.getPropertyPanel(!0);var c=!b.areDefaultPropertiesShown()||!b.isVisible();c&&b.showDefaultProperties();c!==b.isVisible()&&b.setVisible(c)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var a=document.createElement("div");a.className="homeViewWrapper";a.style.cursor="pointer";this.viewer.container.appendChild(a);this.homeViewContainer=a;var b=this;a.addEventListener("click",function(a){b.viewer.navigation.setRequestHomeView(!0)});
this._initHomeMenu(a)}},_initHomeMenu:function(a){function b(a){h.style.display="none";document.removeEventListener("click",b)}var c=this.viewer,f=c.autocam,g=document.createElement("div");g.className="homeViewMenuHandle";var d=document.createElement("img");d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg==";
d.width=d.height=18;g.appendChild(d);g.addEventListener("mouseover",function(a){d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"});
g.addEventListener("mouseleave",function(a){d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg=="});
a.appendChild(g);var h=document.createElement("div");h.className="homeViewMenu";c.container.appendChild(h);var k=document.createElement("div");k.className="homeViewMenuItem";k.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home");h.appendChild(k);k.addEventListener("click",function(a){f.setCurrentViewAsHome(!1);b(a)});k=document.createElement("div");k.className="homeViewMenuItem";k.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home");h.appendChild(k);k.addEventListener("click",
function(a){f.setCurrentViewAsHome(!0);b(a)});k=document.createElement("div");k.className="homeViewMenuItem";k.textContent=Autodesk.Viewing.i18n.translate("Reset Home");h.appendChild(k);k.addEventListener("click",function(a){f.resetHome();b(a)});a.addEventListener("mouseover",function(a){if(c.model&&c.model.is2d()||c.prefs&&!c.prefs.viewCube)g.style.display="block"});a.addEventListener("mouseleave",function(a){g.style.display="none"});g.addEventListener("click",function(a){if(c.model&&c.model.is2d()||
c.prefs&&!c.prefs.viewCube)h.style.display="block",document.addEventListener("click",b);a.stopPropagation()});a.addEventListener("contextmenu",function(a){if(c.model&&c.model.is2d()||c.prefs&&!c.prefs.viewCube)h.style.display="block",document.addEventListener("click",b)})},displayViewCube:function(a,b){!1!==b&&this.viewer.prefs.set("viewCube",a);if(a&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.viewer.container.appendChild(this.viewcube),this.cube=
new Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH);else if(!this.cube){this._positionHomeButton();return}this.viewcube.style.display=a?"block":"none";this._positionHomeButton();a&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var a=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,b=this.viewer.container.getBoundingClientRect(),c=this.homeViewContainer.getBoundingClientRect();a?(a=this.viewcube.getBoundingClientRect(),
b=b.left+b.width-a.left-c.width):this.infoButton?(a=this.infoButton.getBoundingClientRect(),b=b.left+b.width-a.left+a.width-c.width):b=10;this.homeViewContainer.style.right=b+"px"}},uninitialize:function(){this.viewer=null}};"use strict";AutodeskNamespace("Autodesk.Viewing.Private");AutodeskNamespace("Autodesk.Viewing.Extensions");function stringToDOM(a){var b=document.createElement("div");b.innerHTML=a;return b.firstChild}
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=Autodesk.Viewing.UI,f=Autodesk.Viewing.Extensions;a.TOOLBAR_CREATED_EVENT="toolbarCreated";a.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"};b.GuiViewer3D=function(b,c){c||(c={});this.customizeConfig(c);a.Viewer3D.call(this,b,c);this.toolbar=null;this.dockingPanels=[];this.layersPanel=this.modelstructure=null};b.GuiViewer3D.prototype=Object.create(a.Viewer3D.prototype);b.GuiViewer3D.prototype.constructor=
b.GuiViewer3D;b.GuiViewer3D.prototype.customizeConfig=function(a){a.startOnInitialize=!1;a.hasOwnProperty("docStructureConfig")||(a.docStructureConfig=b.GuiViewer3D.kDefaultDocStructureConfig)};b.GuiViewer3D.prototype.resize=function(){a.Viewer3D.prototype.resize.call(this);this.resizePanels();this.centerToolBar&&this.centerToolBar()};b.GuiViewer3D.kDefaultDocStructureConfig={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}};b.GuiViewer3D.prototype.initialize=function(){var c=
a.Viewer3D.prototype.initialize.call(this);if(0<c)return c;var d=this;this.toolController&&(c=new a.HotGestureTool(this),this.toolController.registerTool(c),this.toolController.activateTool(c.getName()));this.getToolbar(!0);this.addEventListener(a.FULLSCREEN_MODE_EVENT,function(a){d.resizePanels({viewer:d});d.updateFullscreenButton(a.mode)});this.contextMenu||this.setContextMenu(new f.ViewerObjectContextMenu(this));this.progressbar=new b.ProgressBar(this.container);this.addEventListener(a.PROGRESS_UPDATE_EVENT,
function(a){void 0!==a.percent&&d.progressbar.setPercent(a.percent)},!1);this.selectionActive=!1;this.addEventListener(a.SELECTION_CHANGED_EVENT,function(a){d.selectionActive=0<a.dbIdArray.length;d.prefs.openPropertiesOnSelect&&d.getPropertyPanel(!0).setVisible(d.selectionActive)});this.addEventListener(a.ISOLATE_EVENT,function(a){(d.prefs.openPropertiesOnSelect||a.nodeIdArray[0]===d.model.getRootId())&&d.propertygrid&&d.propertygrid.setVisible(0<a.nodeIdArray.length||d.selectionActive)});this.addEventListener(a.VIEWER_STATE_RESTORED_EVENT,
function(a){d.renderoptions&&d.renderoptions.syncUI();(a=d.getSettingsPanel(!0))&&a.syncUI()});this.initEscapeHandlers();this.localize();this.run();return 0};b.GuiViewer3D.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null);this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null);this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null);this.propertygrid&&(this.propertygrid.uninitialize(),
this.propertygrid=null);this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null);a.theHotkeyManager.popHotkeys("Autodesk.ROLL");a.theHotkeyManager.popHotkeys("Autodesk.FOV");this.toolbar=this.debugMenu=this.navTools=this.modelTools=this.progressbar=null;a.Viewer3D.prototype.uninitialize.call(this)};b.GuiViewer3D.prototype.setUp=function(b){b||(b={});this.customizeConfig(b);this.getToolbar(!0);a.Viewer3D.prototype.setUp.call(this,b)};b.GuiViewer3D.prototype.tearDown=function(){a.Viewer3D.prototype.tearDown.call(this);
this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null);this.modelstructure&&this.setModelStructurePanel(null);this.propertygrid&&this.setPropertyPanel(null);this.viewerSettingsPanel&&this.setSettingsPanel(null);this.layersPanel&&this.setLayersPanel(null);this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null)};b.GuiViewer3D.prototype.loadModel=function(b,c,f,k,m){var n=this,q=function(){n.displayViewCube(n.prefs.viewCube);
n.removeEventListener(a.GEOMETRY_LOADED_EVENT,q)};-1!=b.indexOf(".f2d")?(this.createUI("2d"),n.prefs.useFirstPersonNav?this.unloadExtension("Autodesk.FirstPerson"):this.unloadExtension("Autodesk.Beeline"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1)):(this.createUI("3d"),-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),n.prefs.useFirstPersonNav?this.loadExtension("Autodesk.FirstPerson",null):this.loadExtension("Autodesk.Beeline",
null),this.loadExtension("Autodesk.Viewing.Oculus",null),this.prefs.fusionOrbit&&this.loadExtension("Autodesk.Viewing.FusionOrbit",null),this.loadExtension("Autodesk.Section",null),this.addEventListener(a.GEOMETRY_LOADED_EVENT,q));return a.Viewer3D.prototype.loadModel.call(this,b,c,f,k,m)};b.GuiViewer3D.prototype.createUI=function(f){var d=this;this.initHotkeys(f);this.loadExtension("Autodesk.DefaultTools.NavTools",{mode:f});this.initModelTools(f);ENABLE_DEBUG&&this.initDebugTools();this.fireEvent({type:a.TOOLBAR_CREATED_EVENT});
this.viewCubeUi||(this.viewCubeUi=new b.ViewCubeUi(this));this.viewCubeUi.create();this.centerToolBar=function(){d.toolbar.container.style.left="calc(50% - "+d.toolbar.getDimensions().width/2+"px)"};this.toolbar.addEventListener(c.ToolBar.Event.SIZE_CHANGED,this.centerToolBar);this.initModality();this.resize()};b.GuiViewer3D.prototype.addOptionToggle=function(b,c,f,k,m){var n=m?this.prefs[m]:null;f="boolean"===typeof n?n:f;n=document.createElement("li");n.className="toolbar-submenu-listitem";var q=
document.createElement("input");q.className="toolbar-submenu-checkbox";q.type="checkbox";q.id=c;n.appendChild(q);var l=document.createElement("label");l.setAttribute("for",c);l.setAttribute("data-i18n",c);l.textContent=a.i18n.translate(c);n.appendChild(l);b.appendChild(n);q.checked=f;q.addEventListener("touchstart",touchStartToClick);l.addEventListener("touchstart",touchStartToClick);n.addEventListener("touchstart",touchStartToClick);q.addEventListener("click",function(a){k(q.checked);a.stopPropagation()});
l.addEventListener("click",function(a){a.stopPropagation()});n.addEventListener("click",function(a){k(!q.checked);a.stopPropagation()});m&&this.prefs.addListeners(m,function(a){q.checked=a},function(a){q.checked=a;k(a)});return q};b.GuiViewer3D.prototype.addOptionList=function(b,c,f,k,m,n){var q=this.prefs[n];k="number"===typeof q?q:k;var l=document.createElement("select");l.className="optionDropDown";l.id="selectMenu_"+c;for(q=0;q<f.length;q++){var p=document.createElement("option");p.value=q;p.setAttribute("data-i18n",
f[q]);p.textContent=Autodesk.Viewing.i18n.translate(f[q]);l.add(p)}f=document.createElement("li");f.className="toolbar-submenu-select";q=document.createElement("div");q.className="toolbar-submenu-selectlabel";q.setAttribute("for",c);q.setAttribute("data-i18n",c);q.textContent=a.i18n.translate(c);f.appendChild(q);f.appendChild(l);b.appendChild(f);l.selectedIndex=k;l.onchange=function(a){m(a.target.selectedIndex);a.stopPropagation()};l.addEventListener("touchstart",function(a){a.stopPropagation()});
l.addEventListener("click",function(a){a.stopPropagation()});n&&this.prefs.addListeners(n,function(a){l.selectedIndex=a},function(a){l.selectedIndex=a;m(a)});return l};b.GuiViewer3D.prototype.showViewer3dOptions=function(a){var b=this.getSettingsPanel(!0);a&&b.isVisible()&&b.setVisible(!1);b.setVisible(a)};b.GuiViewer3D.prototype.showRenderingOptions=function(a){this.renderoptions.setVisible(a)};b.GuiViewer3D.prototype.showLayerManager=function(a){this.layersPanel.setVisible(a)};b.GuiViewer3D.prototype.initHotkeys=
function(b){var c=this,f=a.theHotkeyManager.KEYCODES;if("3d"===b){var k;a.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[f.CONTROL,f.SHIFT],onPress:function(){if(c.toolController.getIsLocked())return!1;k=c.getActiveNavigationTool();c.setActiveNavigationTool("fov");return!0},onRelease:function(){if(c.toolController.getIsLocked())return!1;c.setActiveNavigationTool(k);return!0}}],{tryUntilSuccess:!0})}var m;a.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[f.ALT,f.SHIFT],onPress:function(){if(c.toolController.getIsLocked())return!1;
m=c.getActiveNavigationTool();c.setActiveNavigationTool("worldup");return!0},onRelease:function(){if(c.toolController.getIsLocked())return!1;c.setActiveNavigationTool(m);return!0}}],{tryUntilSuccess:!0})};b.GuiViewer3D.prototype.setModelStructurePanel=function(b){var d=this;if(b instanceof a.UI.ModelStructurePanel||null===b){this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize());if(this.modelstructure=b)this.addPanel(this.modelstructure),
b.addVisibilityListener(function(a){if(a)d.onPanelVisible(b,d);d.settingsTools.structurebutton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)}),d.model&&d.model.getObjectTree(function(a){d.modelstructure.setModel(a)});return!0}return!1};b.GuiViewer3D.prototype.setLayersPanel=function(b){var d=this;if(this.model&&!this.model.is2d())return console.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1;if(b instanceof a.UI.LayersPanel||!b){this.layersPanel&&(this.layersPanel.setVisible(!1),
this.removePanel(this.layersPanel),this.layersPanel.uninitialize());if(this.layersPanel=b)this.addPanel(b),b.addVisibilityListener(function(a){if(a)d.onPanelVisible(b,d);d.settingsTools.layerButton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)});return!0}return!1};b.GuiViewer3D.prototype.setPropertyPanel=function(b){var d=this;if(b instanceof a.UI.PropertyPanel||!b){this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize());
if(this.propertygrid=b)this.addPanel(b),b.addVisibilityListener(function(a){if(a)d.onPanelVisible(b,d);d.settingsTools.propertiesbutton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)});return!0}return!1};b.GuiViewer3D.prototype.getPropertyPanel=function(a){!this.propertygrid&&a&&this.setPropertyPanel(new f.ViewerPropertyPanel(this));return this.propertygrid};b.GuiViewer3D.prototype.setSettingsPanel=function(b){return b instanceof a.UI.SettingsPanel||!b?(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),
this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),(this.viewerSettingsPanel=b)&&this.addPanel(b),!0):!1};b.GuiViewer3D.prototype.getSettingsPanel=function(a){!this.viewerSettingsPanel&&a&&this.setSettingsPanel(new f.ViewerSettingsPanel(this,this.model.is2d()?"2d":"3d"));return this.viewerSettingsPanel};b.GuiViewer3D.prototype.initModelTools=function(g){var d=this;if("3d"===g){d.modelstructure||d.setModelStructurePanel(new f.ViewerModelStructurePanel(d,"Browser",{docStructureConfig:d.config.docStructureConfig}));
var h=new c.Button("toolbar-modelStructureTool");h.setToolTip("Model browser");h.setIcon("adsk-icon-structure");h.onClick=function(a){d.showModelStructurePanel(!d.modelstructure.isVisible())};this.settingsTools.addControl(h);this.settingsTools.structurebutton=h;this.initExplodeSlider()}else h=new f.ViewerLayersPanel(this),this.setLayersPanel(h),h=new c.Button("toolbar-layersTool"),h.setToolTip("Layer Manager"),h.setIcon("adsk-icon-layers"),h.onClick=function(a){d.layersPanel||d.setLayersPanel(new f.ViewerLayersPanel(d));
d.showLayerManager(!d.layersPanel.isVisible())},this.settingsTools.addControl(h),this.settingsTools.layerButton=h;d.addEventListener(a.RESET_EVENT,function(){d.model&&!d.model.is2d()&&(d.explode(0),d.explodeSlider.value=0);d.showAll()});h=new c.Button("toolbar-propertiesTool");h.setToolTip("Properties");h.setIcon("adsk-icon-properties");h.onClick=function(a){a=d.getPropertyPanel(!0);a.setVisible(!a.isVisible())};h.setVisible(!d.prefs.openPropertiesOnSelect);this.settingsTools.addControl(h);this.settingsTools.propertiesbutton=
h;h=new f.ViewerSettingsPanel(this,g);this.setSettingsPanel(h);this.viewerOptionButton=h=new c.Button("toolbar-settingsTool");h.setIcon("adsk-icon-settings");h.setToolTip("Settings");this.settingsTools.addControl(h);this.createViewerOptionsMenu(g);ENABLE_DEBUG&&"3d"===g&&(this.renderoptions=new b.RenderOptionsPanel(this),this.addPanel(this.renderoptions),g=new c.Button("toolbar-renderOptionsTool"),g.setToolTip("Rendering options"),g.setIcon("adsk-icon-settings-render"),g.onClick=function(a){d.showRenderingOptions(!d.renderoptions.isVisible())},
this.settingsTools.addControl(g),this.renderoptionsbutton=g);this.canChangeScreenMode()&&(g=new c.Button("toolbar-fullscreenTool",{collapsible:!1}),g.setToolTip("Full screen"),g.setIcon("adsk-icon-fullscreen"),g.onClick=function(a){d.nextScreenMode()},this.settingsTools.addControl(g),this.settingsTools.fullscreenbutton=g,this.updateFullscreenButton(this.getScreenMode()))};b.GuiViewer3D.prototype.setPropertiesOnSelect=function(a){this.settingsTools.propertiesbutton.setVisible(!a)};b.GuiViewer3D.prototype.addDivider=
function(a){var b=document.createElement("li");b.className="toolbar-submenu-horizontal-divider";a.appendChild(b);return b};b.GuiViewer3D.prototype.createViewerOptionsMenu=function(g){function d(a){var b=h.getSettingsPanel(!0);b.isVisible()&&b.isTabSelected(a)?h.showViewer3dOptions(!1):(h.showViewer3dOptions(!0),b.selectTab(a))}var h=this,k=document.createElement("div");k.id="toolbar-settingsToolSubmenu";k.classList.add("toolbar-submenu");k.classList.add("toolbar-settings-sub-menu");k.classList.add("adsk-hidden");
k.mode=g;this.container.appendChild(k);if("3d"===g){g=[];for(var m=0;m<b.LightPresets.length;m++)g.push(b.LightPresets[m].name);this.viewerOptionButton.envList=this.addOptionList(k,"Background and lighting",g,4,function(a){h.blockEvent||(k.classList.toggle("adsk-hidden"),h.setLightPreset(a))},"lightPreset");this.selectLightPreset=function(a){h.blockEvent=!0;h.viewerOptionButton.envList&&(h.viewerOptionButton.envList.selectedIndex=h.impl.currentLightPreset());h.blockEvent=!1};h.addEventListener(a.RENDER_OPTION_CHANGED_EVENT,
this.selectLightPreset);this.viewerOptionButton.displayLines=this.addOptionToggle(k,"Display Lines",!0,function(a){h.hideLines(!a)},"lineRendering");this.addDivider(k)}g=document.createElement("li");g.className="toolbar-submenu-listitem";m=document.createElement("label");m.setAttribute("data-i18n","Performance and appearance settings");m.textContent=a.i18n.translate("Performance and appearance settings");g.appendChild(m);this.show3dOptionsPerformanceTab=function(){d(f.ViewerSettingTab.Performance)};
this.viewerOptionButton.performanceOption=g;this.viewerOptionButton.performanceOption.addEventListener("touchstart",touchStartToClick);this.viewerOptionButton.performanceOption.addEventListener("click",this.show3dOptionsPerformanceTab);k.appendChild(this.viewerOptionButton.performanceOption);this.addDivider(k);g=document.createElement("li");g.className="toolbar-submenu-listitem";m=document.createElement("label");m.setAttribute("data-i18n","Navigation and selection settings");m.textContent=a.i18n.translate("Navigation and selection settings");
g.appendChild(m);this.show3dOptionsNavigationTab=function(){d(f.ViewerSettingTab.Navigation)};this.viewerOptionButton.navigationOption=g;this.viewerOptionButton.navigationOption.addEventListener("touchstart",touchStartToClick);this.viewerOptionButton.navigationOption.addEventListener("click",this.show3dOptionsNavigationTab);k.appendChild(g);k.style.width=k.getBoundingClientRect().width+"px";this.container.removeChild(k);this.viewerOptionButton.onClick=function(a){k.classList.toggle("adsk-hidden");
this.setState(this.getState()===c.Button.State.ACTIVE?c.Button.State.INACTIVE:c.Button.State.ACTIVE)};this.viewerOptionButton.container.appendChild(k);this.viewerOptionButton.subMenu=k};b.GuiViewer3D.prototype.removeViewerOptionsMenu=function(a){this.viewerOptionButton.container.removeChild(this.viewerOptionButton.subMenu);"3d"===a&&(this.removeEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,this.selectLightPreset),this.viewerOptionButton.envList=null);this.viewerOptionButton.navigationOption.removeEventListener("touchstart",
touchStartToClick);this.viewerOptionButton.navigationOption.removeEventListener("click",this.show3dOptionsNavigationTab);this.viewerOptionButton.navigationOption=null;this.viewerOptionButton.performanceOption.removeEventListener("touchstart",touchStartToClick);this.viewerOptionButton.performanceOption.removeEventListener("click",this.show3dOptionsPerformanceTab);this.viewerOptionButton.performanceOption=null};b.GuiViewer3D.prototype.initDebugTools=function(){var a=new c.ControlGroup("debugTools");
this.debugMenu=a;var b=new c.Button("toolbar-debugTool");b.setIcon("adsk-icon-bug");a.addControl(b);this.debugMenu.debugSubMenuButton=b;this.createDebugSubmenu(this.debugMenu.debugSubMenuButton);this.toolbar.addControl(a)};b.GuiViewer3D.prototype.createDebugSubmenu=function(a){function c(){f.localize()}var f=this,k=document.createElement("div");k.id="toolbar-debugToolSubmenu";k.classList.add("toolbar-submenu");k.classList.add("toolbar-settings-sub-menu");k.classList.add("adsk-hidden");this.debugMenu.subMenu=
k;this.debugMenu.subMenu.style.minWidth="180px";this.container.appendChild(k);this.initModelStats();this.addDivider(k);this.addDivider(k);var m="en ru ja ko zh-Hant sp".split(" ");this.addOptionList(k,"Language","English Russian Japanese Korean Chinese Spanish(unsupported)".split(" "),f.selectedLanguage?f.selectedLanguage:0,function(a){var g=m[a];f.selectedLanguage=a;b.setLanguage(g,c)},null).parentNode.style.paddingBottom="15px";this.addDivider(this.debugMenu.subMenu);this.addOptionList(k,"Error",
"UNKNOWN FAILURE; BAD DATA;NETWORK ERROR;NETWORK ACCESS DENIED;NETWORK FILE NOT FOUND; NETWORK SERVER ERROR;NETWORK UNHANDLED RESPONSE CODE;BROWSER WEBGL NOT SUPPORTED;BAD DATA NO VIEWABLE CONTENT".split(";"),0,function(a){b.ErrorHandler.reportError(f.container,a+1,"")},null).parentNode.style.paddingBottom="15px";var n=k.getBoundingClientRect();this.debugMenu.subMenu.style.width=n.width+"px";this.container.removeChild(k);a.container.appendChild(k);var n=n.left+n.width,q=this.container.getBoundingClientRect().right;
n>q&&(this.debugMenu.subMenu.style.left=-(n-q+10)+"px");a.onMouseOver=function(a){k.classList.remove("adsk-hidden")};a.onMouseOut=function(a){k.classList.add("adsk-hidden")};isTouchDevice()&&(a.onClick=function(a){k.classList.toggle("adsk-hidden")})};b.GuiViewer3D.prototype.initModelStats=function(){function b(a){var c=f.impl,d="";f.model&&(d+="Geom&nbsp;polys:&nbsp;"+c.modelQueue().getGeometryList().geomPolyCount+"<br>",d+="Instance&nbsp;polys:&nbsp;"+c.modelQueue().getGeometryList().instancePolyCount+
"<br>",d+="Fragments:&nbsp;"+c.modelQueue().getFragmentList().getCount()+"<br>",d+="Geoms:&nbsp;"+c.modelQueue().getGeometryList().geoms.length+"<br>");f.modelStats.innerHTML=d+("# "+(a||""))}function c(){f.modelStats=document.createElement("div");f.modelStats.className="statspanel";f.container.appendChild(f.modelStats);f.addEventListener(a.PROGRESS_UPDATE_EVENT,function(a){a.message&&b(a.message)})}var f=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(a){a&&!f.modelStats&&
(c(),b(""));f.modelStats.style.visibility=a?"visible":"hidden"})};b.GuiViewer3D.prototype.initEscapeHandlers=function(){var c=this;this.addEventListener(a.ESCAPE_EVENT,function(a){if(!c.contextMenu||!c.contextMenu.hide())if(c.renderoptions&&c.renderoptions.isVisible())c.renderoptions.setVisible(!1);else if(c.getActiveNavigationTool()!==c.getDefaultNavigationToolName())c.toolController&&c.toolController.setIsLocked(!1),c.setActiveNavigationTool(),b.HudMessage.dismiss();else if(c.selectionActive)c.clearSelection();
else if(!c.areAllVisible())c.showAll();else if(!b.AlertBox.dismiss()){for(a=0;a<c.dockingPanels.length;++a){var f=c.dockingPanels[a];if("none"!==f.container.style.display&&""!==f.container.style.display){f.container===c.modelstructure?c.showModelStructurePanel(!1):f.setVisible(!1);return}}c.escapeScreenMode()}})};b.GuiViewer3D.prototype.displayViewCube=function(a,b){this.viewCubeUi.displayViewCube(a,b)};b.GuiViewer3D.prototype.getToolbar=function(b){!this.toolbar&&b&&(b=a.UI,this.toolbar=new b.ToolBar("guiviewer3d-toolbar"),
this.navTools=new b.RadioButtonGroup(a.TOOLBAR.NAVTOOLSID),this.modelTools=new b.ControlGroup(a.TOOLBAR.MODELTOOLSID),this.settingsTools=new b.ControlGroup(a.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container));return this.toolbar};b.GuiViewer3D.prototype.showModelStructurePanel=function(a){this.modelstructure.setVisible(a)};b.GuiViewer3D.prototype.onPanelVisible=
function(a){this.dockingPanels.splice(this.dockingPanels.indexOf(a),1);this.dockingPanels.splice(0,0,a)};b.GuiViewer3D.prototype.updateFullscreenButton=function(b){var c="adsk-icon-fullscreen";switch(b){case a.ScreenMode.kNormal:this.isScreenModeSupported(a.ScreenMode.kFullBrowser)||(c="adsk-icon-fullscreen");break;case a.ScreenMode.kFullBrowser:c=this.isScreenModeSupported(a.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case a.ScreenMode.kFullScreen:c="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(c)};
b.GuiViewer3D.prototype.localize=function(){a.i18n.localize();if(this.viewerOptionButton&&this.viewerOptionButton.subMenu){var c=this.viewerOptionButton.subMenu.mode;this.removeViewerOptionsMenu(c);this.createViewerOptionsMenu(c)}this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton));b.ErrorHandler.localize()};b.GuiViewer3D.prototype.addPanel=function(a){return-1===this.dockingPanels.indexOf(a)?
(this.dockingPanels.push(a),!0):!1};b.GuiViewer3D.prototype.removePanel=function(a){a=this.dockingPanels.indexOf(a);return-1<a?(this.dockingPanels.splice(a,1),!0):!1};b.GuiViewer3D.prototype.resizePanels=function(a){a=a||{};var b=this.toolbar.getDimensions().height,c=this.getDimensions(),f=c.height;a.dimensions&&a.dimensions.height?f=a.dimensions.height:a.dimensions={height:c.height,width:c.width};a.dimensions.height=f-b;(c=a?a.viewer:null)||(c=this);b=a?a.dockingPanels:null;b||(b=c.dockingPanels);
var m=c.container.getBoundingClientRect(),c=m.top,f=m.bottom,n=m.left,q=m.right,l;a&&a.dimensions?(l=a.dimensions.width,f=m=a.dimensions.height):(l=m.width,m=m.height);for(a=0;a<b.length;++a){var p=b[a].container,r=p.getBoundingClientRect(),A=r.top,A=r.bottom,C=r.left,C=r.right,H=r.width,r=r.height;if(H&&r){l<H&&(H=Math.round(l),p.style.width=H+"px");m<r&&(r=Math.round(m),p.style.height=r+"px");if(q<C||p.dockRight)C=Math.round(q-H-n),p.style.left=C+"px";if(f<A||p.dockBottom)A=Math.round(f-r-c),0>
A&&(A=0),p.style.top=A+"px";p.style.maxWidth=Math.round(l)+"px";p.style.maxHeight=Math.round(m)+"px"}}};b.GuiViewer3D.prototype.initExplodeSlider=function(){var a=this,b=new c.Button("toolbar-explodeTool");b.setIcon("adsk-icon-explode");b.setToolTip("Explode");a.modelTools.addControl(b,{index:0});var f=stringToDOM('<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"></input></div>'),k;k=document.querySelector("#toolbar-explodeTool").parentNode;
f.classList.add("ios");k.appendChild(f);var m=f.querySelector(".explode-slider");a.explodeSlider=m;m.oninput=function(b){a.explode(m.value)};m.onchange=function(b){a.explode(m.value)};f.onclick=function(a){a.stopPropagation()};var n=b.container.querySelector(".adsk-control-tooltip");b.onClick=function(k){k=b.getState();k===c.Button.State.INACTIVE?(b.setState(c.Button.State.ACTIVE),n.style.display="none",f.style.display=""):k===c.Button.State.ACTIVE&&(b.setState(c.Button.State.INACTIVE),n.style.display=
"",m.parentNode.style.display="none",a.explode(0),a.explodeSlider.value=0)}};b.GuiViewer3D.prototype.initInspectTools=function(){var a=new c.Button("toolbar-inspectTools");a.setToolTip("Inspect");a.setIcon("measure");a.setVisible(!1);this.modelTools.addControl(a);var b=new c.RadioButtonGroup("toolbar-inspectSubMenu");b.addClass("toolbar-vertical-group");b.setVisible(!1);this.modelTools.addControl(b);a.container.insertBefore(b.container,a.container.firstChild);a.onMouseOver=function(){b.setVisible(!0)};
a.onMouseOut=function(){b.setVisible(!1)};isTouchDevice()&&(a.onClick=function(a){b.setVisible(!b.isVisible())})};b.GuiViewer3D.prototype.initModality=function(){function a(b){for(var c=0;2>c&&b.parentElement;){var d=b.id;if(0===d.indexOf("toolbar-"))return d.indexOf("arrow")===d.length-5?void 0:a(b.parentElement)||b;b=b.parentElement;c++}}var b={orbitTools:{sectionTool:1,explodeTool:1},panTool:{sectionTool:1,explodeTool:1},zoomTool:{sectionTool:1,explodeTool:1},beelineTool:{sectionTool:1},sectionTool:{},
measureTool:{},explodeTool:{}},c={};this.toolbar.container.addEventListener("click",function(f){if(!f.target.classList.contains("clickoff")){var m=a(f.target);if(m){var n=m.id.substring(8,m.id.length);if(b[n]&&("sectionTool"!==n||!f.target.classList.contains("adsk-icon-section-analysis")&&!f.target.querySelector(".adsk-icon-section-analysis"))){if(c[n]&&(c[n]=void 0,m.classList.contains("active")))return;for(var q in c)if(f=c[q]){var l=f.id.substring(8,f.id.length);f.classList.contains("active")?
b[n][l]||f.dispatchEvent(new Event("click")):c[l]=void 0}c[n]=m}}}},!0)}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.UI;b.Control=function(a,b){this._id=a;this._isCollapsible=!b||b.collapsible;this._toolTipElement=null;this._listeners={};this.container=document.createElement("div");this.container.id=a;this.addClass("adsk-control")};b.Control.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"};a.EventDispatcher.prototype.apply(b.Control.prototype);b.Control.prototype.constructor=b.Control;b.Control.prototype.container=
null;b.Control.prototype.getId=function(){return this._id};b.Control.prototype.setVisible=function(a){if(!this.container.classList.contains("adsk-hidden")===a)return!1;a?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");this.fireEvent({type:b.Control.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:a});return!0};b.Control.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")};b.Control.prototype.setToolTip=
function(a){if(this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")===a)return!1;this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement));this._toolTipElement.setAttribute("data-i18n",a);this._toolTipElement.setAttribute("tooltipText",a);this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(a,{defaultValue:a});
return!0};b.Control.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")};b.Control.prototype.setCollapsed=function(a){if(!this._isCollapsible||this.isCollapsed()===a)return!1;a?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");this.fireEvent({type:b.Control.Event.COLLAPSED_CHANGED,isCollapsed:a});return!0};b.Control.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")};
b.Control.prototype.isCollapsible=function(){return this._isCollapsible};b.Control.prototype.addClass=function(a){this.container.classList.add(a)};b.Control.prototype.removeClass=function(a){this.container.classList.remove(a)};b.Control.prototype.getPosition=function(){var a=this.container.getBoundingClientRect();return{top:a.top,left:a.left}};b.Control.prototype.getDimensions=function(){var a=this.container.getBoundingClientRect();return{width:a.width,height:a.height}}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.ControlGroup=function(b,c){a.Control.call(this,b,c);var f=this;this._controls=[];this.addClass("adsk-control-group");this.handleChildSizeChanged=function(b){f.fireEvent({type:a.ControlGroup.Event.SIZE_CHANGED,childEvent:b})}};a.ControlGroup.Event={VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"};
a.ControlGroup.prototype=Object.create(a.Control.prototype);a.ControlGroup.prototype.constructor=a.ControlGroup;a.ControlGroup.prototype.addControl=function(b,c){var f=c&&void 0!==c.index?c.index:this._controls.length;if(null!==this.getControl(b.getId()))return!1;var g={type:a.ControlGroup.Event.CONTROL_ADDED,control:b,index:f};f<this._controls.length?(this.container.insertBefore(b.container,this._controls[f].container),this._controls.splice(f,0,b)):(this.container.appendChild(b.container),this._controls.push(b));
b.addEventListener(a.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged);b.addEventListener(a.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged);b instanceof a.ControlGroup&&b.addEventListener(a.ControlGroup.Event.SIZE_CHANGED,this.handleChildSizeChanged);this.fireEvent(g);this.fireEvent(a.ControlGroup.Event.SIZE_CHANGED);return!0};a.ControlGroup.prototype.indexOf=function(a){for(var c=0;c<this._controls.length;c++){var f=this._controls[c];if(f===a||"string"===typeof a&&a===f.getId())return c}return-1};
a.ControlGroup.prototype.removeControl=function(b){b="string"===typeof b?this.getControl(b):b;if(!b)return!1;var c=this._controls.indexOf(b);this._controls.splice(c,1);this.container.removeChild(b.container);c={type:a.ControlGroup.Event.CONTROL_REMOVED,control:b,index:c};b.removeEventListener(a.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged);b.removeEventListener(a.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged);b instanceof a.ControlGroup&&b.removeEventListener(a.ControlGroup.Event.SIZE_CHANGED,
this.handleChildSizeChanged);this.fireEvent(c);this.fireEvent(a.ControlGroup.Event.SIZE_CHANGED);return!0};a.ControlGroup.prototype.getControl=function(a){for(var c=0;c<this._controls.length;c++)if(a===this._controls[c].getId())return this._controls[c];return null};a.ControlGroup.prototype.getNumberOfControls=function(){return this._controls.length};a.ControlGroup.prototype.setCollapsed=function(b){if(!this._isCollapsible)return!1;var c=!1;this._controls.forEach(function(a){a.isCollapsible()&&a.setCollapsed(b)&&
(c=!0)});c&&(b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:a.ControlGroup.Event.COLLAPSED_CHANGED,isCollapsed:b}));return c}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.ToolBar=function(b,c){a.ControlGroup.call(this,b,c);this.removeClass("adsk-control-group");this.addClass("adsk-toolbar")};a.ToolBar.Event={VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:a.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:a.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:a.ControlGroup.Event.SIZE_CHANGED};a.ToolBar.prototype=Object.create(a.ControlGroup.prototype);a.ToolBar.prototype.constructor=
a.ToolBar})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.Button=function(b,c){a.Control.call(this,b,c);var f=this;this._state=a.Button.State.INACTIVE;this.icon=document.createElement("div");this.icon.classList.add("adsk-button-icon");this.container.appendChild(this.icon);this.container.addEventListener("click",function(b){f.fireEvent(a.Button.Event.CLICK);if(f.onClick)f.onClick(b);b.stopPropagation()});isTouchDevice()?this.container.addEventListener("touchstart",touchStartToClick):(this.container.addEventListener("mouseover",
function(a){f.onMouseOver(a)}),this.container.addEventListener("mouseout",function(a){f.onMouseOut(a)}));this.addClass("adsk-button");this.addClass(a.Button.StateToClassMap[this._state])};a.Button.Event={VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"};a.Button.State={ACTIVE:0,INACTIVE:1,DISABLED:2};a.Button.StateToClassMap=function(){var b=a.Button.State,c={};c[b.ACTIVE]="active";c[b.INACTIVE]=
"inactive";c[b.DISABLED]="disabled";return c}();a.Button.prototype=Object.create(a.Control.prototype);a.Button.prototype.constructor=a.Button;a.Button.prototype.setState=function(b){if(b===this._state)return!1;this.removeClass(a.Button.StateToClassMap[this._state]);this.addClass(a.Button.StateToClassMap[b]);this._state=b;this.fireEvent({type:a.Button.Event.STATE_CHANGED,state:b});return!0};a.Button.prototype.setIcon=function(a){this.iconClass&&this.icon.classList.remove(this.iconClass);this.iconClass=
a;this.icon.classList.add(a)};a.Button.prototype.getState=function(){return this._state};a.Button.prototype.onClick=function(a){};a.Button.prototype.onMouseOver=function(a){};a.Button.prototype.onMouseOut=function(a){}})();AutodeskNamespace("Auodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.ComboButton=function(b,c){a.Button.call(this,b,c);this.arrowButton=new a.Button(b+"arrow");this.arrowButton.addClass("adsk-button-arrow");this.arrowButton.removeClass("adsk-button");this.subMenu=new a.RadioButtonGroup(b+"SubMenu");this.subMenu.addClass("toolbar-vertical-group");this.subMenu.setVisible(!1);this.container.insertBefore(this.subMenu.container,this.container.firstChild);this.container.insertBefore(this.arrowButton.container,this.container.firstChild);
var f=this;this.arrowButton.onClick=function(a){f.subMenu.setVisible(!f.subMenu.isVisible())};this.toggleFlyoutVisible=function(){f.subMenu.setVisible(!f.subMenu.isVisible())};this.onClick=function(a){f.subMenu.setVisible(!f.subMenu.isVisible())};this.subMenuActiveButtonChangedHandler=function(b){b.isActiveButton?(f.setIcon(b.target.getActiveButton().iconClass),f.setToolTip(b.target.getActiveButton().getToolTip()),f.setState(a.Button.State.ACTIVE),f.onClick=b.button.onClick):f.setState(a.Button.State.INACTIVE)};
this.subMenu.addEventListener(a.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var g=stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(g,this.subMenu.container.firstChild);g.addEventListener("click",function(a){f.subMenu.setVisible(!1);a.stopPropagation()})};a.ComboButton.prototype=Object.create(a.Button.prototype);a.ComboButton.prototype.constructor=a.ComboButton;
a.ComboButton.prototype.addControl=function(b){this.subMenu.addControl(b);b.addEventListener(a.Button.Event.CLICK,this.toggleFlyoutVisible)};a.ComboButton.prototype.removeControl=function(b){b.removeEventListener(a.Button.Event.CLICK,this.toggleFlyoutVisible)};a.ComboButton.prototype.setState=function(b){if(b===a.Button.State.INACTIVE){var c=this.subMenu.getActiveButton();c&&c.setState(a.Button.State.INACTIVE)}a.Button.prototype.setState.call(this,b)}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.RadioButtonGroup=function(b,c){a.ControlGroup.call(this,b,c);var f=this;this._activeButton=null;this._handleButtonStateChange=function(b){var c=a.Button.State;b.state!==c.ACTIVE?b.target===f._activeButton&&(f._activeButton=null,f.fireEvent({type:a.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,button:b.target,isActiveButton:!1})):(f._activeButton=b.target,f.fireEvent({type:a.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,button:b.target,isActiveButton:!0}),f._controls.forEach(function(a){a!==
b.target&&a.getState()!==c.DISABLED&&a.setState(c.INACTIVE)}))}};a.RadioButtonGroup.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:a.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:a.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:a.ControlGroup.Event.SIZE_CHANGED};a.RadioButtonGroup.prototype=Object.create(a.ControlGroup.prototype);a.RadioButtonGroup.prototype.constructor=
a.RadioButtonGroup;a.RadioButtonGroup.prototype.addControl=function(b,c){return b instanceof a.Button?a.ControlGroup.prototype.addControl.call(this,b,c)?(b.addEventListener(a.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0):!1:!1};a.RadioButtonGroup.prototype.removeControl=function(b){b="string"==typeof b?this.getControl(b):b;return null!==b&&a.ControlGroup.prototype.removeControl.call(this,b)?(b.removeEventListener(a.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0):!1};
a.RadioButtonGroup.prototype.getActiveButton=function(){return this._activeButton}})();AutodeskNamespace("Autodesk.Viewing");function MobileCallbacks(){this.ios=window.webkit;this.android=window.JSINTERFACE;this.iosSend=function(a,b){window.webkit.messageHandlers.callbackHandler.postMessage({command:a,data:b})};this.androidSend=window.JSINTERFACE}var proto=MobileCallbacks.prototype;proto.onSelectionChanged=function(a){if(this.ios)this.iosSend("selectionChanged",a);else if(this.android)this.androidSend.onSelectionChanged(a)};
proto.onLongTap=function(a,b){if(this.ios)this.iosSend("contextMenu",[a,b]);else if(this.android)this.androidSend.onLongTap(a,b)};proto.setRTCSession=function(a){this.ios?this.iosSend("setRTCSession",{id:a}):this.android&&this.androidSend.setRTCSessionID(a)};proto.putProperties=function(a,b){this.ios?this.iosSend("putProperties",{name:a,value:b}):this.android&&this.androidSend.putProperties(a,b)};proto.onPropertyRetrievedSuccess=function(){if(this.ios)this.iosSend("onPropertyRetrievedSuccess");else if(this.android)this.androidSend.onPropertyRetrievedSuccess()};
proto.onPropertyRetrievedFailOrEmptyProperties=function(){if(this.ios)this.iosSend("onPropertyRetrievedFailOrEmptyProperties");else if(this.android)this.androidSend.onPropertyRetrievedFailOrEmptyProperties()};proto.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()};proto.updateAnimationProgress=function(a){this.ios?this.iosSend("updateAnimationProgress",a):this.android&&this.androidSend.updateAnimationProgress(a)};
proto.setLoadingProgress=function(a){this.ios?this.iosSend("setLoadingProgress",a):this.android&&this.androidSend.setLoadingProgress(a)};proto.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()};proto.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()};
proto.putSheets=function(a,b){this.ios?this.iosSend("putSheets",{geomName:a,geomGuid:b}):this.android&&this.androidSend.putSheets(a,b)};AutodeskNamespace("Autodesk.Viewing.Extensions");
Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var a=this.parentContainer.getBoundingClientRect(),b={height:0,width:0,left:0,bottom:0,right:0,top:0},c=document.getElementsByClassName("toolbar-menu");c&&0<c.length&&(b=c[0].getBoundingClientRect());return{height:a.height-b.height,width:a.width,left:a.left,bottom:a.bottom-b.height,right:a.right,top:a.top}}};AutodeskNamespace("Autodesk.Viewing.Extensions");AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Extensions;c.ViewerModelStructurePanel=function(a,c,d){this.viewer=a;d=d||{};d.heightAdjustment=75;b.ModelStructurePanel.call(this,a.container,a.container.id+"ViewerModelStructurePanel",c,d);this.clickConfig=d&&d.docStructureConfig?d.docStructureConfig:null;this.isMac=-1!==navigator.userAgent.search("Mac OS");this.initSearchBox();this.prevSearchResults=[];this.prevSearchString=""};c.ViewerModelStructurePanel.prototype=Object.create(b.ModelStructurePanel.prototype);
c.ViewerModelStructurePanel.prototype.constructor=c.ViewerModelStructurePanel;c.ViewerPanelMixin.call(c.ViewerModelStructurePanel.prototype);c.ViewerModelStructurePanel.prototype.initialize=function(){b.ModelStructurePanel.prototype.initialize.call(this);var c=this;c.addEventListener(c.viewer,a.SELECTION_CHANGED_EVENT,function(a){c.setSelection(a.nodeArray.slice())});c.addEventListener(c.viewer,a.ISOLATE_EVENT,function(a){c.setIsolation(a.nodeIdArray.slice())});c.addEventListener(c.viewer,a.HIDE_EVENT,
function(a){c.setHidden(a.nodeIdArray.slice(),!0)});c.addEventListener(c.viewer,a.SHOW_EVENT,function(a){c.setHidden(a.nodeIdArray.slice(),!1)})};c.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null;b.ModelStructurePanel.prototype.uninitialize.call(this)};c.ViewerModelStructurePanel.prototype.handleAction=function(a,b){for(var c in a)switch(a[c]){case "selectOnly":this.viewer.select(b);break;case "deselectAll":this.viewer.select([]);break;case "selectToggle":this.viewer.toggleSelect(b);
break;case "isolate":this.viewer.isolate(b);break;case "showAll":this.viewer.isolate(null);break;case "focus":this.viewer.fitToView();break;case "hide":this.viewer.hide(b);break;case "show":this.viewer.show(b);break;case "toggleVisibility":this.viewer.toggleVisibility(b)}};c.ViewerModelStructurePanel.prototype.ctrlDown=function(a){return this.isMac&&a.metaKey||!this.isMac&&a.ctrlKey};c.ViewerModelStructurePanel.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c="click";this.ctrlDown(b)&&
(c+="Ctrl");b.shiftKey&&(c+="Shift");b.altKey&&(c+="Alt");this.clickConfig&&this.clickConfig[c]?this.handleAction(this.clickConfig[c].onObject,a):this.viewer.select(a)}};c.ViewerModelStructurePanel.prototype.onDoubleClick=function(a,b){this.handleAction(["focus"],a)};c.ViewerModelStructurePanel.prototype.onRightClick=function(a,b){if(this.isMac&&b.ctrlKey&&0===b.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,a):this.viewer.select(a),
null;var c=[],h=!0;if(b.shiftKey||this.isMac&&b.metaKey||b.ctrlKey&&(this.isMac||2===b.button))for(var k=this.viewer.impl.selector.getSelection(),m=0;m<k.length;++m)k[m]!==a?c.push(k[m]):h=!1;h&&c.push(a);this.viewer.select(c);return this.viewer.contextMenu.show(b)};c.ViewerModelStructurePanel.prototype.setHidden=function(a,b){this.uiCreated||this.createUI();for(var c=0;c<a.length;++c)this.tree.iterate(a[c],function(a,c){c.classList.toggle("dim",b);c.classList.toggle("visible",!b)})};c.ViewerModelStructurePanel.prototype.setIsolation=
function(a){this.rootId&&(this.tree&&this.tree.iterate(this.rootId,function(a,b){b.classList.remove("dim");b.classList.remove("visible")}),0<a.length&&(1!==a.length||a[0]!==this.rootId)&&(this.setHidden([this.rootId],!0),this.setHidden(a,!1)))};c.ViewerModelStructurePanel.prototype.initSearchBox=function(){function b(){if(!h.isSearching){for(var a=0;a<h.prevSearchResults.length;a++)h.tree.setCollapsed(h.prevSearchResults[a],!0,!0);0===c.value.length?(h.isSearching=!1,h.prevSearchString="",d.isolate()):
h.prevSearchString!=c.value&&(h.isSearching=!0,d.search(c.value,function(a){d.isolate(a);if(a.length){for(var b=0;b<a.length;b++)h.tree.setCollapsed(a[b],!1,!0);h.resizeToContent();h.tree.scrollTo(a[0])}h.prevSearchResults=a;h.isSearching=!1},null,["name"]))}}var c=document.createElement("input");c.className="toolbar-search-box";c.type="search";c.results=5;c.placeholder=a.i18n.translate("Filter by name");c.incremental="incremental";c.autosave=this.container.id+"search_autosave";c.setAttribute("data-i18n",
"[placeholder]Filter by name");this.scrollContainer.parentNode.insertBefore(c,this.scrollContainer);var d=this.viewer,h=this,k;c.addEventListener("input",function(a){clearTimeout(k);k=setTimeout(b,500)});c.addEventListener("change",function(a){clearTimeout(k);b()})}})();AutodeskNamespace("Autodesk.Viewing.Extensions");
Autodesk.Viewing.Extensions.ViewerPropertyPanel=function(a){this.viewer=a;this.currentNodeIds=[];this.isSelection=!1;this.isDirty=!0;this.propertyNodeId=null;Autodesk.Viewing.UI.PropertyPanel.call(this,a.container,"ViewerPropertyPanel","Object Properties Loading...")};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype=Object.create(Autodesk.Viewing.UI.PropertyPanel.prototype);Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.constructor=Autodesk.Viewing.Extensions.ViewerPropertyPanel;
Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype);
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.initialize=function(){Autodesk.Viewing.UI.PropertyPanel.prototype.initialize.call(this);var a=this;a.addEventListener(a.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(b){a.currentNodeIds=b.dbIdArray;a.isSelection=0<b.dbIdArray.length;a.isDirty=!0;a.requestProperties()});a.addEventListener(a.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(b){0==b.nodeIdArray.length&&a.isSelection||(a.currentNodeIds=b.nodeIdArray,a.isDirty=!0,a.requestProperties())});
a.addEventListener(a.viewer,Autodesk.Viewing.HIDE_EVENT,function(b){a.isDirty=!0;a.requestProperties()});a.addEventListener(a.viewer,Autodesk.Viewing.SHOW_EVENT,function(b){a.isDirty=!0;a.requestProperties()});this.currentNodeIds=a.viewer.getSelection();0===this.currentNodeIds.length?this.currentNodeIds=a.viewer.getIsolatedNodes():this.isSelection=!0};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.setTitle=function(a,b){a||(a="Object Properties",b=b||{},b.localizeTitle=!0);Autodesk.Viewing.UI.PropertyPanel.prototype.setTitle.call(this,a,b)};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.setVisible=function(a){Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a);this.requestProperties()};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.visibilityChanged=function(){Autodesk.Viewing.UI.DockingPanel.prototype.visibilityChanged.call(this);this.isVisible()&&this.requestProperties()};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(0<this.currentNodeIds.length?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.setNodeProperties=function(a){var b=this;this.propertyNodeId=a;b.viewer.getProperties(a,function(a){b.setTitle(a.name);b.setProperties(a.properties);b.highlight(b.viewer.searchText);b.resizeToContent();if(b.isVisible()){var f=b.viewer.toolController;a=f.lastClickX;var f=f.lastClickY,g=b.container.getBoundingClientRect(),d=g.left,h=g.top,k=g.width,g=g.height,m=b.viewer.canvas.getBoundingClientRect(),n=m.left,q=m.top,l=m.width,m=m.height;d<=
a&&a<d+k&&h<=f&&f<h+g&&(a<d+k/2&&a+k<n+l?(b.container.style.left=Math.round(a-n)+"px",b.container.dockRight=!1):n<=a-k?(b.container.style.left=Math.round(a-n-k)+"px",b.container.dockRight=!1):a+k<n+l?(b.container.style.left=Math.round(a-n)+"px",b.container.dockRight=!1):f+g<q+m?(b.container.style.top=Math.round(f-q)+"px",b.container.dockBottom=!1):q<=f-g&&(b.container.style.top=Math.round(f-q-g)+"px",b.container.dockBottom=!1))}})};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.showDefaultProperties=function(){var a=this.viewer.model.getRootId();a?this.setNodeProperties(a):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),Autodesk.Viewing.UI.PropertyPanel.prototype.showDefaultProperties.call(this))};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.areDefaultPropertiesShown=function(){var a=this.viewer.model.getRootId();return this.propertyNodeId===a};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.PropertyPanel.prototype.uninitialize.call(this);this.viewer=null};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.onCategoryClick=function(a,b){Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryClick.call(this,a,b);this.viewer.getDimensions();this.resizeToContent()};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.onCategoryIconClick=function(a,b){Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryIconClick.call(this,a,b);this.viewer.getDimensions();this.resizeToContent()};AutodeskNamespace("Autodesk.Viewing.Extensions");Autodesk.Viewing.Extensions.ViewerLayersPanel=function(a){var b=a.container;Autodesk.Viewing.UI.LayersPanel.call(this,a,b,b.id+"ViewerLayersPanel")};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype);
Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.constructor=Autodesk.Viewing.Extensions.ViewerLayersPanel;Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype);Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a,!(b.shiftKey||b.metaKey||b.ctrlKey))};
Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onRightClick=function(a,b){this.setLayerVisible(a,!(b.shiftKey||b.metaKey||b.ctrlKey))};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onImageClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a)};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onTitleClick=function(a){this.viewer.setLayerVisible(null,!0)};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onTitleDoubleClick=function(a){this.viewer.fitToView()};
AutodeskNamespace("Autodesk.Viewing.Extensions");Autodesk.Viewing.Extensions.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"};
Autodesk.Viewing.Extensions.ViewerSettingsPanel=function(a,b){this.viewer=a;this.is3dMode="3d"===b;Autodesk.Viewing.UI.SettingsPanel.call(this,a.container,"ViewerSettingsPanel","Settings",{width:340,heightAdjustment:155});this.addTab("navigationtab","Navigation and selection",{className:"navigation"});this.addTab("performancetab","Performance and appearance",{className:"performance"});this.restoreDiv=document.createElement("div");this.restoreDiv.className="viewer-restore-defaults";this.restoreDiv.setAttribute("data-i18n",
"Restore settings defaults");this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore settings defaults");this.addEventListener(this.restoreDiv,"touchstart",touchStartToClick);this.addEventListener(this.restoreDiv,"click",function(){var b=a.model.is2d()?"2d":"3d";a.prefs.reset(b)},!1);this.container.appendChild(this.restoreDiv);this.createNavigationPanel();this.createPerformancePanel()};Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.SettingsPanel.prototype);
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.constructor=Autodesk.Viewing.Extensions.ViewerSettingsPanel;Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype);Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.uninitialize=function(){this.viewer=null;Autodesk.Viewing.UI.SettingsPanel.prototype.uninitialize.call(this)};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.addCheckbox=function(a,b,c,f,g){var d=this.viewer,h=d.prefs[g];a=Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox.call(this,a,b,"boolean"===typeof h?h:c,function(a){d.prefs.set(g,a);f(a)});var k=this.getControl(a);k.saveKey=g;d.prefs.addListeners(g,function(a){k.setValue(a)},function(a){k.setValue(a);f(a)});return k};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.removeCheckbox=function(a){this.viewer.prefs.removeListeners(a.saveKey);this.removeEventListener(a,"change",a.changeListener);return Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox.call(this,a)};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.createNavigationPanel=function(){var a=this.viewer,b=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation;this.is3dMode&&(this.addCheckbox(b,"Show ViewCube",!0,function(b){a.displayViewCube(b)},"viewCube"),this.addCheckbox(b,"ViewCube acts on pivot",!1,function(b){a.setUsePivotAlways(b)},"alwaysUsePivot"),this.addCheckbox(b,"Zoom towards pivot",!1,function(b){a.setZoomTowardsPivot(b)},"zoomTowardsPivot"),this.addCheckbox(b,"Set pivot with left mouse button",
!1,function(b){a.setClickToSetCOI(b)},"clickToSetCOI"),this.addCheckbox(b,"Fusion style orbit",!1,function(b){b?a.loadExtension("Autodesk.Viewing.FusionOrbit",null):a.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"));this.addCheckbox(b,"Reverse mouse zoom direction",!1,function(b){a.setReverseZoomDirection(b)},"reverseMouseZoomDir");this.is3dMode&&this.addCheckbox(b,"Orbit past world poles",!0,function(b){a.setOrbitPastWorldPoles(b)},"orbitPastWorldPoles");this.addCheckbox(b,"Open properties on select",
!0,function(b){a.setPropertiesOnSelect(b)},"openPropertiesOnSelect");this.addCheckbox(b,"Left handed mouse setup",!1,function(b){a.setUseLeftHandedInput(b)},"leftHandedMouseSetup")};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.createPerformancePanel=function(){var a=this.viewer,b=Autodesk.Viewing.Extensions.ViewerSettingTab.Performance;this.is3dMode&&(this.ghosthiddenChkBoxId=this.addCheckbox(b,"Ghost hidden objects",!0,function(b){a.setGhosting(b)},"ghosting"),this.optimizeNavigationhkBoxId=this.addCheckbox(b,"Smooth navigation",isMobileDevice(),function(b){a.setOptimizeNavigation(b)},"optimizeNavigation"),this.antialiasingChkBoxId=this.addCheckbox(b,"Anti-aliasing",
!0,function(b){a.setQualityLevel(a.prefs.ambientShadows,b)},"antialiasing"),this.ambientshadowsChkBoxId=this.addCheckbox(b,"Ambient shadows",!0,function(b){a.setQualityLevel(b,a.prefs.antialiasing)},"ambientShadows"),this.groundShadowChkBoxId=this.addCheckbox(b,"Ground shadow",!0,function(b){a.setGroundShadow(b)},"groundShadow"),this.groundReflectionChkBoxId=this.addCheckbox(b,"Ground reflection",!0,function(b){a.setGroundReflection(b)},"groundReflection"));this.progressiveRenderChkBoxId=this.addCheckbox(b,
"Progressive model display",!0,function(b){a.setProgressiveRendering(b)},"progressiveRendering")};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.syncUI=function(){var a=this.viewer,b=this.getControl(this.antialiasingChkBoxId);b&&b.setValue(a.prefs.antialiasing);(b=this.getControl(this.ambientshadowsChkBoxId))&&b.setValue(a.prefs.ambientShadows);(b=this.getControl(this.groundShadowChkBoxId))&&b.setValue(a.prefs.groundShadow);(b=this.getControl(this.groundReflectionChkBoxId))&&b.setValue(a.prefs.groundReflection);(b=this.getControl(this.progressiveRenderChkBoxId))&&b.setValue(a.prefs.progressiveRendering);
(b=this.getControl(this.ghosthiddenChkBoxId))&&b.setValue(a.prefs.ghosting)};AutodeskNamespace("Autodesk.Viewing.Extensions");Autodesk.Viewing.Extensions.ViewerObjectContextMenu=function(a){Autodesk.Viewing.UI.ObjectContextMenu.call(this,a)};Autodesk.Viewing.Extensions.ViewerObjectContextMenu.prototype=Object.create(Autodesk.Viewing.UI.ObjectContextMenu.prototype);Autodesk.Viewing.Extensions.ViewerObjectContextMenu.prototype.constructor=Autodesk.Viewing.Extensions.ViewerObjectContextMenu;
Autodesk.Viewing.Extensions.ViewerObjectContextMenu.prototype.buildMenu=function(a,b){var c=this,f=[],g=this.viewer.model.is2d();!g&&b.hasSelected&&(f.push({title:"Isolate",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection();c.viewer.isolate(a)}}),b.hasVisible&&f.push({title:"Hide Selected",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection();c.viewer.hide(a)}}),b.hasHidden&&f.push({title:"Show Selected",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection();
c.viewer.show(a)}}));g?f.push({title:"Show All Layers",target:function(){c.viewer.setLayerVisible(null,!0)}}):f.push({title:"Show All Objects",target:function(){c.viewer.showAll()}});!g&&b.hasSelected&&f.push({title:"Focus",target:function(){var a=c.viewer.getSelection();c.viewer.fitToView(a)}});b.hasSelected&&f.push({title:"Clear Selection",target:function(){c.viewer.clearSelection()}});return f};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");
Autodesk.Viewing.Extensions.CAM360.CAM360Extension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype.constructor=Autodesk.Viewing.Extensions.CAM360.CAM360Extension;
Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype.load=function(){function a(){b.impl.setLightPreset(0,!0);b.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}var b=this.viewer,c=new Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options);b.setModelStructurePanel(c);b.hideLines(!1);b.setGhosting(!1);b.setQualityLevel(!1,!0);b.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a);return!0};
Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype.unload=function(){this.viewer.setModelStructurePanel(null)};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",Autodesk.Viewing.Extensions.CAM360.CAM360Extension);"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel=function(a,b,c){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,a,b,c);this.viewer=a};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype);Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel;
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.sortCamNodes=function(a,b){function c(a,b){g.viewer.getProperties(a,function(c){a:{c=c.properties;for(var d=0;d<c.length;++d){var f=c[d];if("9429B915-D020-4CEB-971B-6ADD0A5D4BFA"===f.displayName){c=f.displayValue;break a}}c=null}c?("CAM_Setup"==c?g.camSetupNodes.push(a):"CAM_Operation"==c?g.camOperationNodes.push(a):"CAM_Tool"===c?g.camToolNodes.push(a):"CAM_Stock"===c?g.camStockNodes.push(a):"CAM_Folder"==c&&g.camFolderNodes.push(a),
g.camNodes.push(a)):g.camModelNodes.push(a);b()},function(a,c,d){b()})}function f(){0<d.length?c(d.shift(),f):b()}this.camNodes=[];this.camModelNodes=[];this.camSetupNodes=[];this.camStockNodes=[];this.camOperationNodes=[];this.camToolNodes=[];this.camFolderNodes=[];var g=this,d=[];a.enumNodeChildren(a.getRootId(),function(a){d.push(a)},!0);d.shift();f()};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.setModel=function(a,b){var c=this;c.sortCamNodes(a,function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.setModel.call(c,a,b);c.SetCAMNodeVisible(!1);c.setVisible(!0);c.ExpandSetupNodes();c.resizeToContent()})};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.initialize=function(){function a(c){b.SetCAMNodeVisible(!1);b.removeEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this);var b=this;this.viewer.model&&this.viewer.model.isLoadDone()||b.addEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a);b.addEventListener(b.viewer,Autodesk.Viewing.SHOW_EVENT,function(a){if(a=a.nodeIdArray)for(var f=
0;f<a.length;f++)b.setCamNodeVisibility(a[f])});b.addEventListener(b.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(a){if(a=a.nodeArray)for(var f=0;f<a.length;f++)b.HideHightlightCAMNode(a[f])});b.addEventListener(b.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(a){if(a=a.nodeIdArray)if(0==a.length)b.SetModelVisible(),b.SetCAMNodeVisible(!0);else for(var f=0;f<a.length;f++)b.setCamNodeVisibility(a[f])})};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMNode=function(a){return-1!==this.camNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMSetupNode=function(a){return-1!==this.camSetupNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMStockNode=function(a){return-1!==this.camStockNodes.indexOf(a)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMToolNode=function(a){return-1!==this.camToolNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMOperationNode=function(a){return-1!==this.camOperationNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMFolderNode=function(a){return-1!==this.camFolderNodes.indexOf(a)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.shouldInclude=function(a){return!this.IsCAMStockNode(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.isGroupNode=function(a){return this.IsCAMOperationNode(a)?!1:Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.isGroupNode.call(this,a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.setNodeVisibility=function(a,b){b?this.viewer.show(a):this.viewer.hide(a)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var a=0;a<this.camModelNodes.length;a++)this.setNodeVisibility(this.camModelNodes[a],!0)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.SetCAMNodeVisible=function(a){if(this.camNodes){for(var b=0;b<this.camNodes.length;b++)this.setNodeVisibility(this.camNodes[b],a);this.SetToolNodeVisible(!1)}};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.SetToolNodeVisible=function(a){if(this.camToolNodes)for(var b=0;b<this.camToolNodes.length;b++)this.setNodeVisibility(this.camToolNodes[b],a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.HideHightlightNode=function(a){var b=this.viewer.impl,c=this;c.instanceTree.enumNodeFragments(a,function(a){b.highlightFragment(c.model,a,!1,!0)},!0)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.HideHightlightCAMNode=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),f=this.IsCAMFolderNode(a),g=this;g.instanceTree.enumNodeChildren(a,function(a){b?g.IsCAMStockNode(a)||g.HideHightlightNode(a):c?g.IsCAMToolNode(a)&&g.HideHightlightNode(a):f&&g.HideHightlightNode(a)},!1)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.setCamNodeVisibility=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),f=this.IsCAMFolderNode(a),g=this;b?this.instanceTree.enumNodeChildren(a,function(a){var b=g.IsCAMStockNode(a);g.setNodeVisibility(a,b)}):c?this.instanceTree.enumNodeChildren(a,function(a){g.IsCAMToolNode(a)&&g.setNodeVisibility(a,!1)}):f&&this.instanceTree.enumNodeChildren(a,function(a){g.setNodeVisibility(a,!1)})};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.onClick=function(a,b){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,a,b);this.SetModelVisible();this.setCamNodeVisibility(a);this.viewer.fitToView()};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var a=0;a<this.camSetupNodes.length;a++)this.tree.setCollapsed(this.camSetupNodes[a],!1)};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360");
Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b);this.viewer=a;this.animTools=null;this.animToolsId="animationTools";this.playButton=null;this.prevExplodeValue=0;this.prevAnimationTime=-1};Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360.AnimationExtension;
Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype.load=function(){function a(a,b){b?(a.setIcon("toolbar-animationPlayIcon"),a.setToolTip("Play")):(a.setIcon("toolbar-animationPauseIcon"),a.setToolTip("Pause"))}function b(){m.toolbar.removeClass("toolbar-animationMenuplacer");k.animTools.setVisible(!1)}function c(a,b){m.model.is2d()||0===m.getExplodeScale()||(k.prevExplodeValue=m.explodeSlider.value,b&&(m.explodeSlider.value=a),m.explode(a))}function f(a){var b=a.value;a.style.background=
"-webkit-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="-moz-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="-ms-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="-o-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="linear-gradient(to right,#ffffff "+b+"%, #393939 "+b+"%)"}function g(a){var b="";0>a&&(b="-",a=-a);var c=~~(a/3600),d=~~(a%3600/60);a%=60;0<c&&(b+=c+":"+(10>d?"0":""));return b=b+(d+":"+
(10>a?"0":""))+a.toFixed(2)}function d(q){m.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,d);k.toolbar=new n.ToolBar("animation-toolbar");k.toolbar.addClass("toolbar-animationSubtoolbar");m.container.appendChild(k.toolbar.container);k.animTools=new n.ControlGroup(k.animToolsId);k.animTools.setVisible(!1);k.toolbar.addControl(k.animTools);k.playButton=new n.Button("toolbar-animationPlay");k.playButton.setToolTip("Play");k.playButton.onClick=function(b){c(0);var d=m.impl.keyFrameAnimator;
void 0!==d&&d&&(0<k.prevAnimationTime&&(d.goto(k.prevAnimationTime),k.prevAnimationTime=-1),d.play(0,function(b){p.value=b;l.value=g(d.currentTime);A.value=g(d.currentTime-d.duration);100<=b&&a(k.playButton,!0);f(p)}),a(k.playButton,d.isPaused),m.toolbar.addClass("toolbar-animationMenuplacer"),k.animTools.setVisible(!0),k.animTools.isPositionAdjusted||(h(),k.animTools.isPositionAdjusted=!0))};k.playButton.setIcon("toolbar-animationPlayIcon");m.modelTools.addControl(k.playButton);k.onExplodeChange=
function(){var c=m.impl.keyFrameAnimator;void 0!==c&&c&&(0!==c.currentTime&&(k.prevAnimationTime=c.currentTime,c.goto(0)),a(k.playButton,!0));b()};m.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,k.onExplodeChange);m.modelTools.resetModelButton&&(m.modelTools.resetModelButton.onClick=function(b){m.showAll();b=m.impl.keyFrameAnimator;void 0!==b&&b&&(b.goto(0),p.value=0,l.value=g(0),A.value=g(-b.duration),a(k.playButton,!0));c(0,!0);f(p)});k.animTools.backwardButton=new n.Button("toolbar-animationBackward");
k.animTools.backwardButton.setToolTip("Previous keyframe");k.animTools.backwardButton.onClick=function(b){b=m.impl.keyFrameAnimator;void 0!==b&&b&&(b.prev(),p.value=0<b.duration?b.currentTime/b.duration*100:0,l.value=g(b.currentTime),A.value=g(b.currentTime-b.duration),a(k.playButton,b.isPaused),f(p))};k.animTools.backwardButton.addClass("toolbar-animationButton");k.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon");k.animTools.addControl(k.animTools.backwardButton);k.animTools.forwardButton=
new n.Button("toolbar-animationForward");k.animTools.forwardButton.setToolTip("Next keyframe");k.animTools.forwardButton.onClick=function(b){b=m.impl.keyFrameAnimator;void 0!==b&&b&&(b.next(),p.value=0<b.duration?b.currentTime/b.duration*100:0,l.value=g(b.currentTime),A.value=g(b.currentTime-b.duration),a(k.playButton,b.isPaused),f(p))};k.animTools.forwardButton.addClass("toolbar-animationButton");k.animTools.forwardButton.setIcon("toolbar-animationForwardIcon");k.animTools.addControl(k.animTools.forwardButton);
k.animTools.timeText=new n.Control("toolbar-animationTimeLapse");var l=document.createElement("input");l.type="text";l.value="0";l.className="animationTimeLapse";l.disabled=!0;k.animTools.timeText.container.appendChild(l);k.animTools.timeText.addClass("toolbar-animationButton");k.animTools.addControl(k.animTools.timeText);k.animTools.timeline=new n.Control("toolbar-animationTimeline");var p=k.animTools.input=document.createElement("input");p.type="range";p.value="0";p.className="animationTimeline";
k.animTools.timeline.container.appendChild(p);p.addEventListener("input",function(b){b=m.impl.keyFrameAnimator;if(void 0!==b&&b){var c=p.value*b.duration/100;l.value=g(c);A.value=g(c-b.duration);b.goto(c);a(k.playButton,b.isPaused);f(p)}});var r=document.createElement("div");r.className="adsk-control-tooltip";r.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub");k.animTools.timeline.container.appendChild(r);p.addEventListener("mouseover",function(a){a.target===p&&(r.style.visibility=
"visible")});p.addEventListener("mouseout",function(a){a.target===p&&(r.style.visibility="hidden")});k.animTools.timeline.addClass("toolbar-animationButton");k.animTools.timeline.addClass("toolbar-animationTimeline");k.animTools.addControl(k.animTools.timeline);k.animTools.timeLeftText=new n.Control("toolbar-animationRemainingTime");var A=document.createElement("input");A.type="text";A.value="0";A.className="animationTimeLapse";A.disabled=!0;k.animTools.timeLeftText.container.appendChild(A);k.animTools.timeLeftText.addClass("toolbar-animationButton");
k.animTools.addControl(k.animTools.timeLeftText);k.animTools.closeButton=new n.Button("toolbar-animationClose");k.animTools.closeButton.setToolTip("Close animation timeline");k.animTools.closeButton.onClick=function(a){b()};k.animTools.closeButton.setIcon("toolbar-animationCloseIcon");k.animTools.closeButton.addClass("toolbar-animationButton");k.animTools.addControl(k.animTools.closeButton);k.onEscape=function(c){c=m.impl.keyFrameAnimator;void 0!==c&&c&&(c.isPaused?b():c.pause(),a(k.playButton,c.isPaused))};
m.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,k.onEscape);k.onCameraChange=function(){if(m.toolController.cameraUpdated){var a=m.impl.keyFrameAnimator;void 0!==a&&a&&(!a.isPlaying||a.isPaused||a.areCameraAnimationsPaused||a.pauseCameraAnimations())}};m.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,k.onCameraChange);k.onResize=function(){m.container.clientWidth<(isTouchDevice()?560:600)?k.toolbar.setCollapsed(!0):(k.toolbar.setCollapsed(!1),h())};m.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,
k.onResize)}function h(){var a=m.toolbar.getDimensions().width,b=m.container.getBoundingClientRect().width;a>b&&(a=m.modelTools.getDimensions().width);b=a-(2*k.animTools.backwardButton.getDimensions().width+3*k.animTools.timeText.getDimensions().width+k.animTools.closeButton.getDimensions().width)+12;k.animTools.input.style.width=b+"px";k.toolbar.container.style.left="calc(50% - "+a/2+"px)"}var k=this,m=this.viewer,n=Autodesk.Viewing.UI;this.viewer.toolbar&&this.viewer.toolbar.modelTools&&0<this.viewer.toolbar.modelTools.getNumberOfControls()?
d():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,d);return!0};
Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype.unload=function(){var a=this.viewer,b=a.impl.keyFrameAnimator;b&&b.stop();a.impl.keyFrameAnimator=null;this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),
this.animTools.removeControl(this.animTools.closeButton.getId()));this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null);(b=a.getToolbar(!1))&&b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId());a.removeEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeChange);a.removeEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscape);a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,
this.onCameraChange);a.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize);return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",Autodesk.Viewing.Extensions.Fusion360.AnimationExtension);
function init_WarpShader(){"undefined"===typeof window.WarpShader&&(WarpShader={uniforms:{tDiffuse:{type:"t",value:null},scale:{type:"v2",value:new THREE.Vector2(1,1)},scaleIn:{type:"v2",value:new THREE.Vector2(1,1)},lensCenter:{type:"v2",value:new THREE.Vector2(0,0)},hmdWarpParam:{type:"v4",value:new THREE.Vector4(1,.22,.24,0)},chromAbParam:{type:"v4",value:new THREE.Vector4(.996,-.004,1.014,0)}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 scale;\nuniform vec2 scaleIn;\nuniform vec2 lensCenter;\nuniform vec4 hmdWarpParam;\nuniform vec4 chromAbParam;\nvarying vec2 vUv;\nvec4 sampleColor() {\nvec2 uv = (vUv*2.0)-1.0;\nvec2 theta = (uv-lensCenter)*scaleIn;\nfloat rSq = theta.x*theta.x + theta.y*theta.y;\nvec2 rvector = theta*(hmdWarpParam.x + hmdWarpParam.y*rSq + hmdWarpParam.z*rSq*rSq + hmdWarpParam.w*rSq*rSq*rSq);\n  vec2 rBlue = rvector * (chromAbParam.z + chromAbParam.w * rSq);\n  vec2 tcBlue = (lensCenter + scale * rBlue);\n  tcBlue = (tcBlue+1.0)/2.0;\n  if (any(bvec2(clamp(tcBlue, vec2(0.0,0.0), vec2(1.0,1.0))-tcBlue)))\n    return vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 tcGreen = lensCenter + scale * rvector;\n  tcGreen = (tcGreen+1.0)/2.0;\n  vec2 rRed = rvector * (chromAbParam.x + chromAbParam.y * rSq);\n  vec2 tcRed = lensCenter + scale * rRed;\n  tcRed = (tcRed+1.0)/2.0;\n  return vec4(texture2D(tDiffuse, tcRed).r, texture2D(tDiffuse, tcGreen).g, texture2D(tDiffuse, tcBlue).b, 1);\n}\nvoid main() {\nvec4 texel = sampleColor();\ngl_FragColor = texel;\n}"})}
AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus");
Autodesk.Viewing.Extensions.Oculus.StereoRenderContext=function(a){var b,c,f,g,d,h,k,m,n,q,l=a?a.useWarp:!0,p=a&&a.HMD?a.HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.0635,lensSeparationDistance:.0635,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},r,A,C=1,H=0,z=100,t=1;this.init=function(a,b,c){init_WarpShader();d=a;h=b;k=c;m=d.getPixelRatio();t=p.hResolution/(2*p.vResolution);a=-1-4*(p.hScreenSize/
4-p.lensSeparationDistance/2)/p.hScreenSize;C=p.distortionK[0]+p.distortionK[1]*Math.pow(a,2)+p.distortionK[2]*Math.pow(a,4)+p.distortionK[3]*Math.pow(a,6);z=THREE.Math.radToDeg(2*Math.atan2(p.vScreenSize*C,2*p.eyeToScreenDistance));H=4*(p.hScreenSize/4-p.interpupillaryDistance/2)/p.hScreenSize;a=4*(p.hScreenSize/4-p.lensSeparationDistance/2)/p.hScreenSize;r=new THREE.Vector2(a,0);A=new THREE.Vector2(-a,0);f=new RenderContext;g=new RenderContext;f.settings.sao=g.settings.sao=!1;f.settings.antialias=
g.settings.antialias=!1;f.settings.customPresentPass=g.settings.customPresentPass=l;f.init(d,h/2*C/m,k*C/m);g.init(d,k/2*C/m,k*C/m);this.settings=f.settings;if(l){n=new LmvShaderPass(WarpShader);q=new LmvShaderPass(WarpShader);a=[n,q];for(b=0;2>b;b++)a[b].material.blending=THREE.NoBlending,a[b].material.depthWrite=!1,a[b].material.depthTest=!1,a[b].uniforms.hmdWarpParam.value.set(p.distortionK[0],p.distortionK[1],p.distortionK[2],p.distortionK[3]),a[b].uniforms.chromAbParam.value.set(p.chromaAbParameter[0],
p.chromaAbParameter[1],p.chromaAbParameter[2],p.chromaAbParameter[3]),a[b].uniforms.scaleIn.value.set(1,1/t),a[b].uniforms.scale.value.set(1/C,1*t/C);a[0].uniforms.lensCenter.value.copy(r);a[1].uniforms.lensCenter.value.copy(A)}};this.update=function(a){var b=f.update(a);a=g.update(a);return b||a};this.beginScene=function(a,d,h,k){b=d.clone();c=d.clone();b.aspect=c.aspect=t;b.fov=c.fov=z;var l=1/f.getUnitScale();d=d.target.clone().sub(d.position).cross(d.up).normalize();d.multiplyScalar(.5*p.interpupillaryDistance*
l);b.position.sub(d);c.position.add(d);b.target.sub(d);c.target.add(d);b.toPerspective();c.toPerspective();b.projectionMatrix.elements[12]+=H;c.projectionMatrix.elements[12]-=H;f.beginScene(a,b,h,k);g.beginScene(a,c,h,k)};this.renderScenePart=function(a,b,c,d){f.renderScenePart(a,b,c,d);g.renderScenePart(a,b,c,d)};this.sceneDirty=function(a,b){f.sceneDirty(a,b);g.sceneDirty(a,b)};this.endScene=function(){f.endScene();g.endScene()};this.clearAllOverlays=function(){f.clearAllOverlays();g.clearAllOverlays()};
this.renderOverlays=function(a){f.renderOverlays(a);g.renderOverlays(a)};this.composeFinalFrame=function(a,b){f.composeFinalFrame(a,b,!0);g.composeFinalFrame(a,b,!0);d.setViewport(0,0,h/2,k);f.presentBuffer(n);d.setViewport(h/2,0,h/2,k);g.presentBuffer(q);d.setViewport(0,0,h,k)};this.cleanup=function(){f.cleanup();g.cleanup()};this.setSize=function(a,b,c){h=a;k=b;f.setSize(h/2*C/m,k*C/m,c);g.setSize(h/2*C/m,k*C/m,c);d.setSize(a,b)};this.getMaxAnisotropy=function(){return f.getMaxAnisotropy()};this.hasMRT=
function(){return f.hasMRT()};this.initPostPipeline=function(a,b,c){c=b=a=!1;f.initPostPipeline(a,b,c);g.initPostPipeline(a,b,c)};this.setClearColors=function(a,b){f.setClearColors(a,b);g.setClearColors(a,b)};this.setAOOptions=function(a,b){f.setAOOptions(a,b);g.setAOOptions(a,b)};this.getAORadius=function(){return f.getAORadius()};this.getAOIntensity=function(){return f.getAOIntensity()};this.setTonemapExposureBias=function(a){f.setTonemapExposureBias(a);g.setTonemapExposureBias(a)};this.getExposureBias=
function(){return f.getExposureBias()};this.setTonemapMethod=function(a){f.setTonemapMethod(a);g.setTonemapMethod(a)};this.getToneMapMethod=function(){return f.getToneMapMethod()};this.toggleTwoSided=function(a){f.toggleTwoSided(a);g.toggleTwoSided(a)};this.enter2DMode=function(a){f.enter2DMode(a);g.enter2DMode(a)};this.idAtPixel=function(a,b){console.warn("idAtPixel not implemented in stereo context.");return 0};this.overlayUpdate=function(a){f.overlayUpdate(a);g.overlayUpdate(a)};this.rolloverObjectViewport=
function(a,b){console.warn("rolloverObjectViewport not implemented in stereo context")};this.screenCapture=function(){console.warn("Screen capture not implemented by stereo render context");return null};this.setUnitScale=function(a){f.setUnitScale(a);g.setUnitScale(a)};this.getUnitScale=function(){return f.getUnitScale()}};AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus");
(function(){function a(a){function b(){H.copy(d.matrixWorld);H.elements[12]=0;H.elements[13]=0;H.elements[14]=0;t&&C.set(t[1],t[2],t[3])}function c(){var a=new WebSocket("ws://localhost:8888/ws");a.onopen=function(){console.log("### Oculus Connected ####")};a.onmessage=function(a){a=a.data;try{t=JSON.parse(a)}catch(b){console.log(a)}};a.onclose=function(){console.log("### Oculus Connection Closed ####")};O=a}var d,f=new THREE.Vector3(0,0,0),g=new THREE.Quaternion,r=new THREE.Quaternion,A=new THREE.Matrix4,
C=new THREE.Vector3(0,0,0),H=new THREE.Matrix4,z=new THREE.Matrix4,t,w=0,E=1,B=10,D=-1,J=0,F=0,G=0,M=0,I=0,L=0,K=0,O;h?t=[0,0,0,0,0,0,0,0]:c();this.getNames=function(){return["headtracker"]};this.getName=function(){return"headtracker"};this.activate=function(c){d=a.navigation.getCamera();b();a.model&&(E=1/a.model.getUnitScale(),B=1E-4*a.model.getBoundingBox().size().length())};this.deactivate=function(a){d=null};this.update=function(b){0>D&&(D=b);var c=b-D;d.isPerspective||a.navigation.toPerspective();
if(h){var m=h.getState();t[0]=w+1;m.orientation&&(t[4]=m.orientation.x,t[5]=m.orientation.y,t[6]=m.orientation.z,t[7]=m.orientation.w);m.position&&(t[1]=m.position.x,t[2]=m.position.y,t[3]=m.position.z)}if(t){m=t[0];if(m>w){d.position.sub(f);f.set(t[1],t[2],t[3]);f.sub(C);f.multiplyScalar(E);f.applyMatrix4(H);d.position.add(f);J+=(L-K)*c*.001;r.setFromAxisAngle(d.worldup,J);g.set(t[4],t[5],t[6],t[7]);r.multiply(g);z.makeRotationFromQuaternion(r);A.multiplyMatrices(H,z);var n=A.elements,fa=new THREE.Vector3(-n[8],
-n[9],-n[10]),U=d.target.clone().sub(d.position).length();d.up.set(n[4],n[5],n[6]);var n=new THREE.Vector3(n[0],n[1],n[2]),P=fa.clone().multiplyScalar((F-M)*c*B);d.position.add(P);c=n.multiplyScalar((I-G)*c*B);d.position.add(c);d.target.set(d.position.x,d.position.y,d.position.z);d.target.add(fa.multiplyScalar(U))}w=m}O&&1===O.readyState&&O.send("get\n");D=b;return!0};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};
this.handleDoubleTap=function(a,b){return!1};this.handleKeyDown=function(a,b){var c=!1;switch(b){case 38:case 87:F=1;c=!0;break;case 40:case 83:M=1;c=!0;break;case 37:case 65:G=1;c=!0;break;case 39:case 68:I=1;c=!0;break;case 81:L=1;c=!0;break;case 69:K=1,c=!0}return c};this.handleKeyUp=function(a,c){var d=!1;switch(c){case 38:case 87:F=0;d=!0;break;case 40:case 83:M=0;d=!0;break;case 37:case 65:G=0;d=!0;break;case 39:case 68:I=0;d=!0;break;case 81:L=0;d=!0;break;case 69:K=0;d=!0;break;case 32:b(),
d=!0}return d};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(a){return!1};this.handleGesture=function(a,b){return!1};this.handleTouchChange=function(a,b){return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,f=b.UI,g=c.Oculus,d=null,h=null;g.Oculus=function(a,c){b.Extension.call(this,a,c);this.viewer=a;this.context=null;
this.initialized=!1};g.Oculus.prototype=Object.create(b.Extension.prototype);g.Oculus.prototype.constructor=c.Oculus;g.Oculus.prototype.toggleOculus=function(b){var c=this.viewer;b?this.context||(this.context=new g.StereoRenderContext({useWarp:!d}),c.impl.setUserRenderContext(this.context),c.resize(c.canvas.clientWidth,c.canvas.clientHeight),c.displayViewCube(!1,!1),c.navigation.isPerspective||c.navigation.toPerspective(),d?launchFullscreen(c.impl.canvas,{vrDisplay:d}):launchFullscreen(c.impl.canvas),
this.headTracker||(this.headTracker=new a(c),c.toolController.registerTool(this.headTracker)),c.toolController.activateTool("headtracker")):this.context&&(this.context=null,c.impl.setUserRenderContext(null),c.displayViewCube(c.prefs.get("viewCube"),!1),c.toolController.deactivateTool("headtracker"),exitFullscreen())};g.Oculus.prototype.createUI=function(){var a=this,b=this.viewer;this.oculusButton=new f.Button("toolbar-oculusTool");this.oculusButton.setToolTip("Oculus VR Mode");this.oculusButton.setIcon("oculusIcon");
this.oculusButton.onClick=function(b){a.toggleOculus(!a.context)};b.modelTools.addControl(this.oculusButton)};g.Oculus.prototype.load=function(){function a(c){f.removeEventListener(b.TOOLBAR_CREATED_EVENT,a);g.createUI()}function c(l){for(var m=0;m<l.length;++m)if(l[m]instanceof HMDVRDevice){d=l[m];break}if(d){for(m=0;m<l.length;++m)if(l[m]instanceof PositionSensorVRDevice&&l[m].hardwareUnitId==d.hardwareUnitId){h=l[m];break}d&&h?f.modelTools&&0<f.modelTools.getNumberOfControls()?g.createUI():f.addEventListener(b.TOOLBAR_CREATED_EVENT,
a):stderr("Didn't find a HMD and sensor!");g.initialized=!0}}var f=this.viewer,g=this;navigator.getVRDevices?navigator.getVRDevices().then(c):navigator.mozGetVRDevices?navigator.mozGetVRDevices(c):this.initialized=!0;return!0};g.Oculus.prototype.unload=function(){this.toggleOculus(!1);return!0};b.theExtensionManager.registerExtension("Autodesk.Viewing.Oculus",g.Oculus)})();AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration");
(function(){var a=Autodesk.Viewing,b=a.Private,c=a.Extensions.Collaboration;c.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]};this.getName=function(){return"intercept"};this.activate=function(a){};this.deactivate=function(a){};this.update=function(a){return!1};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};this.handleDoubleTap=function(a,b){return!1};this.handleKeyDown=function(a,
b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(b){a.takeControl();return!1};this.handleButtonDown=function(b,c){a.takeControl();return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(b){a.updatePointer(b);return!1};this.handleGesture=function(b){a.takeControl();return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}};c.ViewTransceiver=function(c){function g(a){r=!0;a=JSON.parse(a.data.msg);B.restoreState(a);
p.impl.invalidate(!0,!1,!0);r=!1}function d(a){for(var b=0;b<a.length;b++)a[b]=Math.round(1E3*a[b])/1E3}function h(a){var b=a.data.msg;!0===b[1]||C||(b[0]!=H&&(H=b[0],a.data.lastInControl=b[0],l.dispatchEvent({type:"controlChange",channelId:l.channelId,data:a.data})),A=!1,p.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),p.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function k(a){if(A||C)a=a.camera,a=[a.position.x,a.position.y,
a.position.z,a.target.x,a.target.y,a.target.z,a.up.x,a.up.y,a.up.z],d(a),a.unshift(C),a.unshift(c.getLocalId()),z.sendMessage("camera",a,l.channelId),H!=a[0]&&(H=a[0],l.dispatchEvent({type:"controlChange",channelId:l.channelId,data:{lastInControl:H}}))}function m(a,b,c){a&&!w&&(w=document.createElement("div"),w.classList.add("collabPointer"));a&&!E?(p.container.appendChild(w),E=!0):!a&&E&&(p.container.removeChild(w),E=!1);a&&(w.style.left=b-6+"px",w.style.top=c-6+"px")}function n(a){A||C||(a=a.data.msg,
t.origin.set(a[1],a[2],a[3]),t.direction.set(a[4],a[5],a[6]),a=t.at(p.getCamera().near),a.project(p.getCamera()),a=p.impl.viewportToClient(a.x,a.y),m(!0,a.x,a.y))}function q(a){r||(a=B.getState(D),c.sendMessage("state",JSON.stringify(a),l.channelId))}var l=this,p=this.viewer=null,r=!1,A=!1,C=!1,H,z=this.client=c,t=new THREE.Ray,w=null,E=!1;this.channelId=null;var B,D={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};
this.takeControl=function(){A=!0;m(!1)};this.updatePointer=function(a){A&&(a=p.impl.clientToViewport(a.canvasX,a.canvasY),p.impl.viewportToRay(a,t),a=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z],d(a),a.unshift(c.getLocalId()),z.sendMessage("pointer",a,l.channelId))};this.connectCamera=function(a){C=!a};this.attach=function(c){p&&this.detach();this.viewer=p=c;B=new b.ViewerState(p);z.addEventListener("cameraChange",h);z.addEventListener("pointerMove",n);z.addEventListener("viewerState",
g);p.hasEventListener(a.CAMERA_CHANGE_EVENT,k)||p.addEventListener(a.CAMERA_CHANGE_EVENT,k);p.hasEventListener(a.SELECTION_CHANGED_EVENT,q)||(p.addEventListener(a.SELECTION_CHANGED_EVENT,q),p.addEventListener(a.ISOLATE_EVENT,q),p.addEventListener(a.HIDE_EVENT,q),p.addEventListener(a.SHOW_EVENT,q),p.addEventListener(a.HIGHLIGHT_EVENT,q),p.addEventListener(a.EXPLODE_CHANGE_EVENT,q),p.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,q),p.addEventListener(a.CUTPLANES_CHANGE_EVENT,q))};this.detach=function(){z&&
(z.removeEventListener("cameraChange",h),z.removeEventListener("viewerState",g));p&&(p.removeEventListener(a.CAMERA_CHANGE_EVENT,k),p.removeEventListener(a.SELECTION_CHANGED_EVENT,q),p.removeEventListener(a.ISOLATE_EVENT,q),p.removeEventListener(a.HIDE_EVENT,q),p.removeEventListener(a.SHOW_EVENT,q),p.removeEventListener(a.HIGHLIGHT_EVENT,q),p.removeEventListener(a.EXPLODE_CHANGE_EVENT,q),p.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,q),p.removeEventListener(a.CUTPLANES_CHANGE_EVENT,q),B=
this.viewer=p=null)}};c.ViewTransceiver.prototype.constructor=c.ViewTransceiver;Autodesk.Viewing.EventDispatcher.prototype.apply(c.ViewTransceiver.prototype)})();AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration");var avec=Autodesk.Viewing.Extensions.Collaboration;avec.Panel=null;Autodesk.Viewing.startLiveReviewSession=function(){avec.Panel&&avec.Panel.startSession()};Autodesk.Viewing.endLiveReviewSession=function(){avec.Panel&&avec.Panel.endSession()};
(function(){function a(a,d,f,g){this.viewer=a;this.client=d;this.p2p=f;this.viewtx=g;c.UI.DockingPanel.call(this,a.container,"CollabPanel","Live Review");this.container.classList.add("collabPanel");this.container.style.height="auto";this.container.dockRight=!0;this.content=document.createElement("div");this.container.appendChild(this.content);this.content.classList.add("collabPanelContent");this.tableContainer=document.createElement("div");this.tableContainer.classList.add("userListTable","dockingPanelScroll");
this.table=document.createElement("table");this.table.classList.add("tftable");this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.tableContainer.appendChild(this.table);this.content.appendChild(this.tableContainer);this.inviteDiv=document.createElement("div");this.inviteDiv.className="collabBoxOK";this.inviteDiv.style.float="left";this.inviteDiv.style.width="232px";this.inviteDiv.setAttribute("data-i18n","Invite");this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite");
this.content.appendChild(this.inviteDiv);this.inviteDiv.addEventListener("click",function(c){(new b).start(a.container,function(){document.location.href="mailto:?subject=Please Join My Live Review"},"Invite Others","Email Invite",!0)});this.chatHistory=document.createElement("div");this.chatHistory.classList.add("chatHistory");this.chatHistory.classList.add("textEntry");this.chatHistory.classList.add("dockingPanelScroll");this.content.appendChild(this.chatHistory);this.chatPanel=document.createElement("div");
this.chatPanel.classList.add("chatPanel");this.textInput=document.createElement("input");this.textInput.type="text";this.textInput.classList.add("textEntry");this.textInput.placeholder="Type a message...";this.chatPanel.appendChild(this.textInput);this.content.appendChild(this.chatPanel);this.isCameraConnected=!0;var h=this;this.addEventListener(d,"userListChange",function(a){a.channelId&&a.channelId!==h.viewtx.channelId||(a=h.client.getChannelInfo(h.viewtx.channelId))&&h.updateUsers(a.users)});this.addEventListener(this.viewtx,
"controlChange",function(a){a.channelId===h.viewtx.channelId&&h.updateUserInControl(a.data.lastInControl)});this.addEventListener(d,"chatReceived",function(a){a.channelId===h.viewtx.channelId&&h.updateChatHistory(a)});this.textInput.onkeyup=function(a){h.handleChatInput(a)};this.addEventListener(this.p2p,"remoteStreamAdded",function(a){h.videoPanel||h.createVideoPanel();h.remoteVideo.src=window.URL.createObjectURL(a.data)});this.addEventListener(this.p2p,"localStreamAdded",function(a){h.videoPanel||
h.createVideoPanel();h.localVideo.src=window.URL.createObjectURL(a.data)});this.addEventListener(this.p2p,"remoteHangup",function(a){h.removeVideoPanel()})}function b(){}var c=Autodesk.Viewing,f=c.Extensions,g=c.Private,d=c.UI,h=f.Collaboration;a.prototype=Object.create(c.UI.DockingPanel.prototype);a.prototype.constructor=a;a.prototype.startSession=function(){var a=this;this.isVisible()||(new b).start(this.viewer.container,function(){a.setVisible(!0,!0)},"Start a Live Review","Start Review")};a.prototype.endSession=
function(){this.isVisible()&&(this.setVisible(!1,!0),this.reset())};a.prototype.updateUsers=function(a){for(var b=document.createElement("tbody"),c=0;c<a.length;c++){var d=b.insertRow(-1);d.id=a[c].id;var f=d.insertCell(0);f.style.width="14px";f.style.cursor="default";var g=document.createElement("div");g.classList.add("statusBase");g.classList.add("statusNormal");g.innerHTML="&#9679";f.appendChild(g);d.insertCell(1).textContent=a[c].name}this.table.replaceChild(b,this.tbody);this.tbody=b;this.fixComponentPlacement()};
a.prototype.updateUserInControl=function(a){for(var b=0;b<this.tbody.rows.length;b++){var c=this.tbody.rows[b],d=c.cells[0].childNodes[0];c.id==a?(d.classList.remove("statusNormal"),d.classList.add("statusInControl"),d.innerHTML="&#9784",c.cells[1].style.color="#4CBA36"):(d.classList.remove("statusInControl"),d.classList.add("statusNormal"),d.innerHTML="&#9679",c.cells[1].style.color="#ffffff")}};a.prototype.updateChatHistory=function(a){var b=this.client.getUserById(a.data.from,a.channelId);if("/"!=
a.data.msg.charAt(0)){if(this.chatHistory.lastUser!=b.name){var c=document.createElement("p"),d=document.createElement("div");d.classList.add("heading");d.style.float="left";d.style.fontStyle="normal";d.style.color="#857E7E";d.textContent=b.name;c.appendChild(d);d=document.createElement("div");d.classList.add("heading");d.style.textAlign="right";d.style.fontStyle="normal";d.style.color="#857E7E";d.textContent=(new Date).toLocaleTimeString();c.appendChild(d);this.chatHistory.appendChild(c);this.chatHistory.lastUser=
b.name}else b=document.createElement("br"),this.chatHistory.appendChild(b);b=document.createElement("span");b.classList.add("messageText");b.textContent=a.data.msg;this.chatHistory.appendChild(b);this.chatHistory.scrollTop=this.chatHistory.scrollHeight}};a.prototype.handleChatInput=function(a){13==a.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")};a.prototype.fixComponentPlacement=
function(a){a=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel&&(a+=this.videoPanel.offsetHeight);this.chatHistory.style.height="calc(100% - "+a+"px)"};a.prototype.createVideoPanel=function(a){this.videoPanel=document.createElement("div");this.videoPanel.classList.add("videoPanel");this.localVideo=document.createElement("video");this.localVideo.autoplay=!0;this.localVideo.muted=!0;this.localVideo.classList.add("videoInset");this.videoPanel.appendChild(this.localVideo);
this.remoteVideo=document.createElement("video");this.remoteVideo.autoplay=!0;this.remoteVideo.classList.add("videoMain");this.videoPanel.appendChild(this.remoteVideo);var b=this;a=document.createElement("div");a.classList.add("dockingPanelClose");a.innerHTML="&times";a.title="End video call";a.onclick=function(a){b.p2p.hangup();b.removeVideoPanel()};this.videoPanel.appendChild(a);this.content.insertBefore(this.videoPanel,this.chatHistory);this.fixComponentPlacement()};a.prototype.removeCollabPrompt=
function(){var a=document.getElementById("collabBox");a&&(a.style.visibility="hidden",this.viewer.container.removeChild(a))};a.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel);this.videoPanel=null};a.prototype.reset=function(a){this.tbody&&(a=document.createElement("tbody"),this.table.replaceChild(a,this.tbody),this.tbody=a);this.chatHistory.textContent="";this.textInput.value="";this.removeVideoPanel();this.removeCollabPrompt()};b.prototype.start=function(a,
b,c,d,f){if(a){var h=document.createElement("div");h.id="collabBox";h.className="collabBox";a.appendChild(h);var r=document.createElement("div");r.className="collabBoxTitle";r.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c});h.appendChild(r);c=document.createElement("span");c.className="collabBoxText";r="Enter your name:";f&&(r="Review URL");c.textContent=Autodesk.Viewing.i18n.translate(r,{defaultValue:r});h.appendChild(c);c=document.createElement("span");c.className="collabBoxInputContainer";
h.appendChild(c);var A=document.createElement("input");A.type="text";A.className="collabBoxInputText";f&&(r=window.location.toString(),r=-1==r.indexOf("?")?r+"?invited=true":r+"&invited=true",Autodesk.Viewing.Private.docItemId&&(r+="&itemid="+Autodesk.Viewing.Private.docItemId),A.value=r+"&doNotRedirect=true");c.appendChild(A);A.onkeyup=function(c){13==c.keyCode&&(h.style.visibility="hidden",a.removeChild(h),g.setUserName(A.value),b())};c=document.createElement("div");c.className="collabBoxClose";
c.innerHTML="&times;";c.addEventListener("click",function(b){h.style.visibility="hidden";a.removeChild(h)});h.appendChild(c);f?(c=document.createElement("span"),c.className="collabBoxText",c.style.marginTop="0px",r="Copy and send this URL to invite others",c.textContent=Autodesk.Viewing.i18n.translate(r,{defaultValue:r})):(c=document.createElement("div"),c.className="collabBoxOK",c.textContent=Autodesk.Viewing.i18n.translate(d,{defaultValue:d}),c.addEventListener("click",function(c){h.style.visibility=
"hidden";a.removeChild(h);""!==A.value.trim()&&g.setUserName(A.value);b()}));h.appendChild(c);h.style.visibility="visible";A.focus();f&&A.select()}};f.Collaboration.Collaboration=function(a,b){c.Extension.call(this,a,b);b&&b.rtc&&b.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0);this.viewer=a};f.Collaboration.Collaboration.prototype=Object.create(c.Extension.prototype);f.Collaboration.Collaboration.prototype.constructor=f.Collaboration.Collaboration;f.Collaboration.Collaboration.prototype.initNetwork=
function(a){if(!this.p2p||a)this.viewtx=new h.ViewTransceiver(this.client),this.interceptor=new h.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new g.P2PClient(this.client)};f.Collaboration.Collaboration.prototype.createUI=function(){var c=this,h=this.viewer;this.initNetwork(!1);this.panel=new a(this.viewer,this.client,this.p2p,this.viewtx);f.Collaboration.Collaboration.Panel=this.panel;this.collabButton=new d.Button("toolbar-collaborateTool");
this.collabButton.setToolTip("Live review");this.collabButton.setIcon("adsk-icon-live-review");this.collabButton.onClick=function(a){c.panel.isVisible()?(c.panel.setVisible(!1,!0),c.panel.reset()):(new b).start(h.container,function(){c.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")};this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0);this.panel.addVisibilityListener(function(a){a?(h.model&&(a=h.model.getData(),c.viewtx.channelId=a.basePath,c.viewtx.attach(h),c.client.connect(c.viewtx.channelId),
c.client.join(c.viewtx.channelId)),h.toolController.activateTool(c.interceptor.getName()),c.collabButton.setState(d.Button.State.ACTIVE),g.logger&&g.logger.log({category:"viewer_rtc_start"})):(g.logger&&c.client.isConnected()&&g.logger.log({category:"viewer_rtc_stop"}),c.p2p.hangup(),c.viewtx.detach(h),c.viewtx.channelId=null,c.client.disconnect(),c.panel.reset(),h.toolController.deactivateTool(c.interceptor.getName()),c.collabButton.setState(d.Button.State.INACTIVE))});h.modelTools.addControl(this.collabButton);
Autodesk.Viewing.Private.getParameterByName("invited")&&(new b).start(h.container,function(){c.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")};f.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0);this.panel.reset()};f.Collaboration.Collaboration.prototype.load=function(){var a=this.viewer,b=this;g.loadDependency("io","socket.io-1.3.5.js",function(){function c(d){a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,c);b.createUI()}b.client=g.MessageClient.GetInstance(b.options?
b.options.messageServerURL:void 0);b.client.addEventListener("socketError",function(c){g.ErrorHandler.reportError(a.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,c.data);b.close()});b.presenceChannelId=window.location.host;b.client.isConnected();a.modelTools?b.createUI():a.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,c)});return!0};f.Collaboration.Collaboration.prototype.unload=function(){var a=this.viewer;this.p2p.hangup();this.viewtx.detach(a);this.client.disconnect();a.toolController.deactivateTool(this.interceptor.getName());
this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null);a.modelTools.removeControl(this.collabButton.getId());this.collabButton=null;return!0};c.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",f.Collaboration.Collaboration)})();"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension;
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(b.impl,b);b.toolController.registerTool(this.tool);this.createUI(c);var g;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";c=[];c.push({keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:function(){g=b.getActiveNavigationTool();b.setActiveNavigationTool(a.tool.getName());
return!0},onRelease:function(){b.setActiveNavigationTool(g?g:b.defaultNavigationToolName);return!0}});Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,c);this.onToolChanged=function(b){-1!==b.toolName.indexOf("beeline")&&a.beelineButton.setState(b.active?f.Button.State.ACTIVE:f.Button.State.INACTIVE)};b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);return!0};
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(a){var b=Autodesk.Viewing.UI;a=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);var c=this.viewer,f=new b.Button("toolbar-beelineTool");f.setToolTip("Walk to");f.setIcon("adsk-icon-walk");f.onClick=function(a){a=f.getState();a===b.Button.State.INACTIVE?c.setActiveNavigationTool("beeline"):a===b.Button.State.ACTIVE&&c.setActiveNavigationTool()};this.beelineButton=f;var g=a.getControl("toolbar-cameraSubmenuTool");g?a.addControl(this.beelineButton,
{index:a.indexOf(g.getId())}):a.addControl(this.beelineButton);var d=this,h=function(){c.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,h);var a=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,b=c.getSettingsPanel(!0);d.viewerOption_LookHorId=b.addCheckbox(a,"Reverse horizontal look direction",!1,function(a){c.setReverseHorizontalLookDirection(a)},"reverseHorizontalLookDirection");d.viewerOption_LookVertId=b.addCheckbox(a,"Reverse vertical look direction",!1,function(a){c.setReverseVerticalLookDirection(a)},
"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?h():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,h)};
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);this.onToolChanged=void 0;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId());this.beelineButton=null;this.viewer.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId);this.viewer.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId);
a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool();a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");
Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(a,b){function c(){h.revertToStartState()}function f(a){var b={};b.target=a.target.clone();b.worldup=a.worldup.clone();b.position=a.position.clone();b.up=a.up.clone();for(var c="isPerspective fov zoom aspect left right top bottom".split(" "),d=0;d<c.length;d++)b[c[d]]=a[c[d]];return b}function g(b){var c=new THREE.Vector3(b.x,b.y,1),d=a.hitTestViewport(c.clone(),!1);if(!d||!d.intersectPoint)return[];b=new THREE.Raycaster;var c=c.clone(),f=a.camera,
g=new THREE.Vector3(c.x,c.y,1);c.z=-1;c=c.unproject(f);g=g.unproject(f);g.sub(c).normalize();b.set(n.isPerspective?f.position:c,g);c=[];d=d.fragId instanceof Array?d.fragId:[d.fragId];for(f=0;f<d.length;f++)g=a.getRenderProxy(this.model,d[f]),VBIntersector.meshRayCast(g,b,c);c.sort(function(a,b){return a.distance-b.distance});return c}function d(){n.isPerspective||(n.toPerspective(),q.activatePivot(!1));28<n.getFocalLength()&&n.setFocalLength(28,!0)}var h=this,k=b.container,m=b.autocam,n=b.navigation,
q=b.utilities,l=["beeline"],p=0,r=!1,A=0,C=null,H=null,z=new THREE.Vector3,t=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3,B=!1,D=new THREE.Vector3,J=new THREE.Vector3,F=null,G=null;this.getNames=function(){return l};this.getName=function(){return l[0]};this.activate=function(a){A=0;b.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c);m.userLookSpeed=.8;this.showHUDMessage(!0)};this.deactivate=function(){b.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c);this.revertToStartState();
this.showHUDMessage(!1)};this.getCursor=function(){return r?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":
1>=A?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":
null};this.update=function(){var a=n.getCamera(),c=r=!1;if(1===A){var d=D.clone().sub(J);if(0!==d.x||0!==d.y){r=!0;J.x+=.7*d.x;J.y+=.7*d.y;var c=n.getWorldUpVector().dot(n.getCameraUpVector()),g=b.prefs.reverseHorizontalLookDirection?-1:1,h=b.prefs.reverseVerticalLookDirection?-1:1;d.x*=0>c?-g:g;d.y*=h;m.sync(n.getCamera());m.look(d);c=!0;F=f(a)}}return c};this.revertToStartState=function(){q.pivotActive(!1);p=0;B=!0};this.attemptFlight=function(a,b){var c=g(a);0<c.length&&(z=c[0].point,t=c[c.length-
1].point,h.fly(1E3,b))};this.fly=function(a,b){q.setPivotPoint(0===b?z:t,!0,!0);d();w=n.getPosition();H=a;switch(b){case 0:E=w.clone().lerp(z,.8);break;case 1:var c=2*m.camera.near,f=t.clone().sub(w).length(),c=c/f;q.setPivotPoint(w.clone().lerp(t,1+10*c),!0,!0);E=w.clone().lerp(t,1+c);break;default:return}p=1;B=!1;C=null;requestAnimationFrame(h.step)};this.step=function(a){var b=n.getCamera();if(!B){if(null===C)F=f(b),C=a;else{var c;a:if(c=F,b.target.equals(c.target)&&b.position.equals(c.position)&&
b.worldup.equals(c.worldup)&&b.up.equals(c.up)){for(var d="isPerspective fov zoom aspect left right top bottom".split(" "),g=0;g<d.length;g++)if(b[d[g]]!==c[d[g]]){c=!1;break a}c=!0}else c=!1;if(!c){h.revertToStartState();return}}a-=C;c=a<H?a/H:1;c=w.clone().lerp(E,c);d=n.getEyeVector();d.multiplyScalar(n.getPivotPoint().sub(n.getPosition()).length()/d.length());n.setView(c,d.add(c));F=f(b);q.activatePivot(!1);a<H?requestAnimationFrame(h.step):h.revertToStartState()}};this.handleGesture=function(a){switch(a.type){case "dragstart":return G=
"drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===G?this.handleMouseMove(a):!1;case "dragend":if("drag"===G)return this.handleButtonUp(a,0),G=null,!0}return!1};this.handleButtonDown=function(a,b){A+=1<<b;return 0===b?(J.x=D.x=a.canvasX,J.y=D.y=a.canvasY,!0):!1};this.handleButtonUp=function(a,b){A-=1<<b;return 0===b?!0:!1};this.handleSingleClick=function(a,b){if(0===b){var c={x:a.normalizedX,y:a.normalizedY};switch(p){case 0:h.attemptFlight(c,0);break;case 1:h.revertToStartState()}}else return this.revertToStartState(),
!1;return!0};this.handleSingleTap=function(a){return this.handleSingleClick(a,0)};this.handleDoubleTap=function(a){return a.pointers&&1===a.pointers.length?(h.attemptFlight({x:a.normalizedX,y:a.normalizedY},1),!0):!1};this.handleDoubleClick=function(a,b){return 0===b?(h.attemptFlight({x:a.normalizedX,y:a.normalizedY},1),!0):!1};this.handleMouseMove=function(a){D.x=a.canvasX;D.y=a.canvasY;return 1===A?(d(),!0):!1};this.handleBlur=function(a){this.revertToStartState();return!1};this.showOrthoWarningMessage=
function(){Autodesk.Viewing.Private.HudMessage.displayMessage(k,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."})};this.showFocalWarningMessage=function(){Autodesk.Viewing.Private.HudMessage.displayMessage(k,{msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."})};
this.watchCamera=function(a){if(b.toolController.getActiveToolName()===l[0]||b.toolController.getActiveToolName()===l[1]){a=(a=n.getCamera())&&!a.isPerspective;var c=28<n.getFocalLength();a?h.showOrthoWarningMessage():c?h.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}};this.showHUDMessage=function(a){var c=n.getCamera(),c=c&&!c.isPerspective,d=28<n.getFocalLength();a&&c?h.showOrthoWarningMessage():a&&d?h.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss();
a?b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,h.watchCamera):b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,h.watchCamera)}};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools");
(function(){function a(a,b,c){return function(){var k=b.getState();k===f.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(f.Button.State.ACTIVE)):k===f.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(f.Button.State.INACTIVE))}}var b=Autodesk.Viewing,c=Autodesk.Viewing.Extensions.DefaultTools,f=Autodesk.Viewing.UI;c.NavToolsExtension=function(a,c){b.Extension.call(this,a,c)};c.NavToolsExtension.prototype=Object.create(b.Extension.prototype);c.NavToolsExtension.prototype.constructor=
c.NavToolsExtension;c.NavToolsExtension.prototype.load=function(){var a=this.viewer,c=new b.FovTool(a),f=new b.WorldUpTool(a.impl,a);a.toolController.registerTool(c);a.toolController.registerTool(f);this.createUI();this.initCameraStateMachine();this.initFocalLengthOverlay();return!0};c.NavToolsExtension.prototype.createUI=function(){var c=this.viewer,d=c.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID);d.returnToDefault=function(){};if("3d"===this.options.mode){var h=new f.ComboButton("toolbar-orbitTools");
h.setToolTip("Orbit");h.setIcon("adsk-icon-orbit-constrained");this.createOrbitSubmenu(h);d.addControl(h);d.orbittoolsbutton=h;h.setState(f.Button.State.ACTIVE);d.returnToDefault=function(){h.setState(f.Button.State.ACTIVE)}}var k=new f.Button("toolbar-panTool");k.setToolTip("Pan");k.setIcon("adsk-icon-pan");k.onClick=a(c,k,"pan");d.addControl(k);d.panbutton=k;k=new f.Button("toolbar-zoomTool");k.setToolTip("Zoom");k.setIcon("adsk-icon-zoom");k.onClick=a(c,k,"dolly");d.addControl(k);d.dollybutton=
k;c=new f.ComboButton("toolbar-cameraSubmenuTool");c.setToolTip("Camera interactions");c.setIcon("adsk-icon-camera");this.createCameraSubmenu(c);d.addControl(c);d.camerabutton=c};c.NavToolsExtension.prototype.createOrbitSubmenu=function(c){var d=this.viewer,h=d.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID),k=new f.Button("toolbar-freeOrbitTool");k.setToolTip("Free orbit");k.setIcon("adsk-icon-orbit-free");k.onClick=a(d,k,"freeorbit");c.addControl(k);h.freeorbitbutton=k;k=new f.Button("toolbar-orbitTool");
k.setToolTip("Orbit");k.setIcon("adsk-icon-orbit-constrained");k.onClick=a(d,k,"orbit");c.addControl(k);h.orbitbutton=k;c.onClick=k.onClick};c.NavToolsExtension.prototype.createCameraSubmenu=function(c){var d=this,h=this.viewer,k=h.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID);if(isTouchDevice()){var m=new f.Button("toolbar-homeTool");m.setToolTip("Home");m.setIcon("adsk-icon-home");m.onClick=function(){h.navigation.setRequestHomeView(!0)};c.addControl(m);k.homebutton=m}m=new f.Button("toolbar-fitToViewTool");
m.setToolTip("Fit to view");m.setIcon("adsk-icon-fit-to-view");m.onClick=function(a){h.fitToView("3d"===d.options.mode?h.getSelection():void 0)};c.addControl(m);k.fovbutton=m;"3d"===this.options.mode&&(m=new f.Button("toolbar-focalLengthTool"),m.setToolTip("Focal length"),m.setIcon("adsk-icon-fov"),m.onClick=a(h,m,"fov"),c.addControl(m),k.fovbutton=m);m=new f.Button("toolbar-rollTool");m.setToolTip("Roll");m.setIcon("adsk-icon-roll");m.onClick=a(h,m,"worldup");c.addControl(m);k.rollbutton=m};c.NavToolsExtension.prototype.initCameraStateMachine=
function(a){var c=this,f=this.viewer,k=f.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(a){"fov"===a.toolName&&c.showFocalLengthOverlay(a.active)};f.addEventListener(b.TOOL_CHANGE_EVENT,this.toolChangedHandler);this.navChangedHandler=function(a){f.getDefaultNavigationToolName()===a.id&&k.returnToDefault()};f.addEventListener(b.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)};c.NavToolsExtension.prototype.initFocalLengthOverlay=function(){var a=this.focallength=
document.createElement("div");a.className="focallength";var b=document.createElement("table"),c=document.createElement("tbody");b.appendChild(c);a.appendChild(b);this.viewer.container.appendChild(a);b=c.insertRow(-1);c=b.insertCell(0);c.setAttribute("data-i18n","Focal Length");c.textContent=Autodesk.Viewing.i18n.translate("Focal Length");c=b.insertCell(1);c.textContent="";c.style.width="4em";c.style.textAlign="right";this.fovCell=c;a.style.visibility="hidden"};c.NavToolsExtension.prototype.showFocalLengthOverlay=
function(a){function c(a){a?b.Private.HudMessage.displayMessage(q.container,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."}):b.Private.HudMessage.dismiss()}function f(a){a&&k();n.focallength&&(n.focallength.style.visibility=a?"visible":"hidden")}function k(){var a=q.getFocalLength();l!==a&&(l=a,n.fovCell.textContent=a.toString()+" mm")}function m(a){k();"fov"===
q.toolController.getActiveToolName()&&(a=(a=q.navigation.getCamera())&&!a.isPerspective,f(!a),c(a))}var n=this,q=this.viewer,l=0,p=q.navigation.getCamera(),p=p&&!p.isPerspective;f(a&&!p);c(a&&p);a?q.addEventListener(b.CAMERA_CHANGE_EVENT,m):q.removeEventListener(b.CAMERA_CHANGE_EVENT,m)};c.NavToolsExtension.prototype.unload=function(){this.destroyUI();return!0};c.NavToolsExtension.prototype.destroyUI=function(){var a=this.viewer,c=a.getToolbar(!1);if(!c)return!0;c=c.getControl(b.TOOLBAR.NAVTOOLSID);
if(!c)return!0;"3d"===this.options.mode&&(c.orbittoolsbutton.subMenu.removeEventListener(f.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,c.orbittoolsbutton.subMenuActiveButtonChangedHandler(c)),c.removeControl(c.orbittoolsbutton.getId()),c.orbittoolsbutton=null);c.removeControl(c.panbutton.getId());c.panbutton=null;c.removeControl(c.dollybutton.getId());c.dollybutton=null;c.camerabutton.subMenu.removeEventListener(f.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,c.camerabutton.subMenuActiveButtonChangedHandler(c));
c.removeControl(c.camerabutton.getId());c.camerabutton=null;a.removeEventListener(b.TOOL_CHANGE_EVENT,this.toolChangedHandler);this.toolChangedHandler=null;a.removeEventListener(b.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler);this.navChangedHandler=null;return!0};b.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",c.NavToolsExtension)})();"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
Autodesk.Viewing.Extensions.Measure.MeasureExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.constructor=Autodesk.Viewing.Extensions.Measure.MeasureExtension;
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.load=function(){function a(){b.createUI()}var b=this,c=this.viewer;this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape";if(!c.toolController)return!1;this.tool=new Autodesk.Viewing.Extensions.Measure.MeasureTool(c,{onCloseCallback:function(a){b.enableMeasureTool(!1)}});c.toolController.registerTool(this.tool);this.viewer.toolbar?0<this.viewer.toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID).getNumberOfControls()?this.createUI():
this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a):this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);return!0};Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.unload=function(){var a=this.viewer;this.destroyUI();a.toolController.deregisterTool(this.tool);this.tool=null;return!0};
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.enableMeasureTool=function(a){if(this.tool){var b=this.viewer.toolController,c=this.tool.isActive();if(a&&!c)return b.activateTool("measure"),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!a&&c)return b.deactivateTool("measure"),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return!1};
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.createUI=function(){var a=Autodesk.Viewing.UI,b=this,c=this.viewer;this.measureToolButton=null;c=c.getToolbar(!0).getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);this.measureToolButton=new a.Button("toolbar-measureTool");this.measureToolButton.setToolTip("Measure");this.measureToolButton.setIcon("adsk-icon-measure");this.measureToolButton.onClick=function(a){b.enableMeasureTool(!b.tool.isActive())};this.onMeasureButtonStateChange=function(c){c.state===
a.Button.State.ACTIVE?b.enableMeasureTool(!0):c.state===a.Button.State.INACTIVE&&b.enableMeasureTool(!1)};this.measureToolButton.addEventListener(a.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);c.addControl(this.measureToolButton,{index:0});Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return b.enableMeasureTool(!1)}}])};
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.destroyUI=function(){var a=this.viewer;if(!a.model.is2d()){this.measureToolButton&&this.measureToolButton.removeEventListener(Autodesk.Viewing.UI.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);if(a=a.getToolbar(!1))if(a=a.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID)){if(this.measureToolButton){var b=a.getControl("toolbar-inspectSubMenu");b?b.removeControl(this.measureToolButton.getId()):a.removeControl(this.measureToolButton.getId())}this.measureToolButton=
null}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)}};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Measure",Autodesk.Viewing.Extensions.Measure.MeasureExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
Autodesk.Viewing.Extensions.Measure.MeasureTool=function(a,b){function c(){B.updateLabelPositions()}function f(){d.clearMeasurement()}function g(a){var b=this,c=!1,f=null,g=null,k=null,l=null,m=null,p=null,t=null,w={first:{},second:{}},B={first:{},second:{}},D={first:{},second:{}},F={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},G={},K=[];this.showFirstVertex=function(a){var b=this.setScale(a);this.showEndPoint("first",a,b)};this.showSecondVertex=
function(a){var b=this.setScale(a);this.showEndPoint("second",a,b)};this.showEndPoint=function(a,b,c){f||(f=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1}),h.impl.createOverlayScene("MeasureTool-endPoint"));var d=w[a],g=d.mesh;g||(d.geometry=new THREE.SphereGeometry(1),g=d.mesh=new THREE.Mesh(d.geometry,f),h.impl.addOverlay("MeasureTool-endPoint",g));g.scale.x=c;g.scale.y=c;g.scale.z=c;g.position.set(b.x,b.y,b.z);g.visible=!0;h.impl.invalidate(!1,
!1,!0);if(r||E)c=d.label,c||(c=d.label=document.createElement("div"),c.className="measure-label",h.container.appendChild(c),g=document.createElement("div"),g.className="adsk-icon-"+a+" measure-label-icon",c.appendChild(g)),c.classList.toggle("visible",!0),d.position=b.clone(),this.updateLabelPositions()};this.setScale=function(a){var b=h.navigation,c=b.getCamera(),d=b.getEyeVector(),f=b.getPosition();a=a.clone();c=c.isPerspective?a.sub(f).dot(d.normalize()):b.getEyeVector().length();d=b.getVerticalFov();
c=2*c*Math.tan(THREE.Math.degToRad(.5*d));b=b.getScreenViewport();return 5*c/(b.height*(window.devicePixelRatio||1))};this.updateScale=function(){var a=h.impl.overlayScenes["MeasureTool-endPoint"];if(a)for(var a=a.scene,b=0;b<a.children.length;b++){var c=a.children[b];if(c){var d=this.setScale(c.position);c.scale.x=d;c.scale.y=d;c.scale.z=d}}if(a=h.impl.overlayScenes["MeasureTool-extensionLine"])for(a=a.scene,b=0;b<a.children.length;b++)if(c=a.children[b])d=this.setScale(c.geometry.vertices[0]),c.material.dashSize=
4*d,c.material.gapSize=2*d};this.showFirstEdge=function(a,b){this.showEdge("first",a,b)};this.showSecondEdge=function(a,b){this.showEdge("second",a,b)};this.showEdge=function(a,b,c){g||(g=new THREE.LineBasicMaterial({color:2002943,opacity:.7,linewidth:5,depthTest:!1,depthWrite:!1}),h.impl.createOverlayScene("MeasureTool-edge"));var d=B[a];d.line&&h.impl.removeOverlay("MeasureTool-edge",d.line);d.line=new THREE.Line(b,g,THREE.LinePieces);h.impl.addOverlay("MeasureTool-edge",d.line);if(r||E){var f=
d.label;if(!f){f=d.label=document.createElement("div");f.className="measure-label";h.container.appendChild(f);var k=document.createElement("div");k.className="measure-label-text";f.appendChild(k);k=document.createElement("div");k.className="adsk-icon-"+a+" measure-label-icon";f.appendChild(k)}f.children[0].textContent=this.getEdgeLength(b);f.classList.toggle("visible",!0);d.intersectPoint=c.clone();this.updateLabelPositions()}};this.showFirstFace=function(a,b){this.showFace("first",a,b)};this.showSecondFace=
function(a,b){this.showFace("second",a,b)};this.showFace=function(a,b,c){k||(k=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),h.impl.createOverlayScene("MeasureTool-face"));var d=D[a];d.mesh&&h.impl.removeOverlay("MeasureTool-face",d.mesh);d.mesh=new THREE.Mesh(b,k);h.impl.addOverlay("MeasureTool-face",d.mesh);if(r||E){var f=d.label;if(!f){f=d.label=document.createElement("div");f.className="measure-label";h.container.appendChild(f);
var g=document.createElement("div");g.className="measure-label-text";f.appendChild(g);g=document.createElement("div");g.className="adsk-icon-"+a+" measure-label-icon";f.appendChild(g)}f.children[0].textContent=this.getFaceArea(b);f.classList.toggle("visible",!0);d.intersectPoint=c.clone();this.updateLabelPositions()}};this.drawExtensionFace=function(a){t||(t=new THREE.MeshPhongMaterial({color:52479,ambient:52479,opacity:.25,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),h.impl.createOverlayScene("MeasureTool-extensionFace"));
a=new THREE.Mesh(a,t);h.impl.addOverlay("MeasureTool-extensionFace",a)};this.getEdgeLength=function(a){var b=0;a=a.clone().vertices;for(var c=0;c<a.length;c+=2)h.model.is2d()&&(h.model.pageToModel(a[c],O),h.model.pageToModel(a[c+1],O)),b+=a[c].distanceTo(a[c+1]);b=Autodesk.Viewing.Private.convertUnits(h.model.getUnitString(),H,b);return Autodesk.Viewing.Private.formatValueWithUnits(b,H,3,z)};this.getFaceArea=function(a){var b=0;a=a.vertices;for(var c=new THREE.Vector3,d=new THREE.Vector3,f=0;f<a.length;f+=
3)c.subVectors(a[f+1],a[f]),d.subVectors(a[f+2],a[f]),b+=c.length()*d.length()*Math.sin(c.angleTo(d))/2;b=Autodesk.Viewing.Private.convertUnits(h.model.getUnitString(),H,b,"square");return H?Autodesk.Viewing.Private.formatValueWithUnits(b,H+"^2",3,z):Autodesk.Viewing.Private.formatValueWithUnits(b,null,3,z)};this.updateLabels=function(){A===SNAP_EDGE?B.first.label.children[0].textContent=this.getEdgeLength(n):A===SNAP_FACE&&(D.first.label.children[0].textContent=this.getFaceArea(n));C===SNAP_EDGE?
B.second.label.children[0].textContent=this.getEdgeLength(q):C===SNAP_FACE&&(D.second.label.children[0].textContent=this.getFaceArea(q))};this.updateLabelPositions=function(){function a(b,c,d){var f=h.navigation.getCamera(),g=h.navigation.getScreenViewport();b=new THREE.Vector3(b,c,d);b=b.project(f);return{x:Math.round((b.x+1)/2*g.width)+5,y:Math.round((-b.y+1)/2*g.height)+5}}function b(c){var d=c.p1,f=c.p2,g=a(d.x,d.y,d.z),h=a(f.x,f.y,f.z),d=h.x-g.x,g=h.y-g.y,h=a(f.x,f.y,f.z),f=h.x,h=h.y;c=c.label.getBoundingClientRect();
h=0<g?h+4:h-(c.height+4);f=0>d||0<g?f-(c.width+4):f+4;return{x:f,y:h}}function c(b,d){var f=b.p1,g=b.p2,g=a(f.x+(g.x-f.x)/2,f.y+(g.y-f.y)/2,f.z+(g.z-f.z)/2),f=g.x,g=g.y,h=d.p1,k=d.p2,h=a(h.x,h.y,h.z),l=a(k.x,k.y,k.z),k=f-(f+h.x+l.x)/3,h=g-(g+h.y+l.y)/3,m=b.label.getBoundingClientRect(),l=m.width/2,m=m.height/2,f=f-l,g=g-m;return{x:0<k?f+l:f-l,y:0<h?g+m:g-m}}for(var d in F)if(F.hasOwnProperty(d)){var f=F[d],g=f.label;g&&(f=f.axis?c(f,F.xyz):b(f),g.style.top=f.y+"px",g.style.left=f.x+"px",K.push(g))}G&&
(g=G.label)&&(f=b(G),g.style.top=f.y+"px",g.style.left=f.x+"px",K.push(g));for(d in D)D.hasOwnProperty(d)&&(f=D[d],g=f.label,f=f.intersectPoint,g&&f&&(f=a(f.x,f.y,f.z),g.style.top=f.y+"px",g.style.left=f.x+"px",K.push(g)));for(d in B)B.hasOwnProperty(d)&&(f=B[d],g=f.label,f=f.intersectPoint,g&&f&&(f=a(f.x,f.y,f.z),g.style.top=f.y+"px",g.style.left=f.x+"px",K.push(g)));for(d in w)w.hasOwnProperty(d)&&(f=w[d],g=f.label,f=f.position,g&&f&&(f=a(f.x,f.y,f.z),g.style.top=f.y+"px",g.style.left=f.x+"px",
K.push(g)));for(d=0;d<K.length;d++)for(g=0;g<d;g++)this.labelsOverlapDetection(K[g],K[d]);K=[]};this.labelsOverlapDetection=function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect();d.top<=c.bottom&&d.bottom>=c.top&&(d.right>=c.left&&d.right<=c.right?b.style.left=parseInt(b.style.left,10)-(d.right-c.left)+"px":d.left>=c.left&&d.left<=c.right?b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px":d.left<=c.left&&d.right>=c.right&&(b.style.left=parseInt(b.style.left,10)+(c.right-
d.left)+"px"))};this.drawLine=function(a,d){function f(a,d,g,k,l,m,n){var p=F[a],q=p.line,t=p.label;d=new THREE.Vector3(d,g,k);m=new THREE.Vector3(l,m,n);q&&(h.impl.removeOverlay("MeasureTool-"+a,q),p.line=null);t&&t.classList.remove("visible");0<d.distanceTo(m)&&(l="xyz"===a||!c&&r,q||(p.material=new THREE.LineBasicMaterial({color:parseInt(p.color,16),linewidth:"xyz"===a?5:"z"===a?1:2,depthTest:!1,depthWrite:!1}),p.overlayName="MeasureTool-"+a,h.impl.createOverlayScene(p.overlayName)),p.material.opacity=
r?1:.7,h.impl.clearOverlay(p.overlayName),q=p.geometry=new THREE.Geometry,q.vertices.push(d),q.vertices.push(m),q=p.line=new THREE.Line(q,p.material),h.impl.addOverlay(p.overlayName,q),q.visible=l,p.p1=d,p.p2=m,"xyz"!=a||r)&&(t||(t=p.label=document.createElement("div"),t.className="measure-length","xyz"===a?(q=document.createElement("div"),q.className="measure-length-text",t.appendChild(q)):t.style.pointerEvents="none",p.axis&&(t.className="adsk-icon-axis-"+a+" measure-label-axis measure-label-axis-"+
a),h.container.appendChild(t)),p.axis||b.updateDistance(),t.classList.toggle("visible",l))}f("xyz",a.x,a.y,a.z,d.x,d.y,d.z);var g=h.navigation.getAlignedUpVector(),k=Math.abs(g.x),l=Math.abs(g.y),g=Math.abs(g.z);g>k&&g>l?(f("x",a.x,a.y,a.z,d.x,a.y,a.z),f("y",d.x,a.y,a.z,d.x,d.y,a.z),f("z",d.x,d.y,a.z,d.x,d.y,d.z)):l>k&&l>g?(f("x",a.x,a.y,a.z,d.x,a.y,a.z),f("z",d.x,a.y,a.z,d.x,a.y,d.z),f("y",d.x,a.y,d.z,d.x,d.y,d.z)):(f("y",a.x,a.y,a.z,a.x,d.y,a.z),f("z",a.x,d.y,a.z,a.x,d.y,d.z),f("x",a.x,d.y,d.z,
d.x,d.y,d.z));this.updateLabelPositions()};this.updateDistance=function(){var a=F.xyz.label;a&&(a.children[0].textContent=d.getDistance("xyz"))};this.updateAngle=function(){var a=G.label;a&&(a.children[0].textContent=d.getAngle())};this.drawExtensionLine=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3;d.subVectors(b,a);f.subVectors(c,b);a=d.dot(f);d.subVectors(c,b);a=-a/d.dot(d);d.subVectors(c,b);d.multiplyScalar(a);d=d.add(b);if(0>a)c=d;else if(1<a)b=c,c=d;else return;p||(p=new THREE.LineDashedMaterial({color:13311,
linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),h.impl.createOverlayScene("MeasureTool-extensionLine"));p.opacity=r?1:.7;d=this.setScale(b);p.dashSize=4*d;p.gapSize=2*d;d=new THREE.Geometry;d.vertices.push(b);d.vertices.push(c);d.computeLineDistances();b=new THREE.Line(d,p);h.impl.addOverlay("MeasureTool-extensionLine",b)};this.drawExtensionLinePointToPoint=function(a,b){p||(p=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),h.impl.createOverlayScene("MeasureTool-extensionLine"));
p.opacity=r?1:.7;var c=this.setScale(a);p.dashSize=4*c;p.gapSize=2*c;c=new THREE.Geometry;c.vertices.push(a);c.vertices.push(b);c.computeLineDistances();c=new THREE.Line(c,p);h.impl.addOverlay("MeasureTool-extensionLine",c)};this.nearestPointsInSegmentToSegment=function(a,b,c,d){var f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;f.subVectors(b,a);g.subVectors(d,c);h.subVectors(a,c);d=f.dot(f);var k=f.dot(g),l=g.dot(g),m=f.dot(h),n=g.dot(h),p=d*l-k*k,q,t=p;b=p;.001>p?(q=0,t=1,p=n,b=l):
(q=k*n-l*m,p=d*n-k*m,0>q?(q=0,p=n,b=l):q>t&&(q=t,p=n+k,b=l));0>p?(p=0,0>-m?q=0:-m>d?q=t:(q=-m,t=d)):p>b&&(p=b,0>-m+k?q=0:-m+k>d?q=t:(q=-m+k,t=d));d=.001>Math.abs(q)?0:q/t;b=.001>Math.abs(p)?0:p/b;f.multiplyScalar(d);g.multiplyScalar(b);h.add(f);h.sub(g);f.add(a);g.add(c);return[f,g]};this.edgeToEdgeMeasure=function(a,b,c){var d=J.getEndPointsInEdge(a);a=d[0].clone();var f=d[1].clone(),d=J.getEndPointsInEdge(b);b=d[0].clone();var d=d[1].clone(),g=this.nearestPointInPointToLine(a,b,d),h=this.nearestPointInPointToLine(f,
b,d),k=new THREE.Vector3,l=new THREE.Vector3;c=this.nearestPointInPointToLine(c,a,f);if(a.distanceTo(b)<a.distanceTo(d)&&a.distanceTo(b)<f.distanceTo(b)&&a.distanceTo(b)<f.distanceTo(d)){k.subVectors(a,f);l.subVectors(b,d);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,l,.01))return this.drawLine(a,g),this.drawExtensionLine(a,b,d),[a,g];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(a,c,b,d,g);return g}if(a.distanceTo(d)<a.distanceTo(b)&&a.distanceTo(d)<
f.distanceTo(b)&&a.distanceTo(d)<f.distanceTo(d)){k.subVectors(a,f);l.subVectors(d,b);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,l,.01))return this.drawLine(a,g),this.drawExtensionLine(a,b,d),[a,g];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(a,c,d,b,g);return g}if(f.distanceTo(b)<a.distanceTo(b)&&f.distanceTo(b)<a.distanceTo(d)&&f.distanceTo(b)<f.distanceTo(d)){k.subVectors(f,a);l.subVectors(b,d);k.normalize();l.normalize();if(this.isEqualVectors(k,
l,.01)||this.isInverseVectors(k,l,.01))return this.drawLine(f,h),this.drawExtensionLine(f,b,d),[f,h];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(f,c,b,d,g);return g}k.subVectors(f,a);l.subVectors(d,b);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,l,.01))return this.drawLine(f,h),this.drawExtensionLine(f,b,d),[f,h];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(f,c,d,b,g);return g};this.nearestPointInPointToSegment=function(a,b,c){var d=
new THREE.Vector3,f=new THREE.Vector3;d.subVectors(b,a);f.subVectors(c,b);a=d.dot(f);d.subVectors(c,b);a=-a/d.dot(d);0>a||(1<a?b=c:(d.subVectors(c,b),d.multiplyScalar(a),b=d.add(b)));return b};this.nearestPointInPointToLine=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3;d.subVectors(b,a);f.subVectors(c,b);a=d.dot(f);d.subVectors(c,b);a=-a/d.dot(d);d.subVectors(c,b);d.multiplyScalar(a);return d.add(b)};this.pointToEdgeMeasure=function(a,b,c){b=J.getEndPointsInEdge(b);var d=b[0],f=b[1];
b=this.nearestPointInPointToLine(a,d,f);c=this.nearestPointInPointToLine(c,d,f);d=new THREE.Vector3;d.subVectors(c,b);d.add(a);this.drawLine(d,c);this.drawExtensionLinePointToPoint(a,d);return[a,b]};this.edgeToPointMeasure=function(a,b){var c=J.getEndPointsInEdge(a),d=c[0],c=c[1],f=this.nearestPointInPointToLine(b,d,c);this.drawLine(b,f);this.drawExtensionLine(b,d,c);return[b,f]};this.faceToFaceMeasure=function(a,b,c,d){var f=b.clone(),g=d.clone(),h=this.angleVectorToVector(b,d);return f.x<=g.x+.01&&
f.x>=g.x-.01&&f.y<=g.y+.01&&f.y>=g.y-.01&&f.z<=g.z+.01&&f.z>=g.z-.01||f.x<=-g.x+.01&&f.x>=-g.x-.01&&f.y<=-g.y+.01&&f.y>=-g.y-.01&&f.z<=-g.z+.01&&f.z>=-g.z-.01?(b=new THREE.Vector3,b.subVectors(a,c),f=f.dot(b)/f.dot(g),b.addVectors(c,g.multiplyScalar(f)),g=new THREE.Vector3,g.subVectors(b,a),a=D.first.mesh.geometry.clone(),a.applyMatrix((new THREE.Matrix4).makeTranslation(g.x,g.y,g.z)),this.drawExtensionFace(a),this.drawLine(c,b),[c,b,h]):h=this.drawAngleFaceToFace(a,b,c,d)};this.angleVectorToVector=
function(a,b){return 180*a.angleTo(b)/Math.PI};this.intersectPlaneToPlane=function(a,b,c,d){var f=new THREE.Vector3;f.crossVectors(b,d);var g=0<=f.x?f.x:-f.x,h=0<=f.y?f.y:-f.y,k=0<=f.z?f.z:-f.z,h=g>h?g>k?1:3:h>k?2:3,g=new THREE.Vector3,l,k=-b.dot(a);l=-d.dot(c);switch(h){case 1:g.x=0;0!==f.x?(g.y=(l*b.z-k*d.z)/f.x,g.z=(k*d.y-l*b.y)/f.x):(g.y=-(l*b.z)/(b.z*d.y),g.z=-(k*d.y)/(b.z*d.y));break;case 2:g.y=0;0!==f.y?(g.x=(k*d.z-l*b.z)/f.y,g.z=(l*b.x-k*d.x)/f.y):(g.x=-(k*d.z)/(b.x*d.z),g.z=-(l*b.x)/(b.x*
d.z));break;case 3:g.z=0,0!==f.z?(g.x=(l*b.y-k*d.y)/f.z,g.y=(k*d.x-l*b.x)/f.z):(g.x=-(l*b.y)/(b.y*d.x),g.y=-(k*d.x)/(b.y*d.x))}b=new THREE.Vector3;b.addVectors(g,f.multiplyScalar(100));a=this.nearestPointInPointToLine(a,g,b);c=this.nearestPointInPointToLine(c,g,b);return[a,c]};this.drawAngle=function(a,b,c,d,f){l||(l=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),m=new THREE.LineBasicMaterial({color:16750848,
opacity:1,linewidth:5,depthTest:!1}),h.impl.createOverlayScene("MeasureTool-angle",l),h.impl.createOverlayScene("MeasureTool-angle-outline",m));h.impl.clearOverlay("MeasureTool-angle");h.impl.clearOverlay("MeasureTool-angle-outline");var g=a.distanceTo(b),k=new THREE.CircleGeometry(g,100,0,f*Math.PI/180),k=new THREE.Mesh(k,l),n=k.geometry.vertices[0].clone();k.geometry.vertices.push(n);k.position.set(a.x,a.y,a.z);n=k.position.clone();n.add(d);k.lookAt(n);k.updateMatrixWorld();var p=k.geometry.vertices[1].clone(),
q=k.geometry.vertices[k.geometry.vertices.length-2].clone();p.applyMatrix4(k.matrixWorld);q.applyMatrix4(k.matrixWorld);var n=new THREE.Vector3,t=new THREE.Vector3,w=new THREE.Vector3,z=new THREE.Vector3;n.subVectors(p,a);t.subVectors(q,a);w.subVectors(b,a);z.subVectors(c,a);c=n.angleTo(w);p=n.angleTo(z);b=t.angleTo(w);q=t.angleTo(z);b=(.001>=c&&-.001<=c||.001>=p&&-.001<=p)&&(.001>=b&&-.001<=b||.001>=q&&-.001<=q)?0:(c<=Math.PI+.001&&c>=Math.PI-.001||p<=Math.PI+.001&&p>=Math.PI-.001)&&(b<=Math.PI+
.001&&b>=Math.PI-.001||q<=Math.PI+.001&&q>=Math.PI-.001)?Math.PI:c<=b+.001&&c>=b-.001||c<=q+.001&&c>=q-.001?c:p;c=new THREE.Matrix4;c.makeRotationAxis(d,b);c.multiply(k.matrix);k.matrix=c;k.rotation.setFromRotationMatrix(k.matrix);k.updateMatrixWorld();p=k.geometry.vertices[1].clone();q=k.geometry.vertices[k.geometry.vertices.length-2].clone();p.applyMatrix4(k.matrixWorld);q.applyMatrix4(k.matrixWorld);n.subVectors(p,a);t.subVectors(q,a);c=n.angleTo(w);p=n.angleTo(z);t.angleTo(w);t.angleTo(z);.001<=
c&&.001<=p&&(c=new THREE.Matrix4,c.makeRotationAxis(d,2*-b),c.multiply(k.matrix),k.matrix=c,k.rotation.setFromRotationMatrix(k.matrix));a=new THREE.CircleGeometry(.9*g,100,0,f*Math.PI/180);a=new THREE.Line(a,m);a.geometry.vertices.splice(0,1);k.updateMatrixWorld();a.applyMatrix(k.matrixWorld);f=new THREE.Geometry;d=new THREE.Geometry;f.vertices.push(k.geometry.vertices[0],k.geometry.vertices[1]);d.vertices.push(k.geometry.vertices[0],k.geometry.vertices[k.geometry.vertices.length-2]);f=new THREE.Line(f,
l);d=new THREE.Line(d,l);f.applyMatrix(k.matrixWorld);d.applyMatrix(k.matrixWorld);h.impl.addOverlay("MeasureTool-angle",k);h.impl.addOverlay("MeasureTool-angle-outline",a);h.impl.addOverlay("MeasureTool-angle-outline",f);h.impl.addOverlay("MeasureTool-angle-outline",d)};this.drawAngleFaceToFace=function(a,b,c,f){var g=this.intersectPlaneToPlane(a,b,c,f),k=new THREE.Vector3,l=new THREE.Vector3;k.subVectors(a,g[0]);l.subVectors(c,g[1]);var k=this.angleVectorToVector(k,l),l=g[0].clone(),m=new THREE.Vector3;
m.crossVectors(b,f);m.normalize();g=this.intersectPlaneToPlane(a,b,l,m);a=g[0].clone();g=this.intersectPlaneToPlane(c,f,l,m);c=g[0].clone();this.drawAngle(l,a,c,m,k);r&&(c=G.label,c||(c=G.label=document.createElement("div"),c.className="measure-length",h.container.appendChild(c),f=document.createElement("div"),f.className="measure-length-text",c.appendChild(f)),c.children[0].textContent=d.getAngle(),c.classList.toggle("visible",!0),G.p1=l.clone(),G.p2=l.clone(),this.updateLabelPositions());return k};
this.drawAngleLineToLine=function(a,b,c,f,g){var k=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Vector3;l.subVectors(a,b);m.subVectors(c,f);k.crossVectors(l,m);k.normalize();l=new THREE.Vector3;l.subVectors(a,c);l.add(f);this.drawAngle(a,b,l,k,g);r&&(b=G.label,b||(b=G.label=document.createElement("div"),b.className="measure-length",h.container.appendChild(b),c=document.createElement("div"),c.className="measure-length-text",b.appendChild(c)),b.children[0].textContent=d.getAngle(),b.classList.toggle("visible",
!0),G.p1=a.clone(),G.p2=a.clone(),this.updateLabelPositions())};this.intersectLineToLine=function(a,b,c,d){var f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(c,a);f.cross(d);g.crossVectors(b,d);c=f.divide(g);g=b.clone();g.multiplyScalar(c);f.addVectors(a,g);return f};this.nearestPointInPointToPlane=function(a,b,c){var d=new THREE.Vector3;c=c.clone();var f=new THREE.Vector3;f.subVectors(a,b);b=-c.dot(f);f=c.dot(c);d.addVectors(a,c.multiplyScalar(b/f));return d};this.faceToPointMeasure=function(a,
b,c,d){b=this.nearestPointInPointToPlane(d,a.vertices[0],b);c=c.clone();var f=new THREE.Vector3;f.subVectors(c,b);f.add(d);f=new THREE.Vector3;f.subVectors(b,c);a=a.clone();a.applyMatrix((new THREE.Matrix4).makeTranslation(f.x,f.y,f.z));this.drawExtensionFace(a);this.drawLine(d,b);return[d,b]};this.nearestPointInPointToFace=function(a,b,c){for(var d,f=Number.MAX_VALUE,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,m=0;m<b.vertices.length;m+=3){g.subVectors(b.vertices[m+
1],b.vertices[m]);h.subVectors(b.vertices[m+2],b.vertices[m]);l.crossVectors(g,h);k.subVectors(a,b.vertices[m]);g.cross(k);var n=g.dot(l)/l.dot(l);k.cross(h);var p=k.dot(l)/l.dot(l),q=1-n-p;if(0<=q&&1>=q&&0<=p&&1>=p&&0<=n&&1>=n)return d=this.nearestPointInPointToPlane(a,b.vertices[0],c)}for(m=0;m<b.vertices.length;m+=3)c=this.nearestPointInPointToSegment(a,b.vertices[m],b.vertices[m+1]),a.distanceTo(c)<f&&(f=a.distanceTo(c),d=c.clone()),c=this.nearestPointInPointToSegment(a,b.vertices[m],b.vertices[m+
2]),a.distanceTo(c)<f&&(f=a.distanceTo(c),d=c.clone()),c=this.nearestPointInPointToSegment(a,b.vertices[m+1],b.vertices[m+2]),a.distanceTo(c)<f&&(f=a.distanceTo(c),d=c.clone());return d};this.pointToFaceMeasure=function(a,b,c,d){b=this.nearestPointInPointToPlane(a,b.vertices[0],c);d=d.clone();c=new THREE.Vector3;c.subVectors(d,b);c.add(a);this.drawLine(d,c);this.drawExtensionLinePointToPoint(a,c);return[a,b]};this.nearestPointsInEdgeToFace=function(a,b){for(var c=[],d=Number.MAX_VALUE,f=J.getEndPointsInEdge(a),
g=f[0],f=f[1],h,k,l=0;l<b.vertices.length;l+=3)h=b.vertices[l],k=b.vertices[l+1],h=this.nearestPointsInSegmentToSegment(g,f,h,k),h[0].distanceTo(h[1])<d&&(d=h[0].distanceTo(h[1]),c[0]=h[0].clone(),c[1]=h[1].clone()),h=b.vertices[l],k=b.vertices[l+2],h=this.nearestPointsInSegmentToSegment(g,f,h,k),h[0].distanceTo(h[1])<d&&(d=h[0].distanceTo(h[1]),c[0]=h[0].clone(),c[1]=h[1].clone()),h=b.vertices[l+1],k=b.vertices[l+2],h=this.nearestPointsInSegmentToSegment(g,f,h,k),h[0].distanceTo(h[1])<d&&(d=h[0].distanceTo(h[1]),
c[0]=h[0].clone(),c[1]=h[1].clone());return c};this.faceToEdgeMeasure=function(a,b,c,d,f){var g=J.getEndPointsInEdge(d),h;g[0].distanceTo(c)<g[1].distanceTo(c)?(d=g[0],h=g[1]):(d=g[1],h=g[0]);var k=new THREE.Vector3;k.subVectors(h,d);g=this.angleLineToPlane(k,b);if(.01>=k.dot(b)&&-.01<=k.dot(b))return k=this.nearestPointInPointToPlane(d,a.vertices[0],b),f=this.nearestPointInPointToLine(f,d,h),this.faceToPointMeasure(a,b,c,f),[d,k,g];f=this.nearestPointInPointToLine(f,d,h);this.drawAngleEdgeToFace(a.vertices[0],
b,c,d,f,g);return g};this.edgeToFaceMeasure=function(a,b,c,d,f){var g=J.getEndPointsInEdge(a),h;g[0].distanceTo(f)<g[1].distanceTo(f)?(a=g[0],h=g[1]):(a=g[1],h=g[0]);var k=new THREE.Vector3;k.subVectors(h,a);g=this.angleLineToPlane(k,d);if(.01>=k.dot(d)&&-.01<=k.dot(d))return c=this.nearestPointInPointToPlane(a,c.vertices[0],d),d=new THREE.Vector3,d.subVectors(f,c),d.add(a),b=new THREE.Vector3,b.subVectors(f,c),b.add(h),this.drawLine(d,f),this.drawExtensionLinePointToPoint(d,b),[a,c,g];h=this.nearestPointInPointToLine(b,
a,h);this.drawAngleEdgeToFace(c.vertices[0],d,f,a,h,g);return g};this.angleLineToPlane=function(a,b){var c=this.angleVectorToVector(a,b);return 90<c?c-90:90-c};this.drawAngleEdgeToFace=function(a,b,c,f,g,k){var l=this.intersectPointLineToPlane(a,b,f,g);if(l){a=90===k?c.clone():this.nearestPointInPointToPlane(g,a,b);b=new THREE.Vector3;c=new THREE.Vector3;var m=new THREE.Vector3;c.subVectors(g,f);m.subVectors(a,l);b.crossVectors(c,m);b.normalize();this.drawAngle(l,g,a,b,k);r&&(f=G.label,f||(f=G.label=
document.createElement("div"),f.className="measure-length",h.container.appendChild(f),g=document.createElement("div"),g.className="measure-length-text",f.appendChild(g)),f.children[0].textContent=d.getAngle(),f.classList.toggle("visible",!0),G.p1=l.clone(),G.p2=l.clone(),this.updateLabelPositions())}};this.intersectPointLineToPlane=function(a,b,c,d){var f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(d,c);g.subVectors(c,a);a=b.dot(f);b=-b.dot(g);if(.001>Math.abs(a))return null;f.multiplyScalar(b/
a);f.add(c);return f};this.isEqualVectors=function(a,b,c){return a.x<=b.x+c&&a.x>=b.x-c&&a.y<=b.y+c&&a.y>=b.y-c&&a.z<=b.z+c&&a.z>=b.z-c?!0:!1};this.isInverseVectors=function(a,b,c){return a.x<=-b.x+c&&a.x>=-b.x-c&&a.y<=-b.y+c&&a.y>=-b.y-c&&a.z<=-b.z+c&&a.z>=-b.z-c?!0:!1};this.setSimple=function(a){if(c!=a){c=a;for(var b in F)if("xyz"!==b&&F.hasOwnProperty(b)){var d=F[b];d.line&&(d.line.visible=!a,d.label&&d.label.classList.toggle("visible",!a))}h.impl.invalidate(!1,!1,!0)}};this.hide=function(){for(var a in w)if(w.hasOwnProperty(a)){var b=
w[a];b.mesh&&(b.mesh.visible=!1);b.label&&b.label.classList.remove("visible")}for(a in B)B.hasOwnProperty(a)&&(b=B[a],b.line&&(b.line.visible=!1),b.label&&b.label.classList.remove("visible"));for(a in D)D.hasOwnProperty(a)&&(b=D[a],b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible"));for(a in F)F.hasOwnProperty(a)&&(b=F[a],b.line&&(b.line.visible=!1),b.label&&b.label.classList.remove("visible"));G.label&&G.label.classList.remove("visible");l&&(h.impl.clearOverlay("MeasureTool-angle"),
h.impl.clearOverlay("MeasureTool-angle-outline"));p&&h.impl.clearOverlay("MeasureTool-extensionLine");t&&h.impl.clearOverlay("MeasureTool-extensionFace");h.impl.invalidate(!1,!1,!0)};this.hideClick=function(a){if(w.hasOwnProperty(a)){var b=w[a];b.mesh&&(b.mesh.visible=!1);b.label&&b.label.classList.remove("visible")}B.hasOwnProperty(a)&&(b=B[a],b.line&&(b.line.visible=!1),b.label&&b.label.classList.remove("visible"));D.hasOwnProperty(a)&&(a=D[a],a.mesh&&(a.mesh.visible=!1),a.label&&a.label.classList.remove("visible"));
for(var c in F)F.hasOwnProperty(c)&&(a=F[c],a.line&&(a.line.visible=!1),a.label&&a.label.classList.remove("visible"));G.label&&G.label.classList.remove("visible");l&&(h.impl.clearOverlay("MeasureTool-angle"),h.impl.clearOverlay("MeasureTool-angle-outline"));p&&h.impl.clearOverlay("MeasureTool-extensionLine");t&&h.impl.clearOverlay("MeasureTool-extensionFace");h.impl.invalidate(!1,!1,!0)};this.destroy=function(){for(var a in w)if(w.hasOwnProperty(a)){var b=w[a];b.mesh&&(h.impl.removeOverlay("MeasureTool-endPoint",
b.mesh),b.mesh=b.geometry=null);b.label&&(b.label.parentNode.removeChild(b.label),b.label=null)}for(a in B)B.hasOwnProperty(a)&&(b=B[a],b.line&&(h.impl.removeOverlay("MeasureTool-edge",b.line),b.line=b.intersectPoint=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null));for(a in D)D.hasOwnProperty(a)&&(b=D[a],b.mesh&&(h.impl.removeOverlay("MeasureTool-face",b.mesh),b.mesh=b.intersectPoint=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null));f&&(f=null,h.impl.removeOverlayScene("MeasureTool-endPoint"));
k&&(k=null,h.impl.removeOverlayScene("MeasureTool-face"));g&&(g=null,h.impl.removeOverlayScene("MeasureTool-edge"));p&&(p=null,h.impl.removeOverlayScene("MeasureTool-extensionLine"));t&&(t=null,h.impl.removeOverlayScene("MeasureTool-extensionFace"));for(a in F)F.hasOwnProperty(a)&&(b=F[a],b.line&&(h.impl.removeOverlay(b.overlayName,b.line),h.impl.removeOverlayScene(b.overlayName),b.material=b.line=b.geometry=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null),b.material=b.line=b.geometry=
b.label=b.p1=b.p2=null);G.label&&(G.label.parentNode.removeChild(G.label),G.label=null);G.label=G.p1=G.p2=null}}var d=this,h=a,k=["measure"],m=!1,n=null,q=null,l=!1,p=0,r=!1,A=null,C=null,H="",z=3,t={},w=0,E=!1,B=null,D=null,J=null,F=null,G=null,M=null,I=null,L=null,K=null,O=null;this.register=function(){D||(D=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(d,h,"measure-panel","Measure",b),h.addPanel(D));J||(J=new Autodesk.Viewing.Extensions.Measure.Snapper(a),h.toolController.registerTool(J))};
this.deregister=function(){this.deactivate();h.removePanel(D);D.uninitialize();h.toolController.deregisterTool(J);J=null};this.isActive=function(){return m};this.getNames=function(){return k};this.getName=function(){return k[0]};this.getCursor=function(){return l?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), wait"};
this.activate=function(){m=!0;p=0;l=!1;H||(H=h.model.getUnitString());z=h.model&&h.model.is2d()?2:1;B||(B=new g(h));B.hide();D.setVisible(!0);D.updatePanel();h.model&&h.model.is2d()&&D.isolate.setDisabled(!0);H?D.disableUnitOption(0):D.disableUnitOption();h.clearSelection();h.toolController.activateTool("snapper");h.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c);h.addEventListener(Autodesk.Viewing.RESET_EVENT,f)};this.deactivate=function(){m=!1;n=q=null;t={};this.clearMeasurement();B&&(B.hide(),
B.destroy());t={};D&&(D.setVisible(!1),D.updatePanel());J&&J.isActive()&&h.toolController.deactivateTool("snapper");h.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c);h.removeEventListener(Autodesk.Viewing.RESET_EVENT,f)};this.update=function(){return!1};this.getUnits=function(){return H};this.setUnits=function(a){H!==a&&(H=a,B&&(B.updateDistance(),B.updateLabels()))};this.getPrecision=function(){return z};this.setPrecision=function(a){z!==a&&(z=a,B&&(B.updateDistance(),B.updateLabels()))};
this.getDistance=function(a){if(h.model&&h.model.isLoadDone())return a=Autodesk.Viewing.Private.convertUnits(h.model.getUnitString(),H,t[a]||0),Autodesk.Viewing.Private.formatValueWithUnits(a,H,3,z)};this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(w,String.fromCharCode(176),3,z)};this.clearMeasurement=function(){O=L=K=A=C=n=q=null;p=1;t={};w=0;B&&B.hide();D&&(D.updatePanel(),D.hideMeasureResult(),D.isolateMeasure&&this.clearIsolate())};this.clearRubberBand=function(){C=
q=null;B.hideClick("second")};this.clearFirstPick=function(){q?(B.hide(),n=q.clone(),A=C,F=G,M=I,L=K,O=G,E=!0,A===SNAP_VERTEX?B.showFirstVertex(n):A===SNAP_EDGE?B.showFirstEdge(n,F):B.showFirstFace(n,F),E=!1,K=C=q=null,p=2,t={},w=0,D&&D.isolateMeasure&&this.clearIsolate()):this.clearMeasurement();D.showSelection1()};this.clearSecondPick=function(){K=C=q=null;p=2;t={};w=0;B.hideClick("second");D&&D.isolateMeasure&&this.clearIsolate()};this.getIndicator=function(){return B};this.getFirstGeometry=function(){return{type:A,
geometry:n}};this.getSecondGeometry=function(){return{type:C,geometry:q}};this.getEdgeLength=function(a){return B.getEdgeLength(a)};this.getFaceArea=function(a){return B.getFaceArea(a)};this.isolateMeasurement=function(){L&&K&&h.isolate([L,K])};this.clearIsolate=function(){h.showAll()};this._handleMouseEvent=function(a){if(J.isSnapped()){0===p&&(this.clearMeasurement(),p=1);if(1===p)O=J.getViewportIndex(),J.getHighlightGeometry()===SNAP_VERTEX?(n=J.getVertex(),A=SNAP_VERTEX,B.showFirstVertex(n)):
J.getHighlightGeometry()===SNAP_EDGE?(n=J.getEdge(),A=SNAP_EDGE,F=J.getIntersectPoint(),B.showFirstEdge(n,F)):(n=J.getFace(),A=SNAP_FACE,F=J.getIntersectPoint(),M=J.getFaceNormal(),B.showFirstFace(n,F)),L=J.getSnapNode(),D.showSelection1();else if(2===p){var b;A===SNAP_VERTEX&&J.getHighlightGeometry()===SNAP_VERTEX?(q=J.getVertex(),C=SNAP_VERTEX,B.showSecondVertex(q),B.drawLine(n,q),b=[n,q]):A===SNAP_EDGE&&J.getHighlightGeometry()===SNAP_EDGE?(q=J.getEdge(),C=SNAP_EDGE,G=J.getIntersectPoint(),B.showSecondEdge(q,
G),b=B.edgeToEdgeMeasure(q,n,G)):A===SNAP_FACE&&J.getHighlightGeometry()===SNAP_FACE?(q=J.getFace(),C=SNAP_FACE,G=J.getIntersectPoint(),I=J.getFaceNormal(),B.showSecondFace(q,G),b=B.faceToFaceMeasure(F,M,G,I)):A===SNAP_VERTEX&&J.getHighlightGeometry()===SNAP_EDGE?(q=J.getEdge(),C=SNAP_EDGE,G=J.getIntersectPoint(),B.showSecondEdge(q,G),b=B.pointToEdgeMeasure(n,q,G)):A===SNAP_EDGE&&J.getHighlightGeometry()===SNAP_VERTEX?(q=J.getVertex(),C=SNAP_VERTEX,B.showSecondVertex(q),b=B.edgeToPointMeasure(n,q)):
A===SNAP_VERTEX&&J.getHighlightGeometry()===SNAP_FACE?(q=J.getFace(),C=SNAP_FACE,I=J.getFaceNormal(),G=J.getIntersectPoint(),B.showSecondFace(q,G),b=B.pointToFaceMeasure(n,q,I,G)):A===SNAP_FACE&&J.getHighlightGeometry()===SNAP_VERTEX?(q=J.getVertex(),C=SNAP_VERTEX,B.showSecondVertex(q),b=B.faceToPointMeasure(n,M,F,q)):A===SNAP_EDGE&&J.getHighlightGeometry()===SNAP_FACE?(q=J.getFace(),C=SNAP_FACE,I=J.getFaceNormal(),G=J.getIntersectPoint(),B.showSecondFace(q,G),b=B.edgeToFaceMeasure(n,F,q,I,G)):A===
SNAP_FACE&&J.getHighlightGeometry()===SNAP_EDGE&&(q=J.getEdge(),C=SNAP_EDGE,G=J.getIntersectPoint(),B.showSecondEdge(q,G),b=B.faceToEdgeMeasure(n,M,F,q,G));r&&(void 0===b.length?(w=b,D.showAngleResult()):(a=b[0].clone(),b=b[1].clone(),h.model.is2d()&&(h.model.pageToModel(a,O),h.model.pageToModel(b,O)),t.xyz=a.distanceTo(b),t.x=Math.abs(a.x-b.x),t.y=Math.abs(a.y-b.y),t.z=Math.abs(a.z-b.z),D.showDistanceResult()),D.showSelection2(),D.updatePanel(),B.updateDistance(),B.updateAngle(),K=J.getSnapNode(),
J.getViewportIndex(),D.isolateMeasure&&this.isolateMeasurement());B.updateLabelPositions()}return!0}2===p&&(A===SNAP_VERTEX?(q=this.inverseProject(a.canvasX,a.canvasY),C=SNAP_VERTEX,B.drawLine(n,q)):A===SNAP_EDGE?(q=this.inverseProject(a.canvasX,a.canvasY),C=SNAP_VERTEX,B.edgeToPointMeasure(n,q)):A===SNAP_FACE&&(q=this.inverseProject(a.canvasX,a.canvasY),C=SNAP_VERTEX,B.faceToPointMeasure(n,M,F,q)));return!1};this.inverseProject=function(a,b){var c=h.navigation.getCamera(),d=h.navigation.getScreenViewport(),
f=new THREE.Vector3;f.x=a/d.width*2-1;f.y=-(b/d.height*2-1);f.z=0;return f=f.unproject(c)};this.handleButtonDown=function(a,b){l=!0;0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||(r=!0);return!1};this.handleMouseMove=function(a){r=!1;2===p&&(this.clearRubberBand(),this._handleMouseEvent(a));return!1};this.handleButtonUp=function(a,b){return l=!1};this.handleSingleClick=function(a,b){if(r){this._handleMouseEvent(a)||(this.clearMeasurement(),p=0);if(1===p||2===p)p=1===p?2:0;r=!1}return!0};this.handleDoubleClick=
function(a,b){return!0};this.handleWheelInput=function(a){B.updateScale();return!1}};AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
Autodesk.Viewing.Extensions.Measure.MeasurePanel=function(a,b,c,f,g){Autodesk.Viewing.UI.DockingPanel.call(this,b.container,c,f,g);this.kPanelExpandedHeight=310;this.kPanelCollapsedHeight=35;this.isDeltaExpanded=!0;this.isolateMeasure=this.isSettingsExpanded=!1;this.measureTool=a;this.viewer=b;this.parentContainer=b.container;this.container.classList.add("measurePanel");this.container.dockRight=!0;this.container.style.minWidth="300px";this.container.style.width="300px";this.container.style.minHeight=
this.kPanelCollapsedHeight+"px";this.container.style.height=this.kPanelExpandedHeight+"px";this.container.style.maxHeight=this.kPanelExpandedHeight+"px";this.container.style.top="200px";this.container.style.left="220px";this.container.style.position="absolute";this.addEventListener(this.closer,"click",function(a){if(g&&g.onCloseCallback)g.onCloseCallback()});this.container.children[0].classList.add("expanded");g=g||{};g.heightAdjustment||(g.heightAdjustment=40);g.marginTop||(g.marginTop=0);g.left=
!1;this.createScrollContainer(g);this.measureResults=document.createElement("div");this.scrollContainer.appendChild(this.measureResults);var d=this;this.selection1=document.createElement("div");this.selection1.className="measure-result-container";this.measureResults.appendChild(this.selection1);a=document.createElement("div");a.className="adsk-icon-first measure-selectionOne-label";this.selection1.appendChild(a);this.selection1Result=document.createElement("div");this.selection1Result.className="measure-selection-result";
this.selection1.appendChild(this.selection1Result);a=document.createElement("div");a.className="adsk-icon-refresh measure-repick";a.addEventListener("click",function(a){d.firstSelectionRepick()},!0);this.selection1.appendChild(a);this.addDivider(this.selection1);this.results=document.createElement("div");this.results.className="measure-result-container";this.measureResults.appendChild(this.results);this.distIcon=document.createElement("div");this.distIcon.className="adsk-icon-measure-distance measure-distance-icon";
this.results.appendChild(this.distIcon);this.angleIcon=document.createElement("div");this.angleIcon.className="adsk-icon-measure-angle measure-angle-icon";this.results.appendChild(this.angleIcon);this.distanceDiv=document.createElement("div");this.distanceDiv.className="measure-result";this.results.appendChild(this.distanceDiv);this.angleDiv=document.createElement("div");this.angleDiv.className="measure-result";this.results.appendChild(this.angleDiv);this.initialDiv=document.createElement("div");
this.initialDiv.className="measure-initial";this.initialDiv.textContent="0.00";this.results.appendChild(this.initialDiv);this.settingsButton=document.createElement("div");this.settingsButton.className="adsk-icon-settings measure-settings-button";this.settingsButton.addEventListener("click",function(a){d.showMeasureSettings()},!0);this.results.appendChild(this.settingsButton);this.deltaButton=document.createElement("div");this.deltaButton.className="adsk-icon-arrow measure-delta-button";this.deltaButton.addEventListener("click",
function(a){d.toggle()},!0);this.results.appendChild(this.deltaButton);this.deltaXDiv=document.createElement("div");this.deltaXDiv.className="measure-delta-result";this.results.appendChild(this.deltaXDiv);a=document.createElement("span");a.textContent="Delta ";this.deltaXDiv.appendChild(a);a=document.createElement("span");a.className="measure-label-axis-x";a.textContent="X";this.deltaXDiv.appendChild(a);a=document.createElement("span");this.deltaXDiv.appendChild(a);this.deltaYDiv=document.createElement("div");
this.deltaYDiv.className="measure-delta-result";this.results.appendChild(this.deltaYDiv);a=document.createElement("span");a.textContent="Delta ";this.deltaYDiv.appendChild(a);a=document.createElement("span");a.className="measure-label-axis-y";a.textContent="Y";this.deltaYDiv.appendChild(a);a=document.createElement("span");this.deltaYDiv.appendChild(a);this.deltaZDiv=document.createElement("div");this.deltaZDiv.className="measure-delta-result";this.results.appendChild(this.deltaZDiv);a=document.createElement("span");
a.textContent="Delta ";this.deltaZDiv.appendChild(a);a=document.createElement("span");a.className="measure-label-axis-z";a.textContent="Z";this.deltaZDiv.appendChild(a);a=document.createElement("span");this.deltaZDiv.appendChild(a);this.addDivider(this.results);this.selection2=document.createElement("div");this.selection2.className="measure-result-container";this.measureResults.appendChild(this.selection2);a=document.createElement("div");a.className="adsk-icon-second measure-selectionTwo-label";this.selection2.appendChild(a);
this.selection2Result=document.createElement("div");this.selection2Result.className="measure-selection-result";this.selection2.appendChild(this.selection2Result);a=document.createElement("div");a.className="adsk-icon-refresh measure-repick";a.addEventListener("click",function(a){d.secondSelectionRepick()},!0);this.selection2.appendChild(a);this.addDivider(this.selection2);this.measureSettings=document.createElement("div");this.measureSettings.className="measure-settings";this.measureSettings.style.display=
"none";this.measureResults.appendChild(this.measureSettings);this.table=document.createElement("table");this.table.className="tftable measure-table";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.measureSettings.appendChild(this.table);this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["decimal-ft"]},{name:"Feet and fractional inches",units:"ft",matches:["ft","in"]},{name:"Decimal inches",units:"decimal-in",matches:["decimal-in"]},
{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];a=this.findUnits();b=[];for(c=0;c<this.units.length;++c)b.push(this.units[c].name);this.unitList=new Autodesk.Viewing.Private.OptionDropDown("Unit type",this.tbody,b,a);this.addEventListener(this.unitList,"change",function(a){d.measureTool.setUnits(d.units[d.unitList.selectedIndex].units);
d.updatePanel();d.setupPrecision()});this.precisionList=new Autodesk.Viewing.Private.OptionDropDown("Precision",this.tbody,[],-1);this.addEventListener(this.precisionList,"change",function(a){d.measureTool.setPrecision(d.precisionList.selectedIndex);d.updatePanel()});this.setupPrecision();this.isolate=new Autodesk.Viewing.Private.OptionCheckbox("Isolate measurement",this.tbody,!1);this.addEventListener(this.isolate,"change",function(a){d.isolateMeasure=d.isolate.checked;d.isolateMeasure?d.measureTool.isolateMeasurement():
d.measureTool.clearIsolate()});this.addDivider(this.measureSettings);a=document.createElement("div");a.className="measure-restart";a.setAttribute("data-i18n","Restart");a.textContent=Autodesk.Viewing.i18n.translate("Restart");a.addEventListener("click",function(){d.measureTool.clearMeasurement()},!1);this.measureResults.appendChild(a);this.updatePanel();this.addVisibilityListener(function(){d.resizeToContent({maxHeight:d.parentContainer.offsetHeight-75})});this.hideMeasureResult()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype);
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.addDropDownMenu=function(a,b,c,f,g){var d=document.createElement("select");d.className="optionDropDown";for(var h=0;h<c.length;h++){var k=document.createElement("option");k.value=h;k.setAttribute("data-i18n",c[h]);k.textContent=Autodesk.Viewing.i18n.translate(c[h]);d.add(k)}c=document.createElement("div");c.className="measure-submenu-select";h=document.createElement("div");h.className="measure-submenu-selectlabel";h.setAttribute("for",b);
h.setAttribute("data-i18n",b);h.textContent=Autodesk.Viewing.i18n.translate(b);c.appendChild(h);c.appendChild(d);a.appendChild(c);d.selectedIndex=f;d.onchange=function(a){g(a.target.selectedIndex)};return d};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.addDivider=function(a){var b=document.createElement("div");b.className="measure-horizontal-divider";a.appendChild(b);return b};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.findUnits=function(){var a,b,c=this.measureTool.getUnits();for(a=0;a<this.units.length;++a){var f=this.units[a].matches;if(f)for(b=0;b<f.length;++b)if(f[b]===c)return a}return 0};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild);for(var a=this.measureTool.getUnits(),a="ft"===a||"in"===a||"fractional-in"===a?"1 1/2 1/4 1/8 1/16 1/32 1/64".split(" "):"0 0.1 0.01 0.001 0.0001 0.00001".split(" "),b=0;b<a.length;++b){var c=document.createElement("option");c.value=b;c.textContent=a[b];this.precisionList.dropdownElement.appendChild(c)}b=
this.measureTool.getPrecision();a.length<=b&&(b=a.length-1,self.measureTool.setPrecision(b));this.precisionList.dropdownElement.selectedIndex=b};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.uninitialize=function(){this.viewer=null;Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this)};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.onTitleClick=function(a){};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.collapse=function(a){var b=this.container.children[0];a?(b.classList.remove("expanded"),b.classList.add("collapsed"),this.measureResults.style.display="none"):(b.classList.remove("collapsed"),b.classList.add("expanded"),this.measureResults.style.display="block");this.measureTool.getIndicator().setSimple(a);this.resizeToContent({maxHeight:this.parentContainer.offsetHeight-75})};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.deltaCollapse=function(){this.deltaButton.classList.toggle("rotated");this.measureTool.getIndicator().setSimple(this.isDeltaExpanded);this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"),
this.isDeltaExpanded=!0);this.resizeToContent()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.toggle=function(){this.deltaCollapse()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.updatePanel=function(){function a(a,f){"angle"===f?a.textContent=b.measureTool.getAngle():"xyz"===f?a.textContent=b.measureTool.getDistance(f):a.children[2].textContent=" = "+b.measureTool.getDistance(f)}var b=this;a(this.distanceDiv,"xyz");a(this.deltaXDiv,"x");a(this.deltaYDiv,"y");a(this.deltaZDiv,"z");a(this.angleDiv,"angle");this.unitList.dropdownElement.selectedIndex=this.findUnits();this.precisionList.dropdownElement.selectedIndex=
this.measureTool.getPrecision();this.showSelection1();this.showSelection2()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showDistanceResult=function(){this.results.style.display="block";this.initialDiv.style.display="none";this.angleDiv.style.display="none";this.angleIcon.style.display="none";this.distanceDiv.style.display="inline-block";this.distIcon.style.display="inline-block";this.deltaButton.style.display="inline-block";this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&
(this.deltaZDiv.style.display="block"));this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showAngleResult=function(){this.results.style.display="block";this.initialDiv.style.display="none";this.angleDiv.style.display="inline-block";this.angleIcon.style.display="inline-block";this.distanceDiv.style.display="none";this.distIcon.style.display="none";this.deltaButton.style.display="none";this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none");this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showSelection1=function(){var a=this.measureTool.getFirstGeometry();null!==a.type&&(this.selection1Result.textContent=a.type===SNAP_VERTEX?"Vertex":a.type===SNAP_EDGE?"Edge - "+this.measureTool.getEdgeLength(a.geometry):"Face - "+this.measureTool.getFaceArea(a.geometry),this.selection1Result.style.display="inline-block",this.selection1.style.display="block",this.resizeToContent())};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showSelection2=function(){var a=this.measureTool.getSecondGeometry();null!==a.type&&(this.selection2Result.textContent=a.type===SNAP_VERTEX?"Vertex":a.type===SNAP_EDGE?"Edge - "+this.measureTool.getEdgeLength(a.geometry):"Face - "+this.measureTool.getFaceArea(a.geometry),this.selection2Result.style.display="inline-block",this.selection2.style.display="block",this.resizeToContent())};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick();this.selection1Result.textContent=this.selection2Result.textContent;this.clearSelectionTwo();this.clearResult();this.resizeToContent()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick();this.clearSelectionTwo();this.clearResult();this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.hideMeasureResult=function(){this.clearSelectionOne();this.clearSelectionTwo();this.clearResult();this.resizeToContent()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.disableUnitOption=function(a){null!=a?this.unitList.dropdownElement.children[a].style.display="none":this.unitList.dropdownElement.disabled=!0};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showMeasureSettings=function(){this.isSettingsExpanded?(this.measureSettings.style.display="none",this.isSettingsExpanded=!1):(this.measureSettings.style.display="block",this.isSettingsExpanded=!0);this.resizeToContent()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.clearSelectionOne=function(){this.selection1Result.textContent="Select Object"};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.clearSelectionTwo=function(){this.selection2Result.textContent="Select Object"};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.clearResult=function(){this.distIcon.style.display="none";this.angleIcon.style.display="none";this.distanceDiv.style.display="none";this.angleDiv.style.display="none";this.initialDiv.style.display="inline-block";this.deltaButton.style.display="none";this.deltaXDiv.style.display="none";this.deltaYDiv.style.display="none";this.deltaZDiv.style.display="none"};AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_PRECISION=.001;
Autodesk.Viewing.Extensions.Measure.Snapper=function(a){function b(a,b){this.viewer=a;this.snapper=b;this.lineGeom=new THREE.Geometry;this.circularArc=null;this.circularArcCenter;this.ellipticalArc=null;this.minDist=Number.MAX_VALUE;this.vpIdElliptical=this.vpIdCircular=this.vpIdLine=null}var c=["snapper"],f=!1,g=.05,d=null,h=null,k=null,m=null,n=null,q=null,l=null,p=null,r=null,A=!1,C=!1,H=null;this.isActive=function(){return f};this.getNames=function(){return c};this.getName=function(){return c[0]};
this.activate=function(){f=!0};this.deactivate=function(){f=!1;this.destroy()};this.getFace=function(){return k};this.getEdge=function(){return m};this.getVertex=function(){return n};this.getSnapNode=function(){return q};this.getHighlightGeometry=function(){return l};this.getIntersectPoint=function(){return p};this.getFaceNormal=function(){return r};this.getEndPointsInEdge=function(a){a=a.vertices;for(var b=[],c=0;c<a.length;++c){for(var d=!1,f=0;f<a.length;++f)if(f!==c&&a[f].equals(a[c])){d=!0;break}d||
b.push(a[c])}return b};this.getViewportIndex=function(){return H};this.isSnapped=function(){return C};this.isEqualWithPrecision=function(a,b){return a<=b+SNAP_PRECISION&&a>=b-SNAP_PRECISION?!0:!1};this.isEqualVectorsWithPrecision=function(a,b){return a.x<=b.x+SNAP_PRECISION&&a.x>=b.x-SNAP_PRECISION&&a.y<=b.y+SNAP_PRECISION&&a.y>=b.y-SNAP_PRECISION&&a.z<=b.z+SNAP_PRECISION&&a.z>=b.z-SNAP_PRECISION?!0:!1};this.isInverseVectorsWithPrecision=function(a,b){return a.x<=-b.x+SNAP_PRECISION&&a.x>=-b.x-SNAP_PRECISION&&
a.y<=-b.y+SNAP_PRECISION&&a.y>=-b.y-SNAP_PRECISION&&a.z<=-b.z+SNAP_PRECISION&&a.z>=-b.z-SNAP_PRECISION?!0:!1};this.snapping3D=function(b){q=b.dbId;var c=b.face,f=b.intersectPoint;b=void 0===b.fragId.length?[b.fragId]:b.fragId;for(var E=0;E<b.length;++E){var B=a.impl.getRenderProxy(a.model,b[E]);if(k=this.faceSnapping(c,B.geometry)){m=this.edgeSnapping(k,f,B);n=this.vertexSnapping(m,f);k.applyMatrix(B.matrixWorld);m.applyMatrix(B.matrixWorld);n.applyMatrix4(B.matrixWorld);p=f.applyMatrix4(B.matrixWorld);
f=(new THREE.Matrix3).getNormalMatrix(B.matrixWorld);r=c.normal.applyMatrix3(f).normalize();g=this.setDetectRadius(p);h<g?(this.drawPoint(n),l=SNAP_VERTEX):d<g?(this.drawLine(m),l=SNAP_EDGE):(this.drawFace(k),l=SNAP_FACE);C=!0;break}}};this.faceSnapping=function(a,b){var c=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Geometry,h=b.attributes;if(void 0!==h.index){var k=h.index.array||b.ib,l=b.vb?b.vb:h.position.array,m=b.vb?b.vbstride:3;(h=b.offsets)&&0!==h.length||(h=[{start:0,
count:k.length,index:0}]);for(var n=0;n<h.length;++n)for(var p=h[n].start,q=h[n].count,r=h[n].index,A=p;A<p+q;A+=3){var C=r+k[A],H=r+k[A+1],aa=r+k[A+2];c.set(l[C*m],l[C*m+1],l[C*m+2]);d.set(l[H*m],l[H*m+1],l[H*m+2]);f.set(l[aa*m],l[aa*m+1],l[aa*m+2]);C=THREE.Triangle.normal(c,d,f);H=new THREE.Vector3;H.set(l[a.a*m],l[a.a*m+1],l[a.a*m+2]);this.isEqualVectorsWithPrecision(C,a.normal)&&this.isEqualWithPrecision(C.dot(c),a.normal.dot(H))&&(C=g.vertices.length,g.vertices.push(c.clone()),g.vertices.push(d.clone()),
g.vertices.push(f.clone()),g.faces.push(new THREE.Face3(C,C+1,C+2)))}}return 0<g.vertices.length?this.getTrianglesOnSameFace(g,a,l,m):null};this.getTrianglesOnSameFace=function(a,b,c,d){var f=!1;a=a.vertices.slice();var g=new THREE.Vector3;g.set(c[b.a*d],c[b.a*d+1],c[b.a*d+2]);var h=new THREE.Vector3;h.set(c[b.b*d],c[b.b*d+1],c[b.b*d+2]);var k=new THREE.Vector3;k.set(c[b.c*d],c[b.c*d+1],c[b.c*d+2]);b=new THREE.Geometry;b.vertices.push(g);b.vertices.push(h);b.vertices.push(k);b.faces.push(new THREE.Face3(0,
1,2));c=[];do{c=[];for(d=0;d<a.length;d+=3)if(a[d].equals(g)&&a[d+1].equals(h)&&a[d+2].equals(k))f=!0,c.push(d);else for(var l=0;l<b.vertices.length;l+=3)if(this.trianglesSharedEdge(a[d],a[d+1],a[d+2],b.vertices[l],b.vertices[l+1],b.vertices[l+2])){l=b.vertices.length;b.vertices.push(a[d].clone());b.vertices.push(a[d+1].clone());b.vertices.push(a[d+2].clone());b.faces.push(new THREE.Face3(l,l+1,l+2));c.push(d);break}for(d=c.length-1;0<=d;--d)a.splice(c[d],3)}while(0<c.length);return f?b:null};this.trianglesSharedEdge=
function(a,b,c,d,f,g){var h=!1,k=!1,l=!1;if(a.equals(d)||a.equals(f)||a.equals(g))h=!0;if(b.equals(d)||b.equals(f)||b.equals(g))k=!0;if(c.equals(d)||c.equals(f)||c.equals(g))l=!0;return h&k||h&l||k&l?!0:!1};this.edgeSnapping=function(a,b,c){for(var f=new THREE.Geometry,g=!0,h=!0,k=!0,l=0;l<a.vertices.length;l+=3){for(var m=0;m<a.vertices.length;m+=3)l!==m&&((a.vertices[l].equals(a.vertices[m])||a.vertices[l].equals(a.vertices[m+1])||a.vertices[l].equals(a.vertices[m+2]))&&(a.vertices[l+1].equals(a.vertices[m])||
a.vertices[l+1].equals(a.vertices[m+1])||a.vertices[l+1].equals(a.vertices[m+2]))&&(g=!1),(a.vertices[l].equals(a.vertices[m])||a.vertices[l].equals(a.vertices[m+1])||a.vertices[l].equals(a.vertices[m+2]))&&(a.vertices[l+2].equals(a.vertices[m])||a.vertices[l+2].equals(a.vertices[m+1])||a.vertices[l+2].equals(a.vertices[m+2]))&&(h=!1),(a.vertices[l+1].equals(a.vertices[m])||a.vertices[l+1].equals(a.vertices[m+1])||a.vertices[l+1].equals(a.vertices[m+2]))&&(a.vertices[l+2].equals(a.vertices[m])||a.vertices[l+
2].equals(a.vertices[m+1])||a.vertices[l+2].equals(a.vertices[m+2]))&&(k=!1));g&&(f.vertices.push(a.vertices[l].clone()),f.vertices.push(a.vertices[l+1].clone()));h&&(f.vertices.push(a.vertices[l].clone()),f.vertices.push(a.vertices[l+2].clone()));k&&(f.vertices.push(a.vertices[l+1].clone()),f.vertices.push(a.vertices[l+2].clone()));k=h=g=!0}a=new THREE.Geometry;var n,g=Number.MAX_VALUE,h=new THREE.Matrix4;h.getInverse(c.matrixWorld);b.applyMatrix4(h);for(c=0;c<f.vertices.length;c+=2)h=this.distancePointToLine(b,
f.vertices[c],f.vertices[c+1]),h<g&&(g=h,n=c);a.vertices.push(f.vertices[n].clone());a.vertices.push(f.vertices[n+1].clone());a.vertices=this.getConnectedLineSegmentsOnSameLine(f,a.vertices);d=g;return a};this.distancePointToLine=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3,g;d.subVectors(b,a);f.subVectors(c,b);g=d.dot(f);d.subVectors(c,b);g=-g/d.dot(d);0>g?a=a.distanceTo(b):1<g?a=a.distanceTo(c):(d.subVectors(a,b),f.subVectors(a,c),d.cross(f),f.subVectors(c,b),a=Math.sqrt(d.dot(d))/
Math.sqrt(f.dot(f)));return a};this.getConnectedLineSegmentsOnSameLine=function(a,b){var c=a.vertices.slice(),d=b[0],f=b[1],g=[];do{for(var g=[],h=0;h<c.length;h+=2)if(!c[h].equals(d)||!c[h+1].equals(f))for(var k=0;k<b.length;k+=2)if(c[h].equals(b[k])||c[h+1].equals(b[k])||c[h].equals(b[k+1])||c[h+1].equals(b[k+1])){var l=new THREE.Vector3,m=new THREE.Vector3;l.subVectors(b[k],b[k+1]);l.normalize();m.subVectors(c[h],c[h+1]);m.normalize();if(this.isEqualVectorsWithPrecision(l,m)||this.isInverseVectorsWithPrecision(l,
m)){g.push(h);break}}for(h=g.length-1;0<=h;--h)b.push(c[g[h]]),b.push(c[g[h]+1]),c.splice(g[h],2)}while(0<g.length);return b};this.vertexSnapping=function(a,b){for(var c=Number.MAX_VALUE,d,f=0;f<a.vertices.length;++f){var g=b.distanceTo(a.vertices[f]);g<c-SNAP_PRECISION&&(c=g,d=a.vertices[f].clone())}h=c;return d};this.angleVector2=function(a){return 0<a.x&&0<=a.y?Math.atan(a.y/a.x):0<=a.x&&0>a.y?Math.atan(a.y/a.x)+2*Math.PI:0>a.x&&0>=a.y?Math.atan(a.y/a.x)+Math.PI:0>=a.x&&0<a.y?Math.atan(a.y/a.x)+
Math.PI:null};b.prototype.onLineSegment=function(a,b,c,d,f){var g=this.lineGeom.vertices;a=new THREE.Vector3(a,b,0);c=new THREE.Vector3(c,d,0);d=this.snapper.getIntersectPoint();d=this.snapper.distancePointToLine(d,a,c);d<this.minDist&&(g.splice(0,2,a,c),this.minDist=d,this.vpIdLine=f)};b.prototype.onCircularArc=function(a,b,c,d,f,g){var h=this.snapper.getIntersectPoint(),k=new THREE.Vector2(h.x,h.y),l=new THREE.Vector2(a,b),h=k.distanceTo(l);k.sub(l);k=this.snapper.angleVector2(k);if(h<=f+.1&&h>=
f-.1){if(d>c&&k>=c&&k<=d)c=new THREE.CircleGeometry(f,100,c,d-c);else if(d<c&&(k>=c||k<=d))c=new THREE.CircleGeometry(f,100,c,2*Math.PI-c+d);else return;c.vertices.splice(0,1);this.circularArc=c;this.circularArcCenter=new THREE.Vector3(a,b,0);this.vpIdCircular=g}};b.prototype.onEllipticalArc=function(a,b,c,d,f,g,h,k){h=this.snapper.getIntersectPoint();var l=new THREE.Vector2(h.x,h.y);h=(l.x-a)*(l.x-a)/(f*f)+(l.y-b)*(l.y-b)/(g*g);var m=new THREE.Vector2(a,b);l.sub(m);l.x*=g;l.y*=f;l=this.snapper.angleVector2(l);
d>2*Math.PI&&(d=2*Math.PI);1.1>=h&&.9<=h&&(d>c&&l>=c&&l<=d||d<c&&(l>=c||l<=d))&&(a=new THREE.EllipseCurve(a,b,f,g,c,d,!1),a=(new THREE.Path(a.getPoints(50))).createPointsGeometry(50),this.isEqualWithPrecision(d-c,2*Math.PI)||a.vertices.pop(),this.ellipticalArc=a,this.vpIdElliptical=k)};this.snapping2D=function(c){if(c){var d=c.intersectPoint,f=c.fragId;if("undefined"!==typeof f){Array.isArray(f)||(f=[f]);p=d;for(var h=new b(a,this),k=0;k<f.length;++k){var q=a.impl.getRenderProxy(a.model,f[k]);(new Autodesk.Viewing.Private.VertexBufferReader(q.geometry)).enumGeomsForObject(c.dbId,
h)}h.circularArc?(this.drawArc(h.circularArc,h.circularArcCenter),h.circularArc=null,n=h.circularArcCenter,l=SNAP_VERTEX,H=h.vpIdCircular,C=!0):h.ellipticalArc?(this.drawArc(h.ellipticalArc),h.ellipticalArc=null):h.lineGeom.vertices.length&&(g=this.setDetectRadius(d),d.distanceTo(h.lineGeom.vertices[0])<g?(n=h.lineGeom.vertices[0],this.drawPoint(n),l=SNAP_VERTEX):d.distanceTo(h.lineGeom.vertices[1])<g?(n=h.lineGeom.vertices[1],this.drawPoint(n),l=SNAP_VERTEX):(m=h.lineGeom,this.drawLine(m),l=SNAP_EDGE),
H=h.vpIdLine,C=!0)}}};this.createOverlay=function(b){a.impl.createOverlayScene(b)};this.addOverlay=function(b,c){a.impl.addOverlay(b,c)};this.clearOverlay=function(){a.impl.overlayScenes["MeasureTool-snapper-face"]&&a.impl.clearOverlay("MeasureTool-snapper-face");a.impl.overlayScenes["MeasureTool-snapper-vertex"]&&a.impl.clearOverlay("MeasureTool-snapper-vertex");a.impl.overlayScenes["MeasureTool-snapper-edge"]&&a.impl.clearOverlay("MeasureTool-snapper-edge")};this.drawFace=function(a){this.createOverlay("MeasureTool-snapper-face");
var b=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide});a=new THREE.Mesh(a,b,!0);this.addOverlay("MeasureTool-snapper-face",a)};this.drawLine=function(a){this.createOverlay("MeasureTool-snapper-edge");var b=new THREE.LineBasicMaterial({color:52224,opacity:.5,linewidth:5,depthTest:!1,depthWrite:!1});a=new THREE.Line(a,b,THREE.LinePieces);this.addOverlay("MeasureTool-snapper-edge",a)};this.drawArc=function(a,b){this.createOverlay("MeasureTool-snapper-edge");
var c=new THREE.LineBasicMaterial({color:52224,opacity:.5,linewidth:5,depthTest:!1,depthWrite:!1}),c=new THREE.Line(a,c);b&&c.position.set(b.x,b.y,b.z);this.addOverlay("MeasureTool-snapper-edge",c)};this.drawPoint=function(a){this.createOverlay("MeasureTool-snapper-vertex");var b=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),b=new THREE.Mesh(new THREE.SphereGeometry(1),b);b.position.set(a.x,a.y,a.z);this.setPointScale(b);this.addOverlay("MeasureTool-snapper-vertex",
b)};this.setPointScale=function(b){var c=a.navigation,d=c.getCamera(),f=c.getEyeVector(),g=c.getPosition(),h=b.position.clone(),d=d.isPerspective?h.sub(g).dot(f.normalize()):c.getEyeVector().length(),f=c.getVerticalFov(),d=2*d*Math.tan(THREE.Math.degToRad(.5*f)),c=c.getScreenViewport(),c=5*d/(c.height*(window.devicePixelRatio||1));b.scale.x=c;b.scale.y=c;b.scale.z=c};this.updatePointScale=function(){var b=a.impl.overlayScenes["MeasureTool-snapper-vertex"];if(b)for(var b=b.scene,c=0;c<b.children.length;c++){var d=
b.children[c];d&&this.setPointScale(d)}};this.setDetectRadius=function(b){var c=a.navigation,d=c.getCamera(),f=c.getEyeVector(),g=c.getPosition();b=b.clone();d=d.isPerspective?b.sub(g).dot(f.normalize()):c.getEyeVector().length();f=c.getVerticalFov();d=2*d*Math.tan(THREE.Math.degToRad(.5*f));c=c.getScreenViewport();c=1.5*d/(c.height*(window.devicePixelRatio||1));a.impl.is2d&&(c*=10);return c};this.drawIntersectFace=function(a,b,c,d){this.createOverlay();var f=new THREE.Vector3;f.set(b[a.a*c],b[a.a*
c+1],b[a.a*c+2]);var g=new THREE.Vector3;g.set(b[a.b*c],b[a.b*c+1],b[a.b*c+2]);var h=new THREE.Vector3;h.set(b[a.c*c],b[a.c*c+1],b[a.c*c+2]);a=new THREE.Geometry;a.vertices.push(f);a.vertices.push(g);a.vertices.push(h);a.faces.push(new THREE.Face3(0,1,2));f=new THREE.Mesh(a,d.material,!0);f.matrixWorld=d.matrixWorld;this.addOverlay(f)};this.handleWheelInput=function(a){this.updatePointScale();return!1};this.handleButtonDown=function(a,b){A=!0;return!1};this.handleButtonUp=function(a,b){return A=!1};
this.handleMouseMove=function(b){A||(this.clearOverlay(),n=m=k=null,C=!1,(b=a.impl.renderer().hasMRT()?a.impl.snappingHitTest(b.canvasX,b.canvasY,!1):a.impl.hitTest(b.canvasX,b.canvasY,!1))&&b.intersectPoint&&(b.face?this.snapping3D(b):this.snapping2D(b)));return!1};this.destroy=function(){this.clearOverlay();a.impl.removeOverlayScene("MeasureTool-snapper-face");a.impl.removeOverlayScene("MeasureTool-snapper-vertex");a.impl.removeOverlayScene("MeasureTool-snapper-edge")}};AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson");
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(a){var b=-1!=navigator.userAgent.search("Mac OS"),c=a.navigation,f=a.container,g=c.getCamera(),d=["firstperson"],h=0,k=Autodesk.Viewing.theHotkeyManager.KEYCODES,m=!1,n=!0,q=!1,l=null,p=new THREE.Clock(!0),r=-1,A=5E3,C=1,H=2,z=0,t=-1E20,w=-1E20,E=0,B=0,D=!1,J=!1,F=!1,G=!1,M=!1,I=!1,L=!1;this.isActive=function(){return m};this.getNames=function(){return d};this.getName=function(){return d[0]};this.activate=function(b){p.start();c.toPerspective();
c.setVerticalFov(75,!0);a.model.getUnitScale();b=a.model.getBoundingBox().size();C=Math.max(Math.min(Math.min(b.x,b.y),b.z)/10,1E-4);a.canvas.focus();m=!0;L||R()};this.deactivate=function(a){m=!1;p.stop();O()};this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"};
this.adjustSpeed=function(a){0===a?H=2:(H*=0<a?1.1:.9,.01>H&&(H=.01))};this.handleGesture=function(a){switch(a.type){case "dragstart":return l="drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===l?this.handleMouseMove(a):!1;case "dragend":if("drag"===l)return this.handleButtonUp(a,0),l=null,!0}return!1};this.handleSingleClick=function(a,b){return!1};this.handleButtonDown=function(a,c){var d;l?d=!0:(d=a.metaKey&&!b,d=a.ctrlKey||b&&a.metaKey||d||a.shiftKey||a.altKey);0!==c||d||(E=B=0,q=
!0);return!0};this.handleMouseMove=function(a){var b=-1E10>t?0:a.pageX-t,c=-1E10>w?0:a.pageY-w;t=a.pageX;w=a.pageY;q===n&&(E+=.0035*b,B+=.0035*c);return!0};this.handleButtonUp=function(a,b){0===b&&q&&(E=B=0,q=!1);return!0};this.handleKeyDown=function(a,b){var c=!1;switch(b){case k.TAB:c=!1;break;case k.SHIFT:h=1;c=!0;break;case k.CONTROL:c=!0;break;case k.ALT:c=!0;break;case k.SPACE:c=!0;break;case k.EQUALS:this.adjustSpeed(1);c=!0;break;case k.DASH:this.adjustSpeed(-1);c=!0;break;case k.ZERO:this.adjustSpeed(0);
c=!0;break;case k.UP:case k.w:c=D=!0;break;case k.LEFT:case k.a:c=F=!0;break;case k.DOWN:case k.s:c=J=!0;break;case k.RIGHT:case k.d:c=G=!0;break;case k.q:c=M=!0;break;case k.e:c=I=!0;break;case k.g:c=!0;break;case k.F1:c=!0}return c};this.handleKeyUp=function(a,b){var c=!1;switch(b){case k.TAB:c=!1;break;case k.SHIFT:h=0;c=!0;break;case k.CONTROL:c=!0;break;case k.ALT:c=!0;break;case k.SPACE:c=!0;break;case k.UP:case k.w:D=!1;c=!0;break;case k.LEFT:case k.a:F=!1;c=!0;break;case k.DOWN:case k.s:J=
!1;c=!0;break;case k.RIGHT:case k.d:G=!1;c=!0;break;case k.q:M=!1;c=!0;break;case k.e:I=!1;c=!0;break;case k.g:c=n=!n;O();K({msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:c?"Press the primary mouse button and drag to change the view orientation.":"Move the cursor to change the view orientation."},5E3);c=!0;break;case k.F1:R(),c=!0}return c};this.handleWheelInput=function(a){c.getReverseZoomDirection()&&(a*=-1);z+=a;return!0};this.handleSingleClick=
function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return this.handleSingleClick(a,0)};this.handleDoubleTap=function(a){return!1};this.handleBlur=function(a){return M=I=F=G=D=J=!1};this.update=function(){if(!m)return!1;var a=p.getDelta();-1<r&&(new Date).getTime()-r>A&&O();g.isPerspective||(console.log("Lost perspective mode: resetting view."),c.toPerspective());var b=g.clone(),d=a*H*C*(1===h?4:1),a=.5*a*C*(1===h?4:1);0!=z&&(b.translateZ(-(1*z*
C*(1===h?4:1))),z=0);D&&b.translateZ(-d);J&&b.translateZ(d);F&&b.translateX(-d);G&&b.translateX(d);M&&b.translateY(a);I&&b.translateY(-a);var d=b.position,a=0!==d.distanceToSquared(g.position),f=b.target,f=g.target.clone().sub(g.position),k=f.clone().cross(g.up).normalize();if(0!=B){var l=new THREE.Quaternion;l.setFromAxisAngle(k,-B);k=f.clone();k.applyQuaternion(l);var n=g.worldup.clone(),k=k.angleTo(n),n=THREE.Math.degToRad(5);k>=n&&k<=Math.PI-n&&(f.applyQuaternion(l),b.up.applyQuaternion(l));B=
0}0!=E&&(l=new THREE.Quaternion,l.setFromAxisAngle(g.worldup,-E),f.applyQuaternion(l),b.up.applyQuaternion(l),E=0);f=d.clone().add(f);b=0!==f.distanceToSquared(g.target);if(a||b)c.setView(d,f),c.orientCameraUp();return g.dirty};var K=function(a,b,c,d,g){Autodesk.Viewing.Private.HudMessage.displayMessage(f,a,c,d,g);0<b?(r=(new Date).getTime(),A=b):(r=-1,A=0)},O=function(){Autodesk.Viewing.Private.HudMessage.dismiss();r=-1},R=function(){O();K({msgTitleKey:"First Person Tool",messageKey:"First Person Tool",
messageDefaultValue:"Use the WASD and QE keys to move.  Shift+Key to move faster.  G key toggles view orientation drag mode.  F1 to view this help.",checkboxChecked:L},5E3,null,null,function(a){L=a.target.checked})}};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson");Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension;
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(b);b.toolController.registerTool(this.tool);this.createUI(c);this.onToolChanged=function(b){-1!==b.toolName.indexOf("firstperson")&&a.firstPersonToolButton.setState(b.active?f.Button.State.ACTIVE:f.Button.State.INACTIVE)};b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);
return!0};
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(a){var b=this,c=this.viewer,f=Autodesk.Viewing.UI;a=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new f.Button("toolbar-firstPersonTool");this.firstPersonToolButton.setToolTip("First person");this.firstPersonToolButton.onClick=function(a){a=b.firstPersonToolButton.getState();a===f.Button.State.INACTIVE?c.setActiveNavigationTool("firstperson"):a===f.Button.State.ACTIVE&&c.setActiveNavigationTool()};
this.firstPersonToolButton.setIcon("adsk-icon-first-person");var g=a.getControl("toolbar-cameraSubmenuTool");g?a.addControl(this.firstPersonToolButton,{index:a.indexOf(g.getId())}):a.addControl(this.firstPersonToolButton)};
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);this.onToolChanged=void 0;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId());this.firstPersonToolButton=null;a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool();
a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.VR");
Autodesk.Viewing.Extensions.VR.VRTool=function(a,b){var c=a.navigation,f=a.container,g=c.getCamera(),d=["vr"],h=!1,k=null,m=!1,n=0,q=0,l=Autodesk.Viewing.theHotkeyManager.KEYCODES,p=0,r=!1,A=!1,C=!1,H=!1,z=!1,t=!1,w=new THREE.Clock(!0),E=-1,B=5E3,D=1,J=16,F=!1,G=16,M=g.isPerspective,I=null,L=null,K=null,O=!1,R=-1,X=!0,W=null,aa=null,fa=!1,U=new THREE.Vector3(0,0,0),P=new THREE.Vector3(0,0,0),Z=!1;this.isActive=function(){return h};this.getNames=function(){return d};this.getName=function(){return d[0]};
this.activate=function(b){h||(m=g.worldup&&1===g.worldup.z,console.log("VRTool : camera world up = "+g.worldup.x+","+g.worldup.y+","+g.worldup.z),w.start(),ea()?(ca({msgTitleKey:"VR Head Mounted Display",messageKey:"VR Head Mounted Display",messageDefaultValue:"VR Mode Enabled (Head Mounted Display) - Use SPACE key to toggle move control."},2E3),S(!1),console.log("VR Supported (Web API): Oculus, etc.")):(ca({msgTitleKey:"VR Device Orientation",messageKey:"VR Device Orientation",messageDefaultValue:"VR Mode Enabled (Device Orientation)"},
2E3),window.addEventListener("deviceorientation",V,!0)),Z="wearality"===(a.config&&a.config.useVR?a.config.useVR:"").toLowerCase(),N(!0),b=a.utilities.getBoundingBox(!0).size(),D=Math.max(Math.min(Math.min(b.x,b.y),b.z)/100,1),this.resetPointerTracking(),a.canvas.focus(),Y(),h=!0)};this.deactivate=function(a){h&&(h=!1,Autodesk.Viewing.Private.HudMessage.dismiss(),E=-1,I&&(K&&(K.stop(),K=null),I.disconnect(),I=null,L&&L.disable()),N(!1),exitFullscreen(),w.stop(),S(!0))};this.getCursor=function(){return"url(data:image/gif;base64,R0lGODlhGAAYAMIDAAQEBH19feDg4P///////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAQALAAAAAAYABgAAAMqSLrc/jDKSau9OOvN8fjDNghBIITZEABAgHpr+15jeYpgp+987//AICEBADs=), auto"};
var S=function(a){var b=document.getElementsByClassName("toolbar-menu");0<b.length&&""!==b[0]&&(b[0].style.display=a?"block":"none")},N=function(b){if(b!==!!k)if(console.log("Enable Render Context: "+b),b){a.displayViewCube(!1,!1);(M=a.navigation.isPerspective)||a.navigation.toPerspective();b=!!W;var c=null,c=Z?{useWarp:b,HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.075,lensSeparationDistance:.075,eyeToScreenDistance:.041,distortionK:[1,.22,
.24,0],chromaAbParameter:[.996,-.004,1.014,0]}}:{useWarp:b};k=new Autodesk.Viewing.Extensions.Oculus.StereoRenderContext(c);a.impl.setUserRenderContext(k);a.resize(a.canvas.clientWidth,a.canvas.clientHeight);W?launchFullscreen(a.impl.canvas,{vrDisplay:W}):launchFullscreen(a.impl.canvas)}else k=null,a.impl.setUserRenderContext(null),a.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),a.displayViewCube(a.prefs.get("viewCube"),!1)};this.handleSingleTap=function(b){if(I&&b.pointers){if(1===b.pointers.length)return setTimeout(function(){a.setActiveNavigationTool(a.defaultNavigationToolName)},
10),!0;if(2===b.pointers.length)return ia(),!0}return!1};this.handleDoubleTap=function(a){return!1};this.handlePressHold=function(a){return!1};this.handleGesture=function(a){return!1};this.handleKeyDown=function(a,b){var c=!1;switch(b){case l.TAB:c=!0;break;case l.SHIFT:n=1;c=!0;break;case l.CONTROL:q=1;c=!0;break;case l.ALT:c=!0;break;case l.SPACE:c=!0;break;case l.EQUALS:this.adjustSpeed(1);c=!0;break;case l.DASH:this.adjustSpeed(-1);c=!0;break;case l.ZERO:this.adjustSpeed(0);c=!0;break;case l.w:if(1===
q&&1===n){c=!0;break}case l.UP:c=r=!0;break;case l.LEFT:case l.a:c=C=!0;break;case l.DOWN:case l.s:c=A=!0;break;case l.RIGHT:case l.d:c=H=!0;break;case l.q:c=t=!0;break;case l.e:c=z=!0;break;case l.h:c=!0}return c};this.handleKeyUp=function(a,b){var c=!1;switch(b){case l.SHIFT:n=0;break;case l.CONTROL:q=0;break;case l.SPACE:W&&W&&((fa=!fa)&&U.copy(P),sa(fa));c=!0;break;case l.w:if(!r&&1===q&&1===n){setTimeout(function(){N(!1);Z=!Z;N(!0)},10);c=!0;break}case l.UP:r=!1;c=!0;break;case l.LEFT:case l.a:C=
!1;c=!0;break;case l.DOWN:case l.s:A=!1;c=!0;break;case l.RIGHT:case l.d:H=!1;c=!0;break;case l.q:t=!1;c=!0;break;case l.e:z=!1;c=!0;break;case l.h:Y(),c=!0}return c};this.handleBlur=function(a){return H=C=A=r=!1};this.update=function(a){if(h){a=w.getDelta();-1<E&&(new Date).getTime()-E>B&&(Autodesk.Viewing.Private.HudMessage.dismiss(),E=-1);var b;if(b=!!W)if(aa){b=aa.getState();if(g){m?(P.x=b.position.x,P.y=-b.position.z,P.z=b.position.y):(P.x=b.position.x,P.y=b.position.y,P.z=b.position.z);if(fa){var d=
U.distanceTo(P);.15<=d&&(d=(d-.15)/.0762*J*D*a,d=P.clone().sub(U).normalize().multiplyScalar(d),g.position.add(d))}m?(g.quaternion.x=b.orientation.x,g.quaternion.y=-b.orientation.z,g.quaternion.z=b.orientation.y):(g.quaternion.x=b.orientation.x,g.quaternion.y=b.orientation.y,g.quaternion.z=b.orientation.z);g.quaternion.w=b.orientation.w;b=new THREE.Vector3(0,0,-1);m&&(b=new THREE.Vector3(b.x,-b.z,b.y));b.applyQuaternion(g.quaternion);g.target=g.position.clone().add(b.clone().multiplyScalar(10));g.dirty=
!0}b=!0}else b=!1;!b&&I&&I&&(b=I.update())&&(m&&(d=b.z,b.z=b.y,b.y=-d),b=(m?new THREE.Vector3(0,1,0):new THREE.Vector3(0,0,-1)).clone().applyQuaternion(b),d=g.target.clone().sub(g.position).length(),c.setTarget(g.position.clone().add(b.multiplyScalar(d))),K?K.isStarted()&&(0>=R?K.checkVideoThreshold(15)&&ia():K.checkVideoThreshold(15)?F&&(b=(new Date).getTime(),d=b-R,250<d&&(R=b,J+=G,sa(!0))):R=-1):(d=m?new THREE.Vector3(0,0,-1):new THREE.Vector3(0,-1,0),b=THREE.Math.radToDeg(b.angleTo(d)),30>b)?
O?F&&(b=(new Date).getTime(),d=b-R,d>=(X?1500:1E3)&&(X=!1,R=b,J+=G,sa(!0))):(ia(),O=!0,F&&(X=!0)):30<=b&&(O=!1,R=-1),g.dirty=!0);b=g.clone();d=a*J*D*(1===n?4:1);a=15*a*D*(1===n?4:1);0!=p&&(b.translateZ(-(3*p*D*(1===n?4:1))),p=0);var f=!1;F&&(f=!0);(r||f)&&b.translateZ(-d);A&&b.translateZ(d);C&&b.translateX(-d);H&&b.translateX(d);z&&b.translateY(a);t&&b.translateY(-a);a=b.position;0!==a.distanceToSquared(g.position)&&(b=b.target,d=a.clone().sub(g.position),b.add(d),c.setView(a,b));return g.dirty}};
this.resetPointerTracking=function(){_mouseDraggingLookMode=z=t=C=H=r=A=!1};var ia=function(){(F=!F)?(G=J,J=1.75,R=(new Date).getTime()):J=G;sa(F);return F},ea=function(){function a(c){for(var d=0;d<c.length;++d)c[d]instanceof HMDVRDevice&&(W=c[d]);for(d=0;d<c.length;++d)c[d]instanceof PositionSensorVRDevice&&(!W||c[d].hardwareUnitId==W.hardwareUnitId)&&(aa=c[d],b=!0)}var b=!1;navigator.getVRDevices?navigator.getVRDevices().then(a):navigator.mozGetVRDevices?navigator.mozGetVRDevices(a):b=!1;return b},
V=function(a){if(!a.alpha)return!1;window.removeEventListener("deviceorientation",V,!0);I=new THREE.DeviceOrientationControls;I.connect();L||(L=new window.NoSleep,L.enable());K=new VideoHelper("videoVR","videoVR-canvas",1);K.start()||(K=null,console.log("VideoHelper : Failed to start."));S(!1);console.log("VR Supported (DeviceOrientation): Google Goggles, etc.");return!0},ca=function(a,b){Autodesk.Viewing.Private.HudMessage.dismiss();Autodesk.Viewing.Private.HudMessage.displayMessage(f,a);E=(new Date).getTime();
if(!b||0>=b)b=5E3;B=b},Y=function(){ca({msgTitleKey:"Virtual Reality Tool",messageKey:"Virtual Reality Tool",messageDefaultValue:"This is the Virtual Reality tool."},3E3)},sa=function(a,b){if(!b||0>=b)b=250;ca({msgTitleKey:"VR Toggle Move",messageKey:"VR Toggle Move",messageDefaultValue:a?"START Auto Move ("+Math.floor(J)+")":"STOP Auto Move"},b)}};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.VR");
Autodesk.Viewing.Extensions.VR.VRExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.VR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.VR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.VR.VRExtension;
Autodesk.Viewing.Extensions.VR.VRExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.VR.VRTool(b,this);b.toolController.registerTool(this.tool);this.createUI(c);this.onToolChanged=function(b){-1!==b.toolName.indexOf("vr")&&a.vrToolButton.setState(b.active?f.Button.State.ACTIVE:f.Button.State.INACTIVE)};b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);return!0};
Autodesk.Viewing.Extensions.VR.VRExtension.prototype.createUI=function(a){var b=this,c=this.viewer,f=Autodesk.Viewing.UI;a=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new f.Button("toolbar-vrTool");this.vrToolButton.setToolTip("Virtual Reality Tool");this.vrToolButton.setIcon("toolbar-vrToolButton");this.vrToolButton.onClick=function(a){a=b.vrToolButton.getState();a===f.Button.State.INACTIVE?c.setActiveNavigationTool("vr"):a===f.Button.State.ACTIVE&&c.setActiveNavigationTool()};
var g=a.getControl("toolbar-cameraSubmenuTool");g?a.addControl(this.vrToolButton,{index:a.indexOf(g.getId())}):a.addControl(this.vrToolButton)};
Autodesk.Viewing.Extensions.VR.VRExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);this.onToolChanged=void 0;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId());this.vrToolButton=null;a.toolController.deregisterTool(this.tool);this.tool=null;return!0};
Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.VR",Autodesk.Viewing.Extensions.VR.VRExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");
(function(){var a=Autodesk.Viewing.Extensions.FusionOrbit;a.FusionOrbitExtension=function(a,c){Autodesk.Viewing.Extension.call(this,a,c)};a.FusionOrbitExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);a.FusionOrbitExtension.prototype.constructor=a.FusionOrbitExtension;a.FusionOrbitExtension.prototype.load=function(){function a(){f.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);c.createUI()}var c=this,f=this.viewer,g=f.getToolbar?f.getToolbar(!0):void 0;this.tool=
new Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool(f);f.toolController.registerTool(this.tool);g?(g=g.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID))&&0<g.getNumberOfControls()?a():f.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a):f.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);return!0};a.FusionOrbitExtension.prototype.createUI=function(){var a=this.viewer,c=Autodesk.Viewing.UI,f=a.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.classicBehavior=
{};this.classicBehavior.orbitOnClick=f.orbitbutton.onClick;this.classicBehavior.freeorbitOnClick=f.freeorbitbutton.onClick;this.classicBehavior.returnToDefault=f.returnToDefault;f.freeorbitbutton.onClick=function(g){g=f.freeorbitbutton.getState();g===c.Button.State.INACTIVE?(a.setActiveNavigationTool("fusion orbit"),f.freeorbitbutton.setState(c.Button.State.ACTIVE)):g===c.Button.State.ACTIVE&&(a.setActiveNavigationTool(),f.freeorbitbutton.setState(c.Button.State.INACTIVE))};f.orbitbutton.onClick=
function(g){g=f.orbitbutton.getState();g===c.Button.State.INACTIVE?(a.setActiveNavigationTool("fusion orbit constrained"),f.orbitbutton.setState(c.Button.State.ACTIVE)):g===c.Button.State.ACTIVE&&(a.setActiveNavigationTool(),f.orbitbutton.setState(c.Button.State.INACTIVE))};f.returnToDefault=function(){f.orbittoolsbutton.setState(c.Button.State.ACTIVE);f.orbittoolsbutton.setState(c.Button.State.INACTIVE)};f.orbittoolsbutton.setState(c.Button.State.INACTIVE);a.prefs.fusionOrbitConstrained?(f.orbittoolsbutton.onClick=
f.orbitbutton.onClick,f.orbittoolsbutton.setIcon(f.orbitbutton.iconClass),a.setDefaultNavigationTool("orbit")):(f.orbittoolsbutton.onClick=f.freeorbitbutton.onClick,f.orbittoolsbutton.setIcon(f.freeorbitbutton.iconClass),a.setDefaultNavigationTool("freeorbit"));a.setActiveNavigationTool();f.returnToDefault()};a.FusionOrbitExtension.prototype.unload=function(){var a=this.viewer,c=a.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c.orbitbutton.onClick=this.classicBehavior.orbitOnClick;
c.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick;c.returnToDefault=this.classicBehavior.returnToDefault;c.orbittoolsbutton&&(c.orbittoolsbutton.onClick=c.orbitbutton.onClick,c.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),c.orbittoolsbutton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE));a.setActiveNavigationTool("orbit");a.setDefaultNavigationTool("orbit");a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",
a.FusionOrbitExtension)})();Autodesk.Viewing.Extensions.FusionOrbit.html='<div class="orbit-gizmo noselect">\n<div class="outside"></div>\n<div class="ring"></div>\n<div class="layout-hor">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n<div class="layout-mid">\n<div class="layout-ver">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n<div class="circle">\n<div class="crosshair-area">\n<div class="crosshair-v"></div>\n<div class="crosshair-h"></div>\n</div>\n</div>\n<div class="layout-ver">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n</div>\n<div class="layout-hor">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n</div>';
Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(a,b){var c=["fusion orbit","fusion orbit constrained"],f,g,d,h,k,m=a.navigation,n,q=isTouchDevice(),l=!1,p={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},r=function(a){p.buttons[a.touches?0:a.button]=!0;p.src=a.target.className;p.x=0;p.y=0;p.dx=0;p.dy=0;p.firstMove=!0;p.mode=void 0;"ring"===p.src?p.mode=2:"edgemark-area"===p.src&&("layout-ver"===a.target.parentNode.className?p.mode=0:"layout-hor"===a.target.parentNode.className&&
(p.mode=1));t();a.stopPropagation()},A=function(a){p.buttons[a.touches?0:a.button]=!1;p.src=void 0},C=function(a){if(p.buttons[0]){var b=a.touches?a.touches[0].pageX:a.pageX;a=a.touches?a.touches[0].pageY:a.pageY;p.firstMove||(p.dx=b-p.x,p.dy=a-p.y);p.x=b;p.y=a;b=n.target.clone().sub(n.position).normalize();a=b.clone().cross(n.up).normalize();var c=a.clone().cross(b).normalize();n.up.copy(c);if(2===p.mode){var d=new THREE.Vector3(p.x-g.center.x,p.y-g.center.y,0),f=(new THREE.Vector3(p.dx,p.dy,0)).add(d);
d.normalize();f.normalize();d=d.clone().cross(f);d=Math.asin(d.z);n.up.applyAxisAngle(b,1*-d)}else 0===p.mode?(f=.005*-p.dx,k&&(n.up=Autodesk.Viewing.Navigation.snapToAxis(n.up.clone())),d=n.up):1===p.mode&&(f=.005*-p.dy,k?(p.firstMove&&(n.up=Autodesk.Viewing.Navigation.snapToAxis(n.up.clone())),d=b.clone().cross(n.up).normalize()):d=a,n.up.applyAxisAngle(d,f)),b=m.getPivotPoint(),a=n.position.clone().sub(b),a.applyAxisAngle(d,f),n.position.addVectors(b,a),a=n.target.clone().sub(b),a.applyAxisAngle(d,
f),n.target.addVectors(b,a);n.dirty=!0;p.firstMove=!1}},H=function(){var b=n.target.clone().sub(n.position).normalize();return(b=a.impl.rayIntersect(new THREE.Ray(n.position,b)))&&b.intersectPoint?b.intersectPoint:n.target},z=function(a,b){var c=b||a.clone().sub(n.position).normalize();return new THREE.Plane(c,-c.x*a.x-c.y*a.y-c.z*a.z)},t=function(){var a=n.target.clone().sub(n.position).normalize(),b=z(n.position,a).distanceToPoint(n.pivot);n.pivot.copy(a).multiplyScalar(b).add(n.position)},w=function(a){a.touches||
0!==a.button||t()},E=function(b){l&&a.setActiveNavigationTool()},B=function(b,c){var d=a.impl.hitTest(b,c),d=d&&d.intersectPoint?d.intersectPoint:a.impl.viewportToRay(a.impl.clientToViewport(b,c)).intersectPlane(z(n.target)),f=n.position.clone().sub(H()).add(d);m.setRequestTransition(!0,f,d,n.fov)};this.register=function(){f=stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html);f.style.display="none";a.canvasWrap.insertBefore(f,a.canvasWrap.firstChild);d=f.querySelector(".ring");d.addEventListener("mousedown",
r);Array.prototype.forEach.call(f.querySelectorAll(".edgemark-area"),function(a,b){a.addEventListener("mousedown",r);q&&a.addEventListener("touchstart",r)});window.addEventListener("mouseup",A);window.addEventListener("mousemove",C);h=f.querySelector(".outside");h.addEventListener("mousedown",E);var b=f.querySelector(".circle");b.addEventListener("mousedown",w);q&&(d.addEventListener("touchstart",r),window.addEventListener("touchend",A),window.addEventListener("touchmove",C),h.addEventListener("touchstart",
E),b.addEventListener("touchstart",w));n=a.impl.camera};this.deregister=function(){window.removeEventListener("mouseup",A);window.removeEventListener("mousemove",C);q&&(window.removeEventListener("touchend",A),window.removeEventListener("touchmove",C));d=f=void 0};this.activate=function(b){f.style.display="";this.handleResize();(k="fusion orbit constrained"===b)?(a.setDefaultNavigationTool("orbit"),a.prefs.set("fusionOrbitConstrained",!0)):(a.setDefaultNavigationTool("freeorbit"),a.prefs.set("fusionOrbitConstrained",
!1));a.navigation.setZoomTowardsPivot(!0)};this.deactivate=function(b){f.style.display="none";a.navigation.setZoomTowardsPivot(a.prefs.zoomTowardsPivot)};this.getNames=function(){return c};this.getName=function(){return c[0]};this.update=function(){return!1};this.handleSingleClick=function(a,b){B(a.canvasX,a.canvasY);return!0};this.handleDoubleClick=function(a,b){return!0};this.handleSingleTap=function(a){B(a.canvasX,a.canvasY);return!0};this.handleDoubleTap=function(a){return!1};this.handleKeyDown=
function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(b){var c=a.impl.canvas.getBoundingClientRect();b=1.2<(c.width>c.height?new THREE.Vector2(((b.canvasX+.5)/c.width*2-1)*c.width/c.height,2*-((b.canvasY+.5)/c.height)+1):new THREE.Vector2((b.canvasX+.5)/c.width*2-1,(2*-((b.canvasY+.5)/c.height)+1)*c.height/c.width)).length();
l!==b&&(h.style.cursor=b?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",
l=b);return!1};this.handleGesture=function(a){t();return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){g=f.getBoundingClientRect();g.center={};g.center.x=g.left+g.width/2;g.center.y=g.top+g.height/2;var a=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth);f.style.width=f.style.height=""+a+"px";f.style.top=f.style.left="calc(50% - "+a/2+"px)";d.style.borderWidth=""+.1*a+"px"}};AutodeskNamespace("Autodesk.Viewing.Private.Collaboration");
(function(){function a(a,b,c){function g(b){b=b.data.msg;n.x=b.x1;n.y=b.y1;q.x=b.x2;q.y=b.y2;l=b.explode;b.command&&("gohome"==b.command?(n.x=n.y=0,q.x=q.y=0,a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0),p=null):"select"==b.command?(b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0)))?a.impl.selector.toggleSelection(b.dbId):a.impl.selector.clearSelection():"hide"==b.command?(b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0)))&&a.hide(b.dbId):"fly"==b.command?
p=p?null:r.target.clone().sub(r.position).normalize():"savepoint"==b.command?(b=H.getState(w),z.push(b),alertify.success("Savepoint created.")):"nextsavepoint"==b.command&&z.length&&(t>=z.length&&(t=0),H.restoreState(z[t++])))}var n=new THREE.Vector2,q=new THREE.Vector2,l=0,p=null,r,A=.02,C=.002,H,z=[],t=0,w={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},E=function(){if(!a.impl.svfloader.isf2d){var b=a.impl.svfloader.svf.bbox.size().length();
A*=b;C*=b;a.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,E)}};a.addEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,E);this.getNames=function(){return["joystick"]};this.getName=function(){return"joystick"};this.activate=function(l){b.addEventListener("joystick",g);c.addEventListener("joystick",g);r=a.navigation.getCamera();a.model&&(a.model.getBoundingBox().size().length(),H=new f.ViewerState(a))};this.deactivate=function(a){b.removeEventListener("joystick",g);c.removeEventListener("joystick",
g);H=r=null;z.length=0};this.update=function(b){r.isPerspective||a.navigation.toPerspective();p&&(b=p.clone().multiplyScalar(C),r.position.add(b),r.target.add(b));0!=l&&(b=a.getExplodeScale()+.01*l,1<b&&(b=1),0>b&&(b=0),a.explode(b));if(0==n.x&&0==n.y&&0==q.x&&0==q.y)return!(!p&&!l);var c=r.target.clone().sub(r.position);b=c.length();c.multiplyScalar(1/b);var f=c.clone().cross(r.up).normalize(),g=c.clone().multiplyScalar(n.y*A);r.position.add(g);r.target.add(g);g=f.clone().multiplyScalar(n.x*A);r.position.add(g);
r.target.add(g);g=new THREE.Quaternion;g.setFromAxisAngle(f,.05*q.y);c=c.clone().applyQuaternion(g);r.up.applyQuaternion(g);f=new THREE.Quaternion;f.setFromAxisAngle(r.worldup,.05*-q.x);c.applyQuaternion(f);r.up.applyQuaternion(f);c.multiplyScalar(b);r.target.copy(r.position).add(c);p&&p.copy(r.target).sub(r.position).normalize();return!0};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};this.handleDoubleTap=function(a,
b){return!1};this.handleKeyDown=function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(a){return!1};this.handleGesture=function(a,b){return!1};this.handleTouchChange=function(a,b){return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,f=b.Private,g=b.UI;c.RemoteControl=
function(c,g){b.Extension.call(this,c,g);this.viewer=c;this.client=f.MessageClient.GetInstance();this.p2p=new f.P2PClient(this.client);this.controllerTool=new a(c,this.client,this.p2p);c.toolController.registerTool(this.controllerTool)};c.RemoteControl.prototype=Object.create(b.Extension.prototype);c.RemoteControl.prototype.constructor=c.RemoteControl;c.RemoteControl.prototype.createUI=function(){var a=this,b=this.viewer;this.controlButton=new g.Button("toolbar-remoteControlTool");this.controlButton.setToolTip("Pair with controller device");
this.controlButton.onClick=function(){this.getState()===g.Button.State.INACTIVE?(a.connect(),this.setState(g.Button.State.ACTIVE)):(a.disconnect(),this.setState(g.Button.State.INACTIVE))};this.controlButton.setIcon("adsk-icon-game-controller");b.modelTools.addControl(this.controlButton);this.panel=new Autodesk.Viewing.UI.DockingPanel(b.container,"remote-panel","Remote Control");this.panel.width=300;this.panel.height=375;this.panel.container.style.width=this.panel.width+"px";this.panel.container.style.height=
this.panel.height+"px";this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px";this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px";this.panel.body=document.createElement("div");this.panel.body.classList.add("body");this.panel.container.appendChild(this.panel.body);this.panel.body.innerHTML='<p>Go to this link:</p>\n<p><a class="url" target="_blank" href="#">Link</a></p>\n<p>or</p>\n<p>Scan the QR code with your device:</p>\n<img class="qr-img" src="">';
this.panel.link=this.panel.container.querySelector(".url");this.panel.code=this.panel.container.querySelector(".code");this.panel.qrImg=this.panel.container.querySelector(".qr-img")};c.RemoteControl.prototype.load=function(){function a(f){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);c.createUI()}var b=this.viewer,c=this;b.modelTools&&0<b.modelTools.getNumberOfControls()?c.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);return!0};c.RemoteControl.prototype.unload=
function(){var a=this.viewer;this.p2p.hangup();this.client.disconnect();a.toolController.deactivateTool(this.controllerTool.getName());this.panel&&(this.panel.setVisible(!1),this.panel=null);if(this.controlButton)try{a.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(b){stderr("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0};c.RemoteControl.prototype.addCrosshair=function(){this.crosshair=stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>');
this.viewer.canvasWrap.appendChild(this.crosshair)};c.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()};c.RemoteControl.prototype.connect=function(a){if(this.client.isConnected())console.log("RemoteControl already connected");else{var b=this,c=this.viewer;b.client.addEventListener("connectSucceeded",function(c){function g(){l&&l.setVisible(!1);b.p2p.removeEventListener(g);b.addCrosshair()}stderr("connect succeeded");c=c.data.id+"rc";b.client.join(c);c=(LMV_RESOURCE_ROOT.length?
LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+c+"&env="+f.env;var k="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(c),l=b.panel;l&&(l.link.href=c,l.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",l.qrImg.src=k,l.setVisible(!0));b.p2p.addEventListener("dataChannelAdded",g);a&&a instanceof Function&&a(c)});c.navigation.toPerspective();b.client.connect();c.toolController.activateTool(b.controllerTool.getName())}};
c.RemoteControl.prototype.disconnect=function(){this.p2p.hangup();this.client.disconnect();this.viewer.toolController.deactivateTool(this.controllerTool.getName());this.removeCrosshair()};b.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",c.RemoteControl)})();"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Section");Autodesk.Viewing.Extensions.Section.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b);this.viewer=a};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension;
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){function a(){c.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);b.createUI()}var b=this,c=this.viewer;this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(c);c.toolController.registerTool(this.tool);this.tool.setOutlineColor({r:1,g:0,b:0});var f=c.getToolbar?c.getToolbar(!0):void 0;f?(f=f.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID))&&0<f.getNumberOfControls()?a():c.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,
a):c.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);c.addEventListener(Autodesk.Viewing.RESET_EVENT,function(){b.tool&&b.tool.resetSection()});this.HOTKEYS_ID="Autodesk.Section.Hotkeys";Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return b.enableSectionTool(!1)}}]);return!0};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(a){if(this.tool){var b=this.viewer.toolController,c=this.tool.isActive();if(a&&!c)return b.activateTool("section"),this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!a&&c)return b.deactivateTool("section"),this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return!1};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var a=this.viewer;this.sectionToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-sectionTool");this.sectionToolButton.setToolTip("Section analysis");this.sectionToolButton.setIcon("adsk-icon-section-analysis");this.createSubmenu(this.sectionToolButton);var a=a.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),b=a.getControl("toolbar-resetTool");b?a.addControl(this.sectionToolButton,{index:a.indexOf(b.getId())}):
a.addControl(this.sectionToolButton,{index:0})};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState();c===d.Button.State.INACTIVE?(a.setState(d.Button.State.ACTIVE),f.enableSectionTool(!0),!1===this instanceof d.ComboButton?f.tool.setSection(b):f.tool.attachControl(!0)):c===d.Button.State.ACTIVE&&(a.setState(d.Button.State.INACTIVE),f.enableSectionTool(!1))}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){a.subVectors(b,c);return a.lengthSq()<
d}}(),b=new THREE.Vector3(1,0,0),d=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),l=g.autocam.getWorldRightVector(),p=g.autocam.getWorldUpVector(),r=g.autocam.getWorldFrontVector();a(p,b,1E-4)?f.sectionYButton.setIcon("adsk-icon-plane-x"):a(p,h,1E-4)?f.sectionYButton.setIcon("adsk-icon-plane-z"):f.sectionYButton.setIcon("adsk-icon-plane-y");a(l,d,1E-4)?f.sectionXButton.setIcon("adsk-icon-plane-y"):a(l,h,1E-4)?f.sectionXButton.setIcon("adsk-icon-plane-z"):f.sectionXButton.setIcon("adsk-icon-plane-x");
a(r,b,1E-4)?f.sectionZButton.setIcon("adsk-icon-plane-x"):a(r,d,1E-4)?f.sectionZButton.setIcon("adsk-icon-plane-y"):f.sectionZButton.setIcon("adsk-icon-plane-z");g.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var f=this,g=this.viewer,d=Autodesk.Viewing.UI,h=this.sectionXButton=new d.Button("toolbar-sectionTool-x");h.setToolTip("Add X plane");h.setIcon("adsk-icon-plane-x");h.onClick=b(h,"X");a.addControl(h);h=this.sectionYButton=new d.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane");
h.setIcon("adsk-icon-plane-y");h.onClick=b(h,"Y");a.addControl(h);h=this.sectionZButton=new d.Button("toolbar-sectionTool-z");h.setToolTip("Add Z plane");h.setIcon("adsk-icon-plane-z");h.onClick=b(h,"Z");a.addControl(h);h=this.sectionBoxButton=new d.Button("toolbar-sectionTool-box");h.setToolTip("Add box");h.setIcon("adsk-icon-box");h.onClick=b(h,"BOX");a.addControl(h);g.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var a=this.viewer.getToolbar(!1);if(a&&(a=a.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID))&&this.sectionToolButton){var b=a.getControl("toolbar-inspectSubMenu");b?b.removeControl(this.sectionToolButton.getId()):a.removeControl(this.sectionToolButton.getId());this.sectionToolButton=null}};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var a=this.viewer;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);this.destroyUI();a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.Section");
Autodesk.Viewing.Extensions.Section.SectionTool=function(a,b){function c(){r.invalidate(!1,!1,!0)}function f(){t&&t.update();w&&w.update()}function g(a){init_three_triangulator();init_three_intersector();var b=r.model.getData().instanceTree;if(b){var c=r.modelQueue().getFragmentList(),d=r.sceneAfter.getObjectByName("section");d&&r.sceneAfter.remove(d);d=new THREE.Object3D;d.name="section";r.sceneAfter.add(d);var f=new THREE.Object3D;d.add(f);var g=new THREE.Object3D;d.add(g);var h=Autodesk.Viewing.Private,
k=h.Intersector.makePlaneBasis(a),l=(new THREE.Matrix4).getInverse(k),d=r.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),m=r.matman().findMaterial(null,d);m.transparent=!0;m.depthTest=!0;m.polygonOffset=!0;m.polygonOffsetFactor=-1;m.polygonOffsetUnits=1;var n=new THREE.Box3;r.getVisibleBounds(!0).size().length();b.enumNodeChildren(r.model.getRootId(),function(d){var p=[],q;b.enumNodeFragments(d,function(b){c.getWorldBounds(b,n);h.Intersector.intersectBoxPlane(a,n)&&(q=c.getVizmesh(b),
q.geometry&&(q.geometry.is2d||q.geometry.isLines||h.Intersector.intersectMeshPlane(a,q,p)))},!1);if(p.length){var t=new THREE.Box3;h.Intersector.convertToPlaneCoords(k,p,t);var w=new VertexBufferBuilder(!1,8*p.length),B=0|63.875*q.material.color.r,z=0|63.875*q.material.color.g,A=0|63.875*q.material.color.b,C=4278190080|A<<16|z<<8|B,D=new h.Triangulator.ContourSet(p,t);D.snapEdges();D.stitchContours();for(t=0;t<D.contours.length;t++)for(var E=D.contours[t],B=0|255.5*Math.random(),z=0|255.5*Math.random(),
A=0|255.5*Math.random(),B=1;B<E.length;B++)z=D.pts[E[B-1]],A=D.pts[E[B]],w.addSegment(z.x,z.y,A.x,A.y,.01,C,d,0);t={mesh:w.toMesh()};h.SvfLoader.meshToGeometry(t);t=t.geometry;t.streamingDraw=!0;t.streamingIndex=!0;t=new THREE.Mesh(t,m);t.matrix.copy(l);t.matrixAutoUpdate=!1;t.frustumCulled=!1;g.add(t);w=new h.Triangulator.TriangulatedSurface(D);if(w.indices.length){D=new THREE.BufferGeometry;C=new Float32Array(3*w.pts.length);for(t=0;t<w.pts.length;t++)C[3*t]=w.pts[t].x,C[3*t+1]=w.pts[t].y,C[3*t+
2]=0;D.addAttribute("position",new THREE.BufferAttribute(C,3));E=(C=q.material.packedNormals)?new Uint16Array(2*w.pts.length):new Float32Array(3*w.pts.length);for(t=0;t<w.pts.length;t++)C?(E[2*t]=32767.5*(0/Math.PI+1)|0,E[2*t+1]=65535):(E[3*t]=0,E[3*t+1]=0,E[3*t+2]=1);D.addAttribute("normal",new THREE.BufferAttribute(E,C?2:3));C&&(D.attributes.normal.bytesPerItem=2,D.attributes.normal.normalize=!0);t=new Uint16Array(w.indices.length);t.set(w.indices);D.addAttribute("index",new THREE.BufferAttribute(t,
1));D.streamingDraw=!0;D.streamingIndex=!0;t=r.matman().cloneMaterial(q.material);t.packedNormals=C;t.cutplanes=null;t.side=THREE.FrontSide;t.depthTest=!0;t.map=null;t.bumpMap=null;t.specularMap=null;t.transparent=!1;t.depthWrite=!0;t.hatchPattern=!0;t.needsUpdate=!0;w=Math.tan((q.material.id+2)*Math.PI*.125);t.hatchParams=new THREE.Vector2(w,10);t=new THREE.Mesh(D,t);t.matrix.copy(l);t.matrixAutoUpdate=!1;t.dbId=d;f.add(t)}}},!0)}}function d(a,b){b=b||r.getVisibleBounds();var c=new THREE.Vector3(0,
0,1),c=(new THREE.Quaternion).setFromUnitVectors(c,a.normal),d=a.projectPoint(b.max),f=a.projectPoint(b.min),g=c.clone().inverse();d.applyQuaternion(g);f.applyQuaternion(g);d=(new THREE.Vector3).subVectors(d,f);d=new THREE.PlaneBufferGeometry(d.x,d.y);f=new THREE.MeshBasicMaterial({opacity:.1,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0});d=new M.SectionMesh(d,f,a);f=a.projectPoint(b.center());d.position.copy(f);d.quaternion.multiply(c);return d}function h(){k(function(a){if(a instanceof
M.SectionMesh&&0<a.connectivity.length){for(var b=(new THREE.Matrix4).getInverse(a.matrixWorld),c=new THREE.Vector3,d=a.geometry.getAttribute("position"),f=0;f<d.length/d.itemSize;f++){var g=a.connectivity[f];null!==I(a.plane,g[0],g[1],c)&&(c.applyMatrix4(b),d.setXYZ(f,c.x,c.y,c.z))}d.needsUpdate=!0}})}function k(a){for(var b=0;b<E.length;b++)E[b].traverse(a)}function m(){k(function(a){a instanceof M.SectionMesh&&a.update()});1===B.length&&g((new THREE.Plane).setComponents(B[0].x,B[0].y,B[0].z,B[0].w));
r.setCutPlanes(B)}function n(a){for(var b=0;b<E.length;b++)E[b].visible=a;z!==a&&c();z=a}function q(b){b&&0<B.length&&(1===B.length&&g((new THREE.Plane).setComponents(B[0].x,B[0].y,B[0].z,B[0].w)),a.setCutPlanes(B));n(b)}function l(a,b){a.attach(b);a.setPosition(b.position)}function p(a){var b=new THREE.Group;a=new THREE.Plane(a,0);a=d(a);b.add(a);B.push(a.planeVec);E.push(b);r.addOverlay("gizmo",b);l(t,a);t.showRotationGizmos(!0);D=t.getPicker();m()}var r=a.impl,A=["section"],C=!1,H=!1,z=!0,t,w,
E=[],B=[],D=[],J="",F=null,G=!1,M=Autodesk.Viewing.Extensions.Section;init_TransformGizmos();init_SectionMesh();var I=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(f,g,h,k){a.set(f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,g.normal.z,h.normal.x,h.normal.y,h.normal.z);var l=a.determinant();if(0===l)return null;b.crossVectors(g.normal,h.normal).multiplyScalar(-f.constant);c.crossVectors(h.normal,f.normal).multiplyScalar(-g.constant);
d.crossVectors(f.normal,g.normal).multiplyScalar(-h.constant);return(k||new THREE.Vector3).copy(b).add(c).add(d).divideScalar(l)}}(),L=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster,d=r.camera;return function(f,g){var h=r.canvas.getBoundingClientRect(),k=(f.clientX-h.left)/h.width*2-1,h=2*-((f.clientY-h.top)/h.height)+1;d.isPerspective?(a.set(k,h,.5),a.unproject(d),c.set(d.position,a.sub(d.position).normalize())):(a.set(k,h,-1),a.unproject(d),b.set(0,0,-1),c.set(a,b.transformDirection(d.matrixWorld)));
k=c.intersectObjects(g,!0);return k[0]?k[0]:!1}}();this.isActive=function(){return C};this.setSection=function(a){this.clearSection();switch(a){case "X":var b=new THREE.Vector3(1,0,0);p(b);break;case "Y":b=new THREE.Vector3(0,1,0);p(b);break;case "Z":b=new THREE.Vector3(0,0,1);p(b);break;case "BOX":for(var c=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],b=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],
[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],f=new THREE.Group,g=r.getVisibleBounds(),h=g.center(),g=new THREE.Box3(g.min,h),k=[],n=[],q=0;q<c.length;q++){var z=new THREE.Plane(c[q],-1*h.dot(c[q]));k.push(z);if(2<q){var A=z.orthoPoint(g.max),C=z.orthoPoint(g.min),A=(new THREE.Vector3).subVectors(A,C);z.constant-=A.length()}z=d(z,g);f.add(z);n.push(z);B.push(z.planeVec)}for(q=0;q<n.length;q++)for(z=n[q],c=b[q],h=0;h<c.length;h++){for(var A=
[],C=c[h],F=0;F<C.length;F++)A.push(k[C[F]]);z.connectivity.push(A)}E.push(f);r.addOverlay("gizmo",f);w.setSize(g.getBoundingSphere().radius/6);l(t,E[0].children[0]);l(w,E[0]);t.showRotationGizmos(!1);D=t.getPicker().concat(w.getPicker());m()}J=a};this.clearSection=function(){t&&t.detach();for(w&&w.detach();0<B.length;)B.pop();for(;0<E.length;){var a=E.pop();r.removeOverlay("gizmo",a)}(a=r.sceneAfter.getObjectByName("section"))&&r.sceneAfter.remove(a);r.setCutPlanes()};this.isPlaneOn=function(){return z};
this.showPlane=function(a){n(a)};this.attachControl=function(a){a?(l(t,E[0].children[0]),"BOX"===J&&l(w,E[0])):(t.detach(),w.detach())};this.setOutlineColor=function(a){r.setCutPlanesOutlineColor(a)};this.resetSection=function(){this.setSection(J)};this.getNames=function(){return A};this.getName=function(){return A[0]};this.register=function(){};this.deregister=function(){this.clearSection();G&&(r.removeOverlay("gizmo",t),t.removeEventListener("change",c),t=null,r.removeOverlay("gizmo",w),w.removeEventListener("change",
c),w=null,r.removeOverlayScene("gizmo"),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),G=!1)};this.activate=function(b){G||(t=new THREE.TransformControls(r.camera,r.canvas,"transrotate"),t.addEventListener("change",c),t.setSnap(Math.PI/2,Math.PI/36),w=new THREE.TransformControls(r.camera,r.canvas,"translate"),w.addEventListener("change",c),void 0===r.overlayScenes.gizmo&&r.createOverlayScene("gizmo"),r.addOverlay("gizmo",t),r.addOverlay("gizmo",w),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,
f),G=!0);C=!0;H=!1;B=B||[];q(!0)};this.deactivate=function(a){H=C=!1;(a=r.sceneAfter.getObjectByName("section"))&&r.sceneAfter.remove(a);q(!1);r.setCutPlanes();t.detach();w.detach()};this.update=function(){return!1};this.handleSingleClick=function(a,b){var d=L(a.pointers?a.pointers[0]:a,E);d&&(l(t,d.object),c());return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return this.handleSingleClick(a,0)};this.handleDoubleTap=function(a){return!1};this.handleKeyDown=
function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){H=!0;return w.onPointerDown(a)?!0:t.onPointerDown(a)};this.handleButtonUp=function(a,b){H=!1;return w.onPointerUp(a)?!0:t.onPointerUp(a)};this.handleMouseMove=function(a){if(H){if(w.onPointerMove(a))return m(),t.update(),!0;if(t.onPointerMove(a))return m(),h(),!0}if("touch"!==a.pointerType){k(function(a){a instanceof M.SectionMesh&&(a.material.opacity=a.materialOpacity)});
var b=a.pointers?a.pointers[0]:a,c=L(b,E);c&&(c.object.material.opacity=.2);b=c||L(b,D)?!0:!1;t.visible=b;w.visible=void 0!==w.object&&b;n(b)}return w.onPointerHover(a)?!0:t.onPointerHover(a)};this.handleGesture=function(a){switch(a.type){case "dragstart":return F="drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===F?this.handleMouseMove(a):!1;case "dragend":if("drag"===F)return F=null,this.handleButtonUp(a,0)}return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){};
this.handlePressHold=function(a){return!0}};
function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1);this.plane=c;this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant);this.materialColor=this.material.color.clone();this.materialOpacity=this.material.opacity;this.connectivity=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=
Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1);this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b);this.plane.constant=b})}
function init_TransformGizmos(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this);
this.depthWrite=this.depthTest=!1;this.transparent=!0;this.linewidth=1;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(a,b,c,f){function g(a){var b=a.normalize().clone();b.index=r.vertices.push(b)-
1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function q(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);r.faces.push(d);B.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(B.z,-B.x);r.faceVertexUvs[0].push([p(a.uv,a,d),p(b.uv,b,d),p(c.uv,c,d)])}function l(a,b){var c=Math.pow(2,b);Math.pow(4,b);for(var d=g(r.vertices[a.a]),f=g(r.vertices[a.b]),h=g(r.vertices[a.c]),k=[],
l=0;l<=c;l++){k[l]=[];for(var m=g(d.clone().lerp(h,l/c)),p=g(f.clone().lerp(h,l/c)),t=c-l,w=0;w<=t;w++)k[l][w]=0==w&&l==c?m:g(m.clone().lerp(p,w/t))}for(l=0;l<c;l++)for(w=0;w<2*(c-l)-1;w++)d=Math.floor(w/2),0==w%2?q(k[l][d+1],k[l+1][d],k[l][d]):q(k[l][d+1],k[l+1][d+1],k[l+1][d])}function p(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,
indices:b,radius:c,detail:f};c=c||1;f=f||0;for(var r=this,A=0,C=a.length;A<C;A+=3)g(new THREE.Vector3(a[A],a[A+1],a[A+2]));a=this.vertices;for(var H=[],z=A=0,C=b.length;A<C;A+=3,z++){var t=a[b[A]],w=a[b[A+1]],E=a[b[A+2]];H[z]=new THREE.Face3(t.index,w.index,E.index,[t.clone(),w.clone(),E.clone()])}for(var B=new THREE.Vector3,A=0,C=H.length;A<C;A++)l(H[A],f);A=0;for(C=this.faceVertexUvs[0].length;A<C;A++)b=this.faceVertexUvs[0][A],f=b[0].x,a=b[1].x,H=b[2].x,z=Math.max(f,Math.max(a,H)),t=Math.min(f,
Math.min(a,H)),.9<z&&.1>t&&(.2>f&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>H&&(b[2].x+=1));A=0;for(C=this.vertices.length;A<C;A++)this.vertices[A].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype));void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,
1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype));void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(a,b,c,f,g){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:f,arc:g};a=a||100;b=b||40;c=c||8;f=f||6;g=g||2*Math.PI;for(var q=new THREE.Vector3,l=[],
p=[],r=0;r<=c;r++)for(var A=0;A<=f;A++){var C=A/f*g,H=r/c*Math.PI*2;q.x=a*Math.cos(C);q.y=a*Math.sin(C);var z=new THREE.Vector3;z.x=(a+b*Math.cos(H))*Math.cos(C);z.y=(a+b*Math.cos(H))*Math.sin(C);z.z=b*Math.sin(H);this.vertices.push(z);l.push(new THREE.Vector2(A/f,r/c));p.push(z.clone().sub(q).normalize())}for(r=1;r<=c;r++)for(A=1;A<=f;A++)a=(f+1)*r+A-1,b=(f+1)*(r-1)+A-1,g=(f+1)*(r-1)+A,q=(f+1)*r+A,C=new THREE.Face3(a,b,q,[p[a].clone(),p[b].clone(),p[q].clone()]),this.faces.push(C),this.faceVertexUvs[0].push([l[a].clone(),
l[b].clone(),l[q].clone()]),C=new THREE.Face3(b,g,q,[p[b].clone(),p[g].clone(),p[q].clone()]),this.faces.push(C),this.faceVertexUvs[0].push([l[b].clone(),l[g].clone(),l[q].clone()]);this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var c=function(a,b,c){var f=new THREE.Geometry;c=c?c:1;for(var g=0;g<=64*c;++g)"x"==b&&f.vertices.push((new THREE.Vector3(0,Math.cos(g/32*Math.PI),Math.sin(g/32*Math.PI))).multiplyScalar(a)),"y"==b&&f.vertices.push((new THREE.Vector3(Math.cos(g/
32*Math.PI),0,Math.sin(g/32*Math.PI))).multiplyScalar(a)),"z"==b&&f.vertices.push((new THREE.Vector3(Math.sin(g/32*Math.PI),Math.cos(g/32*Math.PI),0)).multiplyScalar(a));return f},f=function(a,b,c,f,g,q){var l=new THREE.Geometry;a=new THREE.Mesh(new THREE.CylinderGeometry(a,b,c,f,g,q));a.position.y=.5;a.updateMatrix();l.merge(a.geometry,a.matrix);return l},g=function(a){var b=new THREE.Geometry;"X"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===a?b.vertices.push(new THREE.Vector3(0,
0,0),new THREE.Vector3(0,1,0)):"Z"===a&&b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));return b};THREE.TransformGizmo=function(){var a=this;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.highlights=new THREE.Object3D;this.hemiPicker=new THREE.Object3D;this.subPickers=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);this.add(this.highlights);
this.add(this.hemiPicker);this.add(this.subPickers);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c],a[c].visible=!1;this.setupGizmos();this.activeMode="";this.traverse(function(a){if(a instanceof
THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;a.geometry instanceof THREE.BufferGeometry&&(a.geometry=(new THREE.Geometry).fromBufferGeometry(a.geometry));b.merge(a.geometry,a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.hide=function(){this.traverse(function(a){a.visible=!1})};this.show=function(){this.traverse(function(b){b.visible=!0;if(b.parent==a.pickers||b.parent==a.hemiPicker)b.visible=!1;b.parent==a.planes&&(b.visible=!1)});this.activePlane.visible=
!1};this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})};this.setupGizmos=function(){var a=function(a,b){for(var c in a)for(var d=a[c].length;d--;){var f=a[c][d][0],g=a[c][d][1],h=a[c][d][2],A=a[c][d][3];f.name=c;g&&f.position.set(g[0],g[1],g[2]);h&&f.rotation.set(h[0],h[1],h[2]);A&&(f.visble=A);b.add(f)}};this.setHandlePickerGizmos();a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);
a(this.highlightGizmos,this.highlights);a(this.hemiPickerGizmos,this.hemiPicker);a(this.subPickerGizmos,this.subPickers);this.hide();this.show()}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Matrix4;this.traverse(function(q){q.name&&(-1!=q.name.search("E")?q.quaternion.setFromRotationMatrix(g.lookAt(b,c,f)):-1==q.name.search("X")&&-1==q.name.search("Y")&&
-1==q.name.search("Z")||q.quaternion.setFromEuler(a))})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);this.setHandlePickerGizmos=function(){var c=f(0,.05,.2,12,1,!1),h=g("X"),k=g("Y"),m=g("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(h,new b({color:15805484}))]],Y:[[new THREE.Mesh(c,new a({color:768011})),[0,.5,0]],[new THREE.Line(k,new b({color:768011}))]],Z:[[new THREE.Mesh(c,new a({color:2895089})),[0,
0,.5],[Math.PI/2,0,0]],[new THREE.Line(m,new b({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),
[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,
.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]};this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new a({color:255})),[.5,.5,.5],null,!1]]}};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));
"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);"XY"==a&&(this.activePlane=this.planes.XY);"YZ"==a&&(this.activePlane=this.planes.YZ);"XZ"==a&&(this.activePlane=this.planes.XZ);this.hide();
this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(c(1,"x",.5),new b({color:16711680}))]],RY:[[new THREE.Line(c(1,"y",.5),new b({color:65280}))]],RZ:[[new THREE.Line(c(1,"z",.5),new b({color:255}))]],RE:[[new THREE.Line(c(1.25,"z",1),new b({color:65535}))]],RXYZE:[[new THREE.Line(c(1,"z",1),new b({color:16711935}))]]};
this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,
.12,2,24),new a({color:16711935,opacity:.25}))]]}};this.setActivePlane=function(a){"RE"==a&&(this.activePlane=this.planes.XYZE);"RX"==a&&(this.activePlane=this.planes.YZ);"RY"==a&&(this.activePlane=this.planes.XZ);"RZ"==a&&(this.activePlane=this.planes.XY);this.hide();this.show()};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,f=new THREE.Euler(0,0,1),g=new THREE.Quaternion,q=new THREE.Vector3(1,0,0),l=new THREE.Vector3(0,1,0),p=new THREE.Vector3(0,
0,1),r=new THREE.Quaternion,A=new THREE.Quaternion,C=new THREE.Quaternion,H=b.clone();f.copy(this.planes.XY.rotation);g.setFromEuler(f);c.makeRotationFromQuaternion(g).getInverse(c);H.applyMatrix4(c);this.traverse(function(a){g.setFromEuler(f);"RX"==a.name&&(r.setFromAxisAngle(q,Math.atan2(-H.y,H.z)),g.multiplyQuaternions(g,r),a.quaternion.copy(g));"RY"==a.name&&(A.setFromAxisAngle(l,Math.atan2(H.x,H.z)),g.multiplyQuaternions(g,A),a.quaternion.copy(g));"RZ"==a.name&&(C.setFromAxisAngle(p,Math.atan2(H.y,
H.x)),g.multiplyQuaternions(g,C),a.quaternion.copy(g))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var b=this;this.setHandlePickerGizmos=function(){var b=f(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(b,new a({color:16777215})),
[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new a({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new a({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:255})),[0,0,0],[Math.PI/2,0,.35*
Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new a({color:255})),[0,0,1]]]};this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:255,opacity:.25})),[0,0,0],[Math.PI/
2,0,.35*Math.PI]]]};this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]};this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]};this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,
8,8,0,Math.PI),new a({color:255})),null,null,!1]]}};this.setActivePlane=function(a,b){if("translate"==this.activeMode){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=
this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY));this.hide();this.show()};this.update=function(a,b){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),f=new THREE.Quaternion,g=new THREE.Vector3(1,
0,0),p=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),A=new THREE.Quaternion,C=new THREE.Quaternion,H=new THREE.Quaternion,z=b.clone();d.copy(this.planes.XY.rotation);f.setFromEuler(d);c.makeRotationFromQuaternion(f).getInverse(c);z.applyMatrix4(c);this.traverse(function(a){f.setFromEuler(d);"RX"==a.name&&(A.setFromAxisAngle(g,Math.atan2(-z.y,z.z)),f.multiplyQuaternions(f,A),a.quaternion.copy(f));"RY"==a.name&&(C.setFromAxisAngle(p,Math.atan2(z.x,z.z)),f.multiplyQuaternions(f,C),a.quaternion.copy(f));
"RZ"==a.name&&(H.setFromAxisAngle(r,Math.atan2(z.y,z.x)),f.multiplyQuaternions(f,H),a.quaternion.copy(f))})}};this.show=function(){this.traverse(function(a){if(null==b.parent||b.parent.useAllPickers||a.parent!=b.handles)a.visible=!0;a.material&&(a.material.opacity=a.material.oldOpacity);if(a.parent==b.pickers||a.parent==b.hemiPicker||a.parent==b.subPickers)a.visible=!1;if(a.parent==b.planes||a.parent==b.highlights)a.visible=!1});this.activePlane.visible=!1};this.highlight=function(a){this.traverse(function(c){if(c.material&&
c.material.highlight)if(c.name==a){if(c.parent==b.highlights||c.parent==b.handles)c.visible=!0;c.material.highlight(!0)}else c.material.highlight(!1),c.material.opacity=.1})};this.init()};THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);this.setHandlePickerGizmos=function(){var c=f(.125,.125,.125),h=g("X"),k=g("Y"),m=g("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),
[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(h,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(k,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(m,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,
0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]}};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,
Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);this.hide();this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformControls=function(a,b,c){function f(c,g){var k=
b.getBoundingClientRect(),l=(c.clientX-k.left)/k.width*2-1,k=2*-((c.clientY-k.top)/k.height)+1;a.isPerspective?(w.set(l,k,.5),w.unproject(a),t.set(a.position,w.sub(a.position).normalize())):(w.set(l,k,-1),w.unproject(a),E.set(0,0,-1),t.set(w,E.transformDirection(a.matrixWorld)));l=t.intersectObjects(g,!0);return l[0]?l[0]:!1}THREE.Object3D.call(this);b=void 0!==b?b:document;this.gizmo={};switch(c){case "translate":this.gizmo[c]=new THREE.TransformGizmoTranslate;break;case "rotate":this.gizmo[c]=new THREE.TransformGizmoRotate;
break;case "transrotate":this.gizmo[c]=new THREE.TransformGizmoTranslateRotate;break;case "scale":this.gizmo[c]=new THREE.TransformGizmoScale}this.add(this.gizmo[c]);this.gizmo[c].hide();this.object=void 0;this.snap=null;this.snapDelta=0;this.space="world";this.size=1;this.axis=null;this.useAllPickers=!0;this.unitX=new THREE.Vector3(1,0,0);this.unitY=new THREE.Vector3(0,1,0);this.unitZ=new THREE.Vector3(0,0,1);this.normal=new THREE.Vector3(0,0,1);if("transrotate"===c){var g=new THREE.Geometry;g.vertices.push(new THREE.Vector3(0,
0,0),new THREE.Vector3(0,0,1));var q=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(g,q);g=new THREE.Geometry;q=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});g.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.endLine=new THREE.Line(g,q);g=new THREE.Geometry;q=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});g.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0));this.centerLine=
new THREE.Line(g,q);q=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));q.magFilter=q.minFilter=THREE.NearestFilter;g=new THREE.CircleGeometry(.1,32);q=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:q});this.centerMark=new THREE.Mesh(g,q);this.centerMark.rotation.set(Math.PI/2,0,0);this.ticks={};q=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));q.magFilter=
q.minFilter=THREE.NearestFilter;q=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:q});this.ticks.RX=new THREE.Object3D;g=new THREE.PlaneBufferGeometry(.12,.25);g=new THREE.Mesh(g,q);g.position.set(0,0,-1.275);g.rotation.set(Math.PI/2,Math.PI/2,0);this.ticks.RX.add(g);g=g.clone();g.position.set(0,1.275,0);g.rotation.set(0,Math.PI/2,0);this.ticks.RX.add(g);g=g.clone();g.position.set(0,0,1.275);g.rotation.set(0,Math.PI/2,Math.PI/2);this.ticks.RX.add(g);g=
g.clone();g.position.set(0,-1.275,0);g.rotation.set(0,Math.PI/2,0);this.ticks.RX.add(g);this.ticks.RY=new THREE.Object3D;g=g.clone();g.position.set(0,0,-1.275);g.rotation.set(Math.PI/2,0,0);this.ticks.RY.add(g);g=g.clone();g.position.set(-1.275,0,0);g.rotation.set(Math.PI/2,0,Math.PI/2);this.ticks.RY.add(g);g=g.clone();g.position.set(0,0,1.275);g.rotation.set(Math.PI/2,0,0);this.ticks.RY.add(g);g=g.clone();g.position.set(1.275,0,0);g.rotation.set(Math.PI/2,0,Math.PI/2);this.ticks.RY.add(g)}var l=
this,p=!1,r=c,A={type:"change"},C={type:"mouseDown"},H={type:"mouseUp",mode:r},z={type:"objectChange"},t=new THREE.Raycaster,w=new THREE.Vector3,E=new THREE.Vector3,B=new THREE.Vector3,D=new THREE.Vector3,J=new THREE.Vector3,F=new THREE.Vector3,G=1,M=new THREE.Matrix4,I=new THREE.Vector3,L=new THREE.Matrix4,K=new THREE.Vector3,O=new THREE.Quaternion,R=new THREE.Vector3,X=new THREE.Vector3,W=new THREE.Vector3,aa=new THREE.Quaternion,fa=new THREE.Quaternion,U=new THREE.Quaternion,P=new THREE.Quaternion,
Z=new THREE.Quaternion,S=new THREE.Vector3,N=new THREE.Vector3,ia=new THREE.Matrix4,ea=new THREE.Matrix4,V=new THREE.Vector3,ca=new THREE.Vector3,Y=new THREE.Euler,sa=new THREE.Matrix4,ha=new THREE.Vector3;new THREE.Euler;this.attach=function(a){l.object=a;this.gizmo[r].show();l.update();l.updateUnitVectors()};this.detach=function(a){l.object=void 0;this.axis=null;this.gizmo[r].hide()};this.setMode=function(a){r=a?a:r;"scale"==r&&(l.space="local");this.gizmo[r].show();this.update();l.dispatchEvent(A)};
this.getPicker=function(){return l.gizmo[r].hemiPicker.children};this.setPosition=function(a){this.object.position.copy(a);this.update()};this.setNormal=function(a){O.setFromUnitVectors(this.normal,a);this.unitX.applyQuaternion(O);this.unitY.applyQuaternion(O);this.unitZ.applyQuaternion(O);this.normal.copy(a);this.object&&this.object.quaternion.multiply(O);this.update()};this.setSnap=function(a,b){l.snap=a;l.snapDelta=b};this.setSize=function(a){l.size=a;this.update();l.dispatchEvent(A)};this.setSpace=
function(a){l.space=a;this.update();l.dispatchEvent(A)};this.update=function(c){if(void 0!==l.object){l.object.updateMatrixWorld();ca.setFromMatrixPosition(l.object.matrixWorld);Y.setFromRotationMatrix(L.extractRotation(l.object.matrixWorld));a.updateMatrixWorld();ha.setFromMatrixPosition(a.matrixWorld);this.position.copy(ca);this.quaternion.setFromEuler(Y);this.normal.set(0,0,1);this.normal.applyEuler(Y);var f=ca.distanceTo(ha),f=2*Math.tan(a.fov*Math.PI/180/2)*f,g=b.getBoundingClientRect();G=100*
f/g.height;this.scale.set(G,G,G);c&&this.gizmo[r].highlight(l.axis)}};this.updateUnitVectors=function(){this.unitX.set(1,0,0);this.unitY.set(0,1,0);this.unitZ.set(0,0,1);this.unitX.applyEuler(Y);this.unitY.applyEuler(Y);this.unitZ.applyEuler(Y)};this.showRotationGizmos=function(a){for(var b=this.gizmo[r].handles.children,c=0;c<b.length;c++){var d=b[c];d.visible=!0;-1!==d.name.search("R")&&(d.visible=a)}this.useAllPickers=a};this.onPointerHover=function(a){if(void 0===l.object||!0===p)return!1;a=f(a.pointers?
a.pointers[0]:a,l.useAllPickers?l.gizmo[r].pickers.children:l.gizmo[r].subPickers.children);var b=null,c="";a&&(b=a.object.name,c=-1!=b.search("R")?"rotate":"translate");l.axis!==b&&(l.axis=b,l.gizmo[r].activeMode=c,l.update(!0),l.dispatchEvent(A));null===l.axis&&l.gizmo[r].show();return a?!0:!1};this.onPointerDown=function(b){if(void 0===l.object||!0===p)return!1;var c=b.pointers?b.pointers[0]:b;if("touch"===b.pointerType){b=f(c,l.useAllPickers?l.gizmo[r].pickers.children:l.gizmo[r].subPickers.children);
var g=null,h="";b&&(g=b.object.name,h=-1!=g.search("R")?"rotate":"translate");l.axis!==g&&(l.axis=g,l.gizmo[r].activeMode=h)}b=null;if(0===c.button||void 0===c.button)if(b=f(c,l.useAllPickers?l.gizmo[r].pickers.children:l.gizmo[r].subPickers.children))if(l.dispatchEvent(C),l.axis=b.object.name,l.update(),I.copy(a.position).sub(ca).normalize(),l.gizmo[r].setActivePlane(l.axis,I),(c=f(c,[l.gizmo[r].activePlane]))&&D.copy(c.point),S.copy(l.object.position),N.copy(l.object.scale),ia.extractRotation(l.object.matrix),
sa.extractRotation(l.object.matrixWorld),l.object.parent?(ea.extractRotation(l.object.parent.matrixWorld),V.setFromMatrixScale(L.getInverse(l.object.parent.matrixWorld))):(ea.extractRotation(l.object.matrixWorld),V.setFromMatrixScale(L.getInverse(l.object.matrixWorld))),"transrotate"===r&&"rotate"===l.gizmo[r].activeMode){l.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(l.matrixWorld);l.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(l.matrixWorld);l.startLine.geometry.verticesNeedUpdate=
!0;l.parent.add(l.startLine);var k=l.object.geometry.getAttribute("position"),c=(new THREE.Vector3).fromAttribute(k,0).applyMatrix4(l.object.matrixWorld),g=(new THREE.Vector3).fromAttribute(k,1).applyMatrix4(l.object.matrixWorld),h=(new THREE.Vector3).fromAttribute(k,2).applyMatrix4(l.object.matrixWorld),k=(new THREE.Vector3).fromAttribute(k,3).applyMatrix4(l.object.matrixWorld);"RX"===l.axis?(c.lerp(h,.5),g.lerp(k,.5),k=c.distanceTo(g),l.centerLine.material.dashSize=k/15,l.centerLine.material.gapSize=
k/30,l.centerLine.geometry.vertices[0].copy(c),l.centerLine.geometry.vertices[1].copy(g)):(c.lerp(g,.5),h.lerp(k,.5),k=c.distanceTo(h),l.centerLine.material.dashSize=k/15,l.centerLine.material.gapSize=k/30,l.centerLine.geometry.vertices[0].copy(c),l.centerLine.geometry.vertices[1].copy(h));l.centerLine.geometry.computeLineDistances();l.centerLine.geometry.verticesNeedUpdate=!0;l.parent.add(l.centerLine);l.ticks[l.axis].position.copy(l.position);l.ticks[l.axis].quaternion.copy(l.quaternion);l.ticks[l.axis].scale.copy(l.scale);
l.parent.add(l.ticks[l.axis])}p=!0;return b?!0:!1};this.onPointerMove=function(a){if(void 0===l.object||null===l.axis||!1===p)return!1;(a=f(a.pointers?a.pointers[0]:a,[l.gizmo[r].activePlane]))&&B.copy(a.point);var b=l.gizmo[r].activeMode;if("translate"==b){if(B.sub(D),B.multiply(V),"local"==l.space&&(B.applyMatrix4(L.getInverse(sa)),R.copy(this.unitX),X.copy(this.unitY),W.copy(this.unitZ),K.set(0,0,0),-1!=l.axis.search("X")&&(R.multiplyScalar(B.dot(this.unitX)),K.add(R)),-1!=l.axis.search("Y")&&
(X.multiplyScalar(B.dot(this.unitY)),K.add(X)),-1!=l.axis.search("Z")&&(W.multiplyScalar(B.dot(this.unitZ)),K.add(W)),B.copy(K),B.applyMatrix4(ia),l.object.position.copy(S),l.object.position.add(B)),"world"==l.space||-1!=l.axis.search("XYZ"))R.copy(this.unitX),X.copy(this.unitY),W.copy(this.unitZ),K.set(0,0,0),-1!=l.axis.search("X")&&(R.multiplyScalar(B.dot(this.unitX)),K.add(R)),-1!=l.axis.search("Y")&&(X.multiplyScalar(B.dot(this.unitY)),K.add(X)),-1!=l.axis.search("Z")&&(W.multiplyScalar(B.dot(this.unitZ)),
K.add(W)),B.copy(K),B.applyMatrix4(L.getInverse(ea)),l.object.position.copy(S),l.object.position.add(B)}else if("scale"==b)B.sub(D),B.multiply(V),"local"==l.space&&("XYZ"==l.axis?(G=1+B.y/50,l.object.scale.x=N.x*G,l.object.scale.y=N.y*G,l.object.scale.z=N.z*G):(B.applyMatrix4(L.getInverse(sa)),"X"==l.axis&&(l.object.scale.x=N.x*(1+B.x/50)),"Y"==l.axis&&(l.object.scale.y=N.y*(1+B.y/50)),"Z"==l.axis&&(l.object.scale.z=N.z*(1+B.z/50))));else if("rotate"==b){B.sub(ca);B.multiply(V);K.copy(D).sub(ca);
K.multiply(V);if("RE"==l.axis){B.applyMatrix4(L.getInverse(M));K.applyMatrix4(L.getInverse(M));J.set(Math.atan2(B.z,B.y),Math.atan2(B.x,B.z),Math.atan2(B.y,B.x));F.set(Math.atan2(K.z,K.y),Math.atan2(K.x,K.z),Math.atan2(K.y,K.x));O.setFromRotationMatrix(L.getInverse(ea));var c=J.z-F.z;null!==l.snap&&(b=Math.round(c/l.snap)*l.snap,Math.abs(b-c)<l.snapDelta&&(c=b));Z.setFromAxisAngle(I,c);aa.setFromRotationMatrix(sa);O.multiplyQuaternions(O,Z);O.multiplyQuaternions(O,aa);l.object.quaternion.copy(O)}else if("RXYZE"==
l.axis){c=B.clone().cross(K).normalize();O.setFromRotationMatrix(L.getInverse(ea));var d=-B.clone().angleTo(K);null!==l.snap&&(b=Math.round(d/l.snap)*l.snap,Math.abs(b-d)<l.snapDelta&&(d=b));fa.setFromAxisAngle(c,d);aa.setFromRotationMatrix(sa);O.multiplyQuaternions(O,fa);O.multiplyQuaternions(O,aa);l.object.quaternion.copy(O)}else if("local"==l.space){B.applyMatrix4(L.getInverse(sa));K.applyMatrix4(L.getInverse(sa));var b=B.dot(this.unitX),c=B.dot(this.unitY),d=B.dot(this.unitZ),g=K.dot(this.unitX),
h=K.dot(this.unitY),k=K.dot(this.unitZ);J.set(Math.atan2(d,c),Math.atan2(b,d),Math.atan2(c,b));F.set(Math.atan2(k,h),Math.atan2(g,k),Math.atan2(h,g));d=J.x-F.x;g=J.y-F.y;c=J.z-F.z;null!==l.snap&&(-1!=l.axis.search("X")&&(b=Math.round(d/l.snap)*l.snap,Math.abs(b-d)<l.snapDelta&&(d=b)),-1!=l.axis.search("Y")&&(b=Math.round(g/l.snap)*l.snap,Math.abs(b-g)<l.snapDelta&&(g=b)),-1!=l.axis.search("Z")&&(b=Math.round(c/l.snap)*l.snap,Math.abs(b-c)<l.snapDelta&&(c=b)));fa.setFromAxisAngle(this.unitX,d);U.setFromAxisAngle(this.unitY,
g);P.setFromAxisAngle(this.unitZ,c);aa.setFromRotationMatrix(ia);"RX"==l.axis&&aa.multiplyQuaternions(aa,fa);"RY"==l.axis&&aa.multiplyQuaternions(aa,U);"RZ"==l.axis&&aa.multiplyQuaternions(aa,P);l.object.quaternion.copy(aa)}else"world"==l.space&&(b=B.dot(this.unitX),c=B.dot(this.unitY),d=B.dot(this.unitZ),g=K.dot(this.unitX),h=K.dot(this.unitY),k=K.dot(this.unitZ),J.set(Math.atan2(d,c),Math.atan2(b,d),Math.atan2(c,b)),F.set(Math.atan2(k,h),Math.atan2(g,k),Math.atan2(h,g)),O.setFromRotationMatrix(L.getInverse(ea)),
d=J.x-F.x,g=J.y-F.y,c=J.z-F.z,null!==l.snap&&(-1!=l.axis.search("X")&&(b=Math.round(d/l.snap)*l.snap,Math.abs(b-d)<l.snapDelta&&(d=b)),-1!=l.axis.search("Y")&&(b=Math.round(g/l.snap)*l.snap,Math.abs(b-g)<l.snapDelta&&(g=b)),-1!=l.axis.search("Z")&&(b=Math.round(c/l.snap)*l.snap,Math.abs(b-c)<l.snapDelta&&(c=b))),fa.setFromAxisAngle(this.unitX,d),U.setFromAxisAngle(this.unitY,g),P.setFromAxisAngle(this.unitZ,c),aa.setFromRotationMatrix(sa),"RX"==l.axis&&O.multiplyQuaternions(O,fa),"RY"==l.axis&&O.multiplyQuaternions(O,
U),"RZ"==l.axis&&O.multiplyQuaternions(O,P),O.multiplyQuaternions(O,aa),l.object.quaternion.copy(O));"transrotate"===r&&(l.add(l.endLine),l.add(l.centerMark))}l.object.matrixAutoUpdate=!0;l.update(!0);l.dispatchEvent(A);l.dispatchEvent(z);return a?!0:!1};this.onPointerUp=function(a){p&&null!==l.axis&&(H.mode=r,l.dispatchEvent(H));p=!1;this.gizmo[r].show();this.updateUnitVectors();"transrotate"===r&&"rotate"===this.gizmo[r].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),
this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis]));return!1}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}
(function(a,b){var c=a.document;"undefined"===typeof a.alertify&&(a.alertify=new function(){var f={},g=!1,d=[],h,k,m,n,q,l,p,r,A,C,H,z;z=function(){var a,d,f=!1,g=c.createElement("fakeelement"),h={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(a in h)if(g.style[a]!==b){d=h[a];f=!0;break}return{type:d,supported:f}};h=function(a){return c.getElementById(a)};f={labels:{ok:"OK",cancel:"Cancel"},delay:5E3,buttonReverse:!1,
buttonFocus:"ok",transition:b,addListeners:function(a){var b="undefined"!==typeof m,d="undefined"!==typeof k,f="undefined"!==typeof H,g="",h=this,l,p,r,z,A;l=function(b){"undefined"!==typeof b.preventDefault&&b.preventDefault();r(b);"undefined"!==typeof H&&(g=H.value);"function"===typeof a&&("undefined"!==typeof H?a(!0,g):a(!0));return!1};p=function(b){"undefined"!==typeof b.preventDefault&&b.preventDefault();r(b);"function"===typeof a&&a(!1);return!1};r=function(a){h.hide();h.unbind(c.body,"keyup",
z);h.unbind(n,"focus",A);b&&h.unbind(m,"click",l);d&&h.unbind(k,"click",p)};z=function(a){var b=a.keyCode;(32===b&&!f||f&&13===b)&&l(a);27===b&&d&&p(a)};A=function(a){f?H.focus():!d||h.buttonReverse?m.focus():k.focus()};this.bind(n,"focus",A);this.bind(q,"focus",A);b&&this.bind(m,"click",l);d&&this.bind(k,"click",p);this.bind(c.body,"keyup",z);this.transition.supported||this.setFocus()},bind:function(a,b,c){"function"===typeof a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+
b,c)},handleErrors:function(){if("undefined"!==typeof a.onerror){var b=this;a.onerror=function(a,c,d){b.error("["+a+" on line "+d+" of "+c+"]",0)};return!0}return!1},appendButtons:function(a,b){return this.buttonReverse?b+a:a+b},build:function(a){var b=a.type,c=a.message,d=a.cssClass||"";a='<div class="alertify-dialog"><a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>';"none"===f.buttonFocus&&(a+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>');
"prompt"===b&&(a+='<div id="alertify-form">');a+='<article class="alertify-inner">';a+='<p class="alertify-message">{{message}}</p>'.replace("{{message}}",c);"prompt"===b&&(a+='<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>');a+='<nav class="alertify-buttons">{{buttons}}</nav>';a+="</article>";"prompt"===b&&(a+="</div>");a+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>';a+="</div>";switch(b){case "confirm":a=
a.replace("{{buttons}}",this.appendButtons('<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>','<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>'));a=a.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case "prompt":a=a.replace("{{buttons}}",this.appendButtons('<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>','<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>'));
a=a.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case "alert":a=a.replace("{{buttons}}",'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>'),a=a.replace("{{ok}}",this.labels.ok)}A.className="alertify alertify-"+b+" "+d;r.className="alertify-cover";return a},close:function(a,b){var c=b&&!isNaN(b)?+b:this.delay,d=this,f,g;this.bind(a,"click",function(){f(a)});g=function(a){a.stopPropagation();d.unbind(this,d.transition.type,g);C.removeChild(this);
C.hasChildNodes()||(C.className+=" alertify-logs-hidden")};f=function(a){"undefined"!==typeof a&&a.parentNode===C&&(d.transition.supported?(d.bind(a,d.transition.type,g),a.className+=" alertify-log-hide"):(C.removeChild(a),C.hasChildNodes()||(C.className+=" alertify-logs-hidden")))};0!==b&&setTimeout(function(){f(a)},c)},dialog:function(a,b,f,h,k){p=c.activeElement;var l=function(){C&&null!==C.scrollTop&&r&&null!==r.scrollTop||l()};if("string"!==typeof a)throw Error("message must be a string");if("string"!==
typeof b)throw Error("type must be a string");if("undefined"!==typeof f&&"function"!==typeof f)throw Error("fn must be a function");this.init();l();d.push({type:b,message:a,callback:f,placeholder:h,cssClass:k});g||this.setup();return this},extend:function(a){if("string"!==typeof a)throw Error("extend method must have exactly one paramter");return function(b,c){this.log(b,a,c);return this}},hide:function(){var a,b=this;d.splice(0,1);0<d.length?this.setup(!0):(g=!1,a=function(c){c.stopPropagation();
b.unbind(A,b.transition.type,a)},this.transition.supported?(this.bind(A,this.transition.type,a),A.className="alertify alertify-hide alertify-hidden"):A.className="alertify alertify-hide alertify-hidden alertify-isHidden",r.className="alertify-cover alertify-cover-hidden",p.focus())},init:function(){c.createElement("nav");c.createElement("article");c.createElement("section");null==h("alertify-cover")&&(r=c.createElement("div"),r.setAttribute("id","alertify-cover"),r.className="alertify-cover alertify-cover-hidden",
c.body.appendChild(r));null==h("alertify")&&(g=!1,d=[],A=c.createElement("section"),A.setAttribute("id","alertify"),A.setAttribute("style","z-index : 999999999"),A.className="alertify alertify-hidden",c.body.appendChild(A));null==h("alertify-logs")&&(C=c.createElement("section"),C.setAttribute("id","alertify-logs"),C.className="alertify-logs alertify-logs-hidden",c.body.appendChild(C));c.body.setAttribute("tabindex","0");this.transition=z()},log:function(a,b,c){var d=function(){C&&null!==C.scrollTop||
d()};this.init();d();C.className="alertify-logs";this.notify(a,b,c);return this},notify:function(a,b,d){var f=c.createElement("article");f.className="alertify-log"+("string"===typeof b&&""!==b?" alertify-log-"+b:"");f.innerHTML=a;C.appendChild(f);setTimeout(function(){f.className+=" alertify-log-show"},50);this.close(f,d)},set:function(a){var b;if("object"!==typeof a&&a instanceof Array)throw Error("args must be an object");for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},setFocus:function(){H?(H.focus(),
H.select()):l.focus()},setup:function(a){var c=d[0],p=this,r;g=!0;r=function(a){a.stopPropagation();p.setFocus();p.unbind(A,p.transition.type,r)};this.transition.supported&&!a&&this.bind(A,this.transition.type,r);A.innerHTML=this.build(c);n=h("alertify-resetFocus");q=h("alertify-resetFocusBack");m=h("alertify-ok")||b;k=h("alertify-cancel")||b;l="cancel"===f.buttonFocus?k:"none"===f.buttonFocus?h("alertify-noneFocus"):m;H=h("alertify-text")||b;h("alertify-form");"string"===typeof c.placeholder&&""!==
c.placeholder&&(H.value=c.placeholder);a&&this.setFocus();this.addListeners(c.callback)},unbind:function(a,b,c){"function"===typeof a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}};return{alert:function(a,b,c){f.dialog(a,"alert",b,"",c);return this},confirm:function(a,b,c){f.dialog(a,"confirm",b,"",c);return this},extend:f.extend,init:f.init,log:function(a,b,c){f.log(a,b,c);return this},prompt:function(a,b,c,d){f.dialog(a,"prompt",b,c,d);return this},success:function(a,
b){f.log(a,"success",b);return this},error:function(a,b){f.log(a,"error",b);return this},set:function(a){f.set(a)},hide:function(a){f.hide(a)},labels:f.labels,debug:f.handleErrors}})})(this);AutodeskNamespace("Autodesk.Viewing");AutodeskNamespace("Autodesk.Viewing.Private");var auth=null,VIEWING_URL,ACM_SESSION_URL,OSS_URL,PROTEIN_ROOT=null,PRISM_ROOT=null,LOCALIZATION_REL_PATH="",LMV_VIEWER_VERSION="1.2.16",LMV_RESOURCE_VERSION=null,LMV_RESOURCE_ROOT="";
function stderr(){ENABLE_TRACE&&console.log.apply(console,arguments)}
(function(){var a=Autodesk.Viewing.Private;a.env=null;a.logger=null;a.refreshToken=null;a.docItemId=null;a.token={getAccessToken:null,tokenRefreshInterval:null};a.memoryOptimizedLoading=!0;a.GPU_MEMORY_LIMIT=268435456;a.GPU_OBJECT_LIMIT=1E4;a.FRAGS_PERSISTENT_COUNT=1E4;a.FRAGS_PERSISTENT_MAX_COUNT=8E5;a.onDemandLoading=!1;a.cullGeometryOnLoading=a.onDemandLoading;a.pageOutGeometryEnabled=a.onDemandLoading;a.PAGEOUT_SUCCESS=0;a.PAGEOUT_FAIL=1;a.PAGEOUT_NONE=2;a.GEOMS_COUNT_LIMIT=3E5;a.PAGEOUT_PERCENTAGE=
.35;a.GEOMS_PAGEOUT_COUNT=a.GEOMS_COUNT_LIMIT*a.PAGEOUT_PERCENTAGE;a.assets=[];a.offline=!1;a.offlineResourcePrefix=null;var b={local:{LOGGING:"rtc-dev.api.autodesk.com",RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{LOGGING:"rtc-dev.api.autodesk.com",RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{LOGGING:"rtc-stg.api.autodesk.com",RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{LOGGING:"rtc.api.autodesk.com",
RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},c={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},f={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"};a.EnvironmentConfigurations={Local:{VIEWING:"",ACM:"",OSS:"",LMV:b.local},Development:{VIEWING:c.dev+"/viewingservice/v1",ACM:f.dev+"/oss-ext/v1/acmsessions",
OSS:f.dev+"/oss/v1",LMV:b.dev},Staging:{VIEWING:c.stg+"/viewingservice/v1",ACM:f.stg+"/oss-ext/v1/acmsessions",OSS:f.stg+"/oss/v1",LMV:b.stg},Production:{VIEWING:c.prod+"/viewingservice/v1",ACM:f.prod+"/oss-ext/v1/acmsessions",OSS:f.prod+"/oss/v1",LMV:b.prod},AutodeskDevelopment:{VIEWING:f.dev+"/viewingservice/v1",ACM:f.dev+"/oss-ext/v1/acmsessions",OSS:f.dev+"/oss/v1",LMV:b.dev},AutodeskStaging:{VIEWING:f.stg+"/viewingservice/v1",ACM:f.stg+"/oss-ext/v1/acmsessions",OSS:f.stg+"/oss/v1",LMV:b.stg},
AutodeskProduction:{VIEWING:f.prod+"/viewingservice/v1",ACM:f.prod+"/oss-ext/v1/acmsessions",OSS:f.prod+"/oss/v1",LMV:b.prod},DevelopmentV2:{VIEWING:c.dev+"/derivativeservice/v2",ACM:f.dev+"/oss-ext/v1/acmsessions",OSS:f.dev+"/oss/v1",LMV:b.dev},StagingV2:{VIEWING:c.stg+"/derivativeservice/v2",ACM:f.stg+"/oss-ext/v1/acmsessions",OSS:f.stg+"/oss/v1",LMV:b.stg},ProductionV2:{VIEWING:c.prod+"/derivativeservice/v2",ACM:f.prod+"/oss-ext/v1/acmsessions",OSS:f.prod+"/oss/v1",LMV:b.prod},AutodeskDevelopmentV2:{VIEWING:f.dev+
"/derivativeservice/v2",ACM:f.dev+"/oss-ext/v1/acmsessions",OSS:f.dev+"/oss/v1",LMV:b.dev},AutodeskStagingV2:{VIEWING:f.stg+"/derivativeservice/v2",ACM:f.stg+"/oss-ext/v1/acmsessions",OSS:f.stg+"/oss/v1",LMV:b.stg},AutodeskProductionV2:{VIEWING:f.prod+"/derivativeservice/v2",ACM:f.prod+"/oss-ext/v1/acmsessions",OSS:f.prod+"/oss/v1",LMV:b.prod}};a.initializeEnvironmentVariable=function(b){var c;b&&b.env&&(c=b.env);c||(c=a.getParameterByName("env"));b&&b.offlineResourcePrefix&&(a.offlineResourcePrefix=
b.offlineResourcePrefix);b&&b.offline&&"true"===b.offline&&(a.offline=!0);if(!c)switch(window.location.hostname){case "viewing-dev.api.autodesk.com":c="Development";break;case "viewing-staging.api.autodesk.com":c="Staging";break;case "viewing.api.autodesk.com":c="Production";break;case "developer-dev.api.autodesk.com":c="AutodeskDevelopment";break;case "developer-stg.api.autodesk.com":c="AutodeskStaging";break;case "developer.api.autodesk.com":c="AutodeskProduction";break;case "localhost.autodesk.com":c=
"Local";break;case "":c="Local";break;case "127.0.0.1":c="Local";break;default:c="AutodeskProduction"}console.log("Host name : "+window.location.hostname);console.log("Environment initialized as : "+c);a.env=c};a.initializeServiceEndPoints=function(b){var c=a.EnvironmentConfigurations[a.env];VIEWING_URL=c.VIEWING;ACM_SESSION_URL=c.ACM;OSS_URL=c.OSS;c=[];b&&b.hasOwnProperty("libraryName")&&c.push(b.libraryName);c.push("viewer3D.min.js");c.push("viewer3D.js");var f,k;for(b=0;b<c.length;b++){k=(k=a.getScript(c[b]))?
k.src:"";var m=k.indexOf(c[b]);if(0<=m){f=k.substr(0,m);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;(c=a.getParameterByNameFromPath("v",k))&&c.length&&c!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+c+" vs. "+LMV_RESOURCE_VERSION+". Using "+c),LMV_RESOURCE_VERSION=c):c&&c.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION));LMV_RESOURCE_ROOT=f||LMV_RESOURCE_ROOT};a.refreshCookie=
function(b,c,f){var k=new XMLHttpRequest;k.onload=c;k.onerror=f;k.ontimeout=f;0===a.env.indexOf("Autodesk")?(c=VIEWING_URL.substring(0,VIEWING_URL.indexOf("/viewingservice")),k.open("POST",c+"/utility/v1/settoken",!0),k.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),k.withCredentials=!0,k.send("access-token="+b),_isIE11&&(a.accessToken=b)):(b={oauth:{token:b}},k.open("POST",VIEWING_URL+"/token",!0),k.setRequestHeader("Content-Type","application/json"),k.withCredentials=!0,k.send(JSON.stringify(b)))};
a.initializeAuth=function(b,c){var f=c?c.shouldInitializeAuth:null;f||(f=a.getParameterByName("auth"));if("Local"==a.env&&!f)return setTimeout(b,0),auth=!1;auth=!0;var k;if(c&&c.accessToken)k=c.accessToken,a.refreshCookie(k,b);else if(c&&c.getAccessToken){var m=function(f,h){k=f;a.refreshCookie(k,a.token.tokenRefreshInterval?null:b);var l=h-60;0>=l&&(l=h);a.token.tokenRefreshInterval=1E3*l;setTimeout(function(){c.getAccessToken(m)},a.token.tokenRefreshInterval)};a.token.getAccessToken=c.getAccessToken;
k=c.getAccessToken(m);"string"==typeof k&&k&&a.refreshCookie(k,b)}else k=a.getParameterByName("accessToken"),k||(k="QYNrnn1T44Jy3wWMKJaT6RHmMgg=",console.log("Warning : no access token is provided. Use built in token : "+k)),a.refreshCookie(k,b);return auth};a.refreshTokenAndCookie=function(b,c){var f=null;a.refreshToken&&(f=a.refreshToken());f?a.refreshCookie(f,b,c):c&&c(null)};a.initializeLogger=function(b){a.logger=new a.Logger({endpoint:a.EnvironmentConfigurations[a.env].LMV.LOGGING,eventCallback:b?
b.eventCallback:void 0})};a.initializeProtein=function(){if((!ENABLE_DEBUG||"Local"!=a.env||auth)&&!a.offline){var b=new XMLHttpRequest;b.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0);b.responseType="json";b.onload=function(a){(a=b.response.url)&&a.length&&(a=a.replace("http://","https://"),PROTEIN_ROOT=a+"/",stderr("Protein root is: "+PROTEIN_ROOT))};b.send();var c=new XMLHttpRequest;c.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",
!0);c.responseType="json";c.onload=function(a){(a=c.response.url)&&a.length&&(a=a.replace("http://","https://"),PRISM_ROOT=a+"/",stderr("Prism root is: "+PRISM_ROOT))};c.send()}};a.getAuthObject=function(){return auth};a.getParameterByName=function(b){return a.getParameterByNameFromPath(b,window.location.href)};a.getParameterByNameFromPath=function(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(b);return null==c?"":decodeURIComponent(c[1].replace(/\+/g,
" "))};a.getDemoDocumentURN=function(){var b;switch(a.env){case "Development":b="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";break;case "Staging":b="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case "Production":b="FIXME";break;default:b="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return b};a.setLanguage=function(a,b){var c=
{lng:a,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+a+"/";Autodesk.Viewing.i18n.init(c,function(a){Autodesk.Viewing.i18n.localize();b&&b()})};a.initializeLocalization=function(){navigator.language.split("-");a.setLanguage("en")};a.initializeUserInfo=function(b){b&&b.userInfo&&(a.setUserName(b.userInfo.name),b.comment2Token&&(a.comment2Token=b.comment2Token))};a.getScript=function(a){a=
a.toLowerCase();var b=document.getElementsByTagName("SCRIPT");if(b&&0<b.length)for(var c=0;c<b.length;++c)if(b[c].src&&-1!==b[c].src.toLowerCase().indexOf(a))return b[c];return null};a.getResourceUrl=function(a){var b=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+a+(b?"?v="+b:"")};a.loadDependency=function(b,c,f){"undefined"==typeof window[b]?(b=document.createElement("SCRIPT"),b.src=a.getResourceUrl(c),document.head.appendChild(b),f&&(b.onload=f)):f&&f()};Autodesk.Viewing.Initializer=function(b,
c){a.WEBGL_HELP_LINK=b?b.webGLHelpLink:null;a.initializeEnvironmentVariable(b);a.initializeServiceEndPoints(b);a.initializeProtein();a.initWorkerScript();a.loadDependency("THREE","three.min.js",function(){THREE.warn=function(){stderr.apply(stderr,arguments)};init_three_dds_loader();a.initializeLogger(b);a.initializeAuth(c,b);a.initializeLocalization();a.initializeUserInfo(b)})}})();
